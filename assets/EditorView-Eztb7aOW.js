import{u as V,a as Y,b as X,r as s,s as D,j as e,g as I,V as k}from"./index.prod-N1l0zQze.js";import{e as $}from"./gemini-gv7zKzrE.js";const C="unsaved-title",P="unsaved-text";function W(){const{state:h,dispatch:l}=V(),{state:F}=Y(),{showAlert:L}=X(),[d,u]=s.useState(""),[i,x]=s.useState(""),[m,z]=s.useState(!1),[o,T]=s.useState(""),[g,v]=s.useState(!1),[j,p]=s.useState(null),[r,f]=s.useState("manual"),b=!!F.userApiKey,a=h.editingEntryId?h.history.find(t=>t.id===h.editingEntryId):null;s.useEffect(()=>{(async()=>{if(a)u(a.title),x(a.text),f("manual");else{const y=await I(C)||"",n=await I(P)||"";u(y),x(n)}z(!0)})()},[a]),s.useEffect(()=>{m&&!a&&D(C,d)},[d,a,m]),s.useEffect(()=>{m&&!a&&D(P,i)},[i,a,m]);const N=async()=>{if(p(null),!o){p("Please enter a URL.");return}try{new URL(o)}catch{p("Invalid URL format.");return}v(!0);try{const t=await $(o);u(t.title),x(t.japanese_text),T(""),f("manual")}catch(t){p(t.message)}finally{v(!1)}},K=()=>{if(!b){L("API Key is not configured. Please add your key in the settings menu.");return}const t=i.trim();if(!t)return;const y=d.trim()||t.substring(0,40)+"...";if(a){const n=a.analyzedSentences,A={};t.split(`
`).flatMap(c=>{var U;return((U=c.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:U.filter(E=>E==null?void 0:E.trim()))||[]}).forEach(c=>{n[c]&&(A[c]=n[c])});const R={...a,title:y,text:t,updatedAt:Date.now(),analyzedSentences:A,readingProgress:0};l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:R}),l({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:R.id}),l({type:"SET_VIEW",payload:k.Reader})}else{const n={id:Date.now().toString(),title:y,text:t,createdAt:Date.now(),updatedAt:Date.now(),analyzedSentences:{},readingProgress:0};l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:n}),l({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:n.id}),l({type:"SET_VIEW",payload:k.Reader})}},w="px-4 py-3 text-sm font-medium transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-focus-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background rounded-t-lg",S="border-b-2 border-primary text-primary",_="text-text-muted hover:text-text-primary hover:bg-surface-hover";return e.jsx("div",{className:"h-screen md:h-auto input-area p-6 bg-gradient-to-b from-background/50 to-surface overflow-y-auto no-scrollbar flex flex-col",children:e.jsxs("div",{className:"space-y-6 flex-grow flex flex-col",children:[e.jsx("div",{className:"border-b border-border-subtle flex-shrink-0",children:e.jsxs("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>f("manual"),className:`${w} ${r==="manual"?S:_}`,"aria-current":r==="manual"?"page":void 0,children:"Manual Input"}),e.jsx("button",{onClick:()=>f("url"),className:`${w} ${r==="url"?S:_}`,"aria-current":r==="url"?"page":void 0,children:"Import from URL"})]})}),e.jsxs("div",{className:"flex-grow min-h-0 py-2",children:[r==="manual"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"text-title-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Title"}),e.jsx("input",{type:"text",id:"text-title-input",placeholder:"Enter a title for your text...",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-lg font-medium px-4 py-3",value:d,onChange:t=>u(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sentence-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Japanese Text"}),e.jsx("textarea",{id:"sentence-input",placeholder:"Enter Japanese text here. e.g., 猫が大好きです。犬も好きです。",rows:8,className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3 font-japanese resize-y transition-all duration-200",value:i,onChange:t=>x(t.target.value)})]})]}),r==="url"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsx("label",{htmlFor:"url-input",className:"block text-sm font-medium text-text-secondary",children:"Paste article URL"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"url",id:"url-input",placeholder:"https://example.com/japanese-article",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3",value:o,onChange:t=>T(t.target.value),onKeyDown:t=>t.key==="Enter"&&N(),disabled:g}),e.jsx("button",{onClick:N,disabled:g||!o.trim(),className:"px-4 py-3 rounded-xl bg-accent text-primary-text font-medium hover:bg-accent/90 transition-colors shadow-sm focus-ring disabled:opacity-60 disabled:cursor-not-allowed flex-shrink-0",title:"Fetch content from URL",children:g?e.jsx("i",{className:"bi bi-arrow-repeat text-xl animate-spin"}):e.jsx("i",{className:"bi bi-cloud-arrow-down text-xl"})})]}),j&&e.jsxs("p",{className:"text-sm text-destructive mt-1.5 px-2",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill mr-1 align-middle"}),j]})]})]}),e.jsxs("div",{className:"mt-auto flex-shrink-0 pt-4",children:[e.jsxs("button",{onClick:K,className:"w-full btn-primary text-lg flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!i.trim()||!b,title:b?"":"API Key not configured. Please add one in settings.",children:[e.jsx("i",{className:"bi bi-search"}),"Analyze Text"]}),!b&&e.jsxs("p",{className:"text-center text-sm text-warning-text mt-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill mr-1 align-middle"}),"Please set your API key in settings to enable analysis."]})]})]})})}export{W as default};
