import{u as Y,a as X,b as M,r as s,s as k,j as e,g as C,V as P}from"./index.prod-D7g2wUrF.js";import{u as O}from"./gemini-Dnbr_uT3.js";const L="unsaved-title",z="unsaved-text";function B(){const{state:i,dispatch:n}=Y(),{state:F}=X(),{showAlert:m}=M(),[p,f]=s.useState(""),[d,b]=s.useState(""),[y,K]=s.useState(!1),[o,T]=s.useState(""),{isLoading:E,error:j,execute:N,reset:w}=O(),[c,u]=s.useState("manual"),g=!!F.userApiKey,a=i.editingEntryId?i.history.find(t=>t.id===i.editingEntryId):null;s.useEffect(()=>{(async()=>{if(a)f(a.title),b(a.text),u("manual");else{const r=await C(L)||"",l=await C(z)||"";f(r),b(l)}K(!0)})()},[a]),s.useEffect(()=>{y&&!a&&k(L,p)},[p,a,y]),s.useEffect(()=>{y&&!a&&k(z,d)},[d,a,y]);const h=s.useCallback(async t=>{w();const r=await N(t);r?(f(r.title),b(r.japanese_text),T(""),u("manual")):(T(t),u("url"))},[N,w]),_=s.useCallback(async()=>{if(!o){m("Please enter a URL.");return}try{new URL(o)}catch{m("Invalid URL format.");return}await h(o)},[o,h,m]);s.useEffect(()=>{i.urlToImport&&(n({type:"CLEAR_URL_TO_IMPORT"}),h(i.urlToImport))},[i.urlToImport,n,h]);const V=()=>{if(!g){m("API Key is not configured. Please add your key in the settings menu.");return}const t=d.trim();if(!t)return;const r=p.trim()||t.substring(0,40)+"...";if(a){const l=a.analyzedSentences,S={};t.split(`
`).flatMap(x=>{var D;return((D=x.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:D.filter(v=>v==null?void 0:v.trim()))||[]}).forEach(x=>{l[x]&&(S[x]=l[x])});const U={...a,title:r,text:t,updatedAt:Date.now(),analyzedSentences:S,readingProgress:0};n({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:U}),n({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:U.id}),n({type:"SET_VIEW",payload:P.Reader})}else{const l={id:crypto.randomUUID(),title:r,text:t,createdAt:Date.now(),updatedAt:Date.now(),analyzedSentences:{},readingProgress:0};n({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:l}),n({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:l.id}),n({type:"SET_VIEW",payload:P.Reader})}},A="px-4 py-3 text-sm font-medium transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-focus-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background rounded-t-lg",R="border-b-2 border-primary text-primary",I="text-text-muted hover:text-text-primary hover:bg-surface-hover";return e.jsx("div",{className:"h-screen md:h-auto input-area p-6 bg-gradient-to-b from-background/50 to-surface overflow-y-auto no-scrollbar flex flex-col",children:e.jsxs("div",{className:"space-y-6 flex-grow flex flex-col",children:[e.jsx("div",{className:"border-b border-border-subtle flex-shrink-0",children:e.jsxs("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>u("manual"),className:`${A} ${c==="manual"?R:I}`,"aria-current":c==="manual"?"page":void 0,children:"Manual Input"}),e.jsx("button",{onClick:()=>u("url"),className:`${A} ${c==="url"?R:I}`,"aria-current":c==="url"?"page":void 0,children:"Import from URL"})]})}),e.jsxs("div",{className:"flex-grow min-h-0 py-2",children:[c==="manual"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"text-title-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Title"}),e.jsx("input",{type:"text",id:"text-title-input",placeholder:"Enter a title for your text...",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-lg font-medium px-4 py-3",value:p,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sentence-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Japanese Text"}),e.jsx("textarea",{id:"sentence-input",placeholder:"Enter Japanese text here. e.g., 猫が大好きです。犬も好きです。",rows:8,className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3 font-japanese resize-y transition-all duration-200",value:d,onChange:t=>b(t.target.value)})]})]}),c==="url"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsx("label",{htmlFor:"url-input",className:"block text-sm font-medium text-text-secondary",children:"Paste article URL"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"url",id:"url-input",placeholder:"https://example.com/japanese-article",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3",value:o,onChange:t=>T(t.target.value),onKeyDown:t=>t.key==="Enter"&&_(),disabled:E}),e.jsx("button",{onClick:_,disabled:E||!o.trim(),className:"px-4 py-3 rounded-xl bg-accent text-primary-text font-medium hover:bg-accent/90 transition-colors shadow-sm focus-ring disabled:opacity-60 disabled:cursor-not-allowed flex-shrink-0",title:"Fetch content from URL",children:E?e.jsx("i",{className:"bi bi-arrow-repeat text-xl animate-spin"}):e.jsx("i",{className:"bi bi-cloud-arrow-down text-xl"})})]}),j&&e.jsxs("p",{className:"text-sm text-destructive mt-1.5 px-2",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill mr-1 align-middle"}),j.message]})]})]}),e.jsxs("div",{className:"mt-auto flex-shrink-0 pt-4",children:[e.jsxs("button",{onClick:V,className:"w-full btn-primary text-lg flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!d.trim()||!g,title:g?"":"API Key not configured. Please add one in settings.",children:[e.jsx("i",{className:"bi bi-search"}),"Analyze Text"]}),!g&&e.jsxs("p",{className:"text-center text-sm text-warning-text mt-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill mr-1 align-middle"}),"Please set your API key in settings to enable analysis."]})]})]})})}export{B as EditorView};
