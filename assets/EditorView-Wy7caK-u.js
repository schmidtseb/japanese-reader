import{u as Y,a as X,b as M,r as a,s as D,j as e,g as k,V as C}from"./index.prod-Dcqqmj7B.js";import{e as O}from"./gemini-Beq2aEEu.js";const P="unsaved-title",L="unsaved-text";function B(){const{state:i,dispatch:l}=Y(),{state:F}=X(),{showAlert:z}=M(),[x,p]=a.useState(""),[d,f]=a.useState(""),[b,K]=a.useState(!1),[o,T]=a.useState(""),[E,j]=a.useState(!1),[N,y]=a.useState(null),[c,u]=a.useState("manual"),g=!!F.userApiKey,s=i.editingEntryId?i.history.find(t=>t.id===i.editingEntryId):null;a.useEffect(()=>{(async()=>{if(s)p(s.title),f(s.text),u("manual");else{const n=await k(P)||"",r=await k(L)||"";p(n),f(r)}K(!0)})()},[s]),a.useEffect(()=>{b&&!s&&D(P,x)},[x,s,b]),a.useEffect(()=>{b&&!s&&D(L,d)},[d,s,b]);const h=a.useCallback(async t=>{y(null),j(!0);try{const n=await O(t);p(n.title),f(n.japanese_text),T(""),u("manual")}catch(n){T(t),u("url"),y(n.message)}finally{j(!1)}},[]),w=a.useCallback(async()=>{if(!o){y("Please enter a URL.");return}try{new URL(o)}catch{y("Invalid URL format.");return}await h(o)},[o,h]);a.useEffect(()=>{i.urlToImport&&(l({type:"CLEAR_URL_TO_IMPORT"}),h(i.urlToImport))},[i.urlToImport,l,h]);const V=()=>{if(!g){z("API Key is not configured. Please add your key in the settings menu.");return}const t=d.trim();if(!t)return;const n=x.trim()||t.substring(0,40)+"...";if(s){const r=s.analyzedSentences,R={};t.split(`
`).flatMap(m=>{var U;return((U=m.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:U.filter(v=>v==null?void 0:v.trim()))||[]}).forEach(m=>{r[m]&&(R[m]=r[m])});const I={...s,title:n,text:t,updatedAt:Date.now(),analyzedSentences:R,readingProgress:0};l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:I}),l({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:I.id}),l({type:"SET_VIEW",payload:C.Reader})}else{const r={id:Date.now().toString(),title:n,text:t,createdAt:Date.now(),updatedAt:Date.now(),analyzedSentences:{},readingProgress:0};l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:r}),l({type:"SET_CURRENT_TEXT_ENTRY_ID",payload:r.id}),l({type:"SET_VIEW",payload:C.Reader})}},_="px-4 py-3 text-sm font-medium transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-focus-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background rounded-t-lg",S="border-b-2 border-primary text-primary",A="text-text-muted hover:text-text-primary hover:bg-surface-hover";return e.jsx("div",{className:"h-screen md:h-auto input-area p-6 bg-gradient-to-b from-background/50 to-surface overflow-y-auto no-scrollbar flex flex-col",children:e.jsxs("div",{className:"space-y-6 flex-grow flex flex-col",children:[e.jsx("div",{className:"border-b border-border-subtle flex-shrink-0",children:e.jsxs("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>u("manual"),className:`${_} ${c==="manual"?S:A}`,"aria-current":c==="manual"?"page":void 0,children:"Manual Input"}),e.jsx("button",{onClick:()=>u("url"),className:`${_} ${c==="url"?S:A}`,"aria-current":c==="url"?"page":void 0,children:"Import from URL"})]})}),e.jsxs("div",{className:"flex-grow min-h-0 py-2",children:[c==="manual"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"text-title-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Title"}),e.jsx("input",{type:"text",id:"text-title-input",placeholder:"Enter a title for your text...",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-lg font-medium px-4 py-3",value:x,onChange:t=>p(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sentence-input",className:"block text-sm font-medium text-text-secondary mb-2",children:"Japanese Text"}),e.jsx("textarea",{id:"sentence-input",placeholder:"Enter Japanese text here. e.g., 猫が大好きです。犬も好きです。",rows:8,className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3 font-japanese resize-y transition-all duration-200",value:d,onChange:t=>f(t.target.value)})]})]}),c==="url"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsx("label",{htmlFor:"url-input",className:"block text-sm font-medium text-text-secondary",children:"Paste article URL"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"url",id:"url-input",placeholder:"https://example.com/japanese-article",className:"w-full rounded-xl border-border-subtle bg-surface shadow-sm focus-ring text-base px-4 py-3",value:o,onChange:t=>T(t.target.value),onKeyDown:t=>t.key==="Enter"&&w(),disabled:E}),e.jsx("button",{onClick:w,disabled:E||!o.trim(),className:"px-4 py-3 rounded-xl bg-accent text-primary-text font-medium hover:bg-accent/90 transition-colors shadow-sm focus-ring disabled:opacity-60 disabled:cursor-not-allowed flex-shrink-0",title:"Fetch content from URL",children:E?e.jsx("i",{className:"bi bi-arrow-repeat text-xl animate-spin"}):e.jsx("i",{className:"bi bi-cloud-arrow-down text-xl"})})]}),N&&e.jsxs("p",{className:"text-sm text-destructive mt-1.5 px-2",children:[e.jsx("i",{className:"bi bi-exclamation-circle-fill mr-1 align-middle"}),N]})]})]}),e.jsxs("div",{className:"mt-auto flex-shrink-0 pt-4",children:[e.jsxs("button",{onClick:V,className:"w-full btn-primary text-lg flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!d.trim()||!g,title:g?"":"API Key not configured. Please add one in settings.",children:[e.jsx("i",{className:"bi bi-search"}),"Analyze Text"]}),!g&&e.jsxs("p",{className:"text-center text-sm text-warning-text mt-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill mr-1 align-middle"}),"Please set your API key in settings to enable analysis."]})]})]})})}export{B as default};
