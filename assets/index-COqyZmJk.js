(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const on=["low","medium","high"];let sn=null,W=[],O=null,ee="medium",Fe=null,$=null,Ae=null,st=null;function Yn(o){sn=o}function rn(o){Fe=o}function Vs(o){$=o}function Ni(o){Ae=o}function Pi(o){st=o}function Ln(o){O=o}function Li(o){ee=o}function an(o){W=o}function J(o){return W.find(e=>e.id===o)}function St(o){const e=W.findIndex(t=>t.id===o.id);e>-1?W[e]=o:W.unshift(o)}function ln(o,e){const t=J(o);t&&(t.readingProgress=e,t.updatedAt=Date.now(),St(t))}function Kn(o,e,t){if(!O)return;const n=J(O);n&&(n.analyzedSentences[o]||(n.analyzedSentences[o]={}),n.analyzedSentences[o][t]=e,n.updatedAt=Date.now(),St(n))}function Fs(o){W=W.filter(e=>e.id!==o)}function Us(){W=[]}function Bs(){if(!("speechSynthesis"in window)){document.body.classList.remove("tts-available");return}const o=()=>{const e=window.speechSynthesis.getVoices().filter(s=>s.lang==="ja-JP");if(e.length===0){Yn(null),document.body.classList.remove("tts-available");return}const t=e.find(s=>s.name.includes("Google")),n=e.find(s=>!s.localService),i=t||n||e[0]||null;Yn(i),document.body.classList.toggle("tts-available",!!i)};o(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=o)}function Os(o){if(!("speechSynthesis"in window)||!sn){console.warn("Speech synthesis not available or no Japanese voice found.");return}window.speechSynthesis.cancel();const e=new SpeechSynthesisUtterance(o);e.voice=sn,e.lang="ja-JP",e.rate=.9,e.pitch=1,window.speechSynthesis.speak(e)}const Pe=document.getElementById("generate-button"),me=document.getElementById("sentence-input"),Ie=document.getElementById("text-title-input"),X=document.getElementById("result-container"),Ue=document.querySelector(".input-area"),$t=document.getElementById("main-view"),Y=document.getElementById("reader-view"),B=document.getElementById("analysis-view"),V=document.getElementById("reading-mode-view"),tt=document.getElementById("theme-checkbox"),Be=document.getElementById("furigana-checkbox"),Oe=document.getElementById("color-coding-checkbox"),rt=document.getElementById("pitch-accent-checkbox"),Z=document.getElementById("tooltip"),un=document.getElementById("settings-button"),Qe=document.getElementById("settings-menu"),It=document.getElementById("analysis-depth-slider"),bn=document.getElementById("analysis-depth-label"),At=document.getElementById("font-size-slider"),Dn=document.getElementById("font-size-label"),Vn=document.getElementById("app-header"),bi=document.getElementById("new-text-button"),Di=document.getElementById("history-button"),cn=document.getElementById("history-panel"),yt=document.getElementById("history-panel-overlay"),Vi=document.getElementById("close-history-button"),Fn=document.getElementById("clear-history-button"),wt=document.getElementById("history-list"),Fi=document.getElementById("history-empty-message"),Ui=document.getElementById("export-data-button"),Gs=document.getElementById("import-data-button"),vt=document.getElementById("import-file-input"),be=document.getElementById("api-key-input"),Bi=document.getElementById("save-api-key-button"),pe=document.getElementById("api-key-status"),Ge=document.getElementById("modal-overlay"),Jt=document.getElementById("modal-box"),Un=document.getElementById("modal-message"),he=document.getElementById("modal-confirm-button"),at=document.getElementById("modal-cancel-button"),He=document.getElementById("bottom-sheet"),zt=document.getElementById("bottom-sheet-overlay"),Oi=document.getElementById("bottom-sheet-title"),xe=document.getElementById("bottom-sheet-content"),Gi=document.getElementById("bottom-sheet-close-button"),Hs=[Pe,me,Ie,X,Ue,$t,Y,B,V,tt,Be,Oe,rt,Z,un,Qe,It,bn,At,Dn,Vn,bi,Di,cn,yt,Vi,Fn,wt,Fi,Ui,Gs,vt,be,Bi,pe,Ge,Jt,Un,he,at,He,zt,Oi,xe,Gi];if(Hs.some(o=>!o))throw new Error("A required HTML element was not found in the DOM.");let ce=null,Hi;function ve(){Z.classList.add("opacity-0","invisible","pointer-events-none"),ce&&(ce.classList.remove("tooltip-active"),ce=null)}const qi=()=>clearTimeout(Hi),Wn=()=>{Hi=window.setTimeout(ve,300)};function $i(o){qi();const{reading:e,english:t,patterns:n,category:i,wordUrl:s}=o.dataset;let l="",u="";if(i){const h=i.replace(/_/g," ").split("-").map(g=>g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()).join(", ");u+=`<p class="text-xs text-text-muted"><strong class="font-medium text-text-secondary">Category:</strong> ${h}</p>`}if(u+=`<p class="text-xs text-text-muted mt-1"><strong class="font-medium text-text-secondary">Reading:</strong> ${e||"N/A"}</p>`,u+=`<p class="text-xs text-text-muted mt-1"><strong class="font-medium text-text-secondary">English:</strong> ${t||"N/A"}</p>`,s&&s.includes("http")&&(u+=`<div class="mt-2"><a href="${s}" target="_blank" rel="noopener noreferrer" class="text-xs font-semibold text-accent hover:underline inline-flex items-center gap-1">Search on Jisho <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></div>`),u&&(l+=`<div class="mb-3"><h4 class="text-sm font-semibold border-b border-border-subtle pb-1 mb-1 text-text-primary">Word Info</h4>${u}</div>`),n)try{JSON.parse(n).forEach(h=>{l+=`<div class="mb-2 last:mb-0"><div class="flex items-center gap-2 mb-1"><span class="flex-shrink-0 w-3 h-3 rounded-sm bg-${h.idClass}"></span><h4 class="font-semibold text-accent">${h.name}</h4></div><p class="text-xs text-text-muted">${h.explanation}</p></div>`})}catch(h){console.error("Failed to parse patterns JSON",h)}if(!l){ve();return}Z.innerHTML=l,Z.style.visibility="hidden",Z.classList.remove("opacity-0","invisible","pointer-events-none");const d=o.getBoundingClientRect(),c=Z.getBoundingClientRect(),f=10;let p=d.left+d.width/2-c.width/2;p<f&&(p=f),p+c.width>window.innerWidth-f&&(p=window.innerWidth-c.width-f);let m=d.top-c.height-10;m<f&&(m=d.bottom+10),Z.style.left=`${p}px`,Z.style.top=`${m}px`,Z.style.visibility="visible"}function Ji(o){ce&&ce.classList.remove("tooltip-active"),ce=o,ce.classList.add("tooltip-active"),$i(o)}function zi(o){return ce===o}function mt(){return ce!==null}function qs(){window.matchMedia("(hover: hover)").matches&&(X.addEventListener("mouseover",o=>{if(mt())return;const e=o.target.closest(".segment");e&&$i(e)}),X.addEventListener("mouseout",o=>{mt()||o.target.closest(".segment")&&Wn()})),document.addEventListener("click",o=>{if(!mt())return;const e=o.target.closest(".segment"),t=Z.contains(o.target);!e&&!t&&ve()}),Z.addEventListener("mouseover",qi),Z.addEventListener("mouseout",()=>{mt()||Wn()})}let De=null,Ct=null;function Yi(){Ge.classList.add("opacity-0","invisible"),Jt.classList.add("scale-95","opacity-0"),De=null,Ct=null}function $s(){De==null||De(),Yi()}function Zn(){Ct==null||Ct(),Yi()}function Js(){he.addEventListener("click",$s),at.addEventListener("click",Zn),Ge.addEventListener("click",o=>{o.target===Ge&&Zn()})}function dn(o,e,t={}){var i;Un.textContent=o,De=e,he.textContent=t.confirmText||"Confirm",he.className="px-5 py-3 rounded-xl text-base font-medium text-primary-text transition-colors shadow-lg";const n=((i=t.confirmClass)==null?void 0:i.split(" "))||["bg-destructive","hover:bg-destructive-hover"];he.classList.add(...n),at.textContent=t.cancelText||"Cancel",at.classList.remove("hidden"),Ge.classList.remove("opacity-0","invisible"),Jt.classList.remove("scale-95","opacity-0")}function Xn(o,e){Un.textContent=o,De=null,he.textContent="OK",he.className="px-5 py-3 rounded-xl text-base font-medium text-primary-text transition-colors shadow-lg",he.classList.add("bg-accent","hover:bg-accent/90"),at.classList.add("hidden"),Ge.classList.remove("opacity-0","invisible"),Jt.classList.remove("scale-95","opacity-0")}function zs(o){const e=(o||"unknown").split(/[-_]/)[0].toLowerCase(),t={noun:"bg-pos-noun-bg text-pos-noun-text",verb:"bg-pos-verb-bg text-pos-verb-text",particle:"bg-pos-particle-bg text-pos-particle-text",adjective:"bg-pos-adjective-bg text-pos-adjective-text",adverb:"bg-pos-adverb-bg text-pos-adverb-text",auxiliary:"bg-pos-auxiliary-bg text-pos-auxiliary-text",grammatical:"bg-pos-auxiliary-bg text-pos-auxiliary-text",conjunction:"bg-pos-conjunction-bg text-pos-conjunction-text",suffix:"bg-pos-suffix-bg text-pos-suffix-text",punctuation:"bg-transparent",unknown:"bg-surface-soft"};return t[e]||t.unknown}function Qn(o){return o.split("").map(e=>/[一-龯]/.test(e)?`<a href="https://jisho.org/search/${encodeURIComponent(e)}%20%23kanji" target="_blank" rel="noopener noreferrer" class="underline decoration-text-muted/50 decoration-1 underline-offset-2 hover:text-accent hover:decoration-accent transition">${e}</a>`:e).join("")}function Ki(o,e,t){if(!e||o===e)return t?Qn(o):o;const n=o.match(/([一-龯]+|[^一-龯]+)/g)||[];let i=0,s="";for(let l=0;l<n.length;l++){const u=n[l];if(/[一-龯]/.test(u)){let c="";const f=l+1<n.length&&!/[一-龯]/.test(n[l+1])?n[l+1]:"",p=f?e.indexOf(f,i):-1;p!==-1?(c=e.substring(i,p),i=p):(c=e.substring(i),i=e.length);const m=t?Qn(u):u;s+=c&&c!==u?`<ruby>${m}<rt class="text-xs text-text-muted select-none">${c}</rt></ruby>`:m}else s+=u,e.substring(i).startsWith(u)&&(i+=u.length)}return s}function Ys(o,e){if(!o||!e||o.length!==e.length)return null;const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg");n.setAttribute("class","pitch-accent-svg absolute top-0 left-0 w-full h-[14px] overflow-visible pointer-events-none");const i=e.split("").map((s,l)=>({x:100/o.length*(l+.5),y:s==="H"?2:8}));if(i.length>1){const s=document.createElementNS(t,"polyline");s.setAttribute("points",i.map(l=>`${l.x},${l.y}`).join(" ")),s.setAttribute("class","fill-none stroke-text-muted"),s.setAttribute("stroke-width","1.5"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-linejoin","round"),n.appendChild(s)}return i.forEach(s=>{const l=document.createElementNS(t,"circle");l.setAttribute("cx",String(s.x)),l.setAttribute("cy",String(s.y)),l.setAttribute("r","1.2"),l.setAttribute("class","fill-text-muted"),n.appendChild(l)}),n.setAttribute("viewBox","0 0 100 10"),n.setAttribute("preserveAspectRatio","none"),n}function Wi(o,e){return`
    <div role="alert" class="p-4 bg-destructive-subtle-bg border-l-4 border-destructive rounded-r-lg shadow-md my-4 transition-all duration-300">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-destructive" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3 flex-1">
          <p class="text-sm font-semibold text-destructive-subtle-text">${o}</p>
          ${e?`<div class="mt-2 text-sm text-destructive-subtle-text/80"><p>${e}</p></div>`:""}
        </div>
      </div>
    </div>
  `}function Ks(o,e){var n;const t=document.createDocumentFragment();return(n=o.analysis)==null||n.forEach(i=>{const s=document.createElement("span");if(s.className=`segment relative inline-block rounded-md px-2 py-1 cursor-pointer transition-transform duration-200 hover:-translate-y-0.5 leading-loose ${zs(i.category)}`,s.dataset.japaneseSegment=i.japanese_segment,s.dataset.reading=i.reading,s.dataset.english=i.english_equivalent,s.dataset.category=i.category,s.dataset.wordUrl=`https://jisho.org/search/${encodeURIComponent(i.japanese_segment)}`,i.category!=="PUNCTUATION"){const u=Ys(i.reading,i.pitch_accent);u&&s.appendChild(u)}const l=document.createElement("div");l.innerHTML=Ki(i.japanese_segment,i.reading,!0),s.appendChild(l),t.appendChild(s),e.push(s)}),t}function Zi(o,e,t={}){const n=document.createElement("div");n.className=["relative","p-4","bg-surface-soft","rounded-lg","min-h-36",...t.wrapperClasses||[]].join(" ");const i=document.createElement("div");i.className=["flex","flex-wrap","items-center","gap-x-1.5","gap-y-1","text-2xl","max-h-[50vh]","overflow-y-auto","no-scrollbar","pr-8",...t.sentenceContainerClasses||[]].join(" ");const s=Ks(o,e);i.appendChild(s),n.appendChild(i);const l=document.createElement("div");l.className="absolute top-4 right-4 z-10 flex flex-col gap-1.5",t.extraControls&&t.extraControls.forEach(f=>l.prepend(f));const u=document.createElement("button");u.id="re-analyze-button",u.className="inline-flex items-center justify-center w-8 h-8 rounded-full bg-surface text-accent hover:bg-accent-subtle-bg transition align-middle",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 16 16" stroke="currentColor" stroke-width="0.5"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/></svg>',u.title="Re-analyze sentence";const d=document.createElement("button");d.id="toggle-translation-button",d.className="inline-flex items-center justify-center w-8 h-8 rounded-full bg-surface text-accent hover:bg-accent-subtle-bg transition align-middle",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 16 16" stroke="currentColor" stroke-width="0.3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-translate" viewBox="0 0 16 16"><path d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286zm1.634-.736L5.5 3.956h-.049l-.679 2.022z"/><path d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zm7.138 9.995q.289.451.63.846c-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6 6 0 0 1-.415-.492 2 2 0 0 1-.94.31"/></svg>',d.title="Toggle Translation (T)",d.setAttribute("aria-pressed","false");const c=document.createElement("button");if(c.className="tts-button inline-flex items-center justify-center w-8 h-8 rounded-full bg-surface text-accent hover:bg-accent-subtle-bg transition align-middle",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"></path></svg>',c.title="Read sentence aloud (S)",c.onclick=f=>{f.preventDefault(),Os(o.original_japanese_sentence)},l.append(u,d,c),n.appendChild(l),o.english_translation){const f=document.createElement("div");f.id="sentence-translation-content",f.className="hidden mt-2 pt-2 border-t border-dashed border-border-subtle text-base italic text-text-secondary",f.innerHTML=`<p>${o.english_translation}</p>`,n.appendChild(f)}return n}function Xi(o,e){const t=document.createDocumentFragment();if(!o.grammar_patterns||o.grammar_patterns.length===0)return t;const n=document.createElement("div");n.className="mt-6";const i=document.createElement("ul");i.className="flex flex-col gap-3";const s=new Map;o.grammar_patterns.forEach((u,d)=>{var h;const c=d%12,f=`pattern-${c}`,p={name:u.pattern_name,explanation:u.explanation,idClass:f};(h=u.constituent_indices)==null||h.forEach(g=>{s.has(g)||s.set(g,[]),s.get(g).push(p)});const m=document.createElement("li");m.className="flex gap-4 p-4 rounded-lg bg-surface-subtle cursor-pointer transition-all duration-200",m.dataset.patternId=f,m.innerHTML=`
          <span class="flex-shrink-0 w-1.5 rounded-full bg-pattern-${c}"></span>
          <div class="flex-grow">
              <strong class="font-semibold text-accent">${u.pattern_name}</strong>
              <p class="text-sm text-text-muted mt-1">${u.explanation}</p>
              <button class="show-examples-button mt-3 text-xs font-semibold px-2 py-1 rounded-md border border-accent text-accent hover:bg-accent hover:text-primary-text transition inline-flex items-center gap-2 disabled:opacity-50" data-pattern-name="${u.pattern_name}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
                <span class="button-text">Examples</span>
              </button>
          </div>
      `,i.appendChild(m)}),s.forEach((u,d)=>{const c=e[d];if(c&&u.length>0){c.dataset.patterns=JSON.stringify(u.map(({name:h,explanation:g,idClass:y})=>({name:h,explanation:g,idClass:y})));const f=2,p=3;c.style.paddingBottom=`${4+u.length*f+(u.length-1)*p}px`;const m=u.map(h=>`linear-gradient(to top, rgb(var(--color-${h.idClass}-rgb)) 0%, rgb(var(--color-${h.idClass}-rgb)) 100%)`);c.style.backgroundImage=m.join(", "),c.style.backgroundSize=u.map(()=>`100% ${f}px`).join(", "),c.style.backgroundPosition=u.map((h,g)=>`0 calc(100% - ${g*(f+p)}px)`).join(", "),c.style.backgroundRepeat="no-repeat",c.classList.add("grammar-pattern",...u.map(h=>h.idClass))}}),n.appendChild(i);const l=document.createElement("p");return l.className="text-xs text-center text-text-muted mt-4 px-4",l.innerHTML='Tip: Use <kbd class="font-sans border rounded px-1.5 py-0.5 border-strong">J</kbd>/<kbd class="font-sans border rounded px-1.5 py-0.5 border-strong">K</kbd> to navigate patterns, <kbd class="font-sans border rounded px-1.5 py-0.5 border-strong">E</kbd> for examples, and <kbd class="font-sans border rounded px-1.5 py-0.5 border-strong">Esc</kbd> to clear focus.',n.appendChild(l),t.appendChild(n),t}function Ws(o,e,t={}){const{stickyTopClass:n="top-0"}=t;o.innerHTML="";const i=document.createElement("div");i.className=`sticky ${n} z-20 bg-surface pt-2 rounded-b-lg`,o.appendChild(i);const s=document.createElement("div");s.className="p-4 bg-surface-soft rounded-lg";const l=document.createElement("div");l.className="flex items-center gap-4 text-2xl";const u=document.createElement("p");u.className="flex-grow text-text-muted font-japanese font-medium",u.textContent=e;const d=document.createElement("div");d.className="animate-spin rounded-full h-5 w-5 border-b-2 border-accent flex-shrink-0",l.append(u,d),s.appendChild(l),i.appendChild(s);const c=document.createElement("div");c.className="px-4 pb-4 text-center text-text-muted",c.textContent="Fetching analysis and grammar notes...",o.appendChild(c)}function Mt(o,e,t={}){const{stickyTopClass:n="top-0"}=t;if(o.innerHTML="",!e||!e.analysis)return;const i=[],s=document.createElement("div");s.className=`sticky ${n} z-20 bg-surface transition-colors duration-300 pt-2 rounded-b-lg`,o.appendChild(s);const l=document.createElement("div");l.className="px-4 pb-4",o.appendChild(l);const u=Zi(e,i,{sentenceContainerClasses:["text-2xl"]});s.appendChild(u);const d=Xi(e,i);l.appendChild(d)}function Yt(o){Y.innerHTML="",$&&($.classList.add("opacity-0","invisible","translate-y-5"),$.classList.remove("transform")),Ae&&(Ae.disconnect(),Ni(null)),st&&(window.removeEventListener("scroll",st),Pi(null));const t=o.text.split(`
`).map(c=>{var f;return((f=c.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:f.filter(p=>p==null?void 0:p.trim()))||[]}),n=t.flat();if(!(n.length>0))return;const s=document.createElement("div");Y.appendChild(s);const l=document.createElement("div");l.className="flex justify-between items-center mb-4";const u=document.createElement("h2");if(u.className="text-xl font-bold text-text-primary",u.textContent=o.title,l.appendChild(u),n.length>0){const c=document.createElement("div");c.className="flex items-center gap-2";const f=document.createElement("button");f.id="edit-text-button",f.className="p-2 rounded-full hover:bg-surface-hover focus-ring transition-colors",f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002 2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>',f.title="Edit this text",c.appendChild(f);const p=document.createElement("button");p.id="start-reading-button",p.title="Start Reading Mode",p.className="inline-flex items-center justify-center p-2.5 rounded-full text-primary-text bg-accent hover:bg-accent/90 focus-ring shadow-sm",p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>',c.appendChild(p),l.appendChild(c)}s.appendChild(l);const d=document.createElement("div");d.className="bg-surface-soft border border-border rounded-lg p-4 sm:p-6 max-h-80 overflow-y-auto no-scrollbar",t.forEach(c=>{const f=document.createElement("p");f.className="text-lg sm:text-xl leading-relaxed",c.length>0?c.forEach(p=>{var g;const m=document.createElement("span");m.className="clickable-sentence cursor-pointer rounded p-1 -m-1 transition-colors duration-200 hover:bg-accent-selected-bg/50",!!((g=o.analyzedSentences[p])!=null&&g[ee])?(m.classList.add("text-accent-text"),m.title="Analyzed. Click to view."):m.title="Click to analyze.",m.textContent=p,m.dataset.sentence=p,f.append(m," ")}):f.innerHTML="&nbsp;",d.appendChild(f)}),s.appendChild(d)}function Qi(o,e,t){V.innerHTML="",V.className="";const n=document.createElement("header");n.id="reading-mode-header",n.className="fixed top-0 left-0 right-0 z-30 bg-surface/90 backdrop-blur-md shadow-sm header-collapsed";const i=document.createElement("div");i.id="reading-header-hover-trigger",i.className="hidden md:block absolute top-0 left-0 right-0 h-4 z-20",n.appendChild(i);const s=document.createElement("div");s.id="reading-mode-content-container",s.className="max-w-4xl mx-auto p-2 space-y-2",n.appendChild(s);const l=document.createElement("div");l.id="reading-mode-nav-wrapper",s.appendChild(l);const u=document.createElement("div");u.className="flex justify-between items-center",u.innerHTML=`
        <button id="reading-mode-exit" title="Exit Reading Mode" class="p-2 rounded-full hover:bg-surface-hover transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
        </button>
        <div class="font-medium text-text-secondary flex items-center gap-1">
            <input type="number" id="reading-mode-sentence-input" value="${o+1}" min="1" max="${e}" title="Enter sentence number and press Enter" class="w-12 text-center bg-surface-subtle rounded-md p-1 focus:ring-2 focus:ring-focus-ring focus:outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
            <span>/ ${e}</span>
        </div>
        <div class="flex items-center gap-2">
            <button id="reading-nav-prev" title="Previous Sentence (←)" class="p-2 rounded-full hover:bg-surface-hover disabled:opacity-30 disabled:cursor-not-allowed" ${o===0?"disabled":""}>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="reading-nav-next" title="Next Sentence (→)" class="p-2 rounded-full hover:bg-surface-hover disabled:opacity-30 disabled:cursor-not-allowed" ${!t.isLoaded||o>=e-1?"disabled":""}>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>
    `,l.appendChild(u);const d=document.createElement("main");d.id="reading-mode-content-wrapper";const c=()=>{const p=n.offsetHeight-30;p>0&&d.style.paddingTop!==`${p}px`&&(d.style.paddingTop=`${p}px`)};return new ResizeObserver(()=>{requestAnimationFrame(c)}).observe(n),V.append(n,d),requestAnimationFrame(()=>{c(),requestAnimationFrame(c)}),{headerContentWrapper:s,scrollableContent:d}}function jn(o,e,t){const i=o.text.split(`
`).flatMap(m=>{var h;return((h=m.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:h.filter(g=>g==null?void 0:g.trim()))||[]}).length,s=[],{headerContentWrapper:l,scrollableContent:u}=Qi(e,i,{isLoaded:!0}),d=document.createElement("button");d.id="reading-header-toggle",d.title="Toggle navigation controls",d.className="md:hidden z-10 p-2 rounded-full bg-surface/50 hover:bg-surface-hover transition-colors",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>';const c=Zi(t,s,{wrapperClasses:["p-3","min-h-48"],sentenceContainerClasses:["text-xl","font-medium","font-japanese","pr-12"],extraControls:[d]});l.appendChild(c);const f=document.createElement("div");f.className="max-w-4xl mx-auto p-2 md:p-4",u.appendChild(f);const p=Xi(t,s);f.appendChild(p)}function Zs(o,e){const t=o.text.split(`
`).flatMap(p=>{var m;return((m=p.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:m.filter(h=>h==null?void 0:h.trim()))||[]}),n=t[e],i=t.length,{headerContentWrapper:s,scrollableContent:l}=Qi(e,i,{isLoaded:!1}),u=document.createElement("div");u.className="relative p-3 bg-surface-soft rounded-lg max-h-[50vh] overflow-y-auto no-scrollbar",s.appendChild(u);const d=document.createElement("button");d.id="reading-header-toggle",d.title="Toggle navigation controls",d.className="md:hidden absolute top-2 right-2 z-10 p-2 rounded-full bg-surface/50 hover:bg-surface-hover",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>',u.appendChild(d);const c=document.createElement("div");c.className="flex-grow flex items-center gap-4 text-xl font-medium font-japanese text-text-muted pr-10",c.innerHTML=`
      <p class="flex-grow">${n}</p>
      <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-accent flex-shrink-0"></div>
    `,u.appendChild(c);const f=document.createElement("div");f.className="max-w-4xl mx-auto p-6 text-center text-text-muted",f.textContent="Fetching analysis and grammar notes...",l.appendChild(f)}function qe(){wt.innerHTML="";const o=W;Fi.classList.toggle("hidden",o.length>0),Fn.classList.toggle("hidden",o.length===0),o.forEach(e=>{const t=document.createElement("li");t.className="text-entry-item group p-4 hover:bg-surface-hover transition-colors flex justify-between items-center";const n=document.createElement("div");n.className="flex-grow pr-4 truncate cursor-pointer",n.dataset.action="load",n.dataset.entryId=e.id;const i=document.createElement("span");i.className="font-medium text-sm pointer-events-none text-text-primary",i.textContent=e.title,i.title=e.title;const s=document.createElement("span");s.className="block text-xs text-text-muted mt-1 pointer-events-none",s.textContent=`Updated: ${new Date(e.updatedAt).toLocaleString()}`,n.append(i,s);const l=document.createElement("div");l.className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0";const u=document.createElement("button");u.className="p-2 rounded-full hover:bg-destructive-subtle-bg text-destructive/70 hover:text-destructive transition-colors",u.title="Delete Text",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>',u.dataset.action="delete",u.dataset.entryId=e.id,l.append(u),t.append(n,l),wt.appendChild(t)})}function te(){const o=!Be.checked,e=!rt.checked,t=!Oe.checked;X.classList.toggle("color-coding-disabled",t),document.querySelectorAll("#result-container rt").forEach(n=>n.classList.toggle("hidden",o)),document.querySelectorAll("#result-container .pitch-accent-svg").forEach(n=>n.classList.toggle("hidden",e)),document.querySelectorAll("#result-container .segment").forEach(n=>{n.classList.toggle("pt-[18px]",!e),n.classList.toggle("pt-1",e)})}function dt(){const o=me.value.trim().length>0,e=!!Fe;Pe.disabled=!o||!e,e?o?Pe.title="":Pe.title="Please enter some text to process.":Pe.title="Please set your Gemini API key in the settings menu."}function ji(){$t.classList.remove("hidden"),V.classList.add("hidden"),Vn.classList.remove("hidden")}function Xs(){$t.classList.add("hidden"),V.classList.remove("hidden"),Vn.classList.add("hidden")}function Bn(o){const e=o.message||"";return e.includes("429")||e.includes("RESOURCE_EXHAUSTED")?{main:"The request to the AI model was rate-limited.",detail:"This can happen if you process very large texts or make many requests in a short period. The app tried to retry automatically but was unsuccessful. Please wait a moment before trying again."}:e.includes("API key not valid")?{main:"The Gemini API key is not valid.",detail:"Please check the key in the settings menu. Make sure it has been copied correctly and is enabled for use."}:e.includes("timed out")?{main:"The request to the AI model timed out.",detail:"This could be due to a temporary network issue or the model taking too long to respond. Please try again in a moment."}:e.includes("GoogleGenAI")||e.includes("Request failed with status code")?{main:"An unexpected API error occurred.",detail:e}:{main:e}}function Rt(){Ie.value="",me.value="",ji(),Ue.classList.remove("hidden"),Y.innerHTML="",B.innerHTML="",Ln(null),ve(),dt()}var P;(function(o){o.assertEqual=i=>{};function e(i){}o.assertIs=e;function t(i){throw new Error}o.assertNever=t,o.arrayToEnum=i=>{const s={};for(const l of i)s[l]=l;return s},o.getValidEnumValues=i=>{const s=o.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),l={};for(const u of s)l[u]=i[u];return o.objectValues(l)},o.objectValues=i=>o.objectKeys(i).map(function(s){return i[s]}),o.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&s.push(l);return s},o.find=(i,s)=>{for(const l of i)if(s(l))return l},o.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(l=>typeof l=="string"?`'${l}'`:l).join(s)}o.joinValues=n,o.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(P||(P={}));var eo;(function(o){o.mergeShapes=(e,t)=>({...e,...t})})(eo||(eo={}));const T=P.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fe=o=>{switch(typeof o){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(o)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(o)?T.array:o===null?T.null:o.then&&typeof o.then=="function"&&o.catch&&typeof o.catch=="function"?T.promise:typeof Map<"u"&&o instanceof Map?T.map:typeof Set<"u"&&o instanceof Set?T.set:typeof Date<"u"&&o instanceof Date?T.date:T.object;default:return T.unknown}},v=P.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class de extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},n={_errors:[]},i=s=>{for(const l of s.issues)if(l.code==="invalid_union")l.unionErrors.map(i);else if(l.code==="invalid_return_type")i(l.returnTypeError);else if(l.code==="invalid_arguments")i(l.argumentsError);else if(l.path.length===0)n._errors.push(t(l));else{let u=n,d=0;for(;d<l.path.length;){const c=l.path[d];d===l.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(t(l))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return i(this),n}static assert(e){if(!(e instanceof de))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,P.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}de.create=o=>new de(o);const fn=(o,e)=>{let t;switch(o.code){case v.invalid_type:o.received===T.undefined?t="Required":t=`Expected ${o.expected}, received ${o.received}`;break;case v.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(o.expected,P.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:t=`Unrecognized key(s) in object: ${P.joinValues(o.keys,", ")}`;break;case v.invalid_union:t="Invalid input";break;case v.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${P.joinValues(o.options)}`;break;case v.invalid_enum_value:t=`Invalid enum value. Expected ${P.joinValues(o.options)}, received '${o.received}'`;break;case v.invalid_arguments:t="Invalid function arguments";break;case v.invalid_return_type:t="Invalid function return type";break;case v.invalid_date:t="Invalid date";break;case v.invalid_string:typeof o.validation=="object"?"includes"in o.validation?(t=`Invalid input: must include "${o.validation.includes}"`,typeof o.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${o.validation.position}`)):"startsWith"in o.validation?t=`Invalid input: must start with "${o.validation.startsWith}"`:"endsWith"in o.validation?t=`Invalid input: must end with "${o.validation.endsWith}"`:P.assertNever(o.validation):o.validation!=="regex"?t=`Invalid ${o.validation}`:t="Invalid";break;case v.too_small:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at least":"more than"} ${o.minimum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at least":"over"} ${o.minimum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${o.minimum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(o.minimum))}`:t="Invalid input";break;case v.too_big:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at most":"less than"} ${o.maximum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at most":"under"} ${o.maximum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="bigint"?t=`BigInt must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly":o.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(o.maximum))}`:t="Invalid input";break;case v.custom:t="Invalid input";break;case v.invalid_intersection_types:t="Intersection results could not be merged";break;case v.not_multiple_of:t=`Number must be a multiple of ${o.multipleOf}`;break;case v.not_finite:t="Number must be finite";break;default:t=e.defaultError,P.assertNever(o)}return{message:t}};let Qs=fn;function js(){return Qs}const er=o=>{const{data:e,path:t,errorMaps:n,issueData:i}=o,s=[...t,...i.path||[]],l={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let u="";const d=n.filter(c=>!!c).slice().reverse();for(const c of d)u=c(l,{data:e,defaultError:u}).message;return{...i,path:s,message:u}};function C(o,e){const t=js(),n=er({issueData:e,data:o.data,path:o.path,errorMaps:[o.common.contextualErrorMap,o.schemaErrorMap,t,t===fn?void 0:fn].filter(i=>!!i)});o.common.issues.push(n)}class z{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const i of t){if(i.status==="aborted")return I;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const i of t){const s=await i.key,l=await i.value;n.push({key:s,value:l})}return z.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const i of t){const{key:s,value:l}=i;if(s.status==="aborted"||l.status==="aborted")return I;s.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof l.value<"u"||i.alwaysSet)&&(n[s.value]=l.value)}return{status:e.value,value:n}}}const I=Object.freeze({status:"aborted"}),je=o=>({status:"dirty",value:o}),Q=o=>({status:"valid",value:o}),to=o=>o.status==="aborted",no=o=>o.status==="dirty",$e=o=>o.status==="valid",kt=o=>typeof Promise<"u"&&o instanceof Promise;var _;(function(o){o.errToObj=e=>typeof e=="string"?{message:e}:e||{},o.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(_||(_={}));class le{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const oo=(o,e)=>{if($e(e))return{success:!0,data:e.value};if(!o.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new de(o.common.issues);return this._error=t,this._error}}};function A(o){if(!o)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:i}=o;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(l,u)=>{const{message:d}=o;return l.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??n??u.defaultError}:l.code!=="invalid_type"?{message:u.defaultError}:{message:d??t??u.defaultError}},description:i}}class R{get description(){return this._def.description}_getType(e){return fe(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:fe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new z,ctx:{common:e.parent.common,data:e.data,parsedType:fe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(kt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fe(e)},i=this._parseSync({data:e,path:n.path,parent:n});return oo(n,i)}"~validate"(e){var n,i;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fe(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return $e(s)?{value:s.value}:{issues:t.common.issues}}catch(s){(i=(n=s==null?void 0:s.message)==null?void 0:n.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>$e(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fe(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(kt(i)?i:Promise.resolve(i));return oo(n,s)}refine(e,t){const n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const l=e(i),u=()=>s.addIssue({code:v.custom,...n(i)});return typeof Promise<"u"&&l instanceof Promise?l.then(d=>d?!0:(u(),!1)):l?!0:(u(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new Ye({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ge.create(this,this._def)}nullable(){return Ke.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return re.create(this)}promise(){return Dt.create(this,this._def)}or(e){return Pt.create([this,e],this._def)}and(e){return Lt.create(this,e,this._def)}transform(e){return new Ye({...A(this._def),schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new gn({...A(this._def),innerType:this,defaultValue:t,typeName:S.ZodDefault})}brand(){return new xr({typeName:S.ZodBranded,type:this,...A(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new yn({...A(this._def),innerType:this,catchValue:t,typeName:S.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return On.create(this,e)}readonly(){return vn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const tr=/^c[^\s-]{8,}$/i,nr=/^[0-9a-z]+$/,or=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ir=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,sr=/^[a-z0-9_-]{21}$/i,rr=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ar=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,lr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ur="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let en;const cr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,dr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,fr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,pr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,es="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",gr=new RegExp(`^${es}$`);function ts(o){let e="[0-5]\\d";o.precision?e=`${e}\\.\\d{${o.precision}}`:o.precision==null&&(e=`${e}(\\.\\d+)?`);const t=o.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function yr(o){return new RegExp(`^${ts(o)}$`)}function vr(o){let e=`${es}T${ts(o)}`;const t=[];return t.push(o.local?"Z?":"Z"),o.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Cr(o,e){return!!((e==="v4"||!e)&&cr.test(o)||(e==="v6"||!e)&&fr.test(o))}function Tr(o,e){if(!rr.test(o))return!1;try{const[t]=o.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function _r(o,e){return!!((e==="v4"||!e)&&dr.test(o)||(e==="v6"||!e)&&pr.test(o))}class se extends R{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.string,received:s.parsedType}),I}const n=new z;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const l=e.data.length>s.value,u=e.data.length<s.value;(l||u)&&(i=this._getOrReturnCtx(e,i),l?C(i,{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):u&&C(i,{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")lr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"email",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")en||(en=new RegExp(ur,"u")),en.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"emoji",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")ir.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"uuid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")sr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"nanoid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")tr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cuid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")nr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cuid2",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")or.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"ulid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),C(i,{validation:"url",code:v.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"regex",code:v.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?vr(s).test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?gr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?yr(s).test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?ar.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"duration",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?Cr(e.data,s.version)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"ip",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?Tr(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"jwt",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?_r(e.data,s.version)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cidr",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?mr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"base64",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?hr.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"base64url",code:v.invalid_string,message:s.message}),n.dirty()):P.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(i=>e.test(i),{validation:t,code:v.invalid_string,..._.errToObj(n)})}_addCheck(e){return new se({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,..._.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,..._.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,..._.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new se({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new se({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new se({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}se.create=o=>new se({checks:[],typeName:S.ZodString,coerce:(o==null?void 0:o.coerce)??!1,...A(o)});function Er(o,e){const t=(o.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(o.toFixed(i).replace(".","")),l=Number.parseInt(e.toFixed(i).replace(".",""));return s%l/10**i}class we extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.number,received:s.parsedType}),I}let n;const i=new z;for(const s of this._def.checks)s.kind==="int"?P.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:v.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?Er(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_finite,message:s.message}),i.dirty()):P.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,n,i){return new we({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(i)}]})}_addCheck(e){return new we({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&P.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}we.create=o=>new we({checks:[],typeName:S.ZodNumber,coerce:(o==null?void 0:o.coerce)||!1,...A(o)});class Me extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let n;const i=new z;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):P.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return C(t,{code:v.invalid_type,expected:T.bigint,received:t.parsedType}),I}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,n,i){return new Me({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(i)}]})}_addCheck(e){return new Me({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Me.create=o=>new Me({checks:[],typeName:S.ZodBigInt,coerce:(o==null?void 0:o.coerce)??!1,...A(o)});class Nt extends R{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.boolean,received:n.parsedType}),I}return Q(e.data)}}Nt.create=o=>new Nt({typeName:S.ZodBoolean,coerce:(o==null?void 0:o.coerce)||!1,...A(o)});class Je extends R{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.date,received:s.parsedType}),I}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_date}),I}const n=new z;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):P.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Je({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Je.create=o=>new Je({checks:[],coerce:(o==null?void 0:o.coerce)||!1,typeName:S.ZodDate,...A(o)});class io extends R{_parse(e){if(this._getType(e)!==T.symbol){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.symbol,received:n.parsedType}),I}return Q(e.data)}}io.create=o=>new io({typeName:S.ZodSymbol,...A(o)});class so extends R{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.undefined,received:n.parsedType}),I}return Q(e.data)}}so.create=o=>new so({typeName:S.ZodUndefined,...A(o)});class ro extends R{_parse(e){if(this._getType(e)!==T.null){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.null,received:n.parsedType}),I}return Q(e.data)}}ro.create=o=>new ro({typeName:S.ZodNull,...A(o)});class ao extends R{constructor(){super(...arguments),this._any=!0}_parse(e){return Q(e.data)}}ao.create=o=>new ao({typeName:S.ZodAny,...A(o)});class pn extends R{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Q(e.data)}}pn.create=o=>new pn({typeName:S.ZodUnknown,...A(o)});class Ce extends R{_parse(e){const t=this._getOrReturnCtx(e);return C(t,{code:v.invalid_type,expected:T.never,received:t.parsedType}),I}}Ce.create=o=>new Ce({typeName:S.ZodNever,...A(o)});class lo extends R{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.void,received:n.parsedType}),I}return Q(e.data)}}lo.create=o=>new lo({typeName:S.ZodVoid,...A(o)});class re extends R{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),i=this._def;if(t.parsedType!==T.array)return C(t,{code:v.invalid_type,expected:T.array,received:t.parsedType}),I;if(i.exactLength!==null){const l=t.data.length>i.exactLength.value,u=t.data.length<i.exactLength.value;(l||u)&&(C(t,{code:l?v.too_big:v.too_small,minimum:u?i.exactLength.value:void 0,maximum:l?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(C(t,{code:v.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(C(t,{code:v.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((l,u)=>i.type._parseAsync(new le(t,l,t.path,u)))).then(l=>z.mergeArray(n,l));const s=[...t.data].map((l,u)=>i.type._parseSync(new le(t,l,t.path,u)));return z.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new re({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new re({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new re({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}re.create=(o,e)=>new re({type:o,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray,...A(e)});function Ne(o){if(o instanceof G){const e={};for(const t in o.shape){const n=o.shape[t];e[t]=ge.create(Ne(n))}return new G({...o._def,shape:()=>e})}else return o instanceof re?new re({...o._def,type:Ne(o.element)}):o instanceof ge?ge.create(Ne(o.unwrap())):o instanceof Ke?Ke.create(Ne(o.unwrap())):o instanceof Re?Re.create(o.items.map(e=>Ne(e))):o}class G extends R{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=P.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){const c=this._getOrReturnCtx(e);return C(c,{code:v.invalid_type,expected:T.object,received:c.parsedType}),I}const{status:n,ctx:i}=this._processInputParams(e),{shape:s,keys:l}=this._getCached(),u=[];if(!(this._def.catchall instanceof Ce&&this._def.unknownKeys==="strip"))for(const c in i.data)l.includes(c)||u.push(c);const d=[];for(const c of l){const f=s[c],p=i.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new le(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Ce){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of u)d.push({key:{status:"valid",value:f},value:{status:"valid",value:i.data[f]}});else if(c==="strict")u.length>0&&(C(i,{code:v.unrecognized_keys,keys:u}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of u){const p=i.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new le(i,p,i.path,f)),alwaysSet:f in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const p=await f.key,m=await f.value;c.push({key:p,value:m,alwaysSet:f.alwaysSet})}return c}).then(c=>z.mergeObjectSync(n,c)):z.mergeObjectSync(n,d)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new G({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,l;const i=((l=(s=this._def).errorMap)==null?void 0:l.call(s,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:_.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new G({...this._def,unknownKeys:"strip"})}passthrough(){return new G({...this._def,unknownKeys:"passthrough"})}extend(e){return new G({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new G({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:S.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new G({...this._def,catchall:e})}pick(e){const t={};for(const n of P.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new G({...this._def,shape:()=>t})}omit(e){const t={};for(const n of P.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new G({...this._def,shape:()=>t})}deepPartial(){return Ne(this)}partial(e){const t={};for(const n of P.objectKeys(this.shape)){const i=this.shape[n];e&&!e[n]?t[n]=i:t[n]=i.optional()}return new G({...this._def,shape:()=>t})}required(e){const t={};for(const n of P.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof ge;)s=s._def.innerType;t[n]=s}return new G({...this._def,shape:()=>t})}keyof(){return ns(P.objectKeys(this.shape))}}G.create=(o,e)=>new G({shape:()=>o,unknownKeys:"strip",catchall:Ce.create(),typeName:S.ZodObject,...A(e)});G.strictCreate=(o,e)=>new G({shape:()=>o,unknownKeys:"strict",catchall:Ce.create(),typeName:S.ZodObject,...A(e)});G.lazycreate=(o,e)=>new G({shape:o,unknownKeys:"strip",catchall:Ce.create(),typeName:S.ZodObject,...A(e)});class Pt extends R{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function i(s){for(const u of s)if(u.result.status==="valid")return u.result;for(const u of s)if(u.result.status==="dirty")return t.common.issues.push(...u.ctx.common.issues),u.result;const l=s.map(u=>new de(u.ctx.common.issues));return C(t,{code:v.invalid_union,unionErrors:l}),I}if(t.common.async)return Promise.all(n.map(async s=>{const l={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:l}),ctx:l}})).then(i);{let s;const l=[];for(const d of n){const c={...t,common:{...t.common,issues:[]},parent:null},f=d._parseSync({data:t.data,path:t.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!s&&(s={result:f,ctx:c}),c.common.issues.length&&l.push(c.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const u=l.map(d=>new de(d));return C(t,{code:v.invalid_union,unionErrors:u}),I}}get options(){return this._def.options}}Pt.create=(o,e)=>new Pt({options:o,typeName:S.ZodUnion,...A(e)});function mn(o,e){const t=fe(o),n=fe(e);if(o===e)return{valid:!0,data:o};if(t===T.object&&n===T.object){const i=P.objectKeys(e),s=P.objectKeys(o).filter(u=>i.indexOf(u)!==-1),l={...o,...e};for(const u of s){const d=mn(o[u],e[u]);if(!d.valid)return{valid:!1};l[u]=d.data}return{valid:!0,data:l}}else if(t===T.array&&n===T.array){if(o.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<o.length;s++){const l=o[s],u=e[s],d=mn(l,u);if(!d.valid)return{valid:!1};i.push(d.data)}return{valid:!0,data:i}}else return t===T.date&&n===T.date&&+o==+e?{valid:!0,data:o}:{valid:!1}}class Lt extends R{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=(s,l)=>{if(to(s)||to(l))return I;const u=mn(s.value,l.value);return u.valid?((no(s)||no(l))&&t.dirty(),{status:t.value,value:u.data}):(C(n,{code:v.invalid_intersection_types}),I)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,l])=>i(s,l)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Lt.create=(o,e,t)=>new Lt({left:o,right:e,typeName:S.ZodIntersection,...A(t)});class Re extends R{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.array)return C(n,{code:v.invalid_type,expected:T.array,received:n.parsedType}),I;if(n.data.length<this._def.items.length)return C(n,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),I;!this._def.rest&&n.data.length>this._def.items.length&&(C(n,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((l,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new le(n,l,n.path,u)):null}).filter(l=>!!l);return n.common.async?Promise.all(s).then(l=>z.mergeArray(t,l)):z.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Re({...this._def,rest:e})}}Re.create=(o,e)=>{if(!Array.isArray(o))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Re({items:o,typeName:S.ZodTuple,rest:null,...A(e)})};class bt extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.object)return C(n,{code:v.invalid_type,expected:T.object,received:n.parsedType}),I;const i=[],s=this._def.keyType,l=this._def.valueType;for(const u in n.data)i.push({key:s._parse(new le(n,u,n.path,u)),value:l._parse(new le(n,n.data[u],n.path,u)),alwaysSet:u in n.data});return n.common.async?z.mergeObjectAsync(t,i):z.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof R?new bt({keyType:e,valueType:t,typeName:S.ZodRecord,...A(n)}):new bt({keyType:se.create(),valueType:e,typeName:S.ZodRecord,...A(t)})}}class uo extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.map)return C(n,{code:v.invalid_type,expected:T.map,received:n.parsedType}),I;const i=this._def.keyType,s=this._def.valueType,l=[...n.data.entries()].map(([u,d],c)=>({key:i._parse(new le(n,u,n.path,[c,"key"])),value:s._parse(new le(n,d,n.path,[c,"value"]))}));if(n.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of l){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return I;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),u.set(c.value,f.value)}return{status:t.value,value:u}})}else{const u=new Map;for(const d of l){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return I;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),u.set(c.value,f.value)}return{status:t.value,value:u}}}}uo.create=(o,e,t)=>new uo({valueType:e,keyType:o,typeName:S.ZodMap,...A(t)});class lt extends R{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.set)return C(n,{code:v.invalid_type,expected:T.set,received:n.parsedType}),I;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(C(n,{code:v.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(C(n,{code:v.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function l(d){const c=new Set;for(const f of d){if(f.status==="aborted")return I;f.status==="dirty"&&t.dirty(),c.add(f.value)}return{status:t.value,value:c}}const u=[...n.data.values()].map((d,c)=>s._parse(new le(n,d,n.path,c)));return n.common.async?Promise.all(u).then(d=>l(d)):l(u)}min(e,t){return new lt({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new lt({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}lt.create=(o,e)=>new lt({valueType:o,minSize:null,maxSize:null,typeName:S.ZodSet,...A(e)});class hn extends R{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}hn.create=(o,e)=>new hn({getter:o,typeName:S.ZodLazy,...A(e)});class co extends R{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),I}return{status:"valid",value:e.data}}get value(){return this._def.value}}co.create=(o,e)=>new co({value:o,typeName:S.ZodLiteral,...A(e)});function ns(o,e){return new ze({values:o,typeName:S.ZodEnum,...A(e)})}class ze extends R{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{expected:P.joinValues(n),received:t.parsedType,code:v.invalid_type}),I}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{received:t.data,code:v.invalid_enum_value,options:n}),I}return Q(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ze.create(e,{...this._def,...t})}exclude(e,t=this._def){return ze.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}ze.create=ns;class fo extends R{_parse(e){const t=P.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==T.string&&n.parsedType!==T.number){const i=P.objectValues(t);return C(n,{expected:P.joinValues(i),received:n.parsedType,code:v.invalid_type}),I}if(this._cache||(this._cache=new Set(P.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=P.objectValues(t);return C(n,{received:n.data,code:v.invalid_enum_value,options:i}),I}return Q(e.data)}get enum(){return this._def.values}}fo.create=(o,e)=>new fo({values:o,typeName:S.ZodNativeEnum,...A(e)});class Dt extends R{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return C(t,{code:v.invalid_type,expected:T.promise,received:t.parsedType}),I;const n=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return Q(n.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Dt.create=(o,e)=>new Dt({type:o,typeName:S.ZodPromise,...A(e)});class Ye extends R{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:l=>{C(n,l),l.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const l=i.transform(n.data,s);if(n.common.async)return Promise.resolve(l).then(async u=>{if(t.value==="aborted")return I;const d=await this._def.schema._parseAsync({data:u,path:n.path,parent:n});return d.status==="aborted"?I:d.status==="dirty"||t.value==="dirty"?je(d.value):d});{if(t.value==="aborted")return I;const u=this._def.schema._parseSync({data:l,path:n.path,parent:n});return u.status==="aborted"?I:u.status==="dirty"||t.value==="dirty"?je(u.value):u}}if(i.type==="refinement"){const l=u=>{const d=i.refinement(u,s);if(n.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(n.common.async===!1){const u=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return u.status==="aborted"?I:(u.status==="dirty"&&t.dirty(),l(u.value),{status:t.value,value:u.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(u=>u.status==="aborted"?I:(u.status==="dirty"&&t.dirty(),l(u.value).then(()=>({status:t.value,value:u.value}))))}if(i.type==="transform")if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!$e(l))return I;const u=i.transform(l.value,s);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:u}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>$e(l)?Promise.resolve(i.transform(l.value,s)).then(u=>({status:t.value,value:u})):I);P.assertNever(i)}}Ye.create=(o,e,t)=>new Ye({schema:o,typeName:S.ZodEffects,effect:e,...A(t)});Ye.createWithPreprocess=(o,e,t)=>new Ye({schema:e,effect:{type:"preprocess",transform:o},typeName:S.ZodEffects,...A(t)});class ge extends R{_parse(e){return this._getType(e)===T.undefined?Q(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ge.create=(o,e)=>new ge({innerType:o,typeName:S.ZodOptional,...A(e)});class Ke extends R{_parse(e){return this._getType(e)===T.null?Q(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ke.create=(o,e)=>new Ke({innerType:o,typeName:S.ZodNullable,...A(e)});class gn extends R{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===T.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}gn.create=(o,e)=>new gn({innerType:o,typeName:S.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...A(e)});class yn extends R{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return kt(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new de(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new de(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}yn.create=(o,e)=>new yn({innerType:o,typeName:S.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...A(e)});class po extends R{_parse(e){if(this._getType(e)!==T.nan){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.nan,received:n.parsedType}),I}return{status:"valid",value:e.data}}}po.create=o=>new po({typeName:S.ZodNaN,...A(o)});class xr extends R{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class On extends R{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?I:s.status==="dirty"?(t.dirty(),je(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?I:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new On({in:e,out:t,typeName:S.ZodPipeline})}}class vn extends R{_parse(e){const t=this._def.innerType._parse(e),n=i=>($e(i)&&(i.value=Object.freeze(i.value)),i);return kt(t)?t.then(i=>n(i)):n(t)}unwrap(){return this._def.innerType}}vn.create=(o,e)=>new vn({innerType:o,typeName:S.ZodReadonly,...A(e)});var S;(function(o){o.ZodString="ZodString",o.ZodNumber="ZodNumber",o.ZodNaN="ZodNaN",o.ZodBigInt="ZodBigInt",o.ZodBoolean="ZodBoolean",o.ZodDate="ZodDate",o.ZodSymbol="ZodSymbol",o.ZodUndefined="ZodUndefined",o.ZodNull="ZodNull",o.ZodAny="ZodAny",o.ZodUnknown="ZodUnknown",o.ZodNever="ZodNever",o.ZodVoid="ZodVoid",o.ZodArray="ZodArray",o.ZodObject="ZodObject",o.ZodUnion="ZodUnion",o.ZodDiscriminatedUnion="ZodDiscriminatedUnion",o.ZodIntersection="ZodIntersection",o.ZodTuple="ZodTuple",o.ZodRecord="ZodRecord",o.ZodMap="ZodMap",o.ZodSet="ZodSet",o.ZodFunction="ZodFunction",o.ZodLazy="ZodLazy",o.ZodLiteral="ZodLiteral",o.ZodEnum="ZodEnum",o.ZodEffects="ZodEffects",o.ZodNativeEnum="ZodNativeEnum",o.ZodOptional="ZodOptional",o.ZodNullable="ZodNullable",o.ZodDefault="ZodDefault",o.ZodCatch="ZodCatch",o.ZodPromise="ZodPromise",o.ZodBranded="ZodBranded",o.ZodPipeline="ZodPipeline",o.ZodReadonly="ZodReadonly"})(S||(S={}));const Ee=se.create,mo=we.create;Me.create;const Sr=Nt.create;Je.create;const ho=pn.create;Ce.create;const et=re.create,Ir=G.create,Ar=Pt.create;Lt.create;Re.create;const wr=bt.create,Mr=hn.create,Rr=ze.create;Dt.create;ge.create;Ke.create;const ke={string:o=>se.create({...o,coerce:!0}),number:o=>we.create({...o,coerce:!0}),boolean:o=>Nt.create({...o,coerce:!0}),bigint:o=>Me.create({...o,coerce:!0}),date:o=>Je.create({...o,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kr,Nr;function Pr(){return{geminiUrl:kr,vertexUrl:Nr}}function Lr(o,e,t){var n,i,s;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const l=Pr();return o.vertexai?(i=l.vertexUrl)!==null&&i!==void 0?i:e:(s=l.geminiUrl)!==null&&s!==void 0?s:t}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ft{}function x(o,e){const t=/\{([^}]+)\}/g;return o.replace(t,(n,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const s=e[i];return s!=null?String(s):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function a(o,e,t){for(let s=0;s<e.length-1;s++){const l=e[s];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in o))if(Array.isArray(t))o[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(o[u])){const d=o[u];if(Array.isArray(t))for(let c=0;c<d.length;c++){const f=d[c];a(f,e.slice(s+1),t[c])}else for(const c of d)a(c,e.slice(s+1),t)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in o||(o[u]=[{}]);const d=o[u];a(d[0],e.slice(s+1),t);return}(!o[l]||typeof o[l]!="object")&&(o[l]={}),o=o[l]}const n=e[e.length-1],i=o[n];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=t}function r(o,e){try{if(e.length===1&&e[0]==="_self")return o;for(let t=0;t<e.length;t++){if(typeof o!="object"||o===null)return;const n=e[t];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const s=o[i];return Array.isArray(s)?s.map(l=>r(l,e.slice(t+1))):void 0}else return}else o=o[n]}return o}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var go;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(go||(go={}));var yo;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(yo||(yo={}));var vo;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(vo||(vo={}));var Co;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(Co||(Co={}));var To;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(To||(To={}));var ie;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(ie||(ie={}));var _o;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(_o||(_o={}));var Eo;(function(o){o.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",o.NO_AUTH="NO_AUTH",o.API_KEY_AUTH="API_KEY_AUTH",o.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",o.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",o.OAUTH="OAUTH",o.OIDC_AUTH="OIDC_AUTH"})(Eo||(Eo={}));var xo;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(xo||(xo={}));var So;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(So||(So={}));var Io;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Io||(Io={}));var Ao;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(Ao||(Ao={}));var wo;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(wo||(wo={}));var Vt;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(Vt||(Vt={}));var Mo;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Mo||(Mo={}));var Cn;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Cn||(Cn={}));var Ro;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Ro||(Ro={}));var ko;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(ko||(ko={}));var No;(function(o){o.UNSPECIFIED="UNSPECIFIED",o.BLOCKING="BLOCKING",o.NON_BLOCKING="NON_BLOCKING"})(No||(No={}));var Po;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(Po||(Po={}));var Lo;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(Lo||(Lo={}));var bo;(function(o){o.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",o.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",o.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(bo||(bo={}));var Do;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(Do||(Do={}));var Vo;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(Vo||(Vo={}));var Fo;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(Fo||(Fo={}));var Uo;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Uo||(Uo={}));var Bo;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Bo||(Bo={}));var Oo;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Oo||(Oo={}));var Go;(function(o){o.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",o.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",o.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",o.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",o.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",o.EDIT_MODE_STYLE="EDIT_MODE_STYLE",o.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",o.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Go||(Go={}));var Ho;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(Ho||(Ho={}));var qo;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(qo||(qo={}));var $o;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})($o||($o={}));var Jo;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Jo||(Jo={}));var zo;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(zo||(zo={}));var Yo;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})(Yo||(Yo={}));var Ko;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Ko||(Ko={}));var Wo;(function(o){o.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",o.SILENT="SILENT",o.WHEN_IDLE="WHEN_IDLE",o.INTERRUPT="INTERRUPT"})(Wo||(Wo={}));var Zo;(function(o){o.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",o.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",o.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",o.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",o.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",o.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",o.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",o.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",o.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",o.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",o.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",o.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",o.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Zo||(Zo={}));var Xo;(function(o){o.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",o.QUALITY="QUALITY",o.DIVERSITY="DIVERSITY"})(Xo||(Xo={}));var Le;(function(o){o.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",o.PLAY="PLAY",o.PAUSE="PAUSE",o.STOP="STOP",o.RESET_CONTEXT="RESET_CONTEXT"})(Le||(Le={}));class Xe{get text(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const m of(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,h]of Object.entries(p))m!=="inlineData"&&(h!==null||h!==void 0)&&f.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,i,s,l,u,d,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,i,s,l,u,d,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Qo{}class jo{}class br{}class Dr{}class ei{}class ti{}class ni{}class Vr{}class oi{}class ii{}class si{}class Fr{}class Tn{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ur{}class Br{}class Or{get text(){var e,t,n;let i="",s=!1;const l=[];for(const u of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&l.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;s=!0,i+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?i:void 0}get data(){var e,t,n;let i="";const s=[];for(const l of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(l))u!=="inlineData"&&d!==null&&s.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(i+=atob(l.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class Gr{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function F(o,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function os(o,e){const t=F(o,e);return t?t.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:t.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${t}`:t:""}function is(o,e){return Array.isArray(e)?e.map(t=>Ft(o,t)):[Ft(o,e)]}function Ft(o,e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function Hr(o,e){const t=Ft(o,e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function qr(o,e){const t=Ft(o,e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function ri(o,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function ss(o,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>ri(o,t)):[ri(o,e)]}function _n(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function ai(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function li(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function K(o,e){if(e==null)throw new Error("ContentUnion is required");return _n(e)?e:{role:"user",parts:ss(o,e)}}function rs(o,e){if(!e)return[];if(o.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=K(o,t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const t=K(o,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>K(o,t)):[K(o,e)]}function ne(o,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(ai(e)||li(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[K(o,e)]}const t=[],n=[],i=_n(e[0]);for(const s of e){const l=_n(s);if(l!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)t.push(s);else{if(ai(s)||li(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(s)}}return i||t.push({role:"user",parts:ss(o,n)}),t}const ui=Rr(["string","number","integer","object","array","boolean","null"]),$r=Ar([ui,et(ui)]);function Jr(o=!0){const e=Mr(()=>{const t=Ir({type:$r.optional(),format:Ee().optional(),title:Ee().optional(),description:Ee().optional(),default:ho().optional(),items:e.optional(),minItems:ke.string().optional(),maxItems:ke.string().optional(),enum:et(ho()).optional(),properties:wr(Ee(),e).optional(),required:et(Ee()).optional(),minProperties:ke.string().optional(),maxProperties:ke.string().optional(),propertyOrdering:et(Ee()).optional(),minimum:mo().optional(),maximum:mo().optional(),minLength:ke.string().optional(),maxLength:ke.string().optional(),pattern:Ee().optional(),anyOf:et(e).optional(),additionalProperties:Sr().optional()});return o?t.strict():t});return e}function zr(o,e){o.includes("null")&&(e.nullable=!0);const t=o.filter(n=>n!=="null");if(t.length===1)e.type=Object.keys(ie).includes(t[0].toUpperCase())?ie[t[0].toUpperCase()]:ie.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.keys(ie).includes(n.toUpperCase())?ie[n.toUpperCase()]:ie.TYPE_UNSPECIFIED})}}function nt(o){const e={},t=["items"],n=["anyOf"],i=["properties"];if(o.type&&o.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=o.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,o=s[1]):s[1].type==="null"&&(e.nullable=!0,o=s[0])),o.type instanceof Array&&zr(o.type,e);for(const[l,u]of Object.entries(o))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.keys(ie).includes(u.toUpperCase())?u.toUpperCase():ie.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=nt(u);else if(n.includes(l)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(nt(c))}e[l]=d}else if(i.includes(l)){const d={};for(const[c,f]of Object.entries(u))d[c]=nt(f);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=u}return e}function Ut(o,e){if(Object.keys(e).includes("$schema")){delete e.$schema;const t=Jr().parse(e);return nt(t)}else return nt(e)}function as(o,e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function ls(o,e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Kt(o,e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(t.parameters=Ut(o,t.parameters)),t.response&&(t.response=Ut(o,t.response));return e}function Wt(o,e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function Yr(o,e,t,n=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===n;return o.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${o.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Te(o,e){if(typeof e!="string")throw new Error("name must be a string");return Yr(o,e,"cachedContents")}function us(o,e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function _e(o,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function Kr(o){return o!=null&&typeof o=="object"&&"name"in o}function Wr(o){return o!=null&&typeof o=="object"&&"video"in o}function Zr(o){return o!=null&&typeof o=="object"&&"uri"in o}function cs(o,e){var t;let n;if(Kr(e)&&(n=e.name),!(Zr(e)&&(n=e.uri,n===void 0))&&!(Wr(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const s=n.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${n}`);n=s[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ds(o,e){let t;return o.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function fs(o,e){for(const t of["models","tunedModels","publisherModels"])if(Xr(e,t))return e[t];return[]}function Xr(o,e){return o!==null&&typeof o=="object"&&e in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qr(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function jr(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function ea(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Qr(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],jr(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function ci(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>ea(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function ta(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function na(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function oa(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],na(o,n)),t}function ia(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function sa(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],ia(o,n)),t}function ra(){return{}}function aa(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>ta(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],oa(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],sa(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],ra());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function la(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function ua(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function ca(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],ua(o,n)),t}function da(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],la(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],ca(o,i)),t}function fa(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);t!==void 0&&s!=null&&a(t,["expireTime"],s);const l=r(e,["displayName"]);t!==void 0&&l!=null&&a(t,["displayName"],l);const u=r(e,["contents"]);if(t!==void 0&&u!=null){let p=ne(o,u);Array.isArray(p)&&(p=p.map(m=>ci(o,m))),a(t,["contents"],p)}const d=r(e,["systemInstruction"]);t!==void 0&&d!=null&&a(t,["systemInstruction"],ci(o,K(o,d)));const c=r(e,["tools"]);if(t!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>aa(o,m))),a(t,["tools"],p)}const f=r(e,["toolConfig"]);if(t!==void 0&&f!=null&&a(t,["toolConfig"],da(o,f)),r(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function pa(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],os(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],fa(o,i,t)),t}function ma(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function ha(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function ga(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);return t!==void 0&&s!=null&&a(t,["expireTime"],s),n}function ya(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],ga(o,i,t)),t}function va(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function Ca(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],va(o,n,t)),t}function Ta(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function _a(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Ea(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Ta(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],_a(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function di(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Ea(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function xa(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function Sa(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Ia(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],Sa(o,n)),t}function Aa(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function wa(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Aa(o,n)),t}function Ma(){return{}}function Ra(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function ka(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],Ra(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function Na(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],ka(o,n)),t}function Pa(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>xa(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Ia(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],wa(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],Ma());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],Na(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function La(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function ba(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function Da(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],ba(o,n)),t}function Va(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],La(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],Da(o,i)),t}function Fa(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);t!==void 0&&s!=null&&a(t,["expireTime"],s);const l=r(e,["displayName"]);t!==void 0&&l!=null&&a(t,["displayName"],l);const u=r(e,["contents"]);if(t!==void 0&&u!=null){let m=ne(o,u);Array.isArray(m)&&(m=m.map(h=>di(o,h))),a(t,["contents"],m)}const d=r(e,["systemInstruction"]);t!==void 0&&d!=null&&a(t,["systemInstruction"],di(o,K(o,d)));const c=r(e,["tools"]);if(t!==void 0&&c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>Pa(o,h))),a(t,["tools"],m)}const f=r(e,["toolConfig"]);t!==void 0&&f!=null&&a(t,["toolConfig"],Va(o,f));const p=r(e,["kmsKeyName"]);return t!==void 0&&p!=null&&a(t,["encryption_spec","kmsKeyName"],p),n}function Ua(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],os(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Fa(o,i,t)),t}function Ba(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Oa(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Ga(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);return t!==void 0&&s!=null&&a(t,["expireTime"],s),n}function Ha(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],Te(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Ga(o,i,t)),t}function qa(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function $a(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],qa(o,n,t)),t}function Tt(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["model"]);s!=null&&a(t,["model"],s);const l=r(e,["createTime"]);l!=null&&a(t,["createTime"],l);const u=r(e,["updateTime"]);u!=null&&a(t,["updateTime"],u);const d=r(e,["expireTime"]);d!=null&&a(t,["expireTime"],d);const c=r(e,["usageMetadata"]);return c!=null&&a(t,["usageMetadata"],c),t}function Ja(){return{}}function za(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Tt(o,l))),a(t,["cachedContents"],s)}return t}function _t(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["model"]);s!=null&&a(t,["model"],s);const l=r(e,["createTime"]);l!=null&&a(t,["createTime"],l);const u=r(e,["updateTime"]);u!=null&&a(t,["updateTime"],u);const d=r(e,["expireTime"]);d!=null&&a(t,["expireTime"],d);const c=r(e,["usageMetadata"]);return c!=null&&a(t,["usageMetadata"],c),t}function Ya(){return{}}function Ka(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>_t(o,l))),a(t,["cachedContents"],s)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var We;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(We||(We={}));class Zt{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};n?typeof n=="object"?l=Object.assign({},n):l=n:l={config:{}},l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(s=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wa extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Zt(We.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ua(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>_t(this.apiClient,f))}else{const c=pa(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Tt(this.apiClient,f))}}async get(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ba(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>_t(this.apiClient,f))}else{const c=ma(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Tt(this.apiClient,f))}}async delete(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Oa(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Ya(),p=new ii;return Object.assign(p,f),p})}else{const c=ha(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Ja(),p=new ii;return Object.assign(p,f),p})}}async update(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ha(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>_t(this.apiClient,f))}else{const c=ya(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Tt(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=$a(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ka(this.apiClient,f),m=new si;return Object.assign(m,p),m})}else{const c=Ca(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=za(this.apiClient,f),m=new si;return Object.assign(m,p),m})}}}function fi(o){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&o[e],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function U(o){return this instanceof U?(this.v=o,this):new U(o)}function ot(o,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(h){return function(g){return Promise.resolve(g).then(h,p)}}function u(h,g){n[h]&&(i[h]=function(y){return new Promise(function(E,M){s.push([h,y,E,M])>1||d(h,y)})},g&&(i[h]=g(i[h])))}function d(h,g){try{c(n[h](g))}catch(y){m(s[0][3],y)}}function c(h){h.value instanceof U?Promise.resolve(h.value.v).then(f,p):m(s[0][2],h)}function f(h){d("next",h)}function p(h){d("throw",h)}function m(h,g){h(g),s.shift(),s.length&&d(s[0][0],s[0][1])}}function Et(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],t;return e?e.call(o):(o=typeof fi=="function"?fi(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=o[s]&&function(l){return new Promise(function(u,d){l=o[s](l),i(u,d,l.done,l.value)})}}function i(s,l,u,d){Promise.resolve(d).then(function(c){s({value:c,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Za(o){var e;if(o.candidates==null||o.candidates.length===0)return!1;const t=(e=o.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:ps(t)}function ps(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const e of o.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Xa(o){if(o.length!==0){for(const e of o)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function pi(o){if(o===void 0||o.length===0)return[];const e=[],t=o.length;let n=0;for(;n<t;)if(o[n].role==="user")e.push(o[n]),n++;else{const i=[];let s=!0;for(;n<t&&o[n].role==="model";)i.push(o[n]),s&&!ps(o[n])&&(s=!1),n++;s?e.push(...i):e.pop()}return e}class Qa{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new ja(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ja{constructor(e,t,n,i={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=s,this.sendPromise=Promise.resolve(),Xa(s)}async sendMessage(e){var t;await this.sendPromise;const n=K(this.apiClient,e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,l,u;const d=await i,c=(l=(s=d.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content,f=d.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];f!=null&&(m=(u=f.slice(p))!==null&&u!==void 0?u:[]);const h=c?[c]:[];this.recordHistory(n,h,m)})(),await this.sendPromise,i}async sendMessageStream(e){var t;await this.sendPromise;const n=K(this.apiClient,e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const s=await i;return this.processStreamResponse(s,n)}getHistory(e=!1){const t=e?pi(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var n,i;return ot(this,arguments,function*(){var l,u,d,c;const f=[];try{for(var p=!0,m=Et(e),h;h=yield U(m.next()),l=h.done,!l;p=!0){c=h.value,p=!1;const g=c;if(Za(g)){const y=(i=(n=g.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;y!==void 0&&f.push(y)}yield yield U(g)}}catch(g){u={error:g}}finally{try{!p&&!l&&(d=m.return)&&(yield U(d.call(m)))}finally{if(u)throw u.error}}this.recordHistory(t,f)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(s=>s.role!==void 0)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...pi(n)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function el(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function tl(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],el(o,n,t)),t}function nl(o,e){const t={},n=r(e,["details"]);n!=null&&a(t,["details"],n);const i=r(e,["message"]);i!=null&&a(t,["message"],i);const s=r(e,["code"]);return s!=null&&a(t,["code"],s),t}function ol(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["mimeType"]);s!=null&&a(t,["mimeType"],s);const l=r(e,["sizeBytes"]);l!=null&&a(t,["sizeBytes"],l);const u=r(e,["createTime"]);u!=null&&a(t,["createTime"],u);const d=r(e,["expirationTime"]);d!=null&&a(t,["expirationTime"],d);const c=r(e,["updateTime"]);c!=null&&a(t,["updateTime"],c);const f=r(e,["sha256Hash"]);f!=null&&a(t,["sha256Hash"],f);const p=r(e,["uri"]);p!=null&&a(t,["uri"],p);const m=r(e,["downloadUri"]);m!=null&&a(t,["downloadUri"],m);const h=r(e,["state"]);h!=null&&a(t,["state"],h);const g=r(e,["source"]);g!=null&&a(t,["source"],g);const y=r(e,["videoMetadata"]);y!=null&&a(t,["videoMetadata"],y);const E=r(e,["error"]);return E!=null&&a(t,["error"],nl(o,E)),t}function il(o,e){const t={},n=r(e,["file"]);n!=null&&a(t,["file"],ol(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function sl(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","file"],cs(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function rl(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","file"],cs(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function al(o,e){const t={},n=r(e,["details"]);n!=null&&a(t,["details"],n);const i=r(e,["message"]);i!=null&&a(t,["message"],i);const s=r(e,["code"]);return s!=null&&a(t,["code"],s),t}function En(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["mimeType"]);s!=null&&a(t,["mimeType"],s);const l=r(e,["sizeBytes"]);l!=null&&a(t,["sizeBytes"],l);const u=r(e,["createTime"]);u!=null&&a(t,["createTime"],u);const d=r(e,["expirationTime"]);d!=null&&a(t,["expirationTime"],d);const c=r(e,["updateTime"]);c!=null&&a(t,["updateTime"],c);const f=r(e,["sha256Hash"]);f!=null&&a(t,["sha256Hash"],f);const p=r(e,["uri"]);p!=null&&a(t,["uri"],p);const m=r(e,["downloadUri"]);m!=null&&a(t,["downloadUri"],m);const h=r(e,["state"]);h!=null&&a(t,["state"],h);const g=r(e,["source"]);g!=null&&a(t,["source"],g);const y=r(e,["videoMetadata"]);y!=null&&a(t,["videoMetadata"],y);const E=r(e,["error"]);return E!=null&&a(t,["error"],al(o,E)),t}function ll(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["files"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>En(o,l))),a(t,["files"],s)}return t}function ul(){return{}}function cl(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dl extends ft{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Zt(We.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>En(this.apiClient,t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=tl(this.apiClient,e);return s=x("files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=ll(this.apiClient,d),f=new Fr;return Object.assign(f,c),f})}}async createInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=il(this.apiClient,e);return s=x("upload/v1beta/files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=ul(),c=new Ur;return Object.assign(c,d),c})}}async get(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=sl(this.apiClient,e);return s=x("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>En(this.apiClient,d))}}async delete(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rl(this.apiClient,e);return s=x("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=cl(),c=new Br;return Object.assign(c,d),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fl(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function pl(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function ms(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],fl(o,n)),t}function ml(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],pl(o,n)),t}function hl(o,e){const t={},n=r(e,["speaker"]);n!=null&&a(t,["speaker"],n);const i=r(e,["voiceConfig"]);return i!=null&&a(t,["voiceConfig"],ms(o,i)),t}function gl(o,e){const t={},n=r(e,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>hl(o,s))),a(t,["speakerVoiceConfigs"],i)}return t}function yl(o,e){const t={},n=r(e,["voiceConfig"]);n!=null&&a(t,["voiceConfig"],ms(o,n));const i=r(e,["multiSpeakerVoiceConfig"]);i!=null&&a(t,["multiSpeakerVoiceConfig"],gl(o,i));const s=r(e,["languageCode"]);return s!=null&&a(t,["languageCode"],s),t}function vl(o,e){const t={},n=r(e,["voiceConfig"]);if(n!=null&&a(t,["voiceConfig"],ml(o,n)),r(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(e,["languageCode"]);return i!=null&&a(t,["languageCode"],i),t}function Cl(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Tl(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function _l(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function El(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function xl(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Cl(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],_l(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Sl(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Tl(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],El(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Il(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>xl(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Al(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Sl(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function wl(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function Ml(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function Rl(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function kl(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Nl(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],Rl(o,n)),t}function Pl(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],kl(o,n)),t}function Ll(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function bl(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function Dl(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Ll(o,n)),t}function Vl(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],bl(o,n)),t}function Fl(){return{}}function Ul(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function Bl(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],Ul(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function Ol(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],Bl(o,n)),t}function Gl(){return{}}function Hl(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>wl(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],Nl(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],Dl(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],Gl());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function ql(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>Ml(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Pl(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],Vl(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],Fl());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],Ol(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function $l(o,e){const t={},n=r(e,["handle"]);if(n!=null&&a(t,["handle"],n),r(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function Jl(o,e){const t={},n=r(e,["handle"]);n!=null&&a(t,["handle"],n);const i=r(e,["transparent"]);return i!=null&&a(t,["transparent"],i),t}function mi(){return{}}function hi(){return{}}function zl(o,e){const t={},n=r(e,["disabled"]);n!=null&&a(t,["disabled"],n);const i=r(e,["startOfSpeechSensitivity"]);i!=null&&a(t,["startOfSpeechSensitivity"],i);const s=r(e,["endOfSpeechSensitivity"]);s!=null&&a(t,["endOfSpeechSensitivity"],s);const l=r(e,["prefixPaddingMs"]);l!=null&&a(t,["prefixPaddingMs"],l);const u=r(e,["silenceDurationMs"]);return u!=null&&a(t,["silenceDurationMs"],u),t}function Yl(o,e){const t={},n=r(e,["disabled"]);n!=null&&a(t,["disabled"],n);const i=r(e,["startOfSpeechSensitivity"]);i!=null&&a(t,["startOfSpeechSensitivity"],i);const s=r(e,["endOfSpeechSensitivity"]);s!=null&&a(t,["endOfSpeechSensitivity"],s);const l=r(e,["prefixPaddingMs"]);l!=null&&a(t,["prefixPaddingMs"],l);const u=r(e,["silenceDurationMs"]);return u!=null&&a(t,["silenceDurationMs"],u),t}function Kl(o,e){const t={},n=r(e,["automaticActivityDetection"]);n!=null&&a(t,["automaticActivityDetection"],zl(o,n));const i=r(e,["activityHandling"]);i!=null&&a(t,["activityHandling"],i);const s=r(e,["turnCoverage"]);return s!=null&&a(t,["turnCoverage"],s),t}function Wl(o,e){const t={},n=r(e,["automaticActivityDetection"]);n!=null&&a(t,["automaticActivityDetection"],Yl(o,n));const i=r(e,["activityHandling"]);i!=null&&a(t,["activityHandling"],i);const s=r(e,["turnCoverage"]);return s!=null&&a(t,["turnCoverage"],s),t}function Zl(o,e){const t={},n=r(e,["targetTokens"]);return n!=null&&a(t,["targetTokens"],n),t}function Xl(o,e){const t={},n=r(e,["targetTokens"]);return n!=null&&a(t,["targetTokens"],n),t}function Ql(o,e){const t={},n=r(e,["triggerTokens"]);n!=null&&a(t,["triggerTokens"],n);const i=r(e,["slidingWindow"]);return i!=null&&a(t,["slidingWindow"],Zl(o,i)),t}function jl(o,e){const t={},n=r(e,["triggerTokens"]);n!=null&&a(t,["triggerTokens"],n);const i=r(e,["slidingWindow"]);return i!=null&&a(t,["slidingWindow"],Xl(o,i)),t}function eu(o,e){const t={},n=r(e,["proactiveAudio"]);return n!=null&&a(t,["proactiveAudio"],n),t}function tu(o,e){const t={},n=r(e,["proactiveAudio"]);return n!=null&&a(t,["proactiveAudio"],n),t}function nu(o,e,t){const n={},i=r(e,["generationConfig"]);t!==void 0&&i!=null&&a(t,["setup","generationConfig"],i);const s=r(e,["responseModalities"]);t!==void 0&&s!=null&&a(t,["setup","generationConfig","responseModalities"],s);const l=r(e,["temperature"]);t!==void 0&&l!=null&&a(t,["setup","generationConfig","temperature"],l);const u=r(e,["topP"]);t!==void 0&&u!=null&&a(t,["setup","generationConfig","topP"],u);const d=r(e,["topK"]);t!==void 0&&d!=null&&a(t,["setup","generationConfig","topK"],d);const c=r(e,["maxOutputTokens"]);t!==void 0&&c!=null&&a(t,["setup","generationConfig","maxOutputTokens"],c);const f=r(e,["mediaResolution"]);t!==void 0&&f!=null&&a(t,["setup","generationConfig","mediaResolution"],f);const p=r(e,["seed"]);t!==void 0&&p!=null&&a(t,["setup","generationConfig","seed"],p);const m=r(e,["speechConfig"]);t!==void 0&&m!=null&&a(t,["setup","generationConfig","speechConfig"],yl(o,ls(o,m)));const h=r(e,["enableAffectiveDialog"]);t!==void 0&&h!=null&&a(t,["setup","generationConfig","enableAffectiveDialog"],h);const g=r(e,["systemInstruction"]);t!==void 0&&g!=null&&a(t,["setup","systemInstruction"],Il(o,K(o,g)));const y=r(e,["tools"]);if(t!==void 0&&y!=null){let H=Wt(o,y);Array.isArray(H)&&(H=H.map(q=>Hl(o,Kt(o,q)))),a(t,["setup","tools"],H)}const E=r(e,["sessionResumption"]);t!==void 0&&E!=null&&a(t,["setup","sessionResumption"],$l(o,E));const M=r(e,["inputAudioTranscription"]);t!==void 0&&M!=null&&a(t,["setup","inputAudioTranscription"],mi());const w=r(e,["outputAudioTranscription"]);t!==void 0&&w!=null&&a(t,["setup","outputAudioTranscription"],mi());const k=r(e,["realtimeInputConfig"]);t!==void 0&&k!=null&&a(t,["setup","realtimeInputConfig"],Kl(o,k));const L=r(e,["contextWindowCompression"]);t!==void 0&&L!=null&&a(t,["setup","contextWindowCompression"],Ql(o,L));const b=r(e,["proactivity"]);return t!==void 0&&b!=null&&a(t,["setup","proactivity"],eu(o,b)),n}function ou(o,e,t){const n={},i=r(e,["generationConfig"]);t!==void 0&&i!=null&&a(t,["setup","generationConfig"],i);const s=r(e,["responseModalities"]);t!==void 0&&s!=null&&a(t,["setup","generationConfig","responseModalities"],s);const l=r(e,["temperature"]);t!==void 0&&l!=null&&a(t,["setup","generationConfig","temperature"],l);const u=r(e,["topP"]);t!==void 0&&u!=null&&a(t,["setup","generationConfig","topP"],u);const d=r(e,["topK"]);t!==void 0&&d!=null&&a(t,["setup","generationConfig","topK"],d);const c=r(e,["maxOutputTokens"]);t!==void 0&&c!=null&&a(t,["setup","generationConfig","maxOutputTokens"],c);const f=r(e,["mediaResolution"]);t!==void 0&&f!=null&&a(t,["setup","generationConfig","mediaResolution"],f);const p=r(e,["seed"]);t!==void 0&&p!=null&&a(t,["setup","generationConfig","seed"],p);const m=r(e,["speechConfig"]);t!==void 0&&m!=null&&a(t,["setup","generationConfig","speechConfig"],vl(o,ls(o,m)));const h=r(e,["enableAffectiveDialog"]);t!==void 0&&h!=null&&a(t,["setup","generationConfig","enableAffectiveDialog"],h);const g=r(e,["systemInstruction"]);t!==void 0&&g!=null&&a(t,["setup","systemInstruction"],Al(o,K(o,g)));const y=r(e,["tools"]);if(t!==void 0&&y!=null){let H=Wt(o,y);Array.isArray(H)&&(H=H.map(q=>ql(o,Kt(o,q)))),a(t,["setup","tools"],H)}const E=r(e,["sessionResumption"]);t!==void 0&&E!=null&&a(t,["setup","sessionResumption"],Jl(o,E));const M=r(e,["inputAudioTranscription"]);t!==void 0&&M!=null&&a(t,["setup","inputAudioTranscription"],hi());const w=r(e,["outputAudioTranscription"]);t!==void 0&&w!=null&&a(t,["setup","outputAudioTranscription"],hi());const k=r(e,["realtimeInputConfig"]);t!==void 0&&k!=null&&a(t,["setup","realtimeInputConfig"],Wl(o,k));const L=r(e,["contextWindowCompression"]);t!==void 0&&L!=null&&a(t,["setup","contextWindowCompression"],jl(o,L));const b=r(e,["proactivity"]);return t!==void 0&&b!=null&&a(t,["setup","proactivity"],tu(o,b)),n}function iu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["setup","model"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],nu(o,i,t)),t}function su(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["setup","model"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],ou(o,i,t)),t}function ru(){return{}}function au(){return{}}function lu(){return{}}function uu(){return{}}function cu(o,e){const t={},n=r(e,["media"]);n!=null&&a(t,["mediaChunks"],is(o,n));const i=r(e,["audio"]);i!=null&&a(t,["audio"],qr(o,i));const s=r(e,["audioStreamEnd"]);s!=null&&a(t,["audioStreamEnd"],s);const l=r(e,["video"]);l!=null&&a(t,["video"],Hr(o,l));const u=r(e,["text"]);return u!=null&&a(t,["text"],u),r(e,["activityStart"])!=null&&a(t,["activityStart"],ru()),r(e,["activityEnd"])!=null&&a(t,["activityEnd"],lu()),t}function du(o,e){const t={},n=r(e,["media"]);if(n!=null&&a(t,["mediaChunks"],is(o,n)),r(e,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(e,["audioStreamEnd"]);if(i!=null&&a(t,["audioStreamEnd"],i),r(e,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(e,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(e,["activityStart"])!=null&&a(t,["activityStart"],au()),r(e,["activityEnd"])!=null&&a(t,["activityEnd"],uu()),t}function hs(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["weight"]);return i!=null&&a(t,["weight"],i),t}function fu(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>hs(o,s))),a(t,["weightedPrompts"],i)}return t}function gs(o,e){const t={},n=r(e,["temperature"]);n!=null&&a(t,["temperature"],n);const i=r(e,["topK"]);i!=null&&a(t,["topK"],i);const s=r(e,["seed"]);s!=null&&a(t,["seed"],s);const l=r(e,["guidance"]);l!=null&&a(t,["guidance"],l);const u=r(e,["bpm"]);u!=null&&a(t,["bpm"],u);const d=r(e,["density"]);d!=null&&a(t,["density"],d);const c=r(e,["brightness"]);c!=null&&a(t,["brightness"],c);const f=r(e,["scale"]);f!=null&&a(t,["scale"],f);const p=r(e,["muteBass"]);p!=null&&a(t,["muteBass"],p);const m=r(e,["muteDrums"]);m!=null&&a(t,["muteDrums"],m);const h=r(e,["onlyBassAndDrums"]);h!=null&&a(t,["onlyBassAndDrums"],h);const g=r(e,["musicGenerationMode"]);return g!=null&&a(t,["musicGenerationMode"],g),t}function pu(o,e){const t={},n=r(e,["musicGenerationConfig"]);return n!=null&&a(t,["musicGenerationConfig"],gs(o,n)),t}function ys(o,e){const t={},n=r(e,["model"]);return n!=null&&a(t,["model"],n),t}function vs(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>hs(o,s))),a(t,["weightedPrompts"],i)}return t}function xn(o,e){const t={},n=r(e,["setup"]);n!=null&&a(t,["setup"],ys(o,n));const i=r(e,["clientContent"]);i!=null&&a(t,["clientContent"],vs(o,i));const s=r(e,["musicGenerationConfig"]);s!=null&&a(t,["musicGenerationConfig"],gs(o,s));const l=r(e,["playbackControl"]);return l!=null&&a(t,["playbackControl"],l),t}function mu(){return{}}function hu(){return{}}function gu(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function yu(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function vu(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Cu(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Tu(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],gu(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],vu(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function _u(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],yu(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Cu(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Eu(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Tu(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function xu(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>_u(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function gi(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["finished"]);return i!=null&&a(t,["finished"],i),t}function yi(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["finished"]);return i!=null&&a(t,["finished"],i),t}function Su(o,e){const t={},n=r(e,["retrievedUrl"]);n!=null&&a(t,["retrievedUrl"],n);const i=r(e,["urlRetrievalStatus"]);return i!=null&&a(t,["urlRetrievalStatus"],i),t}function Iu(o,e){const t={},n=r(e,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Su(o,s))),a(t,["urlMetadata"],i)}return t}function Au(o,e){const t={},n=r(e,["modelTurn"]);n!=null&&a(t,["modelTurn"],Eu(o,n));const i=r(e,["turnComplete"]);i!=null&&a(t,["turnComplete"],i);const s=r(e,["interrupted"]);s!=null&&a(t,["interrupted"],s);const l=r(e,["groundingMetadata"]);l!=null&&a(t,["groundingMetadata"],l);const u=r(e,["generationComplete"]);u!=null&&a(t,["generationComplete"],u);const d=r(e,["inputTranscription"]);d!=null&&a(t,["inputTranscription"],gi(o,d));const c=r(e,["outputTranscription"]);c!=null&&a(t,["outputTranscription"],gi(o,c));const f=r(e,["urlContextMetadata"]);return f!=null&&a(t,["urlContextMetadata"],Iu(o,f)),t}function wu(o,e){const t={},n=r(e,["modelTurn"]);n!=null&&a(t,["modelTurn"],xu(o,n));const i=r(e,["turnComplete"]);i!=null&&a(t,["turnComplete"],i);const s=r(e,["interrupted"]);s!=null&&a(t,["interrupted"],s);const l=r(e,["groundingMetadata"]);l!=null&&a(t,["groundingMetadata"],l);const u=r(e,["generationComplete"]);u!=null&&a(t,["generationComplete"],u);const d=r(e,["inputTranscription"]);d!=null&&a(t,["inputTranscription"],yi(o,d));const c=r(e,["outputTranscription"]);return c!=null&&a(t,["outputTranscription"],yi(o,c)),t}function Mu(o,e){const t={},n=r(e,["id"]);n!=null&&a(t,["id"],n);const i=r(e,["args"]);i!=null&&a(t,["args"],i);const s=r(e,["name"]);return s!=null&&a(t,["name"],s),t}function Ru(o,e){const t={},n=r(e,["args"]);n!=null&&a(t,["args"],n);const i=r(e,["name"]);return i!=null&&a(t,["name"],i),t}function ku(o,e){const t={},n=r(e,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Mu(o,s))),a(t,["functionCalls"],i)}return t}function Nu(o,e){const t={},n=r(e,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ru(o,s))),a(t,["functionCalls"],i)}return t}function Pu(o,e){const t={},n=r(e,["ids"]);return n!=null&&a(t,["ids"],n),t}function Lu(o,e){const t={},n=r(e,["ids"]);return n!=null&&a(t,["ids"],n),t}function ht(o,e){const t={},n=r(e,["modality"]);n!=null&&a(t,["modality"],n);const i=r(e,["tokenCount"]);return i!=null&&a(t,["tokenCount"],i),t}function gt(o,e){const t={},n=r(e,["modality"]);n!=null&&a(t,["modality"],n);const i=r(e,["tokenCount"]);return i!=null&&a(t,["tokenCount"],i),t}function bu(o,e){const t={},n=r(e,["promptTokenCount"]);n!=null&&a(t,["promptTokenCount"],n);const i=r(e,["cachedContentTokenCount"]);i!=null&&a(t,["cachedContentTokenCount"],i);const s=r(e,["responseTokenCount"]);s!=null&&a(t,["responseTokenCount"],s);const l=r(e,["toolUsePromptTokenCount"]);l!=null&&a(t,["toolUsePromptTokenCount"],l);const u=r(e,["thoughtsTokenCount"]);u!=null&&a(t,["thoughtsTokenCount"],u);const d=r(e,["totalTokenCount"]);d!=null&&a(t,["totalTokenCount"],d);const c=r(e,["promptTokensDetails"]);if(c!=null){let h=c;Array.isArray(h)&&(h=h.map(g=>ht(o,g))),a(t,["promptTokensDetails"],h)}const f=r(e,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(g=>ht(o,g))),a(t,["cacheTokensDetails"],h)}const p=r(e,["responseTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(g=>ht(o,g))),a(t,["responseTokensDetails"],h)}const m=r(e,["toolUsePromptTokensDetails"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>ht(o,g))),a(t,["toolUsePromptTokensDetails"],h)}return t}function Du(o,e){const t={},n=r(e,["promptTokenCount"]);n!=null&&a(t,["promptTokenCount"],n);const i=r(e,["cachedContentTokenCount"]);i!=null&&a(t,["cachedContentTokenCount"],i);const s=r(e,["candidatesTokenCount"]);s!=null&&a(t,["responseTokenCount"],s);const l=r(e,["toolUsePromptTokenCount"]);l!=null&&a(t,["toolUsePromptTokenCount"],l);const u=r(e,["thoughtsTokenCount"]);u!=null&&a(t,["thoughtsTokenCount"],u);const d=r(e,["totalTokenCount"]);d!=null&&a(t,["totalTokenCount"],d);const c=r(e,["promptTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(y=>gt(o,y))),a(t,["promptTokensDetails"],g)}const f=r(e,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(y=>gt(o,y))),a(t,["cacheTokensDetails"],g)}const p=r(e,["candidatesTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(y=>gt(o,y))),a(t,["responseTokensDetails"],g)}const m=r(e,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(y=>gt(o,y))),a(t,["toolUsePromptTokensDetails"],g)}const h=r(e,["trafficType"]);return h!=null&&a(t,["trafficType"],h),t}function Vu(o,e){const t={},n=r(e,["timeLeft"]);return n!=null&&a(t,["timeLeft"],n),t}function Fu(o,e){const t={},n=r(e,["timeLeft"]);return n!=null&&a(t,["timeLeft"],n),t}function Uu(o,e){const t={},n=r(e,["newHandle"]);n!=null&&a(t,["newHandle"],n);const i=r(e,["resumable"]);i!=null&&a(t,["resumable"],i);const s=r(e,["lastConsumedClientMessageIndex"]);return s!=null&&a(t,["lastConsumedClientMessageIndex"],s),t}function Bu(o,e){const t={},n=r(e,["newHandle"]);n!=null&&a(t,["newHandle"],n);const i=r(e,["resumable"]);i!=null&&a(t,["resumable"],i);const s=r(e,["lastConsumedClientMessageIndex"]);return s!=null&&a(t,["lastConsumedClientMessageIndex"],s),t}function Ou(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],mu());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],Au(o,i));const s=r(e,["toolCall"]);s!=null&&a(t,["toolCall"],ku(o,s));const l=r(e,["toolCallCancellation"]);l!=null&&a(t,["toolCallCancellation"],Pu(o,l));const u=r(e,["usageMetadata"]);u!=null&&a(t,["usageMetadata"],bu(o,u));const d=r(e,["goAway"]);d!=null&&a(t,["goAway"],Vu(o,d));const c=r(e,["sessionResumptionUpdate"]);return c!=null&&a(t,["sessionResumptionUpdate"],Uu(o,c)),t}function Gu(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],hu());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],wu(o,i));const s=r(e,["toolCall"]);s!=null&&a(t,["toolCall"],Nu(o,s));const l=r(e,["toolCallCancellation"]);l!=null&&a(t,["toolCallCancellation"],Lu(o,l));const u=r(e,["usageMetadata"]);u!=null&&a(t,["usageMetadata"],Du(o,u));const d=r(e,["goAway"]);d!=null&&a(t,["goAway"],Fu(o,d));const c=r(e,["sessionResumptionUpdate"]);return c!=null&&a(t,["sessionResumptionUpdate"],Bu(o,c)),t}function Hu(){return{}}function qu(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["weight"]);return i!=null&&a(t,["weight"],i),t}function $u(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>qu(o,s))),a(t,["weightedPrompts"],i)}return t}function Ju(o,e){const t={},n=r(e,["temperature"]);n!=null&&a(t,["temperature"],n);const i=r(e,["topK"]);i!=null&&a(t,["topK"],i);const s=r(e,["seed"]);s!=null&&a(t,["seed"],s);const l=r(e,["guidance"]);l!=null&&a(t,["guidance"],l);const u=r(e,["bpm"]);u!=null&&a(t,["bpm"],u);const d=r(e,["density"]);d!=null&&a(t,["density"],d);const c=r(e,["brightness"]);c!=null&&a(t,["brightness"],c);const f=r(e,["scale"]);f!=null&&a(t,["scale"],f);const p=r(e,["muteBass"]);p!=null&&a(t,["muteBass"],p);const m=r(e,["muteDrums"]);m!=null&&a(t,["muteDrums"],m);const h=r(e,["onlyBassAndDrums"]);h!=null&&a(t,["onlyBassAndDrums"],h);const g=r(e,["musicGenerationMode"]);return g!=null&&a(t,["musicGenerationMode"],g),t}function zu(o,e){const t={},n=r(e,["clientContent"]);n!=null&&a(t,["clientContent"],$u(o,n));const i=r(e,["musicGenerationConfig"]);return i!=null&&a(t,["musicGenerationConfig"],Ju(o,i)),t}function Yu(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);i!=null&&a(t,["mimeType"],i);const s=r(e,["sourceMetadata"]);return s!=null&&a(t,["sourceMetadata"],zu(o,s)),t}function Ku(o,e){const t={},n=r(e,["audioChunks"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Yu(o,s))),a(t,["audioChunks"],i)}return t}function Wu(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["filteredReason"]);return i!=null&&a(t,["filteredReason"],i),t}function Zu(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],Hu());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],Ku(o,i));const s=r(e,["filteredPrompt"]);return s!=null&&a(t,["filteredPrompt"],Wu(o,s)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xu(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Qu(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function ju(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Xu(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Qu(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Xt(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>ju(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function ec(o,e){const t={};if(r(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=r(e,["category"]);n!=null&&a(t,["category"],n);const i=r(e,["threshold"]);return i!=null&&a(t,["threshold"],i),t}function tc(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function nc(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function oc(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],nc(o,n)),t}function ic(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function sc(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],ic(o,n)),t}function rc(){return{}}function ac(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>tc(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],oc(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],sc(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],rc());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function lc(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function uc(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function cc(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],uc(o,n)),t}function dc(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],lc(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],cc(o,i)),t}function fc(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function Cs(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],fc(o,n)),t}function pc(o,e){const t={},n=r(e,["speaker"]);n!=null&&a(t,["speaker"],n);const i=r(e,["voiceConfig"]);return i!=null&&a(t,["voiceConfig"],Cs(o,i)),t}function mc(o,e){const t={},n=r(e,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>pc(o,s))),a(t,["speakerVoiceConfigs"],i)}return t}function hc(o,e){const t={},n=r(e,["voiceConfig"]);n!=null&&a(t,["voiceConfig"],Cs(o,n));const i=r(e,["multiSpeakerVoiceConfig"]);i!=null&&a(t,["multiSpeakerVoiceConfig"],mc(o,i));const s=r(e,["languageCode"]);return s!=null&&a(t,["languageCode"],s),t}function gc(o,e){const t={},n=r(e,["includeThoughts"]);n!=null&&a(t,["includeThoughts"],n);const i=r(e,["thinkingBudget"]);return i!=null&&a(t,["thinkingBudget"],i),t}function yc(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Xt(o,K(o,i)));const s=r(e,["temperature"]);s!=null&&a(n,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(n,["topP"],l);const u=r(e,["topK"]);u!=null&&a(n,["topK"],u);const d=r(e,["candidateCount"]);d!=null&&a(n,["candidateCount"],d);const c=r(e,["maxOutputTokens"]);c!=null&&a(n,["maxOutputTokens"],c);const f=r(e,["stopSequences"]);f!=null&&a(n,["stopSequences"],f);const p=r(e,["responseLogprobs"]);p!=null&&a(n,["responseLogprobs"],p);const m=r(e,["logprobs"]);m!=null&&a(n,["logprobs"],m);const h=r(e,["presencePenalty"]);h!=null&&a(n,["presencePenalty"],h);const g=r(e,["frequencyPenalty"]);g!=null&&a(n,["frequencyPenalty"],g);const y=r(e,["seed"]);y!=null&&a(n,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&a(n,["responseMimeType"],E);const M=r(e,["responseSchema"]);if(M!=null&&a(n,["responseSchema"],Ut(o,M)),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const w=r(e,["safetySettings"]);if(t!==void 0&&w!=null){let D=w;Array.isArray(D)&&(D=D.map(oe=>ec(o,oe))),a(t,["safetySettings"],D)}const k=r(e,["tools"]);if(t!==void 0&&k!=null){let D=Wt(o,k);Array.isArray(D)&&(D=D.map(oe=>ac(o,Kt(o,oe)))),a(t,["tools"],D)}const L=r(e,["toolConfig"]);if(t!==void 0&&L!=null&&a(t,["toolConfig"],dc(o,L)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const b=r(e,["cachedContent"]);t!==void 0&&b!=null&&a(t,["cachedContent"],Te(o,b));const H=r(e,["responseModalities"]);H!=null&&a(n,["responseModalities"],H);const q=r(e,["mediaResolution"]);q!=null&&a(n,["mediaResolution"],q);const j=r(e,["speechConfig"]);if(j!=null&&a(n,["speechConfig"],hc(o,as(o,j))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=r(e,["thinkingConfig"]);return N!=null&&a(n,["thinkingConfig"],gc(o,N)),n}function vi(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);if(i!=null){let l=ne(o,i);Array.isArray(l)&&(l=l.map(u=>Xt(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],yc(o,s,t)),t}function vc(o,e,t){const n={},i=r(e,["taskType"]);t!==void 0&&i!=null&&a(t,["requests[]","taskType"],i);const s=r(e,["title"]);t!==void 0&&s!=null&&a(t,["requests[]","title"],s);const l=r(e,["outputDimensionality"]);if(t!==void 0&&l!=null&&a(t,["requests[]","outputDimensionality"],l),r(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Cc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);i!=null&&a(t,["requests[]","content"],rs(o,i));const s=r(e,["config"]);s!=null&&a(t,["config"],vc(o,s,t));const l=r(e,["model"]);return l!==void 0&&a(t,["requests[]","model"],F(o,l)),t}function Tc(o,e,t){const n={};if(r(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(e,["numberOfImages"]);t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i);const s=r(e,["aspectRatio"]);t!==void 0&&s!=null&&a(t,["parameters","aspectRatio"],s);const l=r(e,["guidanceScale"]);if(t!==void 0&&l!=null&&a(t,["parameters","guidanceScale"],l),r(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=r(e,["safetyFilterLevel"]);t!==void 0&&u!=null&&a(t,["parameters","safetySetting"],u);const d=r(e,["personGeneration"]);t!==void 0&&d!=null&&a(t,["parameters","personGeneration"],d);const c=r(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&a(t,["parameters","includeSafetyAttributes"],c);const f=r(e,["includeRaiReason"]);t!==void 0&&f!=null&&a(t,["parameters","includeRaiReason"],f);const p=r(e,["language"]);t!==void 0&&p!=null&&a(t,["parameters","language"],p);const m=r(e,["outputMimeType"]);t!==void 0&&m!=null&&a(t,["parameters","outputOptions","mimeType"],m);const h=r(e,["outputCompressionQuality"]);if(t!==void 0&&h!=null&&a(t,["parameters","outputOptions","compressionQuality"],h),r(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function _c(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],Tc(o,s,t)),t}function Ec(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function xc(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],ds(o,u)),n}function Sc(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],xc(o,n,t)),t}function Ic(o,e,t){const n={},i=r(e,["displayName"]);t!==void 0&&i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);t!==void 0&&s!=null&&a(t,["description"],s);const l=r(e,["defaultCheckpointId"]);return t!==void 0&&l!=null&&a(t,["defaultCheckpointId"],l),n}function Ac(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Ic(o,i,t)),t}function wc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Mc(o,e){const t={};if(r(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function Rc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);if(i!=null){let l=ne(o,i);Array.isArray(l)&&(l=l.map(u=>Xt(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],Mc(o,s)),t}function kc(o,e){const t={};if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(e,["imageBytes"]);n!=null&&a(t,["bytesBase64Encoded"],_e(o,n));const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Nc(o,e,t){const n={},i=r(e,["numberOfVideos"]);if(t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i),r(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=r(e,["durationSeconds"]);if(t!==void 0&&s!=null&&a(t,["parameters","durationSeconds"],s),r(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=r(e,["aspectRatio"]);if(t!==void 0&&l!=null&&a(t,["parameters","aspectRatio"],l),r(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const u=r(e,["personGeneration"]);if(t!==void 0&&u!=null&&a(t,["parameters","personGeneration"],u),r(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=r(e,["negativePrompt"]);if(t!==void 0&&d!=null&&a(t,["parameters","negativePrompt"],d),r(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Pc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["image"]);s!=null&&a(t,["instances[0]","image"],kc(o,s));const l=r(e,["config"]);return l!=null&&a(t,["config"],Nc(o,l,t)),t}function Lc(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function bc(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Dc(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Lc(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],bc(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Ze(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Dc(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Vc(o,e){const t={},n=r(e,["featureSelectionPreference"]);return n!=null&&a(t,["featureSelectionPreference"],n),t}function Fc(o,e){const t={},n=r(e,["method"]);n!=null&&a(t,["method"],n);const i=r(e,["category"]);i!=null&&a(t,["category"],i);const s=r(e,["threshold"]);return s!=null&&a(t,["threshold"],s),t}function Uc(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function Bc(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Oc(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],Bc(o,n)),t}function Gc(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function Hc(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Gc(o,n)),t}function qc(){return{}}function $c(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function Jc(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],$c(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function zc(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],Jc(o,n)),t}function Ts(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>Uc(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Oc(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],Hc(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],qc());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],zc(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function Yc(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function Kc(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function Wc(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],Kc(o,n)),t}function Zc(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],Yc(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],Wc(o,i)),t}function Xc(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function Qc(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],Xc(o,n)),t}function jc(o,e){const t={},n=r(e,["voiceConfig"]);if(n!=null&&a(t,["voiceConfig"],Qc(o,n)),r(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(e,["languageCode"]);return i!=null&&a(t,["languageCode"],i),t}function ed(o,e){const t={},n=r(e,["includeThoughts"]);n!=null&&a(t,["includeThoughts"],n);const i=r(e,["thinkingBudget"]);return i!=null&&a(t,["thinkingBudget"],i),t}function td(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Ze(o,K(o,i)));const s=r(e,["temperature"]);s!=null&&a(n,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(n,["topP"],l);const u=r(e,["topK"]);u!=null&&a(n,["topK"],u);const d=r(e,["candidateCount"]);d!=null&&a(n,["candidateCount"],d);const c=r(e,["maxOutputTokens"]);c!=null&&a(n,["maxOutputTokens"],c);const f=r(e,["stopSequences"]);f!=null&&a(n,["stopSequences"],f);const p=r(e,["responseLogprobs"]);p!=null&&a(n,["responseLogprobs"],p);const m=r(e,["logprobs"]);m!=null&&a(n,["logprobs"],m);const h=r(e,["presencePenalty"]);h!=null&&a(n,["presencePenalty"],h);const g=r(e,["frequencyPenalty"]);g!=null&&a(n,["frequencyPenalty"],g);const y=r(e,["seed"]);y!=null&&a(n,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&a(n,["responseMimeType"],E);const M=r(e,["responseSchema"]);M!=null&&a(n,["responseSchema"],Ut(o,M));const w=r(e,["routingConfig"]);w!=null&&a(n,["routingConfig"],w);const k=r(e,["modelSelectionConfig"]);k!=null&&a(n,["modelConfig"],Vc(o,k));const L=r(e,["safetySettings"]);if(t!==void 0&&L!=null){let ue=L;Array.isArray(ue)&&(ue=ue.map(jt=>Fc(o,jt))),a(t,["safetySettings"],ue)}const b=r(e,["tools"]);if(t!==void 0&&b!=null){let ue=Wt(o,b);Array.isArray(ue)&&(ue=ue.map(jt=>Ts(o,Kt(o,jt)))),a(t,["tools"],ue)}const H=r(e,["toolConfig"]);t!==void 0&&H!=null&&a(t,["toolConfig"],Zc(o,H));const q=r(e,["labels"]);t!==void 0&&q!=null&&a(t,["labels"],q);const j=r(e,["cachedContent"]);t!==void 0&&j!=null&&a(t,["cachedContent"],Te(o,j));const N=r(e,["responseModalities"]);N!=null&&a(n,["responseModalities"],N);const D=r(e,["mediaResolution"]);D!=null&&a(n,["mediaResolution"],D);const oe=r(e,["speechConfig"]);oe!=null&&a(n,["speechConfig"],jc(o,as(o,oe)));const Jn=r(e,["audioTimestamp"]);Jn!=null&&a(n,["audioTimestamp"],Jn);const zn=r(e,["thinkingConfig"]);return zn!=null&&a(n,["thinkingConfig"],ed(o,zn)),n}function Ci(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);if(i!=null){let l=ne(o,i);Array.isArray(l)&&(l=l.map(u=>Ze(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],td(o,s,t)),t}function nd(o,e,t){const n={},i=r(e,["taskType"]);t!==void 0&&i!=null&&a(t,["instances[]","task_type"],i);const s=r(e,["title"]);t!==void 0&&s!=null&&a(t,["instances[]","title"],s);const l=r(e,["outputDimensionality"]);t!==void 0&&l!=null&&a(t,["parameters","outputDimensionality"],l);const u=r(e,["mimeType"]);t!==void 0&&u!=null&&a(t,["instances[]","mimeType"],u);const d=r(e,["autoTruncate"]);return t!==void 0&&d!=null&&a(t,["parameters","autoTruncate"],d),n}function od(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);i!=null&&a(t,["instances[]","content"],rs(o,i));const s=r(e,["config"]);return s!=null&&a(t,["config"],nd(o,s,t)),t}function id(o,e,t){const n={},i=r(e,["outputGcsUri"]);t!==void 0&&i!=null&&a(t,["parameters","storageUri"],i);const s=r(e,["negativePrompt"]);t!==void 0&&s!=null&&a(t,["parameters","negativePrompt"],s);const l=r(e,["numberOfImages"]);t!==void 0&&l!=null&&a(t,["parameters","sampleCount"],l);const u=r(e,["aspectRatio"]);t!==void 0&&u!=null&&a(t,["parameters","aspectRatio"],u);const d=r(e,["guidanceScale"]);t!==void 0&&d!=null&&a(t,["parameters","guidanceScale"],d);const c=r(e,["seed"]);t!==void 0&&c!=null&&a(t,["parameters","seed"],c);const f=r(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&a(t,["parameters","safetySetting"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["includeSafetyAttributes"]);t!==void 0&&m!=null&&a(t,["parameters","includeSafetyAttributes"],m);const h=r(e,["includeRaiReason"]);t!==void 0&&h!=null&&a(t,["parameters","includeRaiReason"],h);const g=r(e,["language"]);t!==void 0&&g!=null&&a(t,["parameters","language"],g);const y=r(e,["outputMimeType"]);t!==void 0&&y!=null&&a(t,["parameters","outputOptions","mimeType"],y);const E=r(e,["outputCompressionQuality"]);t!==void 0&&E!=null&&a(t,["parameters","outputOptions","compressionQuality"],E);const M=r(e,["addWatermark"]);t!==void 0&&M!=null&&a(t,["parameters","addWatermark"],M);const w=r(e,["enhancePrompt"]);return t!==void 0&&w!=null&&a(t,["parameters","enhancePrompt"],w),n}function sd(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],id(o,s,t)),t}function Gn(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["gcsUri"],n);const i=r(e,["imageBytes"]);i!=null&&a(t,["bytesBase64Encoded"],_e(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function rd(o,e){const t={},n=r(e,["maskMode"]);n!=null&&a(t,["maskMode"],n);const i=r(e,["segmentationClasses"]);i!=null&&a(t,["maskClasses"],i);const s=r(e,["maskDilation"]);return s!=null&&a(t,["dilation"],s),t}function ad(o,e){const t={},n=r(e,["controlType"]);n!=null&&a(t,["controlType"],n);const i=r(e,["enableControlImageComputation"]);return i!=null&&a(t,["computeControl"],i),t}function ld(o,e){const t={},n=r(e,["styleDescription"]);return n!=null&&a(t,["styleDescription"],n),t}function ud(o,e){const t={},n=r(e,["subjectType"]);n!=null&&a(t,["subjectType"],n);const i=r(e,["subjectDescription"]);return i!=null&&a(t,["subjectDescription"],i),t}function cd(o,e){const t={},n=r(e,["referenceImage"]);n!=null&&a(t,["referenceImage"],Gn(o,n));const i=r(e,["referenceId"]);i!=null&&a(t,["referenceId"],i);const s=r(e,["referenceType"]);s!=null&&a(t,["referenceType"],s);const l=r(e,["maskImageConfig"]);l!=null&&a(t,["maskImageConfig"],rd(o,l));const u=r(e,["controlImageConfig"]);u!=null&&a(t,["controlImageConfig"],ad(o,u));const d=r(e,["styleImageConfig"]);d!=null&&a(t,["styleImageConfig"],ld(o,d));const c=r(e,["subjectImageConfig"]);return c!=null&&a(t,["subjectImageConfig"],ud(o,c)),t}function dd(o,e,t){const n={},i=r(e,["outputGcsUri"]);t!==void 0&&i!=null&&a(t,["parameters","storageUri"],i);const s=r(e,["negativePrompt"]);t!==void 0&&s!=null&&a(t,["parameters","negativePrompt"],s);const l=r(e,["numberOfImages"]);t!==void 0&&l!=null&&a(t,["parameters","sampleCount"],l);const u=r(e,["aspectRatio"]);t!==void 0&&u!=null&&a(t,["parameters","aspectRatio"],u);const d=r(e,["guidanceScale"]);t!==void 0&&d!=null&&a(t,["parameters","guidanceScale"],d);const c=r(e,["seed"]);t!==void 0&&c!=null&&a(t,["parameters","seed"],c);const f=r(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&a(t,["parameters","safetySetting"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["includeSafetyAttributes"]);t!==void 0&&m!=null&&a(t,["parameters","includeSafetyAttributes"],m);const h=r(e,["includeRaiReason"]);t!==void 0&&h!=null&&a(t,["parameters","includeRaiReason"],h);const g=r(e,["language"]);t!==void 0&&g!=null&&a(t,["parameters","language"],g);const y=r(e,["outputMimeType"]);t!==void 0&&y!=null&&a(t,["parameters","outputOptions","mimeType"],y);const E=r(e,["outputCompressionQuality"]);t!==void 0&&E!=null&&a(t,["parameters","outputOptions","compressionQuality"],E);const M=r(e,["editMode"]);t!==void 0&&M!=null&&a(t,["parameters","editMode"],M);const w=r(e,["baseSteps"]);return t!==void 0&&w!=null&&a(t,["parameters","editConfig","baseSteps"],w),n}function fd(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["referenceImages"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>cd(o,d))),a(t,["instances[0]","referenceImages"],u)}const l=r(e,["config"]);return l!=null&&a(t,["config"],dd(o,l,t)),t}function pd(o,e,t){const n={},i=r(e,["includeRaiReason"]);t!==void 0&&i!=null&&a(t,["parameters","includeRaiReason"],i);const s=r(e,["outputMimeType"]);t!==void 0&&s!=null&&a(t,["parameters","outputOptions","mimeType"],s);const l=r(e,["outputCompressionQuality"]);t!==void 0&&l!=null&&a(t,["parameters","outputOptions","compressionQuality"],l);const u=r(e,["numberOfImages"]);t!==void 0&&u!=null&&a(t,["parameters","sampleCount"],u);const d=r(e,["mode"]);return t!==void 0&&d!=null&&a(t,["parameters","mode"],d),n}function md(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["image"]);i!=null&&a(t,["instances[0]","image"],Gn(o,i));const s=r(e,["upscaleFactor"]);s!=null&&a(t,["parameters","upscaleConfig","upscaleFactor"],s);const l=r(e,["config"]);return l!=null&&a(t,["config"],pd(o,l,t)),t}function hd(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function gd(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],ds(o,u)),n}function yd(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],gd(o,n,t)),t}function vd(o,e,t){const n={},i=r(e,["displayName"]);t!==void 0&&i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);t!==void 0&&s!=null&&a(t,["description"],s);const l=r(e,["defaultCheckpointId"]);return t!==void 0&&l!=null&&a(t,["defaultCheckpointId"],l),n}function Cd(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],vd(o,i,t)),t}function Td(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],F(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function _d(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Ze(o,K(o,i)));const s=r(e,["tools"]);if(t!==void 0&&s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>Ts(o,d))),a(t,["tools"],u)}const l=r(e,["generationConfig"]);return t!==void 0&&l!=null&&a(t,["generationConfig"],l),n}function Ed(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);if(i!=null){let l=ne(o,i);Array.isArray(l)&&(l=l.map(u=>Ze(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],_d(o,s,t)),t}function xd(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["contents"]);if(i!=null){let l=ne(o,i);Array.isArray(l)&&(l=l.map(u=>Ze(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],s),t}function Sd(o,e,t){const n={},i=r(e,["numberOfVideos"]);t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i);const s=r(e,["outputGcsUri"]);t!==void 0&&s!=null&&a(t,["parameters","storageUri"],s);const l=r(e,["fps"]);t!==void 0&&l!=null&&a(t,["parameters","fps"],l);const u=r(e,["durationSeconds"]);t!==void 0&&u!=null&&a(t,["parameters","durationSeconds"],u);const d=r(e,["seed"]);t!==void 0&&d!=null&&a(t,["parameters","seed"],d);const c=r(e,["aspectRatio"]);t!==void 0&&c!=null&&a(t,["parameters","aspectRatio"],c);const f=r(e,["resolution"]);t!==void 0&&f!=null&&a(t,["parameters","resolution"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["pubsubTopic"]);t!==void 0&&m!=null&&a(t,["parameters","pubsubTopic"],m);const h=r(e,["negativePrompt"]);t!==void 0&&h!=null&&a(t,["parameters","negativePrompt"],h);const g=r(e,["enhancePrompt"]);return t!==void 0&&g!=null&&a(t,["parameters","enhancePrompt"],g),n}function Id(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],F(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["image"]);s!=null&&a(t,["instances[0]","image"],Gn(o,s));const l=r(e,["config"]);return l!=null&&a(t,["config"],Sd(o,l,t)),t}function Ad(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function wd(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Md(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Ad(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],wd(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Rd(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Md(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function kd(o,e){const t={},n=r(e,["citationSources"]);return n!=null&&a(t,["citations"],n),t}function Nd(o,e){const t={},n=r(e,["retrievedUrl"]);n!=null&&a(t,["retrievedUrl"],n);const i=r(e,["urlRetrievalStatus"]);return i!=null&&a(t,["urlRetrievalStatus"],i),t}function Pd(o,e){const t={},n=r(e,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Nd(o,s))),a(t,["urlMetadata"],i)}return t}function Ld(o,e){const t={},n=r(e,["content"]);n!=null&&a(t,["content"],Rd(o,n));const i=r(e,["citationMetadata"]);i!=null&&a(t,["citationMetadata"],kd(o,i));const s=r(e,["tokenCount"]);s!=null&&a(t,["tokenCount"],s);const l=r(e,["finishReason"]);l!=null&&a(t,["finishReason"],l);const u=r(e,["urlContextMetadata"]);u!=null&&a(t,["urlContextMetadata"],Pd(o,u));const d=r(e,["avgLogprobs"]);d!=null&&a(t,["avgLogprobs"],d);const c=r(e,["groundingMetadata"]);c!=null&&a(t,["groundingMetadata"],c);const f=r(e,["index"]);f!=null&&a(t,["index"],f);const p=r(e,["logprobsResult"]);p!=null&&a(t,["logprobsResult"],p);const m=r(e,["safetyRatings"]);return m!=null&&a(t,["safetyRatings"],m),t}function Ti(o,e){const t={},n=r(e,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>Ld(o,d))),a(t,["candidates"],u)}const i=r(e,["modelVersion"]);i!=null&&a(t,["modelVersion"],i);const s=r(e,["promptFeedback"]);s!=null&&a(t,["promptFeedback"],s);const l=r(e,["usageMetadata"]);return l!=null&&a(t,["usageMetadata"],l),t}function bd(o,e){const t={},n=r(e,["values"]);return n!=null&&a(t,["values"],n),t}function Dd(){return{}}function Vd(o,e){const t={},n=r(e,["embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>bd(o,l))),a(t,["embeddings"],s)}return r(e,["metadata"])!=null&&a(t,["metadata"],Dd()),t}function Fd(o,e){const t={},n=r(e,["bytesBase64Encoded"]);n!=null&&a(t,["imageBytes"],_e(o,n));const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function _s(o,e){const t={},n=r(e,["safetyAttributes","categories"]);n!=null&&a(t,["categories"],n);const i=r(e,["safetyAttributes","scores"]);i!=null&&a(t,["scores"],i);const s=r(e,["contentType"]);return s!=null&&a(t,["contentType"],s),t}function Ud(o,e){const t={},n=r(e,["_self"]);n!=null&&a(t,["image"],Fd(o,n));const i=r(e,["raiFilteredReason"]);i!=null&&a(t,["raiFilteredReason"],i);const s=r(e,["_self"]);return s!=null&&a(t,["safetyAttributes"],_s(o,s)),t}function Bd(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Ud(o,l))),a(t,["generatedImages"],s)}const i=r(e,["positivePromptSafetyAttributes"]);return i!=null&&a(t,["positivePromptSafetyAttributes"],_s(o,i)),t}function Od(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["updateTime"]);return s!=null&&a(t,["updateTime"],s),t}function Sn(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);s!=null&&a(t,["description"],s);const l=r(e,["version"]);l!=null&&a(t,["version"],l);const u=r(e,["_self"]);u!=null&&a(t,["tunedModelInfo"],Od(o,u));const d=r(e,["inputTokenLimit"]);d!=null&&a(t,["inputTokenLimit"],d);const c=r(e,["outputTokenLimit"]);c!=null&&a(t,["outputTokenLimit"],c);const f=r(e,["supportedGenerationMethods"]);return f!=null&&a(t,["supportedActions"],f),t}function Gd(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["_self"]);if(i!=null){let s=fs(o,i);Array.isArray(s)&&(s=s.map(l=>Sn(o,l))),a(t,["models"],s)}return t}function Hd(){return{}}function qd(o,e){const t={},n=r(e,["totalTokens"]);n!=null&&a(t,["totalTokens"],n);const i=r(e,["cachedContentTokenCount"]);return i!=null&&a(t,["cachedContentTokenCount"],i),t}function $d(o,e){const t={},n=r(e,["video","uri"]);n!=null&&a(t,["uri"],n);const i=r(e,["video","encodedVideo"]);i!=null&&a(t,["videoBytes"],_e(o,i));const s=r(e,["encoding"]);return s!=null&&a(t,["mimeType"],s),t}function Jd(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],$d(o,n)),t}function zd(o,e){const t={},n=r(e,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Jd(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function Yd(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response","generateVideoResponse"]);return u!=null&&a(t,["response"],zd(o,u)),t}function Kd(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Wd(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Zd(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Kd(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Wd(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Xd(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Zd(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Qd(o,e){const t={},n=r(e,["citations"]);return n!=null&&a(t,["citations"],n),t}function jd(o,e){const t={},n=r(e,["content"]);n!=null&&a(t,["content"],Xd(o,n));const i=r(e,["citationMetadata"]);i!=null&&a(t,["citationMetadata"],Qd(o,i));const s=r(e,["finishMessage"]);s!=null&&a(t,["finishMessage"],s);const l=r(e,["finishReason"]);l!=null&&a(t,["finishReason"],l);const u=r(e,["avgLogprobs"]);u!=null&&a(t,["avgLogprobs"],u);const d=r(e,["groundingMetadata"]);d!=null&&a(t,["groundingMetadata"],d);const c=r(e,["index"]);c!=null&&a(t,["index"],c);const f=r(e,["logprobsResult"]);f!=null&&a(t,["logprobsResult"],f);const p=r(e,["safetyRatings"]);return p!=null&&a(t,["safetyRatings"],p),t}function _i(o,e){const t={},n=r(e,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(f=>jd(o,f))),a(t,["candidates"],c)}const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["responseId"]);s!=null&&a(t,["responseId"],s);const l=r(e,["modelVersion"]);l!=null&&a(t,["modelVersion"],l);const u=r(e,["promptFeedback"]);u!=null&&a(t,["promptFeedback"],u);const d=r(e,["usageMetadata"]);return d!=null&&a(t,["usageMetadata"],d),t}function ef(o,e){const t={},n=r(e,["truncated"]);n!=null&&a(t,["truncated"],n);const i=r(e,["token_count"]);return i!=null&&a(t,["tokenCount"],i),t}function tf(o,e){const t={},n=r(e,["values"]);n!=null&&a(t,["values"],n);const i=r(e,["statistics"]);return i!=null&&a(t,["statistics"],ef(o,i)),t}function nf(o,e){const t={},n=r(e,["billableCharacterCount"]);return n!=null&&a(t,["billableCharacterCount"],n),t}function of(o,e){const t={},n=r(e,["predictions[]","embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>tf(o,l))),a(t,["embeddings"],s)}const i=r(e,["metadata"]);return i!=null&&a(t,["metadata"],nf(o,i)),t}function sf(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["gcsUri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["imageBytes"],_e(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Es(o,e){const t={},n=r(e,["safetyAttributes","categories"]);n!=null&&a(t,["categories"],n);const i=r(e,["safetyAttributes","scores"]);i!=null&&a(t,["scores"],i);const s=r(e,["contentType"]);return s!=null&&a(t,["contentType"],s),t}function Hn(o,e){const t={},n=r(e,["_self"]);n!=null&&a(t,["image"],sf(o,n));const i=r(e,["raiFilteredReason"]);i!=null&&a(t,["raiFilteredReason"],i);const s=r(e,["_self"]);s!=null&&a(t,["safetyAttributes"],Es(o,s));const l=r(e,["prompt"]);return l!=null&&a(t,["enhancedPrompt"],l),t}function rf(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Hn(o,l))),a(t,["generatedImages"],s)}const i=r(e,["positivePromptSafetyAttributes"]);return i!=null&&a(t,["positivePromptSafetyAttributes"],Es(o,i)),t}function af(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Hn(o,s))),a(t,["generatedImages"],i)}return t}function lf(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Hn(o,s))),a(t,["generatedImages"],i)}return t}function uf(o,e){const t={},n=r(e,["endpoint"]);n!=null&&a(t,["name"],n);const i=r(e,["deployedModelId"]);return i!=null&&a(t,["deployedModelId"],i),t}function cf(o,e){const t={},n=r(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["updateTime"]);return s!=null&&a(t,["updateTime"],s),t}function df(o,e){const t={},n=r(e,["checkpointId"]);n!=null&&a(t,["checkpointId"],n);const i=r(e,["epoch"]);i!=null&&a(t,["epoch"],i);const s=r(e,["step"]);return s!=null&&a(t,["step"],s),t}function In(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);s!=null&&a(t,["description"],s);const l=r(e,["versionId"]);l!=null&&a(t,["version"],l);const u=r(e,["deployedModels"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(h=>uf(o,h))),a(t,["endpoints"],m)}const d=r(e,["labels"]);d!=null&&a(t,["labels"],d);const c=r(e,["_self"]);c!=null&&a(t,["tunedModelInfo"],cf(o,c));const f=r(e,["defaultCheckpointId"]);f!=null&&a(t,["defaultCheckpointId"],f);const p=r(e,["checkpoints"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(h=>df(o,h))),a(t,["checkpoints"],m)}return t}function ff(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["_self"]);if(i!=null){let s=fs(o,i);Array.isArray(s)&&(s=s.map(l=>In(o,l))),a(t,["models"],s)}return t}function pf(){return{}}function mf(o,e){const t={},n=r(e,["totalTokens"]);return n!=null&&a(t,["totalTokens"],n),t}function hf(o,e){const t={},n=r(e,["tokensInfo"]);return n!=null&&a(t,["tokensInfo"],n),t}function gf(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["uri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["videoBytes"],_e(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function yf(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],gf(o,n)),t}function vf(o,e){const t={},n=r(e,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>yf(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function Cf(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],vf(o,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tf="Content-Type",_f="X-Server-Timeout",Ef="User-Agent",An="x-goog-api-client",xf="0.15.0",Sf=`google-genai-sdk/${xf}`,If="v1beta1",Af="v1beta",Ei=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class xs extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class wn extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class wf{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:If,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Af,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))i.searchParams.append(l,String(u));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.unaryApiCall(i,s,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[i,s]of Object.entries(t))typeof s=="object"?n[i]=Object.assign(Object.assign({},n[i]),s):s!==void 0&&(n[i]=s);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.streamApiCall(i,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n){if(t&&t.timeout||n){const i=new AbortController,s=i.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>i.abort(),t.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),e.signal=s}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await xi(i),new Tn(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await xi(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return ot(this,arguments,function*(){const i=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),s=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:u,value:d}=yield U(i.read());if(u){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=s.decode(d);try{const p=JSON.parse(c);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),h=m.status,g=m.code,y=`got status: ${h}. ${JSON.stringify(p)}`;if(g>=400&&g<500)throw new xs(y);if(g>=500&&g<600)throw new wn(y)}}catch(p){const m=p;if(m.name==="ClientError"||m.name==="ServerError")throw p}l+=c;let f=l.match(Ei);for(;f;){const p=f[1];try{const m=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield U(new Tn(m)),l=l.slice(f[0].length),f=l.match(Ei)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},t=Sf+" "+this.clientOptions.userAgentExtra;return e[Ef]=t,e[An]=t,e[Tf]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[n,i]of Object.entries(e.headers))t.append(n,i);e.timeout&&e.timeout>0&&t.append(_f,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var n;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const s=this.clientOptions.uploader,l=await s.stat(e);i.sizeBytes=String(l.size);const u=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d=await this.fetchUploadUrl(i,t);return s.upload(e,d,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var n;let i={};t!=null&&t.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const s={file:e},l=await this.request({path:x("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:i});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(n=l==null?void 0:l.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function xi(o){var e;if(o===void 0)throw new wn("response is undefined");if(!o.ok){const t=o.status,n=o.statusText;let i;!((e=o.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const s=`got status: ${t} ${n}. ${JSON.stringify(i)}`;throw t>=400&&t<500?new xs(s):t>=500&&t<600?new wn(s):new Error(s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mf="mcp_used/unknown";function Mn(o){for(const e of o)if(qn(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Rn(o){var e;o[An]=(((e=o[An])!==null&&e!==void 0?e:"")+` ${Mf}`).trimStart()}function Rf(o){var e,t,n;return(n=(t=(e=o.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>qn(i)))!==null&&n!==void 0?n:!1}function kf(o){var e,t,n;return(n=(t=(e=o.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!qn(i)))!==null&&n!==void 0?n:!1}function qn(o){return o!==null&&typeof o=="object"&&"tool"in o&&"callTool"in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Nf(o,e,t){const n=new Gr,i=JSON.parse(t.data),s=Zu(o,i);Object.assign(n,s),e(n)}class Pf{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),l=Df(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(k=>{c=k}),p=e.callbacks,m=function(){c({})},h=this.apiClient,g={onopen:m,onmessage:k=>{Nf(h,p.onmessage,k)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(k){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(k){}},y=this.webSocketFactory.create(d,bf(l),g);y.connect(),await f;const E=F(this.apiClient,e.model),M=ys(this.apiClient,{model:E}),w=xn(this.apiClient,{setup:M});return y.send(JSON.stringify(w)),new Lf(y,this.apiClient)}}class Lf{constructor(e,t){this.conn=e,this.apiClient=t}async setClientContent(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=fu(this.apiClient,e),n=vs(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=pu(this.apiClient,e),n=xn(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const t=xn(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Le.PLAY)}pause(){this.sendPlaybackControl(Le.PAUSE)}stop(){this.sendPlaybackControl(Le.STOP)}resetContext(){this.sendPlaybackControl(Le.RESET_CONTEXT)}close(){this.conn.close()}}function bf(o){const e={};return o.forEach((t,n)=>{e[n]=t}),e}function Df(o){const e=new Headers;for(const[t,n]of Object.entries(o))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vf="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Ff(o,e,t){const n=new Or;let i;if(t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),o.isVertexAI()){const s=Gu(o,i);Object.assign(n,s)}else{const s=Ou(o,i);Object.assign(n,s)}e(n)}class Uf{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Pf(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,s,l,u;const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const p=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Mn(e.config.tools)&&Rn(p);const m=Hf(p);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const N=this.apiClient.getApiKey();f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.BidiGenerateContent?key=${N}`}let h=()=>{};const g=new Promise(N=>{h=N}),y=e.callbacks,E=function(){var N;(N=y==null?void 0:y.onopen)===null||N===void 0||N.call(y),h({})},M=this.apiClient,w={onopen:E,onmessage:N=>{Ff(M,y.onmessage,N)},onerror:(t=y==null?void 0:y.onerror)!==null&&t!==void 0?t:function(N){},onclose:(n=y==null?void 0:y.onclose)!==null&&n!==void 0?n:function(N){}},k=this.webSocketFactory.create(f,Gf(m),w);k.connect(),await g;let L=F(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&L.startsWith("publishers/")){const N=this.apiClient.getProject(),D=this.apiClient.getLocation();L=`projects/${N}/locations/${D}/`+L}let b={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Vt.AUDIO]}:e.config.responseModalities=[Vt.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const H=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],q=[];for(const N of H)if(this.isCallableTool(N)){const D=N;q.push(await D.tool())}else q.push(N);q.length>0&&(e.config.tools=q);const j={model:L,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?b=su(this.apiClient,j):b=iu(this.apiClient,j),delete b.config,k.send(JSON.stringify(b)),new Of(k,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const Bf={turnComplete:!0};class Of{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=ne(e,t.turns),e.isVertexAI()?n=n.map(i=>Ze(e,i)):n=n.map(i=>Xt(e,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const s of n){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(Vf)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Bf),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:du(this.apiClient,e)}:t={realtimeInput:cu(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function Gf(o){const e={};return o.forEach((t,n)=>{e[n]=t}),e}function Hf(o){const e=new Headers;for(const[t,n]of Object.entries(o))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Si=10;function Ii(o){var e,t,n;if(!((e=o==null?void 0:o.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const l of(t=o==null?void 0:o.tools)!==null&&t!==void 0?t:[])if(xt(l)){i=!0;break}if(!i)return!0;const s=(n=o==null?void 0:o.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function xt(o){return"callTool"in o&&typeof o.callTool=="function"}function Ai(o){var e;return!(!((e=o==null?void 0:o.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qf extends ft{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,i,s,l,u;if(t.config&&t.config.tools&&Mn(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),Rn(t.config.httpOptions.headers)),!Rf(t)||Ii(t.config))return await this.generateContentInternal(t);if(kf(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");const d=await this.transformCallableTools(t);let c,f;const p=ne(this.apiClient,d.contents),m=(s=(i=(n=d.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:Si;let h=0;for(;h<m&&(c=await this.generateContentInternal(d),!(!c.functionCalls||c.functionCalls.length===0));){const g=c.candidates[0].content,y=[];for(const E of(u=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(xt(E)){const w=await E.callTool(c.functionCalls);y.push(...w)}h++,f={role:"user",parts:y},d.contents=ne(this.apiClient,d.contents),d.contents.push(g),d.contents.push(f),Ai(d.config)&&(p.push(g),p.push(f))}return Ai(d.config)&&(c.automaticFunctionCallingHistory=p),c},this.generateContentStream=async t=>{if(t.config&&t.config.tools&&Mn(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),Rn(t.config.httpOptions.headers)),Ii(t.config)){const n=await this.transformCallableTools(t);return await this.generateContentStreamInternal(n)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var i;let s;const l=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?s=d==null?void 0:d.safetyAttributes:l.push(d);let u;return s?u={generatedImages:l,positivePromptSafetyAttributes:s}:u={generatedImages:l},u}),this.list=async t=>{var n;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((n=l.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Zt(We.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(i)}}async transformCallableTools(e){var t;const n=(t=e.config)===null||t===void 0?void 0:t.tools;if(!n)return e;const i=await Promise.all(n.map(async l=>xt(l)?await l.tool():l)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};return s.config.tools=i,s}async initAfcToolsMap(e){var t,n,i;const s=new Map;for(const l of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(xt(l)){const u=l,d=await u.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(s.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);s.set(c.name,u)}}return s}async processAfcStream(e){var t,n,i;const s=(i=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:Si;let l=!1,u=0;const d=await this.initAfcToolsMap(e);return function(c,f,p){var m,h;return ot(this,arguments,function*(){for(var g,y,E,M;u<s;){l&&(u++,l=!1);const b=yield U(c.transformCallableTools(p)),H=yield U(c.generateContentStreamInternal(b)),q=[],j=[];try{for(var w=!0,k=(y=void 0,Et(H)),L;L=yield U(k.next()),g=L.done,!g;w=!0){M=L.value,w=!1;const N=M;if(yield yield U(N),N.candidates&&(!((m=N.candidates[0])===null||m===void 0)&&m.content)){j.push(N.candidates[0].content);for(const D of(h=N.candidates[0].content.parts)!==null&&h!==void 0?h:[])if(u<s&&D.functionCall){if(!D.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(D.functionCall.name)){const oe=yield U(f.get(D.functionCall.name).callTool([D.functionCall]));q.push(...oe)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${D.functionCall.name}`)}}}}catch(N){y={error:N}}finally{try{!w&&!g&&(E=k.return)&&(yield U(E.call(k)))}finally{if(y)throw y.error}}if(q.length>0){l=!0;const N=new Xe;N.candidates=[{content:{role:"user",parts:q}}],yield yield U(N);const D=[];D.push(...j),D.push({role:"user",parts:q});const oe=ne(c.apiClient,p.contents).concat(D);p.contents=oe}else break}})}(this,d,e)}async generateContentInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ci(this.apiClient,e);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=_i(this.apiClient,f),m=new Xe;return Object.assign(m,p),m})}else{const c=vi(this.apiClient,e);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Ti(this.apiClient,f),m=new Xe;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ci(this.apiClient,e);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return l=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),l.then(function(p){return ot(this,arguments,function*(){var m,h,g,y;try{for(var E=!0,M=Et(p),w;w=yield U(M.next()),m=w.done,!m;E=!0){y=w.value,E=!1;const L=_i(f,yield U(y.json())),b=new Xe;Object.assign(b,L),yield yield U(b)}}catch(k){h={error:k}}finally{try{!E&&!m&&(g=M.return)&&(yield U(g.call(M)))}finally{if(h)throw h.error}}})})}else{const c=vi(this.apiClient,e);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return l=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),l.then(function(p){return ot(this,arguments,function*(){var m,h,g,y;try{for(var E=!0,M=Et(p),w;w=yield U(M.next()),m=w.done,!m;E=!0){y=w.value,E=!1;const L=Ti(f,yield U(y.json())),b=new Xe;Object.assign(b,L),yield yield U(b)}}catch(k){h={error:k}}finally{try{!E&&!m&&(g=M.return)&&(yield U(g.call(M)))}finally{if(h)throw h.error}}})})}}async embedContent(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=od(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=of(this.apiClient,f),m=new Qo;return Object.assign(m,p),m})}else{const c=Cc(this.apiClient,e);return u=x("{model}:batchEmbedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Vd(this.apiClient,f),m=new Qo;return Object.assign(m,p),m})}}async generateImagesInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=sd(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=rf(this.apiClient,f),m=new jo;return Object.assign(m,p),m})}else{const c=_c(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Bd(this.apiClient,f),m=new jo;return Object.assign(m,p),m})}}async editImageInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=fd(this.apiClient,e);return s=x("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=af(this.apiClient,d),f=new br;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=md(this.apiClient,e);return s=x("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=lf(this.apiClient,d),f=new Dr;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=hd(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>In(this.apiClient,f))}else{const c=Ec(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Sn(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=yd(this.apiClient,e);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=ff(this.apiClient,f),m=new ei;return Object.assign(m,p),m})}else{const c=Sc(this.apiClient,e);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Gd(this.apiClient,f),m=new ei;return Object.assign(m,p),m})}}async update(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Cd(this.apiClient,e);return u=x("{model}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>In(this.apiClient,f))}else{const c=Ac(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Sn(this.apiClient,f))}}async delete(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Td(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=pf(),p=new ti;return Object.assign(p,f),p})}else{const c=wc(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Hd(),p=new ti;return Object.assign(p,f),p})}}async countTokens(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ed(this.apiClient,e);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=mf(this.apiClient,f),m=new ni;return Object.assign(m,p),m})}else{const c=Rc(this.apiClient,e);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=qd(this.apiClient,f),m=new ni;return Object.assign(m,p),m})}}async computeTokens(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=xd(this.apiClient,e);return s=x("{model}:computeTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=hf(this.apiClient,d),f=new Vr;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Id(this.apiClient,e);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>Cf(this.apiClient,f))}else{const c=Pc(this.apiClient,e);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Yd(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $f(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["_url","operationName"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Jf(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["_url","operationName"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function zf(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["operationName"],n);const i=r(e,["resourceName"]);i!=null&&a(t,["_url","resourceName"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],s),t}function Yf(o,e){const t={},n=r(e,["video","uri"]);n!=null&&a(t,["uri"],n);const i=r(e,["video","encodedVideo"]);i!=null&&a(t,["videoBytes"],_e(o,i));const s=r(e,["encoding"]);return s!=null&&a(t,["mimeType"],s),t}function Kf(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],Yf(o,n)),t}function Wf(o,e){const t={},n=r(e,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Kf(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function Zf(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response","generateVideoResponse"]);return u!=null&&a(t,["response"],Wf(o,u)),t}function Xf(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["uri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["videoBytes"],_e(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Qf(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],Xf(o,n)),t}function jf(o,e){const t={},n=r(e,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Qf(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function wi(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],jf(o,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ep extends ft{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let s;return n&&"httpOptions"in n&&(s=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:s}})}else return this.getVideosOperationInternal({operationName:t.name,config:n})}async getVideosOperationInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Jf(this.apiClient,e);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>wi(this.apiClient,f))}else{const c=$f(this.apiClient,e);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Zf(this.apiClient,f))}}async fetchPredictVideosOperationInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=zf(this.apiClient,e);return s=x("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>wi(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tp(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function np(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);return t!==void 0&&l!=null&&a(t,["_query","filter"],l),n}function op(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],np(o,n,t)),t}function ip(o,e){const t={},n=r(e,["textInput"]);n!=null&&a(t,["textInput"],n);const i=r(e,["output"]);return i!=null&&a(t,["output"],i),t}function sp(o,e){const t={};if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(e,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ip(o,s))),a(t,["examples","examples"],i)}return t}function rp(o,e,t){const n={};if(r(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(e,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&a(t,["displayName"],i),r(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const s=r(e,["epochCount"]);t!==void 0&&s!=null&&a(t,["tuningTask","hyperparameters","epochCount"],s);const l=r(e,["learningRateMultiplier"]);if(l!=null&&a(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),r(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=r(e,["batchSize"]);t!==void 0&&u!=null&&a(t,["tuningTask","hyperparameters","batchSize"],u);const d=r(e,["learningRate"]);return t!==void 0&&d!=null&&a(t,["tuningTask","hyperparameters","learningRate"],d),n}function ap(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["trainingDataset"]);i!=null&&a(t,["tuningTask","trainingData"],sp(o,i));const s=r(e,["config"]);return s!=null&&a(t,["config"],rp(o,s,t)),t}function lp(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function up(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);return t!==void 0&&l!=null&&a(t,["_query","filter"],l),n}function cp(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],up(o,n,t)),t}function dp(o,e,t){const n={},i=r(e,["gcsUri"]);if(t!==void 0&&i!=null&&a(t,["supervisedTuningSpec","trainingDatasetUri"],i),r(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function fp(o,e){const t={},n=r(e,["gcsUri"]);return n!=null&&a(t,["validationDatasetUri"],n),t}function pp(o,e,t){const n={},i=r(e,["validationDataset"]);t!==void 0&&i!=null&&a(t,["supervisedTuningSpec"],fp(o,i));const s=r(e,["tunedModelDisplayName"]);t!==void 0&&s!=null&&a(t,["tunedModelDisplayName"],s);const l=r(e,["description"]);t!==void 0&&l!=null&&a(t,["description"],l);const u=r(e,["epochCount"]);t!==void 0&&u!=null&&a(t,["supervisedTuningSpec","hyperParameters","epochCount"],u);const d=r(e,["learningRateMultiplier"]);t!==void 0&&d!=null&&a(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const c=r(e,["exportLastCheckpointOnly"]);t!==void 0&&c!=null&&a(t,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const f=r(e,["adapterSize"]);if(t!==void 0&&f!=null&&a(t,["supervisedTuningSpec","hyperParameters","adapterSize"],f),r(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function mp(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["trainingDataset"]);i!=null&&a(t,["supervisedTuningSpec","trainingDatasetUri"],dp(o,i,t));const s=r(e,["config"]);return s!=null&&a(t,["config"],pp(o,s,t)),t}function hp(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["model"],n);const i=r(e,["name"]);return i!=null&&a(t,["endpoint"],i),t}function Ss(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["state"]);i!=null&&a(t,["state"],us(o,i));const s=r(e,["createTime"]);s!=null&&a(t,["createTime"],s);const l=r(e,["tuningTask","startTime"]);l!=null&&a(t,["startTime"],l);const u=r(e,["tuningTask","completeTime"]);u!=null&&a(t,["endTime"],u);const d=r(e,["updateTime"]);d!=null&&a(t,["updateTime"],d);const c=r(e,["description"]);c!=null&&a(t,["description"],c);const f=r(e,["baseModel"]);f!=null&&a(t,["baseModel"],f);const p=r(e,["_self"]);p!=null&&a(t,["tunedModel"],hp(o,p));const m=r(e,["distillationSpec"]);m!=null&&a(t,["distillationSpec"],m);const h=r(e,["experiment"]);h!=null&&a(t,["experiment"],h);const g=r(e,["labels"]);g!=null&&a(t,["labels"],g);const y=r(e,["pipelineJob"]);y!=null&&a(t,["pipelineJob"],y);const E=r(e,["tunedModelDisplayName"]);return E!=null&&a(t,["tunedModelDisplayName"],E),t}function gp(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Ss(o,l))),a(t,["tuningJobs"],s)}return t}function yp(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);return l!=null&&a(t,["error"],l),t}function vp(o,e){const t={},n=r(e,["checkpointId"]);n!=null&&a(t,["checkpointId"],n);const i=r(e,["epoch"]);i!=null&&a(t,["epoch"],i);const s=r(e,["step"]);s!=null&&a(t,["step"],s);const l=r(e,["endpoint"]);return l!=null&&a(t,["endpoint"],l),t}function Cp(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],n);const i=r(e,["endpoint"]);i!=null&&a(t,["endpoint"],i);const s=r(e,["checkpoints"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>vp(o,u))),a(t,["checkpoints"],l)}return t}function kn(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["state"]);i!=null&&a(t,["state"],us(o,i));const s=r(e,["createTime"]);s!=null&&a(t,["createTime"],s);const l=r(e,["startTime"]);l!=null&&a(t,["startTime"],l);const u=r(e,["endTime"]);u!=null&&a(t,["endTime"],u);const d=r(e,["updateTime"]);d!=null&&a(t,["updateTime"],d);const c=r(e,["error"]);c!=null&&a(t,["error"],c);const f=r(e,["description"]);f!=null&&a(t,["description"],f);const p=r(e,["baseModel"]);p!=null&&a(t,["baseModel"],p);const m=r(e,["tunedModel"]);m!=null&&a(t,["tunedModel"],Cp(o,m));const h=r(e,["supervisedTuningSpec"]);h!=null&&a(t,["supervisedTuningSpec"],h);const g=r(e,["tuningDataStats"]);g!=null&&a(t,["tuningDataStats"],g);const y=r(e,["encryptionSpec"]);y!=null&&a(t,["encryptionSpec"],y);const E=r(e,["partnerModelTuningSpec"]);E!=null&&a(t,["partnerModelTuningSpec"],E);const M=r(e,["distillationSpec"]);M!=null&&a(t,["distillationSpec"],M);const w=r(e,["experiment"]);w!=null&&a(t,["experiment"],w);const k=r(e,["labels"]);k!=null&&a(t,["labels"],k);const L=r(e,["pipelineJob"]);L!=null&&a(t,["pipelineJob"],L);const b=r(e,["tunedModelDisplayName"]);return b!=null&&a(t,["tunedModelDisplayName"],b),t}function Tp(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>kn(o,l))),a(t,["tuningJobs"],s)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _p extends ft{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Zt(We.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const n=await this.tuneMldevInternal(t);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:Cn.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=lp(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>kn(this.apiClient,f))}else{const c=tp(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Ss(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=cp(this.apiClient,e);return u=x("tuningJobs",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Tp(this.apiClient,f),m=new oi;return Object.assign(m,p),m})}else{const c=op(this.apiClient,e);return u=x("tunedModels",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=gp(this.apiClient,f),m=new oi;return Object.assign(m,p),m})}}async tuneInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=mp(this.apiClient,e);return s=x("tuningJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>kn(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ap(this.apiClient,e);return s=x("tunedModels",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>yp(this.apiClient,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ep{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const xp=1024*1024*8,Sp=3,Ip=1e3,Ap=2,tn="x-goog-upload-status";async function wp(o,e,t){var n,i,s;let l=0,u=0,d=new Tn(new Response),c="upload";for(l=o.size;u<l;){const p=Math.min(xp,l-u),m=o.slice(u,u+p);u+p>=l&&(c+=", finalize");let h=0,g=Ip;for(;h<Sp&&(d=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),!(!((n=d==null?void 0:d.headers)===null||n===void 0)&&n[tn]));)h++,await Rp(g),g=g*Ap;if(u+=p,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[tn])!=="active")break;if(l<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((s=d==null?void 0:d.headers)===null||s===void 0?void 0:s[tn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function Mp(o){return{size:o.size,type:o.type}}function Rp(o){return new Promise(e=>setTimeout(e,o))}class kp{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await wp(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Mp(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Np{create(e,t,n){return new Pp(e,t,n)}}class Pp{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mi="x-goog-api-key";class Lp{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(Mi)===null&&e.append(Mi,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bp="gl-node/";class Is{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=Lr(e,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion;const i=new Lp(this.apiKey);this.apiClient=new wf({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:bp+"web",uploader:new kp,downloader:new Ep}),this.models=new qf(this.apiClient),this.live=new Uf(this.apiClient,i,new Np),this.chats=new Qa(this.models,this.apiClient),this.caches=new Wa(this.apiClient),this.files=new dl(this.apiClient),this.operations=new ep(this.apiClient),this.tunings=new _p(this.apiClient)}}const Dp={low:"Identify only the most essential and defining grammar patterns of the sentence. Focus on major conjunctions, verb conjugations (tense/politeness), and sentence-ending particles. Avoid breaking down common compound words or very simple phrases.",medium:"Provide a balanced analysis. Identify all major grammar patterns, common set phrases, and important vocabulary usage. This is the standard level of detail suitable for most learners.",high:"Perform an exhaustive analysis. Identify every possible grammatical pattern, nuance, idiomatic expression, and compound word structure, no matter how small or common. Deconstruct everything for a very detailed view for advanced study."};function Vp(o){return`You are an advanced linguistic analysis model, acting as a patient, insightful teacher of the Japanese language.
Your primary task is to take a single Japanese sentence and produce a detailed, structured analysis according to the specified JSON schema. Your explanations should be clear enough for a language learner.

Detailed Task Breakdown:
1.  **Sentence Analysis**: Deconstruct the input sentence into its smallest meaningful components (words, particles, etc.).
    For each component in the 'analysis' array:
    *   **Grammatical Category**: Assign a highly specific category. Use the format \`BASE_TYPE-FORM-TENSE-POLARITY\`.
        *   Examples: \`VERB_GODAN-TE-PAST-AFFIRMATIVE\`, \`ADJECTIVE_I-PLAIN-PRESENT-NEGATIVE\`, \`NOUN_COMMON\`.
        *   Available Categories: NOUN_COMMON, NOUN_PROPER, NOUN_PRONOUN, NOUN_COUNTER, VERB_ICHIDAN, VERB_GODAN, VERB_IRREGULAR, VERB_SURU, ADJECTIVE_I, ADJECTIVE_NA, ADVERB, PARTICLE, AUXILIARY_VERB, GRAMMATICAL_AUXILIARY, CONJUNCTION, INTERJECTION, SUFFIX, PREFIX, PUNCTUATION.
    *   **Reading**: Provide the reading in Hiragana or Katakana.
    *   **English Equivalent**: Provide a concise English meaning.
    *   **Pitch Accent**: THIS IS A CRITICAL, MANDATORY FIELD.
        *   Provide the standard Tokyo-dialect pitch accent as a string of 'H' (High) and 'L' (Low).
        *   **RULE: The length of the 'pitch_accent' string MUST EXACTLY match the character length of the 'reading' string.**
        *   Example: If 'reading' is 'ねこ' (2 chars), 'pitch_accent' MUST be 'LH' (2 chars).
        *   Example: If 'reading' is 'ともだち' (4 chars), 'pitch_accent' (heiban) MUST be 'LHHH' (4 chars).
        *   For particles or single-mora words with no accent drop, use the appropriate single letter ('H' or 'L').
        *   If pitch is truly not applicable (like punctuation), provide an empty string "". DO NOT OMIT THE FIELD. Avoid common pitfalls like providing a pattern shorter than the reading.

2.  **Full Translation**: Provide a natural, fluent English translation of the entire sentence.

3.  **Grammar & Phrase Explanations**: In the 'grammar_patterns' array, identify and explain all notable grammar points, set phrases, or nuanced vocabulary.
    *   **Analysis Thoroughness Level: ${o.toUpperCase()}**
    *   **Instruction: ${Dp[o]}**
    *   For each pattern, provide its name, a clear explanation for a learner, and the 'constituent_indices' that form the pattern in the 'analysis' array. This section must be comprehensive according to the specified thoroughness level.

Input is a single Japanese sentence. You must respond ONLY with the JSON object defined in the schema. Do not add any conversational text or markdown fences.`}function Fp(){return`You are a Japanese language teaching assistant.
Your task is to provide 2-3 simple, distinct, and pedagogically useful example sentences for the Japanese grammar pattern provided as the user input.

For each example sentence, you MUST provide:
1.  'japanese': The full sentence in Japanese, using Kanji where appropriate.
2.  'reading': The complete furigana reading of the sentence in Hiragana.
3.  'english': A natural and accurate English translation.
4.  'highlight_indices': A two-element array \`[startIndex, endIndex]\` indicating the exact location of the grammar pattern within the 'japanese' string. 'startIndex' is the zero-based index of the first character of the pattern, and 'endIndex' is the zero-based index of the character immediately AFTER the last character of the pattern.

Example for pattern "〜について":
If the user input is "〜について" and a sentence is "日本の文化について話します。", the pattern "について" starts at index 5 and ends at index 9. So, 'highlight_indices' would be [5, 9].

Respond ONLY with a JSON object that adheres to the provided schema. Do not add any extra text or markdown fences.`}const Up={type:"OBJECT",properties:{original_japanese_sentence:{type:"STRING",description:"The original Japanese sentence provided by the user."},analysis:{type:"ARRAY",description:"An array of objects, each representing a segmented component of the Japanese sentence.",items:{type:"OBJECT",properties:{japanese_segment:{type:"STRING",description:"The individual Japanese segment (word, particle, etc.)."},reading:{type:"STRING",description:"The reading of the Japanese segment in Hiragana or Katakana."},category:{type:"STRING",description:"A highly specific grammatical category label for the segment (e.g., 'NOUN_COMMON', 'VERB_ICHIDAN-TE-PAST-AFFIRMATIVE')."},english_equivalent:{type:"STRING",description:"A direct, concise English equivalent of the segment."},pitch_accent:{type:"STRING",description:`CRITICAL: A string representing the pitch accent pattern using 'H' for high and 'L' for low. This string's length MUST exactly match the character length of the 'reading' field. For heiban words, use 'L' followed by all 'H's (e.g., reading 'ともだち' -> pitch 'LHHH'). For non-applicable segments like punctuation, this MUST be an empty string "". Do not omit this field.`}},required:["japanese_segment","reading","category","english_equivalent","pitch_accent"]}},grammar_patterns:{type:"ARRAY",description:"A comprehensive array of identified grammatical patterns, idiomatic phrases, or nuanced vocabulary in the sentence.",items:{type:"OBJECT",properties:{pattern_name:{type:"STRING",description:"The name of the grammatical pattern or the phrase being explained (e.g., '〜なければならない', 'よろしくお願いします')."},explanation:{type:"STRING",description:"A detailed explanation of the pattern's meaning, usage, and nuance for a language learner."},constituent_indices:{type:"ARRAY",description:"An array of zero-based indices from the 'analysis' array that form this pattern.",items:{type:"NUMBER"}}},required:["pattern_name","explanation","constituent_indices"]}},english_translation:{type:"STRING",description:"The complete, natural-sounding English translation of the entire Japanese sentence."}},required:["original_japanese_sentence","analysis","grammar_patterns","english_translation"]},Bp={type:"ARRAY",description:"An array of 2-3 simple example sentences for the given grammar pattern.",items:{type:"OBJECT",properties:{japanese:{type:"STRING",description:"The full example sentence in Japanese, including Kanji."},reading:{type:"STRING",description:"The complete reading of the Japanese sentence in Hiragana."},english:{type:"STRING",description:"The natural English translation of the sentence."},highlight_indices:{type:"ARRAY",description:"A two-element array [startIndex, endIndex] indicating the character position of the grammar pattern within the 'japanese' string. startIndex is inclusive, endIndex is exclusive.",items:{type:"NUMBER"},minItems:2,maxItems:2}},required:["japanese","reading","english","highlight_indices"]}};function As(o,e){return new Promise((t,n)=>{const i=setTimeout(()=>{n(new Error(`Request timed out after ${e/1e3} seconds`))},e);o.then(s=>{clearTimeout(i),t(s)},s=>{clearTimeout(i),n(s)})})}async function ws(o,e=3,t=1e3){let n=0,i=t;for(;;)try{return await o()}catch(s){const l=(s.message||"").toLowerCase();if((l.includes("429")||l.includes("resource_exhausted"))&&n<e){n++;const d=Math.random()*500;console.warn(`Rate limit hit. Retrying in ${Math.round(i+d)}ms... (Attempt ${n}/${e})`),await new Promise(c=>setTimeout(c,i+d)),i*=2}else throw s}}function Ms(o){var i;const e=o.text;if(typeof e!="string"||e.trim()===""){console.error("Gemini API returned an empty or invalid text response.",o);const s=(i=o.candidates)==null?void 0:i[0];if(s&&s.finishReason!=="STOP"){const l=`The response may have been blocked. Reason: ${s.finishReason}.`;throw new Error(`The AI model's response was incomplete. ${l}`)}throw new Error("The AI model returned an empty response. This might be due to a content filter or an internal issue.")}const t=/^```(?:json)?\s*\n?(.*?)\n?\s*```$/s,n=e.trim().match(t);return n?n[1].trim():e.trim()}async function Op(o,e,t){return ws(async()=>{const i=new Is({apiKey:o}),s=Vp(t),l=i.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:e,config:{systemInstruction:s,responseMimeType:"application/json",responseSchema:Up,temperature:.1,seed:42}}),u=await As(l,3e4),d=Ms(u);try{const c=JSON.parse(d);return Array.isArray(c)?c[0]:c}catch{throw console.error("Failed to parse JSON from model response:",d),new Error("The AI model returned a response that was not valid JSON.")}})}async function Gp(o,e){const t=async()=>{const n=new Is({apiKey:o}),i=Fp(),s=n.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:e,config:{systemInstruction:i,responseMimeType:"application/json",responseSchema:Bp,temperature:.01,seed:42}}),l=await As(s,2e4),u=Ms(l);try{return JSON.parse(u)}catch{throw console.error(`Failed to parse JSON examples for "${e}":`,u),new Error(`The AI model returned invalid JSON for examples of "${e}".`)}};try{return await ws(t)}catch(n){throw console.error(`Failed to get examples for "${e}":`,n),n instanceof Error&&(n.message.includes("JSON")||n.message.includes("timed out"))?n:new Error(`Could not generate examples for ${e}.`)}}function pt(o,e="main",t){const n=Wi(o,t);e==="analysis"?B.innerHTML=n:($t.classList.remove("hidden"),V.classList.add("hidden"),Y.innerHTML=n,B.innerHTML="")}function Rs(){if(!$){const o=document.createElement("button");o.className="fixed bottom-5 right-5 w-12 h-12 bg-accent text-primary-text rounded-full shadow-lg flex items-center justify-center text-2xl font-bold opacity-0 invisible transform translate-y-5 transition-all duration-300 hover:bg-accent/90 z-50",o.innerHTML="&#8679;",o.title="Back to analyzed sentence",document.body.appendChild(o),Vs(o)}}function Ri(){const o=Y.querySelector(".clickable-sentence.selected");if(!o)return;Rs(),$&&($.onclick=()=>o.scrollIntoView({behavior:"smooth",block:"center"}),$.title="Back to analyzed sentence"),Ae&&Ae.disconnect();const e=new IntersectionObserver(([t])=>{$==null||$.classList.toggle("opacity-0",t.isIntersecting),$==null||$.classList.toggle("invisible",t.isIntersecting),$==null||$.classList.toggle("translate-y-5",t.isIntersecting)},{root:null,threshold:.1});e.observe(Y),Ni(e)}const ks="japanese-analyzer-history-v2",ut="japanese-analyzer-unsaved-title",ct="japanese-analyzer-unsaved-text",Bt="japanese-analyzer-analysis-depth",Nn="japanese-analyzer-api-key",Ot="theme",Gt="furigana-hidden",Ht="color-coding-hidden",qt="pitch-accent-hidden",Ns="japanese-analyzer-font-size",Ps=[{label:"XX-Small",value:"0.75"},{label:"X-Small",value:"0.85"},{label:"Small",value:"1.0"},{label:"Medium",value:"1.15"},{label:"Large",value:"1.3"},{label:"X-Large",value:"1.5"}],ki=2;function ae(){try{W.sort((o,e)=>e.updatedAt-o.updatedAt),localStorage.setItem(ks,JSON.stringify(W))}catch(o){console.error("Failed to save history to localStorage",o)}}function Hp(){try{const o=localStorage.getItem(ks);o&&an(JSON.parse(o))}catch(o){console.error("Failed to load or parse history from localStorage",o),an([])}qe()}function qp(){const o=()=>{cn.classList.remove("translate-x-full"),yt.classList.remove("invisible","opacity-0")},e=()=>{cn.classList.add("translate-x-full"),yt.classList.add("invisible","opacity-0")};Di.addEventListener("click",o),Vi.addEventListener("click",e),yt.addEventListener("click",e),Fn.addEventListener("click",()=>{W.length!==0&&dn("Are you sure you want to delete all your saved texts? This cannot be undone.",()=>{Us(),ae(),qe(),O&&Rt()},{confirmText:"Delete All"})}),wt.addEventListener("click",t=>{const i=t.target.closest("[data-action]");if(!i)return;const{action:s,entryId:l}=i.dataset;if(!s||!l)return;const u=J(l);if(u)switch(s){case"load":e(),localStorage.removeItem(ut),localStorage.removeItem(ct),$n(l);break;case"delete":dn(`Are you sure you want to delete "${u.title}"?`,()=>{const d=O===l;Fs(l),ae(),qe(),d&&Rt()},{confirmText:"Delete"});break}})}function $p(){Hp(),qp()}const nn=new Set;async function Qt(o,e,t){var s;const n=(s=o.analyzedSentences[e])==null?void 0:s[t];if(n)return n;if(!Fe)throw new Error("API Key is not configured. Please add one in the settings menu.");const i=e.trim().replace(/^[「『]/,"").replace(/[」』]$/,"").trim();if(!i){const l={original_japanese_sentence:e,analysis:[{japanese_segment:e,reading:e,category:"PUNCTUATION",english_equivalent:"Punctuation/Quotes",pitch_accent:""}],grammar_patterns:[],english_translation:"(Sentence consists only of punctuation)"};return Kn(e,l,t),ae(),Promise.resolve(l)}try{const l=await Op(Fe,i.trim(),t);return l.original_japanese_sentence=e,Kn(e,l,t),ae(),qe(),l}catch(l){throw console.error(`Analysis failed for: "${e}"`,l),l}}async function Jp(o,e){var i;const t=o.text.split(`
`).flatMap(s=>{var l;return((l=s.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:l.filter(u=>u==null?void 0:u.trim()))||[]}),n=e+1;if(n<t.length){const s=t[n];(i=o.analyzedSentences[s])!=null&&i[ee]||(console.log(`Prefetching analysis for: "${s}"`),Qt(o,s,ee).catch(l=>{console.warn(`Prefetch failed for sentence ${n+1}:`,l.message)}))}}async function it(o,e){var l;const t=o.text.split(`
`).flatMap(u=>{var d;return((d=u.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:d.filter(c=>c==null?void 0:c.trim()))||[]});if(e<0||e>=t.length||t.length===0){$n(o.id);return}const n=t[e];Xs();const i=(l=o.analyzedSentences[n])==null?void 0:l[ee];i?jn(o,e,i):Zs(o,e),window.scrollTo({top:0,behavior:"auto"}),te(),Ae&&Ae.disconnect(),st&&window.removeEventListener("scroll",st),Rs();const s=$;if(s){s.onclick=()=>window.scrollTo({top:0,behavior:"smooth"}),s.title="Scroll to top",s.classList.add("opacity-0","invisible","translate-y-5");const u=()=>{if(V.classList.contains("hidden"))return;const d=window.scrollY>window.innerHeight/2;s.classList.toggle("opacity-0",!d),s.classList.toggle("invisible",!d),s.classList.toggle("translate-y-5",!d)};window.addEventListener("scroll",u),Pi(u)}if(!i){if(nn.has(n)){console.log(`Analysis for "${n}" is already in progress.`);return}try{nn.add(n);const u=await Qt(o,n,ee),d=V.querySelector("#reading-mode-sentence-input");d&&parseInt(d.value,10)===e+1&&(V.style.transition="opacity 0.2s ease-in-out",V.style.opacity="0",await new Promise(c=>setTimeout(c,200)),jn(o,e,u),te(),V.style.opacity="1",setTimeout(()=>{V.style.transition=""},250))}catch(u){const d=u instanceof Error?u:new Error("An unknown error occurred during analysis."),{main:c,detail:f}=Bn(d),p=V.querySelector("#reading-mode-content-wrapper");p?p.innerHTML=Wi(c,f):pt(c,"main",f)}finally{nn.delete(n)}}await Jp(o,e)}function $n(o){const e=J(o);e&&(ji(),Ue.classList.add("hidden"),Ie.value=e.title,me.value=e.text,Ln(o),Yt(e),B.innerHTML='<p class="text-center p-8 text-slate-500">Select a sentence to analyze, or start reading mode.</p>',dt())}function Ls(){const o=localStorage.getItem(Ot)||"light";document.documentElement.classList.toggle("dark",o==="dark"),tt.checked=o==="dark";const e=localStorage.getItem(Gt)==="true";Be.checked=!e;const t=localStorage.getItem(Ht)!=="false";Oe.checked=!t;const n=localStorage.getItem(qt)!=="false";rt.checked=!n,te();const i=localStorage.getItem(Bt),s=i&&on.includes(i)?i:"medium";Li(s);const l=on.indexOf(s);It.value=String(l),bn.textContent=s.charAt(0).toUpperCase()+s.slice(1);const u=Ps,d=localStorage.getItem(Ns),c=d?parseInt(d,10):ki,f=c>=0&&c<u.length?c:ki;if(f>=0&&f<u.length){const h=u[f];document.documentElement.style.setProperty("--font-size-multiplier",h.value),At.value=String(f),Dn.textContent=h.label}const p=localStorage.getItem(Nn);rn(p||void 0||null),be.value="",p?(be.placeholder="API key saved",pe.textContent="Using key from local storage.",pe.classList.remove("text-warning-text","font-semibold")):(pe.textContent="No API key found. Please add one.",pe.classList.add("text-warning-text","font-semibold")),dt()}function zp(){tt.addEventListener("change",()=>{var t;const o=tt.checked?"dark":"light";document.documentElement.classList.toggle("dark",tt.checked),localStorage.setItem(Ot,o);const e=Y.querySelector(".clickable-sentence.selected");if(e!=null&&e.dataset.sentence&&O){const n=J(O),i=(t=n==null?void 0:n.analyzedSentences[e.dataset.sentence])==null?void 0:t[ee];i&&(Mt(B,i),te())}})}function Yp(){Be.addEventListener("change",()=>{const o=!Be.checked;localStorage.setItem(Gt,String(o)),te()}),Oe.addEventListener("change",()=>{const o=!Oe.checked;localStorage.setItem(Ht,String(o)),te()}),rt.addEventListener("change",()=>{const o=!rt.checked;localStorage.setItem(qt,String(o)),te()})}function Kp(){It.addEventListener("input",()=>{const o=on[parseInt(It.value,10)];if(bn.textContent=o.charAt(0).toUpperCase()+o.slice(1),Li(o),localStorage.setItem(Bt,o),O){const e=J(O);if(!e)return;if(Yt(e),!V.classList.contains("hidden")){it(e,e.readingProgress);return}const t=Y.querySelector(".clickable-sentence.selected");if(t!=null&&t.dataset.sentence){const n=t.dataset.sentence;B.innerHTML=`<p class="text-center p-8 text-text-muted">Analyzing with new '${o}' setting...</p>`,Qt(e,n,o).then(i=>{Mt(B,i),te()}).catch(i=>{const s=i instanceof Error?i:new Error(String(i)),{main:l,detail:u}=Bn(s);pt(l,"analysis",u)})}}})}function Wp(){const o=Ps;At.addEventListener("input",()=>{const e=parseInt(At.value,10);if(e>=0&&e<o.length){const t=o[e];document.documentElement.style.setProperty("--font-size-multiplier",t.value),Dn.textContent=t.label,localStorage.setItem(Ns,String(e))}})}function Zp(){Bi.addEventListener("click",()=>{const o=be.value.trim();o?(localStorage.setItem(Nn,o),rn(o),be.value="",be.placeholder="API key saved",pe.textContent="✅ Key saved and is now active.",pe.classList.remove("text-warning-text","font-semibold")):(localStorage.removeItem(Nn),rn(null),pe.textContent="User-defined key removed. Falling back to built-in key if available."),dt()})}function Xp(){Ui.addEventListener("click",()=>{const o={version:"1.0",exportedAt:Date.now(),history:W,settings:{[Ot]:localStorage.getItem(Ot),[Gt]:localStorage.getItem(Gt),[Ht]:localStorage.getItem(Ht),[qt]:localStorage.getItem(qt),[Bt]:localStorage.getItem(Bt)}},e=JSON.stringify(o,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n;const s=new Date().toISOString().split("T")[0];i.download=`japanese-analyzer-backup-${s}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}),vt.addEventListener("change",()=>{var t;const o=(t=vt.files)==null?void 0:t[0];if(!o)return;const e=new FileReader;e.onload=n=>{var i;try{const s=JSON.parse((i=n.target)==null?void 0:i.result);if(!s.history||!s.settings)throw new Error("Invalid backup file structure.");dn("Importing will overwrite your current history and settings. Are you sure you want to continue?",()=>{Object.keys(s.settings).forEach(l=>{const u=s.settings[l];u!=null?localStorage.setItem(l,u):localStorage.removeItem(l)}),an(s.history),ae(),Ls(),qe(),Rt(),Xn("Import successful! Your data and settings have been updated.")},{confirmText:"Import",confirmClass:"bg-accent hover:bg-accent/90"})}catch(s){Xn(`Import failed: ${s instanceof Error?s.message:"Could not read file."}`)}finally{vt.value=""}},e.readAsText(o)})}function Qp(){un.addEventListener("click",o=>{o.stopPropagation(),Qe.classList.toggle("hidden")}),document.addEventListener("click",o=>{Qe.classList.contains("hidden")||!Qe.contains(o.target)&&!un.contains(o.target)&&Qe.classList.add("hidden")})}function jp(){Ls(),Qp(),zp(),Yp(),Kp(),Wp(),Zp(),Xp()}let Ve=!1,Se=null;function em(o){var p;const e=o.dataset,t=e.japaneseSegment||((p=o.textContent)==null?void 0:p.trim())||"",{reading:n,english:i,patterns:s,category:l,wordUrl:u}=e;if(!n&&!i&&!s&&!l)return null;const d=t;let c="",f="";if(l){const m=l.replace(/_/g," ").split("-").map(h=>h.charAt(0).toUpperCase()+h.slice(1).toLowerCase()).join(", ");f+=`<p class="text-sm text-text-muted"><strong class="font-medium text-text-secondary">Category:</strong> ${m}</p>`}if(f+=`<p class="text-sm text-text-muted mt-2"><strong class="font-medium text-text-secondary">Reading:</strong> ${n||"N/A"}</p>`,f+=`<p class="text-sm text-text-muted mt-1"><strong class="font-medium text-text-secondary">English:</strong> ${i||"N/A"}</p>`,u&&u.includes("http")&&(f+=`<div class="mt-3"><a href="${u}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-accent hover:underline inline-flex items-center gap-1.5">Search on Jisho <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></div>`),f&&(c+=`<div class="mb-4"><h4 class="text-base font-semibold border-b border-border-subtle pb-2 mb-2 text-text-primary">Word Info</h4>${f}</div>`),s)try{const m=JSON.parse(s);m.length>0&&(c+='<h4 class="text-base font-semibold border-b border-border-subtle pb-2 mb-2 text-text-primary">Grammar Patterns</h4>',c+='<div class="space-y-3">',m.forEach(h=>{c+=`<div><div class="flex items-center gap-3 mb-1.5"><span class="flex-shrink-0 w-3.5 h-3.5 rounded-sm bg-${h.idClass}"></span><h5 class="font-semibold text-accent">${h.name}</h5></div><p class="text-sm text-text-muted">${h.explanation}</p></div>`}),c+="</div>")}catch(m){console.error("Failed to parse patterns JSON for bottom sheet",m)}return c.trim()?{title:d,content:c}:null}function Pn(){let o=0;const e=0,t=document.getElementById("reading-mode-header");if(t&&!V.classList.contains("hidden"))o=t.offsetHeight;else{const i=B.querySelector(".sticky");if(i&&!B.classList.contains("hidden")){const l=i.getBoundingClientRect();l.top<=1&&(o=l.height)}}if(o>0){const i=window.innerHeight-o,s=window.innerHeight*.6,l=Math.min(i-e,s);He.style.maxHeight=`${l}px`}else He.style.maxHeight=""}function ye(){Ve&&(document.body.classList.remove("overflow-hidden","md:overflow-auto"),He.classList.add("translate-y-full"),zt.classList.add("opacity-0","invisible"),He.style.maxHeight="",Se&&(Se.classList.remove("bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30"),Se=null),Ve=!1)}function bs(o){if((o.dataset.category||"").toUpperCase()==="PUNCTUATION")return;const e=em(o);if(!e){Ve&&ye();return}Se&&Se!==o&&Se.classList.remove("bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30"),o.classList.add("bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30"),Se=o;const t=()=>{Oi.textContent=e.title,xe.innerHTML=e.content,xe.scrollTop=0};Ve?(xe.style.transition="opacity 0.1s ease-in-out",xe.style.opacity="0",Pn(),setTimeout(()=>{t(),xe.style.opacity="1",setTimeout(()=>xe.style.transition="",150)},100)):(t(),Pn(),document.body.classList.add("overflow-hidden","md:overflow-auto"),He.classList.remove("translate-y-full"),zt.classList.remove("opacity-0","invisible"),Ve=!0)}function tm(){Gi.addEventListener("click",ye),zt.addEventListener("click",ye),window.addEventListener("resize",()=>{Ve&&Pn()})}function Ds(o){const e=o.closest("#analysis-view, #reading-mode-view");if(!e)return;const t=e.querySelector("#sentence-translation-content");if(!t)return;const n=t.classList.contains("hidden");t.classList.toggle("hidden"),o.setAttribute("aria-pressed",String(!n)),o.classList.toggle("bg-accent-subtle-bg",!n)}function nm(){Pe.addEventListener("click",async()=>{const o=me.value;if(!o.trim()){pt("Input Required","main","Please enter some Japanese text to process.");return}const e=Ie.value.trim()||o.substring(0,40)+"...";let t=O;if(t){const i=J(t);if(i){const s=f=>new Set(f.split(`
`).flatMap(p=>{var m;return((m=p.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:m.filter(h=>h==null?void 0:h.trim()))||[]})),l=s(i.text),u=s(o),d=i.analyzedSentences,c={};for(const f of u)l.has(f)&&d[f]&&(c[f]=d[f]);i.title=e,i.text=o,i.analyzedSentences=c,i.updatedAt=Date.now(),i.readingProgress=0,St(i)}else t=null}if(!t){const i=Date.now().toString(),s={id:i,title:e,text:o,createdAt:Date.now(),updatedAt:Date.now(),analyzedSentences:{},readingProgress:0};St(s),Ln(i)}ae(),qe(),localStorage.setItem(ut,e),localStorage.setItem(ct,o);const n=J(O);Yt(n),Ue.classList.add("hidden"),B.innerHTML='<p class="text-center p-8 text-text-muted">Select a sentence to analyze, or start reading mode.</p>'})}function om(){X.addEventListener("click",async o=>{var l,u;if(!V.classList.contains("hidden"))return;const e=o.target;if(e.closest("#re-analyze-button")){const d=Y.querySelector(".clickable-sentence.selected"),c=d==null?void 0:d.dataset.sentence;if(!c||!O)return;const f=J(O);f.analyzedSentences[c]&&delete f.analyzedSentences[c][ee],d.click();return}const n=e.closest("#toggle-translation-button");if(n){Ds(n);return}if(e.closest("#start-reading-button")){if(O){const d=J(O);d&&await it(d,d.readingProgress)}return}if(e.closest("#edit-text-button")){Ue.classList.remove("hidden"),Y.innerHTML="",B.innerHTML="",Ue.scrollIntoView({behavior:"smooth",block:"start"});return}const i=e.closest(".clickable-sentence");if(i&&Y.contains(i)){const d=i.dataset.sentence;if(!d||!O)return;const c=J(O);if(c){const h=c.text.split(`
`).flatMap(g=>{var y;return((y=g.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:y.filter(E=>E==null?void 0:E.trim()))||[]}).indexOf(d);h!==-1&&(ln(c.id,h),ae())}ve(),ye(),Y.querySelectorAll(".clickable-sentence").forEach(m=>m.classList.remove("selected","bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30","font-semibold")),i.classList.add("selected","bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30","font-semibold");const f=J(O),p=(l=f.analyzedSentences[d])==null?void 0:l[ee];if(p)Mt(B,p),Ri(),B.scrollIntoView({behavior:"smooth",block:"start"});else{Ws(B,d),B.scrollIntoView({behavior:"smooth",block:"start"});try{const m=await Qt(f,d,ee),h=B;h.style.transition="opacity 0.2s ease-in-out",h.style.opacity="0",await new Promise(g=>setTimeout(g,200)),Mt(B,m),Ri(),Yt(f),(u=Y.querySelector(`.clickable-sentence[data-sentence="${CSS.escape(d)}"]`))==null||u.classList.add("selected","bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30","font-semibold"),h.style.opacity="1",setTimeout(()=>{h.style.transition=""},250)}catch(m){const h=m instanceof Error?m:new Error(String(m)),{main:g,detail:y}=Bn(h);pt(g,"analysis",y),B.scrollIntoView({behavior:"smooth",block:"start"})}}te();return}if(e.closest("a.underline")){o.stopPropagation();return}const s=e.closest(".segment");if(s&&B.contains(s)){if(o.stopPropagation(),B.querySelector(".is-focused"))return;window.innerWidth<768?bs(s):zi(s)?ve():Ji(s)}})}function im(){X.addEventListener("click",o=>{if(V.classList.contains("hidden"))return;const e=o.target;if(e.closest("#re-analyze-button")){if(!O)return;const c=J(O);if(!c)return;const f=c.readingProgress,m=c.text.split(`
`).flatMap(h=>{var g;return((g=h.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:g.filter(y=>y==null?void 0:y.trim()))||[]})[f];c.analyzedSentences[m]&&delete c.analyzedSentences[m][ee],ae(),it(c,f);return}const n=e.closest("#reading-header-toggle");if(n){const c=document.getElementById("reading-mode-header");if(c){const f=c.classList.toggle("header-collapsed");n.classList.toggle("is-open",!f)}return}const i=e.closest("#toggle-translation-button");if(i){Ds(i);return}const s=e.closest(".segment");if(s&&V.contains(s)){o.stopPropagation(),window.innerWidth<768?bs(s):zi(s)?ve():Ji(s);return}const l=O;if(!l)return;const u=J(l);if(!u)return;let d=u.readingProgress;if(e.closest("#reading-mode-exit")){ye(),$n(l);return}if(e.closest("#reading-nav-next"))d++;else if(e.closest("#reading-nav-prev"))d--;else return;ye(),ln(l,d),ae(),it(u,d)}),X.addEventListener("change",o=>{if(V.classList.contains("hidden"))return;const e=o.target;if(e.id!=="reading-mode-sentence-input")return;const t=O;if(!t)return;const n=J(t);if(!n)return;const s=n.text.split(`
`).flatMap(u=>{var d;return((d=u.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:d.filter(c=>c==null?void 0:c.trim()))||[]}).length;let l=parseInt(e.value,10)-1;if(isNaN(l)||l<0||l>=s){e.value=String(n.readingProgress+1);return}l!==n.readingProgress&&(ye(),ln(t,l),ae(),it(n,l))})}function sm(){let o=0,e=0,t=0,n=0;const i=50,s=40;X.addEventListener("touchstart",l=>{V.classList.contains("hidden")||l.touches.length===1&&(o=l.touches[0].clientX,e=l.touches[0].clientY,t=o,n=e)},{passive:!0}),X.addEventListener("touchmove",l=>{V.classList.contains("hidden")||l.touches.length!==1||(t=l.touches[0].clientX,n=l.touches[0].clientY)},{passive:!0}),X.addEventListener("touchend",()=>{if(V.classList.contains("hidden"))return;const l=t-o,u=n-e,d=Math.abs(l),c=Math.abs(u);if(d>i&&c<s)if(l<0){const f=document.getElementById("reading-nav-next");f&&!f.disabled&&f.click()}else{const f=document.getElementById("reading-nav-prev");f&&!f.disabled&&f.click()}o=0,e=0})}function rm(){X.addEventListener("click",o=>{const e=o.target.closest("[data-pattern-id]");if(!e)return;const t=e.closest("#analysis-view, #reading-mode-view");if(!t)return;const{patternId:n}=e.dataset;if(!n)return;const i=e.classList.contains("is-focused");t.querySelectorAll("[data-pattern-id]").forEach(s=>s.classList.remove("is-focused","ring-2","ring-focus-ring","bg-surface-soft")),t.querySelectorAll(".segment").forEach(s=>s.classList.remove("opacity-30")),i||(e.classList.add("is-focused","ring-2","ring-focus-ring","bg-surface-soft"),t.querySelectorAll(`.segment:not(.${n})`).forEach(l=>l.classList.add("opacity-30")))})}function am(){X.addEventListener("click",async o=>{const e=o.target.closest(".show-examples-button");if(!e||e.disabled)return;if(o.preventDefault(),!Fe){pt("API Key Not Found","analysis","Please add your Gemini API key in the settings menu to generate examples.");return}const{patternName:t}=e.dataset,n=e.querySelector(".button-text");if(!n)return;const i=e.nextElementSibling;if(i&&i.classList.contains("examples-container")){i.classList.toggle("hidden"),n.textContent=i.classList.contains("hidden")?"Examples":"Hide";return}e.disabled=!0;const s=e.innerHTML;e.innerHTML='<span class="animate-spin rounded-full h-4 w-4 border-b-2 border-current"></span><span class="button-text">Loading...</span>';try{const l=await Gp(Fe,t);e.innerHTML=s;const u=e.querySelector(".button-text");if((l==null?void 0:l.length)>0){const d=document.createElement("div");d.className="examples-container mt-4 pt-4 border-t border-dashed border-border-subtle";const c=document.createElement("dl");c.className="flex flex-col gap-4",l.forEach(f=>{const p=document.createElement("dt"),m=document.createElement("dd"),h=Ki(f.japanese,f.reading,!1);p.innerHTML=`<span class="text-lg font-jp">${h}</span>`,m.className="text-sm text-text-muted -mt-1",m.textContent=f.english,c.append(p,m)}),d.appendChild(c),e.insertAdjacentElement("afterend",d),u.textContent="Hide"}else u.textContent="No examples"}catch(l){console.error(l),e.innerHTML=s,e.querySelector(".button-text").textContent="Error"}finally{e.disabled=!1,te()}})}function lm(){bi.addEventListener("click",()=>{localStorage.removeItem(ut),localStorage.removeItem(ct),Rt()})}function um(){Ie.value=localStorage.getItem(ut)||"",me.value=localStorage.getItem(ct)||"",Ie.addEventListener("input",()=>{localStorage.setItem(ut,Ie.value)}),me.addEventListener("input",()=>{localStorage.setItem(ct,me.value),dt()})}function cm(){um(),nm(),om(),im(),sm(),rm(),am(),lm()}function dm(){document.addEventListener("keydown",o=>{var l,u;const e=o.target;if(["INPUT","TEXTAREA"].includes(e.tagName)||e.isContentEditable)return;o.key.toLowerCase()==="f"&&(o.preventDefault(),Be.click()),o.key.toLowerCase()==="c"&&(o.preventDefault(),Oe.click());const t=!V.classList.contains("hidden"),n=t?V:B.innerHTML.trim()?B:null;if(t&&(o.key==="ArrowRight"?(o.preventDefault(),(l=document.getElementById("reading-nav-next"))==null||l.click()):o.key==="ArrowLeft"&&(o.preventDefault(),(u=document.getElementById("reading-nav-prev"))==null||u.click())),!n)return;if(o.key.toLowerCase()==="t"){const d=n.querySelector("#toggle-translation-button");d&&(o.preventDefault(),d.click())}if(o.key.toLowerCase()==="s"){const d=n.querySelector(".tts-button");d&&(o.preventDefault(),d.click())}const i=n.querySelector(".is-focused");o.key==="Escape"&&i&&(o.preventDefault(),i.classList.remove("is-focused","ring-2","ring-focus-ring","bg-surface-soft"),n.querySelectorAll(".segment").forEach(d=>d.classList.remove("opacity-30")));const s=Array.from(n.querySelectorAll("[data-pattern-id]"));if(s.length>0){const d=s.findIndex(c=>c.classList.contains("is-focused"));if(o.key.toLowerCase()==="j"||o.key.toLowerCase()==="k"){o.preventDefault();let c=d===-1?0:o.key==="j"?d+1:d-1;c>=s.length&&(c=0),c<0&&(c=s.length-1);const f=s[c];if(!f)return;f.click();const p=n.querySelector(".sticky"),m=p?p.getBoundingClientRect().bottom:0,h=f.getBoundingClientRect(),y=window.innerHeight-m;let E;h.height>y?E=m+20:E=m+y/2-h.height/2;const w=h.top-E;window.scrollBy({top:w,left:0,behavior:"smooth"})}if(o.key.toLowerCase()==="e"&&i){o.preventDefault();const c=i.querySelector(".show-examples-button");c==null||c.click()}}})}function fm(){jp(),$p(),cm(),tm(),dm(),Bs(),qs(),Js(),te(),window.addEventListener("resize",()=>{window.innerWidth>=768?ye():ve()})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/fm();
