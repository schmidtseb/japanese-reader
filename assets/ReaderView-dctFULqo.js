import{u as j,r as h,j as e,R as v,V as E}from"./index.prod-BMhijsYq.js";import{u as N,A as S,a as w}from"./AnalysisPlaceholder-CXWYk3ig.js";import{E as T}from"./PitchAccentVisualizer-DUiEjm7T.js";import"./gemini-CBOh2XMT.js";const C=()=>{const{state:n,dispatch:l}=j(),t=n.history.find(s=>s.id===n.currentTextEntryId);h.useEffect(()=>{t||l({type:"RESET_VIEW"})},[t,l]);const{analysis:m,isLoading:p,error:x,reanalyze:f}=N(t==null?void 0:t.id,n.selectedSentence),u=h.useCallback(s=>{l({type:"SET_SELECTED_SENTENCE",payload:s})},[l]);if(!t)return null;const g=()=>{t&&l({type:"START_EDITING",payload:t.id})},b=()=>{if(!t)return;const s=t.text.split(`
`).flatMap(c=>{var d;return((d=c.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:d.filter(r=>r==null?void 0:r.trim()))||[]}),i=n.selectedSentence?s.indexOf(n.selectedSentence):-1,a=i!==-1?i:t.readingProgress||0;l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:{...t,readingProgress:a}}),l({type:"SET_VIEW",payload:E.ReadingMode})},y=t.text.split(`
`).map(s=>{var i;return((i=s.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:i.filter(a=>a==null?void 0:a.trim()))||[]});return e.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto md:grid md:grid-cols-2 md:overflow-hidden",children:[e.jsxs("div",{className:"p-6 flex flex-col md:h-full md:grid md:grid-rows-[auto_1fr] md:gap-y-4 md:min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 md:mb-0",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary break-words",title:t.title,children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,title:"Edit Text",className:"btn-ghost",children:e.jsx("i",{className:"bi bi-pencil-square text-xl"})}),e.jsx("button",{id:"start-reading-button",onClick:b,title:"Start Reading Mode",className:"inline-flex items-center justify-center p-2.5 rounded-full text-primary-text bg-accent hover:bg-accent/90 focus-ring shadow-sm",children:e.jsx("i",{className:"bi bi-book text-2xl"})})]})]}),e.jsx("div",{id:"reader-view-text-container",className:"reader-view-text bg-surface-soft border border-border rounded-lg p-4 sm:p-6 overflow-y-auto no-scrollbar min-h-0 max-h-[40vh]",children:y.map((s,i)=>e.jsx("p",{className:"text-lg sm:text-xl leading-relaxed mb-4 last:mb-0",children:s.length>0?s.map((a,c)=>{const d=n.selectedSentence===a,r=!!(t!=null&&t.analyzedSentences[a]),o=["clickable-sentence","cursor-pointer","rounded","p-1","-m-1","transition-colors","duration-200","hover:bg-accent-selected-bg/50"];return d?o.push("selected","bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30","font-semibold"):r&&o.push("has-analysis"),e.jsxs(v.Fragment,{children:[e.jsx("span",{className:o.join(" "),onClick:()=>u(a),children:a})," "]},c)}):e.jsx(e.Fragment,{children:" "})},i))})]}),e.jsx("div",{className:"md:h-full md:overflow-y-auto no-scrollbar md:border-l border-border md:min-w-0",children:e.jsx("div",{className:"p-6 md:h-full",children:e.jsx("div",{id:"analysis-view",className:"analysis-view md:h-full",children:n.selectedSentence?x?e.jsx(T,{error:x,onRetry:f}):m?e.jsx(S,{analysis:m,onReanalyze:f,availableQuizText:null,onStartQuiz:()=>{},isQuizLoading:!1}):e.jsx(w,{sentence:n.selectedSentence,isLoading:p}):e.jsx("div",{className:"text-center p-8 text-text-muted md:h-full flex items-center justify-center",children:"Select a sentence to begin."})})})})]})};export{C as ReaderView};
