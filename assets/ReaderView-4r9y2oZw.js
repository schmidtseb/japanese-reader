import{u as j,r as p,j as e,R as E,V as N}from"./index.prod-CXvYPYqy.js";import{u as v,E as S,A as w,a as T}from"./AnalysisPlaceholder-BcJxo26c.js";import"./gemini-Ds7igE-8.js";import"./PitchAccentVisualizer-EXHqCKTs.js";const C=()=>{const{state:n,dispatch:l}=j(),t=n.history.find(s=>s.id===n.currentTextEntryId),{analysis:m,isLoading:f,error:x,reanalyze:h}=v(t==null?void 0:t.id,n.selectedSentence),u=p.useCallback(s=>{l({type:"SET_SELECTED_SENTENCE",payload:s})},[l]);if(!t)return p.useEffect(()=>{l({type:"RESET_VIEW"})},[l]),null;const g=()=>{t&&l({type:"START_EDITING",payload:t.id})},b=()=>{if(!t)return;const s=t.text.split(`
`).flatMap(c=>{var d;return((d=c.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:d.filter(i=>i==null?void 0:i.trim()))||[]}),r=n.selectedSentence?s.indexOf(n.selectedSentence):-1,a=r!==-1?r:t.readingProgress||0;l({type:"ADD_OR_UPDATE_TEXT_ENTRY",payload:{...t,readingProgress:a}}),l({type:"SET_VIEW",payload:N.ReadingMode})},y=t.text.split(`
`).map(s=>{var r;return((r=s.match(/[^。？！]+(?:[。？！][」』]*)?/g))==null?void 0:r.filter(a=>a==null?void 0:a.trim()))||[]});return e.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto md:grid md:grid-cols-2 md:overflow-hidden",children:[e.jsxs("div",{className:"p-6 flex flex-col md:h-full md:grid md:grid-rows-[auto_1fr] md:gap-y-4 md:min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 md:mb-0",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary break-words",title:t.title,children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,title:"Edit Text",className:"btn-ghost",children:e.jsx("i",{className:"bi bi-pencil-square text-xl"})}),e.jsx("button",{id:"start-reading-button",onClick:b,title:"Start Reading Mode",className:"inline-flex items-center justify-center p-2.5 rounded-full text-primary-text bg-accent hover:bg-accent/90 focus-ring shadow-sm",children:e.jsx("i",{className:"bi bi-book text-2xl"})})]})]}),e.jsx("div",{id:"reader-view-text-container",className:"reader-view-text bg-surface-soft border border-border rounded-lg p-4 sm:p-6 overflow-y-auto no-scrollbar min-h-0 max-h-[40vh]",children:y.map((s,r)=>e.jsx("p",{className:"text-lg sm:text-xl leading-relaxed mb-4 last:mb-0",children:s.length>0?s.map((a,c)=>{const d=n.selectedSentence===a,i=!!(t!=null&&t.analyzedSentences[a]),o=["clickable-sentence","cursor-pointer","rounded","p-1","-m-1","transition-colors","duration-200","hover:bg-accent-selected-bg/50"];return d?o.push("selected","bg-accent-selected-bg/60","dark:bg-accent-selected-bg/30","font-semibold"):i&&o.push("has-analysis"),e.jsxs(E.Fragment,{children:[e.jsx("span",{className:o.join(" "),onClick:()=>u(a),children:a})," "]},c)}):e.jsx(e.Fragment,{children:" "})},r))})]}),e.jsx("div",{className:"md:h-full md:overflow-y-auto no-scrollbar md:border-l border-border md:min-w-0",children:e.jsx("div",{className:"p-6 md:h-full",children:e.jsx("div",{id:"analysis-view",className:"md:h-full",children:n.selectedSentence?x?e.jsx(S,{error:x,onRetry:h}):m?e.jsx(w,{analysis:m,onReanalyze:h}):e.jsx(T,{sentence:n.selectedSentence,isLoading:f}):e.jsx("div",{className:"text-center p-8 text-text-muted md:h-full flex items-center justify-center",children:"Select a sentence to begin."})})})})]})};export{C as default};
