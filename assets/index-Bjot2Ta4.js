(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const we=document.getElementById("generate-button"),ue=document.getElementById("sentence-input"),Te=document.getElementById("text-title-input"),de=document.getElementById("result-container"),kt=document.getElementById("main-view"),W=document.getElementById("reader-view"),H=document.getElementById("analysis-view"),J=document.getElementById("reading-mode-view"),Ae=document.getElementById("theme-checkbox"),He=document.getElementById("furigana-checkbox"),Je=document.getElementById("pitch-accent-checkbox"),z=document.getElementById("tooltip"),$t=document.getElementById("settings-button"),Ge=document.getElementById("settings-menu"),rt=document.getElementById("analysis-depth-slider"),Ht=document.getElementById("analysis-depth-label"),ri=document.getElementById("new-text-button"),ai=document.getElementById("history-button"),Jt=document.getElementById("history-panel"),at=document.getElementById("history-panel-overlay"),li=document.getElementById("close-history-button"),hn=document.getElementById("clear-history-button"),pt=document.getElementById("history-list"),ui=document.getElementById("history-empty-message"),ci=document.getElementById("export-data-button"),Ki=document.getElementById("import-data-button"),lt=document.getElementById("import-file-input"),Oe=document.getElementById("api-key-input"),di=document.getElementById("save-api-key-button"),Ce=document.getElementById("api-key-status");if(!we||!ue||!Te||!de||!kt||!W||!H||!J||!Ae||!He||!Je||!z||!$t||!Ge||!ri||!ai||!Jt||!li||!hn||!pt||!ui||!at||!rt||!Ht||!ci||!Ki||!lt||!Oe||!di||!Ce)throw new Error("Required HTML elements not found at startup.");const Ut=["low","medium","high"];let Yt=null,K=[],q=null,fe="medium",Re=null,O=null,_e=null,ze=null;function Sn(o){Yt=o}function Ft(o){Re=o}function zi(o){O=o}function fi(o){_e=o}function pi(o){ze=o}function gn(o){q=o}function In(o){fe=o}function Kt(o){K=o}function Z(o){return K.find(e=>e.id===o)}function mt(o){const e=K.findIndex(t=>t.id===o.id);e>-1?K[e]=o:K.unshift(o)}function An(o,e){const t=Z(o);t&&(t.readingProgress=e,t.updatedAt=Date.now(),mt(t))}function Mn(o,e,t){if(!q)return;const n=Z(q);n&&(n.analyzedSentences[o]||(n.analyzedSentences[o]={}),n.analyzedSentences[o][t]=e,n.updatedAt=Date.now(),mt(n))}function Wi(o){K=K.filter(e=>e.id!==o)}function Zi(){K=[]}var D;(function(o){o.assertEqual=i=>{};function e(i){}o.assertIs=e;function t(i){throw new Error}o.assertNever=t,o.arrayToEnum=i=>{const s={};for(const l of i)s[l]=l;return s},o.getValidEnumValues=i=>{const s=o.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),l={};for(const u of s)l[u]=i[u];return o.objectValues(l)},o.objectValues=i=>o.objectKeys(i).map(function(s){return i[s]}),o.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&s.push(l);return s},o.find=(i,s)=>{for(const l of i)if(s(l))return l},o.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(l=>typeof l=="string"?`'${l}'`:l).join(s)}o.joinValues=n,o.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(D||(D={}));var wn;(function(o){o.mergeShapes=(e,t)=>({...e,...t})})(wn||(wn={}));const T=D.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),le=o=>{switch(typeof o){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(o)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(o)?T.array:o===null?T.null:o.then&&typeof o.then=="function"&&o.catch&&typeof o.catch=="function"?T.promise:typeof Map<"u"&&o instanceof Map?T.map:typeof Set<"u"&&o instanceof Set?T.set:typeof Date<"u"&&o instanceof Date?T.date:T.object;default:return T.unknown}},v=D.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ae extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},n={_errors:[]},i=s=>{for(const l of s.issues)if(l.code==="invalid_union")l.unionErrors.map(i);else if(l.code==="invalid_return_type")i(l.returnTypeError);else if(l.code==="invalid_arguments")i(l.argumentsError);else if(l.path.length===0)n._errors.push(t(l));else{let u=n,d=0;for(;d<l.path.length;){const c=l.path[d];d===l.path.length-1?(u[c]=u[c]||{_errors:[]},u[c]._errors.push(t(l))):u[c]=u[c]||{_errors:[]},u=u[c],d++}}};return i(this),n}static assert(e){if(!(e instanceof ae))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,D.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}ae.create=o=>new ae(o);const zt=(o,e)=>{let t;switch(o.code){case v.invalid_type:o.received===T.undefined?t="Required":t=`Expected ${o.expected}, received ${o.received}`;break;case v.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(o.expected,D.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:t=`Unrecognized key(s) in object: ${D.joinValues(o.keys,", ")}`;break;case v.invalid_union:t="Invalid input";break;case v.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${D.joinValues(o.options)}`;break;case v.invalid_enum_value:t=`Invalid enum value. Expected ${D.joinValues(o.options)}, received '${o.received}'`;break;case v.invalid_arguments:t="Invalid function arguments";break;case v.invalid_return_type:t="Invalid function return type";break;case v.invalid_date:t="Invalid date";break;case v.invalid_string:typeof o.validation=="object"?"includes"in o.validation?(t=`Invalid input: must include "${o.validation.includes}"`,typeof o.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${o.validation.position}`)):"startsWith"in o.validation?t=`Invalid input: must start with "${o.validation.startsWith}"`:"endsWith"in o.validation?t=`Invalid input: must end with "${o.validation.endsWith}"`:D.assertNever(o.validation):o.validation!=="regex"?t=`Invalid ${o.validation}`:t="Invalid";break;case v.too_small:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at least":"more than"} ${o.minimum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at least":"over"} ${o.minimum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${o.minimum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(o.minimum))}`:t="Invalid input";break;case v.too_big:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at most":"less than"} ${o.maximum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at most":"under"} ${o.maximum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="bigint"?t=`BigInt must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly":o.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(o.maximum))}`:t="Invalid input";break;case v.custom:t="Invalid input";break;case v.invalid_intersection_types:t="Intersection results could not be merged";break;case v.not_multiple_of:t=`Number must be a multiple of ${o.multipleOf}`;break;case v.not_finite:t="Number must be finite";break;default:t=e.defaultError,D.assertNever(o)}return{message:t}};let Xi=zt;function Qi(){return Xi}const ji=o=>{const{data:e,path:t,errorMaps:n,issueData:i}=o,s=[...t,...i.path||[]],l={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let u="";const d=n.filter(c=>!!c).slice().reverse();for(const c of d)u=c(l,{data:e,defaultError:u}).message;return{...i,path:s,message:u}};function C(o,e){const t=Qi(),n=ji({issueData:e,data:o.data,path:o.path,errorMaps:[o.common.contextualErrorMap,o.schemaErrorMap,t,t===zt?void 0:zt].filter(i=>!!i)});o.common.issues.push(n)}class ${constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const i of t){if(i.status==="aborted")return A;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const i of t){const s=await i.key,l=await i.value;n.push({key:s,value:l})}return $.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const i of t){const{key:s,value:l}=i;if(s.status==="aborted"||l.status==="aborted")return A;s.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof l.value<"u"||i.alwaysSet)&&(n[s.value]=l.value)}return{status:e.value,value:n}}}const A=Object.freeze({status:"aborted"}),qe=o=>({status:"dirty",value:o}),X=o=>({status:"valid",value:o}),kn=o=>o.status==="aborted",Rn=o=>o.status==="dirty",Ne=o=>o.status==="valid",ht=o=>typeof Promise<"u"&&o instanceof Promise;var _;(function(o){o.errToObj=e=>typeof e=="string"?{message:e}:e||{},o.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(_||(_={}));class ie{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Nn=(o,e)=>{if(Ne(e))return{success:!0,data:e.value};if(!o.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ae(o.common.issues);return this._error=t,this._error}}};function k(o){if(!o)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:i}=o;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(l,u)=>{const{message:d}=o;return l.code==="invalid_enum_value"?{message:d??u.defaultError}:typeof u.data>"u"?{message:d??n??u.defaultError}:l.code!=="invalid_type"?{message:u.defaultError}:{message:d??t??u.defaultError}},description:i}}class N{get description(){return this._def.description}_getType(e){return le(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:le(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new $,ctx:{common:e.parent.common,data:e.data,parsedType:le(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ht(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:le(e)},i=this._parseSync({data:e,path:n.path,parent:n});return Nn(n,i)}"~validate"(e){var n,i;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:le(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return Ne(s)?{value:s.value}:{issues:t.common.issues}}catch(s){(i=(n=s==null?void 0:s.message)==null?void 0:n.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>Ne(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:le(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ht(i)?i:Promise.resolve(i));return Nn(n,s)}refine(e,t){const n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const l=e(i),u=()=>s.addIssue({code:v.custom,...n(i)});return typeof Promise<"u"&&l instanceof Promise?l.then(d=>d?!0:(u(),!1)):l?!0:(u(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new Le({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ce.create(this,this._def)}nullable(){return be.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return oe.create(this)}promise(){return Tt.create(this,this._def)}or(e){return yt.create([this,e],this._def)}and(e){return vt.create(this,e,this._def)}transform(e){return new Le({...k(this._def),schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Qt({...k(this._def),innerType:this,defaultValue:t,typeName:S.ZodDefault})}brand(){return new Es({typeName:S.ZodBranded,type:this,...k(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new jt({...k(this._def),innerType:this,catchValue:t,typeName:S.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return yn.create(this,e)}readonly(){return en.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const es=/^c[^\s-]{8,}$/i,ts=/^[0-9a-z]+$/,ns=/^[0-9A-HJKMNP-TV-Z]{26}$/i,os=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,is=/^[a-z0-9_-]{21}$/i,ss=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,rs=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,as=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ls="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Bt;const us=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ds=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,fs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ps=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ms=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mi="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",hs=new RegExp(`^${mi}$`);function hi(o){let e="[0-5]\\d";o.precision?e=`${e}\\.\\d{${o.precision}}`:o.precision==null&&(e=`${e}(\\.\\d+)?`);const t=o.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function gs(o){return new RegExp(`^${hi(o)}$`)}function ys(o){let e=`${mi}T${hi(o)}`;const t=[];return t.push(o.local?"Z?":"Z"),o.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function vs(o,e){return!!((e==="v4"||!e)&&us.test(o)||(e==="v6"||!e)&&ds.test(o))}function Cs(o,e){if(!ss.test(o))return!1;try{const[t]=o.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function Ts(o,e){return!!((e==="v4"||!e)&&cs.test(o)||(e==="v6"||!e)&&fs.test(o))}class ne extends N{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.string,received:s.parsedType}),A}const n=new $;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const l=e.data.length>s.value,u=e.data.length<s.value;(l||u)&&(i=this._getOrReturnCtx(e,i),l?C(i,{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):u&&C(i,{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")as.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"email",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Bt||(Bt=new RegExp(ls,"u")),Bt.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"emoji",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")os.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"uuid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")is.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"nanoid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")es.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cuid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")ts.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cuid2",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")ns.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"ulid",code:v.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),C(i,{validation:"url",code:v.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"regex",code:v.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?ys(s).test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?hs.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?gs(s).test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:v.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?rs.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"duration",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?vs(e.data,s.version)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"ip",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?Cs(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"jwt",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?Ts(e.data,s.version)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"cidr",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?ps.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"base64",code:v.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?ms.test(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{validation:"base64url",code:v.invalid_string,message:s.message}),n.dirty()):D.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(i=>e.test(i),{validation:t,code:v.invalid_string,..._.errToObj(n)})}_addCheck(e){return new ne({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,..._.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,..._.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,..._.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new ne({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ne({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ne({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ne.create=o=>new ne({checks:[],typeName:S.ZodString,coerce:(o==null?void 0:o.coerce)??!1,...k(o)});function _s(o,e){const t=(o.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(o.toFixed(i).replace(".","")),l=Number.parseInt(e.toFixed(i).replace(".",""));return s%l/10**i}class Ee extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.number,received:s.parsedType}),A}let n;const i=new $;for(const s of this._def.checks)s.kind==="int"?D.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:v.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?_s(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_finite,message:s.message}),i.dirty()):D.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,n,i){return new Ee({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(i)}]})}_addCheck(e){return new Ee({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&D.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ee.create=o=>new Ee({checks:[],typeName:S.ZodNumber,coerce:(o==null?void 0:o.coerce)||!1,...k(o)});class xe extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let n;const i=new $;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),C(n,{code:v.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):D.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return C(t,{code:v.invalid_type,expected:T.bigint,received:t.parsedType}),A}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,n,i){return new xe({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:_.toString(i)}]})}_addCheck(e){return new xe({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}xe.create=o=>new xe({checks:[],typeName:S.ZodBigInt,coerce:(o==null?void 0:o.coerce)??!1,...k(o)});class gt extends N{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.boolean,received:n.parsedType}),A}return X(e.data)}}gt.create=o=>new gt({typeName:S.ZodBoolean,coerce:(o==null?void 0:o.coerce)||!1,...k(o)});class Pe extends N{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_type,expected:T.date,received:s.parsedType}),A}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return C(s,{code:v.invalid_date}),A}const n=new $;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),C(i,{code:v.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):D.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Pe({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Pe.create=o=>new Pe({checks:[],coerce:(o==null?void 0:o.coerce)||!1,typeName:S.ZodDate,...k(o)});class Pn extends N{_parse(e){if(this._getType(e)!==T.symbol){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.symbol,received:n.parsedType}),A}return X(e.data)}}Pn.create=o=>new Pn({typeName:S.ZodSymbol,...k(o)});class Dn extends N{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.undefined,received:n.parsedType}),A}return X(e.data)}}Dn.create=o=>new Dn({typeName:S.ZodUndefined,...k(o)});class Ln extends N{_parse(e){if(this._getType(e)!==T.null){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.null,received:n.parsedType}),A}return X(e.data)}}Ln.create=o=>new Ln({typeName:S.ZodNull,...k(o)});class bn extends N{constructor(){super(...arguments),this._any=!0}_parse(e){return X(e.data)}}bn.create=o=>new bn({typeName:S.ZodAny,...k(o)});class Wt extends N{constructor(){super(...arguments),this._unknown=!0}_parse(e){return X(e.data)}}Wt.create=o=>new Wt({typeName:S.ZodUnknown,...k(o)});class pe extends N{_parse(e){const t=this._getOrReturnCtx(e);return C(t,{code:v.invalid_type,expected:T.never,received:t.parsedType}),A}}pe.create=o=>new pe({typeName:S.ZodNever,...k(o)});class Vn extends N{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.void,received:n.parsedType}),A}return X(e.data)}}Vn.create=o=>new Vn({typeName:S.ZodVoid,...k(o)});class oe extends N{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),i=this._def;if(t.parsedType!==T.array)return C(t,{code:v.invalid_type,expected:T.array,received:t.parsedType}),A;if(i.exactLength!==null){const l=t.data.length>i.exactLength.value,u=t.data.length<i.exactLength.value;(l||u)&&(C(t,{code:l?v.too_big:v.too_small,minimum:u?i.exactLength.value:void 0,maximum:l?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(C(t,{code:v.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(C(t,{code:v.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((l,u)=>i.type._parseAsync(new ie(t,l,t.path,u)))).then(l=>$.mergeArray(n,l));const s=[...t.data].map((l,u)=>i.type._parseSync(new ie(t,l,t.path,u)));return $.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new oe({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new oe({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new oe({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}oe.create=(o,e)=>new oe({type:o,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray,...k(e)});function Me(o){if(o instanceof F){const e={};for(const t in o.shape){const n=o.shape[t];e[t]=ce.create(Me(n))}return new F({...o._def,shape:()=>e})}else return o instanceof oe?new oe({...o._def,type:Me(o.element)}):o instanceof ce?ce.create(Me(o.unwrap())):o instanceof be?be.create(Me(o.unwrap())):o instanceof Se?Se.create(o.items.map(e=>Me(e))):o}class F extends N{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=D.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){const c=this._getOrReturnCtx(e);return C(c,{code:v.invalid_type,expected:T.object,received:c.parsedType}),A}const{status:n,ctx:i}=this._processInputParams(e),{shape:s,keys:l}=this._getCached(),u=[];if(!(this._def.catchall instanceof pe&&this._def.unknownKeys==="strip"))for(const c in i.data)l.includes(c)||u.push(c);const d=[];for(const c of l){const f=s[c],p=i.data[c];d.push({key:{status:"valid",value:c},value:f._parse(new ie(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof pe){const c=this._def.unknownKeys;if(c==="passthrough")for(const f of u)d.push({key:{status:"valid",value:f},value:{status:"valid",value:i.data[f]}});else if(c==="strict")u.length>0&&(C(i,{code:v.unrecognized_keys,keys:u}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const f of u){const p=i.data[f];d.push({key:{status:"valid",value:f},value:c._parse(new ie(i,p,i.path,f)),alwaysSet:f in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const f of d){const p=await f.key,m=await f.value;c.push({key:p,value:m,alwaysSet:f.alwaysSet})}return c}).then(c=>$.mergeObjectSync(n,c)):$.mergeObjectSync(n,d)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new F({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,l;const i=((l=(s=this._def).errorMap)==null?void 0:l.call(s,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:_.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new F({...this._def,unknownKeys:"strip"})}passthrough(){return new F({...this._def,unknownKeys:"passthrough"})}extend(e){return new F({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new F({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:S.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new F({...this._def,catchall:e})}pick(e){const t={};for(const n of D.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new F({...this._def,shape:()=>t})}omit(e){const t={};for(const n of D.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new F({...this._def,shape:()=>t})}deepPartial(){return Me(this)}partial(e){const t={};for(const n of D.objectKeys(this.shape)){const i=this.shape[n];e&&!e[n]?t[n]=i:t[n]=i.optional()}return new F({...this._def,shape:()=>t})}required(e){const t={};for(const n of D.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof ce;)s=s._def.innerType;t[n]=s}return new F({...this._def,shape:()=>t})}keyof(){return gi(D.objectKeys(this.shape))}}F.create=(o,e)=>new F({shape:()=>o,unknownKeys:"strip",catchall:pe.create(),typeName:S.ZodObject,...k(e)});F.strictCreate=(o,e)=>new F({shape:()=>o,unknownKeys:"strict",catchall:pe.create(),typeName:S.ZodObject,...k(e)});F.lazycreate=(o,e)=>new F({shape:o,unknownKeys:"strip",catchall:pe.create(),typeName:S.ZodObject,...k(e)});class yt extends N{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function i(s){for(const u of s)if(u.result.status==="valid")return u.result;for(const u of s)if(u.result.status==="dirty")return t.common.issues.push(...u.ctx.common.issues),u.result;const l=s.map(u=>new ae(u.ctx.common.issues));return C(t,{code:v.invalid_union,unionErrors:l}),A}if(t.common.async)return Promise.all(n.map(async s=>{const l={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:l}),ctx:l}})).then(i);{let s;const l=[];for(const d of n){const c={...t,common:{...t.common,issues:[]},parent:null},f=d._parseSync({data:t.data,path:t.path,parent:c});if(f.status==="valid")return f;f.status==="dirty"&&!s&&(s={result:f,ctx:c}),c.common.issues.length&&l.push(c.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const u=l.map(d=>new ae(d));return C(t,{code:v.invalid_union,unionErrors:u}),A}}get options(){return this._def.options}}yt.create=(o,e)=>new yt({options:o,typeName:S.ZodUnion,...k(e)});function Zt(o,e){const t=le(o),n=le(e);if(o===e)return{valid:!0,data:o};if(t===T.object&&n===T.object){const i=D.objectKeys(e),s=D.objectKeys(o).filter(u=>i.indexOf(u)!==-1),l={...o,...e};for(const u of s){const d=Zt(o[u],e[u]);if(!d.valid)return{valid:!1};l[u]=d.data}return{valid:!0,data:l}}else if(t===T.array&&n===T.array){if(o.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<o.length;s++){const l=o[s],u=e[s],d=Zt(l,u);if(!d.valid)return{valid:!1};i.push(d.data)}return{valid:!0,data:i}}else return t===T.date&&n===T.date&&+o==+e?{valid:!0,data:o}:{valid:!1}}class vt extends N{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=(s,l)=>{if(kn(s)||kn(l))return A;const u=Zt(s.value,l.value);return u.valid?((Rn(s)||Rn(l))&&t.dirty(),{status:t.value,value:u.data}):(C(n,{code:v.invalid_intersection_types}),A)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,l])=>i(s,l)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}vt.create=(o,e,t)=>new vt({left:o,right:e,typeName:S.ZodIntersection,...k(t)});class Se extends N{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.array)return C(n,{code:v.invalid_type,expected:T.array,received:n.parsedType}),A;if(n.data.length<this._def.items.length)return C(n,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&n.data.length>this._def.items.length&&(C(n,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...n.data].map((l,u)=>{const d=this._def.items[u]||this._def.rest;return d?d._parse(new ie(n,l,n.path,u)):null}).filter(l=>!!l);return n.common.async?Promise.all(s).then(l=>$.mergeArray(t,l)):$.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Se({...this._def,rest:e})}}Se.create=(o,e)=>{if(!Array.isArray(o))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Se({items:o,typeName:S.ZodTuple,rest:null,...k(e)})};class Ct extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.object)return C(n,{code:v.invalid_type,expected:T.object,received:n.parsedType}),A;const i=[],s=this._def.keyType,l=this._def.valueType;for(const u in n.data)i.push({key:s._parse(new ie(n,u,n.path,u)),value:l._parse(new ie(n,n.data[u],n.path,u)),alwaysSet:u in n.data});return n.common.async?$.mergeObjectAsync(t,i):$.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof N?new Ct({keyType:e,valueType:t,typeName:S.ZodRecord,...k(n)}):new Ct({keyType:ne.create(),valueType:e,typeName:S.ZodRecord,...k(t)})}}class Un extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.map)return C(n,{code:v.invalid_type,expected:T.map,received:n.parsedType}),A;const i=this._def.keyType,s=this._def.valueType,l=[...n.data.entries()].map(([u,d],c)=>({key:i._parse(new ie(n,u,n.path,[c,"key"])),value:s._parse(new ie(n,d,n.path,[c,"value"]))}));if(n.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const d of l){const c=await d.key,f=await d.value;if(c.status==="aborted"||f.status==="aborted")return A;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),u.set(c.value,f.value)}return{status:t.value,value:u}})}else{const u=new Map;for(const d of l){const c=d.key,f=d.value;if(c.status==="aborted"||f.status==="aborted")return A;(c.status==="dirty"||f.status==="dirty")&&t.dirty(),u.set(c.value,f.value)}return{status:t.value,value:u}}}}Un.create=(o,e,t)=>new Un({valueType:e,keyType:o,typeName:S.ZodMap,...k(t)});class We extends N{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.set)return C(n,{code:v.invalid_type,expected:T.set,received:n.parsedType}),A;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(C(n,{code:v.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(C(n,{code:v.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function l(d){const c=new Set;for(const f of d){if(f.status==="aborted")return A;f.status==="dirty"&&t.dirty(),c.add(f.value)}return{status:t.value,value:c}}const u=[...n.data.values()].map((d,c)=>s._parse(new ie(n,d,n.path,c)));return n.common.async?Promise.all(u).then(d=>l(d)):l(u)}min(e,t){return new We({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new We({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}We.create=(o,e)=>new We({valueType:o,minSize:null,maxSize:null,typeName:S.ZodSet,...k(e)});class Xt extends N{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Xt.create=(o,e)=>new Xt({getter:o,typeName:S.ZodLazy,...k(e)});class Fn extends N{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:e.data}}get value(){return this._def.value}}Fn.create=(o,e)=>new Fn({value:o,typeName:S.ZodLiteral,...k(e)});function gi(o,e){return new De({values:o,typeName:S.ZodEnum,...k(e)})}class De extends N{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{expected:D.joinValues(n),received:t.parsedType,code:v.invalid_type}),A}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{received:t.data,code:v.invalid_enum_value,options:n}),A}return X(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return De.create(e,{...this._def,...t})}exclude(e,t=this._def){return De.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}De.create=gi;class Bn extends N{_parse(e){const t=D.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==T.string&&n.parsedType!==T.number){const i=D.objectValues(t);return C(n,{expected:D.joinValues(i),received:n.parsedType,code:v.invalid_type}),A}if(this._cache||(this._cache=new Set(D.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=D.objectValues(t);return C(n,{received:n.data,code:v.invalid_enum_value,options:i}),A}return X(e.data)}get enum(){return this._def.values}}Bn.create=(o,e)=>new Bn({values:o,typeName:S.ZodNativeEnum,...k(e)});class Tt extends N{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return C(t,{code:v.invalid_type,expected:T.promise,received:t.parsedType}),A;const n=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return X(n.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Tt.create=(o,e)=>new Tt({type:o,typeName:S.ZodPromise,...k(e)});class Le extends N{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:l=>{C(n,l),l.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const l=i.transform(n.data,s);if(n.common.async)return Promise.resolve(l).then(async u=>{if(t.value==="aborted")return A;const d=await this._def.schema._parseAsync({data:u,path:n.path,parent:n});return d.status==="aborted"?A:d.status==="dirty"||t.value==="dirty"?qe(d.value):d});{if(t.value==="aborted")return A;const u=this._def.schema._parseSync({data:l,path:n.path,parent:n});return u.status==="aborted"?A:u.status==="dirty"||t.value==="dirty"?qe(u.value):u}}if(i.type==="refinement"){const l=u=>{const d=i.refinement(u,s);if(n.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(n.common.async===!1){const u=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return u.status==="aborted"?A:(u.status==="dirty"&&t.dirty(),l(u.value),{status:t.value,value:u.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(u=>u.status==="aborted"?A:(u.status==="dirty"&&t.dirty(),l(u.value).then(()=>({status:t.value,value:u.value}))))}if(i.type==="transform")if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Ne(l))return A;const u=i.transform(l.value,s);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:u}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>Ne(l)?Promise.resolve(i.transform(l.value,s)).then(u=>({status:t.value,value:u})):A);D.assertNever(i)}}Le.create=(o,e,t)=>new Le({schema:o,typeName:S.ZodEffects,effect:e,...k(t)});Le.createWithPreprocess=(o,e,t)=>new Le({schema:e,effect:{type:"preprocess",transform:o},typeName:S.ZodEffects,...k(t)});class ce extends N{_parse(e){return this._getType(e)===T.undefined?X(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ce.create=(o,e)=>new ce({innerType:o,typeName:S.ZodOptional,...k(e)});class be extends N{_parse(e){return this._getType(e)===T.null?X(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}be.create=(o,e)=>new be({innerType:o,typeName:S.ZodNullable,...k(e)});class Qt extends N{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===T.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Qt.create=(o,e)=>new Qt({innerType:o,typeName:S.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...k(e)});class jt extends N{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ht(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ae(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ae(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}jt.create=(o,e)=>new jt({innerType:o,typeName:S.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...k(e)});class Gn extends N{_parse(e){if(this._getType(e)!==T.nan){const n=this._getOrReturnCtx(e);return C(n,{code:v.invalid_type,expected:T.nan,received:n.parsedType}),A}return{status:"valid",value:e.data}}}Gn.create=o=>new Gn({typeName:S.ZodNaN,...k(o)});class Es extends N{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class yn extends N{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?A:s.status==="dirty"?(t.dirty(),qe(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?A:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new yn({in:e,out:t,typeName:S.ZodPipeline})}}class en extends N{_parse(e){const t=this._def.innerType._parse(e),n=i=>(Ne(i)&&(i.value=Object.freeze(i.value)),i);return ht(t)?t.then(i=>n(i)):n(t)}unwrap(){return this._def.innerType}}en.create=(o,e)=>new en({innerType:o,typeName:S.ZodReadonly,...k(e)});var S;(function(o){o.ZodString="ZodString",o.ZodNumber="ZodNumber",o.ZodNaN="ZodNaN",o.ZodBigInt="ZodBigInt",o.ZodBoolean="ZodBoolean",o.ZodDate="ZodDate",o.ZodSymbol="ZodSymbol",o.ZodUndefined="ZodUndefined",o.ZodNull="ZodNull",o.ZodAny="ZodAny",o.ZodUnknown="ZodUnknown",o.ZodNever="ZodNever",o.ZodVoid="ZodVoid",o.ZodArray="ZodArray",o.ZodObject="ZodObject",o.ZodUnion="ZodUnion",o.ZodDiscriminatedUnion="ZodDiscriminatedUnion",o.ZodIntersection="ZodIntersection",o.ZodTuple="ZodTuple",o.ZodRecord="ZodRecord",o.ZodMap="ZodMap",o.ZodSet="ZodSet",o.ZodFunction="ZodFunction",o.ZodLazy="ZodLazy",o.ZodLiteral="ZodLiteral",o.ZodEnum="ZodEnum",o.ZodEffects="ZodEffects",o.ZodNativeEnum="ZodNativeEnum",o.ZodOptional="ZodOptional",o.ZodNullable="ZodNullable",o.ZodDefault="ZodDefault",o.ZodCatch="ZodCatch",o.ZodPromise="ZodPromise",o.ZodBranded="ZodBranded",o.ZodPipeline="ZodPipeline",o.ZodReadonly="ZodReadonly"})(S||(S={}));const ve=ne.create,On=Ee.create;xe.create;const xs=gt.create;Pe.create;const qn=Wt.create;pe.create;const $e=oe.create,Ss=F.create,Is=yt.create;vt.create;Se.create;const As=Ct.create,Ms=Xt.create,ws=De.create;Tt.create;ce.create;be.create;const Ie={string:o=>ne.create({...o,coerce:!0}),number:o=>Ee.create({...o,coerce:!0}),boolean:o=>gt.create({...o,coerce:!0}),bigint:o=>xe.create({...o,coerce:!0}),date:o=>Pe.create({...o,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ks,Rs;function Ns(){return{geminiUrl:ks,vertexUrl:Rs}}function Ps(o,e,t){var n,i,s;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const l=Ns();return o.vertexai?(i=l.vertexUrl)!==null&&i!==void 0?i:e:(s=l.geminiUrl)!==null&&s!==void 0?s:t}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tt{}function x(o,e){const t=/\{([^}]+)\}/g;return o.replace(t,(n,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const s=e[i];return s!=null?String(s):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function a(o,e,t){for(let s=0;s<e.length-1;s++){const l=e[s];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in o))if(Array.isArray(t))o[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(o[u])){const d=o[u];if(Array.isArray(t))for(let c=0;c<d.length;c++){const f=d[c];a(f,e.slice(s+1),t[c])}else for(const c of d)a(c,e.slice(s+1),t)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in o||(o[u]=[{}]);const d=o[u];a(d[0],e.slice(s+1),t);return}(!o[l]||typeof o[l]!="object")&&(o[l]={}),o=o[l]}const n=e[e.length-1],i=o[n];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=t}function r(o,e){try{if(e.length===1&&e[0]==="_self")return o;for(let t=0;t<e.length;t++){if(typeof o!="object"||o===null)return;const n=e[t];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const s=o[i];return Array.isArray(s)?s.map(l=>r(l,e.slice(t+1))):void 0}else return}else o=o[n]}return o}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var $n;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})($n||($n={}));var Hn;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(Hn||(Hn={}));var Jn;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Jn||(Jn={}));var Yn;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(Yn||(Yn={}));var Kn;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(Kn||(Kn={}));var te;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(te||(te={}));var zn;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(zn||(zn={}));var Wn;(function(o){o.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",o.NO_AUTH="NO_AUTH",o.API_KEY_AUTH="API_KEY_AUTH",o.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",o.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",o.OAUTH="OAUTH",o.OIDC_AUTH="OIDC_AUTH"})(Wn||(Wn={}));var Zn;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(Zn||(Zn={}));var Xn;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(Xn||(Xn={}));var Qn;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Qn||(Qn={}));var jn;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(jn||(jn={}));var eo;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(eo||(eo={}));var _t;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(_t||(_t={}));var to;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(to||(to={}));var tn;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(tn||(tn={}));var no;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(no||(no={}));var oo;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(oo||(oo={}));var io;(function(o){o.UNSPECIFIED="UNSPECIFIED",o.BLOCKING="BLOCKING",o.NON_BLOCKING="NON_BLOCKING"})(io||(io={}));var so;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(so||(so={}));var ro;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(ro||(ro={}));var ao;(function(o){o.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",o.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",o.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(ao||(ao={}));var lo;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(lo||(lo={}));var uo;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(uo||(uo={}));var co;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(co||(co={}));var fo;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(fo||(fo={}));var po;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(po||(po={}));var mo;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(mo||(mo={}));var ho;(function(o){o.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",o.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",o.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",o.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",o.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",o.EDIT_MODE_STYLE="EDIT_MODE_STYLE",o.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",o.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(ho||(ho={}));var go;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(go||(go={}));var yo;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(yo||(yo={}));var vo;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(vo||(vo={}));var Co;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Co||(Co={}));var To;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(To||(To={}));var _o;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})(_o||(_o={}));var Eo;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Eo||(Eo={}));var xo;(function(o){o.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",o.SILENT="SILENT",o.WHEN_IDLE="WHEN_IDLE",o.INTERRUPT="INTERRUPT"})(xo||(xo={}));var So;(function(o){o.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",o.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",o.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",o.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",o.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",o.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",o.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",o.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",o.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",o.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",o.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",o.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",o.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(So||(So={}));var Io;(function(o){o.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",o.QUALITY="QUALITY",o.DIVERSITY="DIVERSITY"})(Io||(Io={}));var ke;(function(o){o.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",o.PLAY="PLAY",o.PAUSE="PAUSE",o.STOP="STOP",o.RESET_CONTEXT="RESET_CONTEXT"})(ke||(ke={}));class Be{get text(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const m of(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&d!==void 0?d:[]){for(const[m,h]of Object.entries(p))m!=="inlineData"&&(h!==null||h!==void 0)&&f.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,n,i,s,l,u,d;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,n,i,s,l,u,d,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,n,i,s,l,u,d,c;if(((i=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(u=(l=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(c=f==null?void 0:f[0])===null||c===void 0?void 0:c.output}}class Ao{}class Mo{}class Ds{}class Ls{}class wo{}class ko{}class Ro{}class bs{}class No{}class Po{}class Do{}class Vs{}class nn{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Us{}class Fs{}class Bs{get text(){var e,t,n;let i="",s=!1;const l=[];for(const u of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[d,c]of Object.entries(u))d!=="text"&&d!=="thought"&&c!==null&&l.push(d);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;s=!0,i+=u.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?i:void 0}get data(){var e,t,n;let i="";const s=[];for(const l of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(l))u!=="inlineData"&&d!==null&&s.push(u);l.inlineData&&typeof l.inlineData.data=="string"&&(i+=atob(l.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class Gs{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function V(o,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function yi(o,e){const t=V(o,e);return t?t.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:t.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${t}`:t:""}function vi(o,e){return Array.isArray(e)?e.map(t=>Et(o,t)):[Et(o,e)]}function Et(o,e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function Os(o,e){const t=Et(o,e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function qs(o,e){const t=Et(o,e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Lo(o,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Ci(o,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Lo(o,t)):[Lo(o,e)]}function on(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function bo(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function Vo(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function Y(o,e){if(e==null)throw new Error("ContentUnion is required");return on(e)?e:{role:"user",parts:Ci(o,e)}}function Ti(o,e){if(!e)return[];if(o.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=Y(o,t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const t=Y(o,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Y(o,t)):[Y(o,e)]}function j(o,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(bo(e)||Vo(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Y(o,e)]}const t=[],n=[],i=on(e[0]);for(const s of e){const l=on(s);if(l!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)t.push(s);else{if(bo(s)||Vo(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(s)}}return i||t.push({role:"user",parts:Ci(o,n)}),t}const Uo=ws(["string","number","integer","object","array","boolean","null"]),$s=Is([Uo,$e(Uo)]);function Hs(o=!0){const e=Ms(()=>{const t=Ss({type:$s.optional(),format:ve().optional(),title:ve().optional(),description:ve().optional(),default:qn().optional(),items:e.optional(),minItems:Ie.string().optional(),maxItems:Ie.string().optional(),enum:$e(qn()).optional(),properties:As(ve(),e).optional(),required:$e(ve()).optional(),minProperties:Ie.string().optional(),maxProperties:Ie.string().optional(),propertyOrdering:$e(ve()).optional(),minimum:On().optional(),maximum:On().optional(),minLength:Ie.string().optional(),maxLength:Ie.string().optional(),pattern:ve().optional(),anyOf:$e(e).optional(),additionalProperties:xs().optional()});return o?t.strict():t});return e}function Js(o,e){o.includes("null")&&(e.nullable=!0);const t=o.filter(n=>n!=="null");if(t.length===1)e.type=Object.keys(te).includes(t[0].toUpperCase())?te[t[0].toUpperCase()]:te.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.keys(te).includes(n.toUpperCase())?te[n.toUpperCase()]:te.TYPE_UNSPECIFIED})}}function Ye(o){const e={},t=["items"],n=["anyOf"],i=["properties"];if(o.type&&o.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=o.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,o=s[1]):s[1].type==="null"&&(e.nullable=!0,o=s[0])),o.type instanceof Array&&Js(o.type,e);for(const[l,u]of Object.entries(o))if(u!=null)if(l=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.keys(te).includes(u.toUpperCase())?u.toUpperCase():te.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=Ye(u);else if(n.includes(l)){const d=[];for(const c of u){if(c.type=="null"){e.nullable=!0;continue}d.push(Ye(c))}e[l]=d}else if(i.includes(l)){const d={};for(const[c,f]of Object.entries(u))d[c]=Ye(f);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=u}return e}function xt(o,e){if(Object.keys(e).includes("$schema")){delete e.$schema;const t=Hs().parse(e);return Ye(t)}else return Ye(e)}function _i(o,e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Ei(o,e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Rt(o,e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(t.parameters=xt(o,t.parameters)),t.response&&(t.response=xt(o,t.response));return e}function Nt(o,e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function Ys(o,e,t,n=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===n;return o.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${o.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function ge(o,e){if(typeof e!="string")throw new Error("name must be a string");return Ys(o,e,"cachedContents")}function xi(o,e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function ye(o,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function Ks(o){return o!=null&&typeof o=="object"&&"name"in o}function zs(o){return o!=null&&typeof o=="object"&&"video"in o}function Ws(o){return o!=null&&typeof o=="object"&&"uri"in o}function Si(o,e){var t;let n;if(Ks(e)&&(n=e.name),!(Ws(e)&&(n=e.uri,n===void 0))&&!(zs(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const s=n.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${n}`);n=s[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Ii(o,e){let t;return o.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Ai(o,e){for(const t of["models","tunedModels","publisherModels"])if(Zs(e,t))return e[t];return[]}function Zs(o,e){return o!==null&&typeof o=="object"&&e in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xs(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Qs(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function js(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Xs(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Qs(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Fo(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>js(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function er(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function tr(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function nr(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],tr(o,n)),t}function or(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function ir(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],or(o,n)),t}function sr(){return{}}function rr(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>er(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],nr(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],ir(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],sr());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function ar(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function lr(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function ur(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],lr(o,n)),t}function cr(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],ar(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],ur(o,i)),t}function dr(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);t!==void 0&&s!=null&&a(t,["expireTime"],s);const l=r(e,["displayName"]);t!==void 0&&l!=null&&a(t,["displayName"],l);const u=r(e,["contents"]);if(t!==void 0&&u!=null){let p=j(o,u);Array.isArray(p)&&(p=p.map(m=>Fo(o,m))),a(t,["contents"],p)}const d=r(e,["systemInstruction"]);t!==void 0&&d!=null&&a(t,["systemInstruction"],Fo(o,Y(o,d)));const c=r(e,["tools"]);if(t!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>rr(o,m))),a(t,["tools"],p)}const f=r(e,["toolConfig"]);if(t!==void 0&&f!=null&&a(t,["toolConfig"],cr(o,f)),r(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function fr(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],yi(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],dr(o,i,t)),t}function pr(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function mr(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function hr(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);return t!==void 0&&s!=null&&a(t,["expireTime"],s),n}function gr(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],hr(o,i,t)),t}function yr(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function vr(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],yr(o,n,t)),t}function Cr(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Tr(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function _r(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Cr(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Tr(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Bo(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>_r(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Er(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function xr(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Sr(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],xr(o,n)),t}function Ir(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function Ar(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Ir(o,n)),t}function Mr(){return{}}function wr(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function kr(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],wr(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function Rr(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],kr(o,n)),t}function Nr(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>Er(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Sr(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],Ar(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],Mr());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],Rr(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function Pr(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function Dr(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function Lr(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],Dr(o,n)),t}function br(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],Pr(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],Lr(o,i)),t}function Vr(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);t!==void 0&&s!=null&&a(t,["expireTime"],s);const l=r(e,["displayName"]);t!==void 0&&l!=null&&a(t,["displayName"],l);const u=r(e,["contents"]);if(t!==void 0&&u!=null){let m=j(o,u);Array.isArray(m)&&(m=m.map(h=>Bo(o,h))),a(t,["contents"],m)}const d=r(e,["systemInstruction"]);t!==void 0&&d!=null&&a(t,["systemInstruction"],Bo(o,Y(o,d)));const c=r(e,["tools"]);if(t!==void 0&&c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>Nr(o,h))),a(t,["tools"],m)}const f=r(e,["toolConfig"]);t!==void 0&&f!=null&&a(t,["toolConfig"],br(o,f));const p=r(e,["kmsKeyName"]);return t!==void 0&&p!=null&&a(t,["encryption_spec","kmsKeyName"],p),n}function Ur(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],yi(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Vr(o,i,t)),t}function Fr(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Br(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Gr(o,e,t){const n={},i=r(e,["ttl"]);t!==void 0&&i!=null&&a(t,["ttl"],i);const s=r(e,["expireTime"]);return t!==void 0&&s!=null&&a(t,["expireTime"],s),n}function Or(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],ge(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Gr(o,i,t)),t}function qr(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function $r(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],qr(o,n,t)),t}function ut(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["model"]);s!=null&&a(t,["model"],s);const l=r(e,["createTime"]);l!=null&&a(t,["createTime"],l);const u=r(e,["updateTime"]);u!=null&&a(t,["updateTime"],u);const d=r(e,["expireTime"]);d!=null&&a(t,["expireTime"],d);const c=r(e,["usageMetadata"]);return c!=null&&a(t,["usageMetadata"],c),t}function Hr(){return{}}function Jr(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>ut(o,l))),a(t,["cachedContents"],s)}return t}function ct(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["model"]);s!=null&&a(t,["model"],s);const l=r(e,["createTime"]);l!=null&&a(t,["createTime"],l);const u=r(e,["updateTime"]);u!=null&&a(t,["updateTime"],u);const d=r(e,["expireTime"]);d!=null&&a(t,["expireTime"],d);const c=r(e,["usageMetadata"]);return c!=null&&a(t,["usageMetadata"],c),t}function Yr(){return{}}function Kr(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["cachedContents"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>ct(o,l))),a(t,["cachedContents"],s)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ve;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Ve||(Ve={}));class Pt{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};n?typeof n=="object"?l=Object.assign({},n):l=n:l={config:{}},l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(s=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zr extends tt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pt(Ve.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ur(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ct(this.apiClient,f))}else{const c=fr(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>ut(this.apiClient,f))}}async get(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Fr(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ct(this.apiClient,f))}else{const c=pr(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>ut(this.apiClient,f))}}async delete(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Br(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Yr(),p=new Po;return Object.assign(p,f),p})}else{const c=mr(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Hr(),p=new Po;return Object.assign(p,f),p})}}async update(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Or(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ct(this.apiClient,f))}else{const c=gr(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>ut(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=$r(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Kr(this.apiClient,f),m=new Do;return Object.assign(m,p),m})}else{const c=vr(this.apiClient,e);return u=x("cachedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Jr(this.apiClient,f),m=new Do;return Object.assign(m,p),m})}}}function Go(o){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&o[e],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function U(o){return this instanceof U?(this.v=o,this):new U(o)}function Ke(o,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(h){return function(g){return Promise.resolve(g).then(h,p)}}function u(h,g){n[h]&&(i[h]=function(y){return new Promise(function(E,w){s.push([h,y,E,w])>1||d(h,y)})},g&&(i[h]=g(i[h])))}function d(h,g){try{c(n[h](g))}catch(y){m(s[0][3],y)}}function c(h){h.value instanceof U?Promise.resolve(h.value.v).then(f,p):m(s[0][2],h)}function f(h){d("next",h)}function p(h){d("throw",h)}function m(h,g){h(g),s.shift(),s.length&&d(s[0][0],s[0][1])}}function dt(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],t;return e?e.call(o):(o=typeof Go=="function"?Go(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=o[s]&&function(l){return new Promise(function(u,d){l=o[s](l),i(u,d,l.done,l.value)})}}function i(s,l,u,d){Promise.resolve(d).then(function(c){s({value:c,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wr(o){var e;if(o.candidates==null||o.candidates.length===0)return!1;const t=(e=o.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Mi(t)}function Mi(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const e of o.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Zr(o){if(o.length!==0){for(const e of o)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Oo(o){if(o===void 0||o.length===0)return[];const e=[],t=o.length;let n=0;for(;n<t;)if(o[n].role==="user")e.push(o[n]),n++;else{const i=[];let s=!0;for(;n<t&&o[n].role==="model";)i.push(o[n]),s&&!Mi(o[n])&&(s=!1),n++;s?e.push(...i):e.pop()}return e}class Xr{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Qr(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Qr{constructor(e,t,n,i={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=s,this.sendPromise=Promise.resolve(),Zr(s)}async sendMessage(e){var t;await this.sendPromise;const n=Y(this.apiClient,e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,l,u;const d=await i,c=(l=(s=d.candidates)===null||s===void 0?void 0:s[0])===null||l===void 0?void 0:l.content,f=d.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];f!=null&&(m=(u=f.slice(p))!==null&&u!==void 0?u:[]);const h=c?[c]:[];this.recordHistory(n,h,m)})(),await this.sendPromise,i}async sendMessageStream(e){var t;await this.sendPromise;const n=Y(this.apiClient,e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const s=await i;return this.processStreamResponse(s,n)}getHistory(e=!1){const t=e?Oo(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var n,i;return Ke(this,arguments,function*(){var l,u,d,c;const f=[];try{for(var p=!0,m=dt(e),h;h=yield U(m.next()),l=h.done,!l;p=!0){c=h.value,p=!1;const g=c;if(Wr(g)){const y=(i=(n=g.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;y!==void 0&&f.push(y)}yield yield U(g)}}catch(g){u={error:g}}finally{try{!p&&!l&&(d=m.return)&&(yield U(d.call(m)))}finally{if(u)throw u.error}}this.recordHistory(t,f)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(s=>s.role!==void 0)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Oo(n)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jr(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);return t!==void 0&&s!=null&&a(t,["_query","pageToken"],s),n}function ea(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],jr(o,n,t)),t}function ta(o,e){const t={},n=r(e,["details"]);n!=null&&a(t,["details"],n);const i=r(e,["message"]);i!=null&&a(t,["message"],i);const s=r(e,["code"]);return s!=null&&a(t,["code"],s),t}function na(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["mimeType"]);s!=null&&a(t,["mimeType"],s);const l=r(e,["sizeBytes"]);l!=null&&a(t,["sizeBytes"],l);const u=r(e,["createTime"]);u!=null&&a(t,["createTime"],u);const d=r(e,["expirationTime"]);d!=null&&a(t,["expirationTime"],d);const c=r(e,["updateTime"]);c!=null&&a(t,["updateTime"],c);const f=r(e,["sha256Hash"]);f!=null&&a(t,["sha256Hash"],f);const p=r(e,["uri"]);p!=null&&a(t,["uri"],p);const m=r(e,["downloadUri"]);m!=null&&a(t,["downloadUri"],m);const h=r(e,["state"]);h!=null&&a(t,["state"],h);const g=r(e,["source"]);g!=null&&a(t,["source"],g);const y=r(e,["videoMetadata"]);y!=null&&a(t,["videoMetadata"],y);const E=r(e,["error"]);return E!=null&&a(t,["error"],ta(o,E)),t}function oa(o,e){const t={},n=r(e,["file"]);n!=null&&a(t,["file"],na(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function ia(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","file"],Si(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function sa(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","file"],Si(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function ra(o,e){const t={},n=r(e,["details"]);n!=null&&a(t,["details"],n);const i=r(e,["message"]);i!=null&&a(t,["message"],i);const s=r(e,["code"]);return s!=null&&a(t,["code"],s),t}function sn(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["mimeType"]);s!=null&&a(t,["mimeType"],s);const l=r(e,["sizeBytes"]);l!=null&&a(t,["sizeBytes"],l);const u=r(e,["createTime"]);u!=null&&a(t,["createTime"],u);const d=r(e,["expirationTime"]);d!=null&&a(t,["expirationTime"],d);const c=r(e,["updateTime"]);c!=null&&a(t,["updateTime"],c);const f=r(e,["sha256Hash"]);f!=null&&a(t,["sha256Hash"],f);const p=r(e,["uri"]);p!=null&&a(t,["uri"],p);const m=r(e,["downloadUri"]);m!=null&&a(t,["downloadUri"],m);const h=r(e,["state"]);h!=null&&a(t,["state"],h);const g=r(e,["source"]);g!=null&&a(t,["source"],g);const y=r(e,["videoMetadata"]);y!=null&&a(t,["videoMetadata"],y);const E=r(e,["error"]);return E!=null&&a(t,["error"],ra(o,E)),t}function aa(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["files"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>sn(o,l))),a(t,["files"],s)}return t}function la(){return{}}function ua(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ca extends tt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Pt(Ve.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>sn(this.apiClient,t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ea(this.apiClient,e);return s=x("files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=aa(this.apiClient,d),f=new Vs;return Object.assign(f,c),f})}}async createInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=oa(this.apiClient,e);return s=x("upload/v1beta/files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=la(),c=new Us;return Object.assign(c,d),c})}}async get(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ia(this.apiClient,e);return s=x("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>sn(this.apiClient,d))}}async delete(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=sa(this.apiClient,e);return s=x("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=ua(),c=new Fs;return Object.assign(c,d),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function da(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function fa(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function wi(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],da(o,n)),t}function pa(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],fa(o,n)),t}function ma(o,e){const t={},n=r(e,["speaker"]);n!=null&&a(t,["speaker"],n);const i=r(e,["voiceConfig"]);return i!=null&&a(t,["voiceConfig"],wi(o,i)),t}function ha(o,e){const t={},n=r(e,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ma(o,s))),a(t,["speakerVoiceConfigs"],i)}return t}function ga(o,e){const t={},n=r(e,["voiceConfig"]);n!=null&&a(t,["voiceConfig"],wi(o,n));const i=r(e,["multiSpeakerVoiceConfig"]);i!=null&&a(t,["multiSpeakerVoiceConfig"],ha(o,i));const s=r(e,["languageCode"]);return s!=null&&a(t,["languageCode"],s),t}function ya(o,e){const t={},n=r(e,["voiceConfig"]);if(n!=null&&a(t,["voiceConfig"],pa(o,n)),r(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(e,["languageCode"]);return i!=null&&a(t,["languageCode"],i),t}function va(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Ca(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Ta(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function _a(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Ea(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],va(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Ta(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function xa(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Ca(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],_a(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Sa(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Ea(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Ia(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>xa(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Aa(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function Ma(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function wa(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function ka(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Ra(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],wa(o,n)),t}function Na(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],ka(o,n)),t}function Pa(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function Da(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function La(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Pa(o,n)),t}function ba(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Da(o,n)),t}function Va(){return{}}function Ua(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function Fa(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],Ua(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function Ba(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],Fa(o,n)),t}function Ga(){return{}}function Oa(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>Aa(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],Ra(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],La(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],Ga());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function qa(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>Ma(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Na(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],ba(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],Va());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],Ba(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function $a(o,e){const t={},n=r(e,["handle"]);if(n!=null&&a(t,["handle"],n),r(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function Ha(o,e){const t={},n=r(e,["handle"]);n!=null&&a(t,["handle"],n);const i=r(e,["transparent"]);return i!=null&&a(t,["transparent"],i),t}function qo(){return{}}function $o(){return{}}function Ja(o,e){const t={},n=r(e,["disabled"]);n!=null&&a(t,["disabled"],n);const i=r(e,["startOfSpeechSensitivity"]);i!=null&&a(t,["startOfSpeechSensitivity"],i);const s=r(e,["endOfSpeechSensitivity"]);s!=null&&a(t,["endOfSpeechSensitivity"],s);const l=r(e,["prefixPaddingMs"]);l!=null&&a(t,["prefixPaddingMs"],l);const u=r(e,["silenceDurationMs"]);return u!=null&&a(t,["silenceDurationMs"],u),t}function Ya(o,e){const t={},n=r(e,["disabled"]);n!=null&&a(t,["disabled"],n);const i=r(e,["startOfSpeechSensitivity"]);i!=null&&a(t,["startOfSpeechSensitivity"],i);const s=r(e,["endOfSpeechSensitivity"]);s!=null&&a(t,["endOfSpeechSensitivity"],s);const l=r(e,["prefixPaddingMs"]);l!=null&&a(t,["prefixPaddingMs"],l);const u=r(e,["silenceDurationMs"]);return u!=null&&a(t,["silenceDurationMs"],u),t}function Ka(o,e){const t={},n=r(e,["automaticActivityDetection"]);n!=null&&a(t,["automaticActivityDetection"],Ja(o,n));const i=r(e,["activityHandling"]);i!=null&&a(t,["activityHandling"],i);const s=r(e,["turnCoverage"]);return s!=null&&a(t,["turnCoverage"],s),t}function za(o,e){const t={},n=r(e,["automaticActivityDetection"]);n!=null&&a(t,["automaticActivityDetection"],Ya(o,n));const i=r(e,["activityHandling"]);i!=null&&a(t,["activityHandling"],i);const s=r(e,["turnCoverage"]);return s!=null&&a(t,["turnCoverage"],s),t}function Wa(o,e){const t={},n=r(e,["targetTokens"]);return n!=null&&a(t,["targetTokens"],n),t}function Za(o,e){const t={},n=r(e,["targetTokens"]);return n!=null&&a(t,["targetTokens"],n),t}function Xa(o,e){const t={},n=r(e,["triggerTokens"]);n!=null&&a(t,["triggerTokens"],n);const i=r(e,["slidingWindow"]);return i!=null&&a(t,["slidingWindow"],Wa(o,i)),t}function Qa(o,e){const t={},n=r(e,["triggerTokens"]);n!=null&&a(t,["triggerTokens"],n);const i=r(e,["slidingWindow"]);return i!=null&&a(t,["slidingWindow"],Za(o,i)),t}function ja(o,e){const t={},n=r(e,["proactiveAudio"]);return n!=null&&a(t,["proactiveAudio"],n),t}function el(o,e){const t={},n=r(e,["proactiveAudio"]);return n!=null&&a(t,["proactiveAudio"],n),t}function tl(o,e,t){const n={},i=r(e,["generationConfig"]);t!==void 0&&i!=null&&a(t,["setup","generationConfig"],i);const s=r(e,["responseModalities"]);t!==void 0&&s!=null&&a(t,["setup","generationConfig","responseModalities"],s);const l=r(e,["temperature"]);t!==void 0&&l!=null&&a(t,["setup","generationConfig","temperature"],l);const u=r(e,["topP"]);t!==void 0&&u!=null&&a(t,["setup","generationConfig","topP"],u);const d=r(e,["topK"]);t!==void 0&&d!=null&&a(t,["setup","generationConfig","topK"],d);const c=r(e,["maxOutputTokens"]);t!==void 0&&c!=null&&a(t,["setup","generationConfig","maxOutputTokens"],c);const f=r(e,["mediaResolution"]);t!==void 0&&f!=null&&a(t,["setup","generationConfig","mediaResolution"],f);const p=r(e,["seed"]);t!==void 0&&p!=null&&a(t,["setup","generationConfig","seed"],p);const m=r(e,["speechConfig"]);t!==void 0&&m!=null&&a(t,["setup","generationConfig","speechConfig"],ga(o,Ei(o,m)));const h=r(e,["enableAffectiveDialog"]);t!==void 0&&h!=null&&a(t,["setup","generationConfig","enableAffectiveDialog"],h);const g=r(e,["systemInstruction"]);t!==void 0&&g!=null&&a(t,["setup","systemInstruction"],Sa(o,Y(o,g)));const y=r(e,["tools"]);if(t!==void 0&&y!=null){let B=Nt(o,y);Array.isArray(B)&&(B=B.map(G=>Oa(o,Rt(o,G)))),a(t,["setup","tools"],B)}const E=r(e,["sessionResumption"]);t!==void 0&&E!=null&&a(t,["setup","sessionResumption"],$a(o,E));const w=r(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&a(t,["setup","inputAudioTranscription"],qo());const M=r(e,["outputAudioTranscription"]);t!==void 0&&M!=null&&a(t,["setup","outputAudioTranscription"],qo());const I=r(e,["realtimeInputConfig"]);t!==void 0&&I!=null&&a(t,["setup","realtimeInputConfig"],Ka(o,I));const R=r(e,["contextWindowCompression"]);t!==void 0&&R!=null&&a(t,["setup","contextWindowCompression"],Xa(o,R));const L=r(e,["proactivity"]);return t!==void 0&&L!=null&&a(t,["setup","proactivity"],ja(o,L)),n}function nl(o,e,t){const n={},i=r(e,["generationConfig"]);t!==void 0&&i!=null&&a(t,["setup","generationConfig"],i);const s=r(e,["responseModalities"]);t!==void 0&&s!=null&&a(t,["setup","generationConfig","responseModalities"],s);const l=r(e,["temperature"]);t!==void 0&&l!=null&&a(t,["setup","generationConfig","temperature"],l);const u=r(e,["topP"]);t!==void 0&&u!=null&&a(t,["setup","generationConfig","topP"],u);const d=r(e,["topK"]);t!==void 0&&d!=null&&a(t,["setup","generationConfig","topK"],d);const c=r(e,["maxOutputTokens"]);t!==void 0&&c!=null&&a(t,["setup","generationConfig","maxOutputTokens"],c);const f=r(e,["mediaResolution"]);t!==void 0&&f!=null&&a(t,["setup","generationConfig","mediaResolution"],f);const p=r(e,["seed"]);t!==void 0&&p!=null&&a(t,["setup","generationConfig","seed"],p);const m=r(e,["speechConfig"]);t!==void 0&&m!=null&&a(t,["setup","generationConfig","speechConfig"],ya(o,Ei(o,m)));const h=r(e,["enableAffectiveDialog"]);t!==void 0&&h!=null&&a(t,["setup","generationConfig","enableAffectiveDialog"],h);const g=r(e,["systemInstruction"]);t!==void 0&&g!=null&&a(t,["setup","systemInstruction"],Ia(o,Y(o,g)));const y=r(e,["tools"]);if(t!==void 0&&y!=null){let B=Nt(o,y);Array.isArray(B)&&(B=B.map(G=>qa(o,Rt(o,G)))),a(t,["setup","tools"],B)}const E=r(e,["sessionResumption"]);t!==void 0&&E!=null&&a(t,["setup","sessionResumption"],Ha(o,E));const w=r(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&a(t,["setup","inputAudioTranscription"],$o());const M=r(e,["outputAudioTranscription"]);t!==void 0&&M!=null&&a(t,["setup","outputAudioTranscription"],$o());const I=r(e,["realtimeInputConfig"]);t!==void 0&&I!=null&&a(t,["setup","realtimeInputConfig"],za(o,I));const R=r(e,["contextWindowCompression"]);t!==void 0&&R!=null&&a(t,["setup","contextWindowCompression"],Qa(o,R));const L=r(e,["proactivity"]);return t!==void 0&&L!=null&&a(t,["setup","proactivity"],el(o,L)),n}function ol(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["setup","model"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],tl(o,i,t)),t}function il(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["setup","model"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],nl(o,i,t)),t}function sl(){return{}}function rl(){return{}}function al(){return{}}function ll(){return{}}function ul(o,e){const t={},n=r(e,["media"]);n!=null&&a(t,["mediaChunks"],vi(o,n));const i=r(e,["audio"]);i!=null&&a(t,["audio"],qs(o,i));const s=r(e,["audioStreamEnd"]);s!=null&&a(t,["audioStreamEnd"],s);const l=r(e,["video"]);l!=null&&a(t,["video"],Os(o,l));const u=r(e,["text"]);return u!=null&&a(t,["text"],u),r(e,["activityStart"])!=null&&a(t,["activityStart"],sl()),r(e,["activityEnd"])!=null&&a(t,["activityEnd"],al()),t}function cl(o,e){const t={},n=r(e,["media"]);if(n!=null&&a(t,["mediaChunks"],vi(o,n)),r(e,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(e,["audioStreamEnd"]);if(i!=null&&a(t,["audioStreamEnd"],i),r(e,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(e,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(e,["activityStart"])!=null&&a(t,["activityStart"],rl()),r(e,["activityEnd"])!=null&&a(t,["activityEnd"],ll()),t}function ki(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["weight"]);return i!=null&&a(t,["weight"],i),t}function dl(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ki(o,s))),a(t,["weightedPrompts"],i)}return t}function Ri(o,e){const t={},n=r(e,["temperature"]);n!=null&&a(t,["temperature"],n);const i=r(e,["topK"]);i!=null&&a(t,["topK"],i);const s=r(e,["seed"]);s!=null&&a(t,["seed"],s);const l=r(e,["guidance"]);l!=null&&a(t,["guidance"],l);const u=r(e,["bpm"]);u!=null&&a(t,["bpm"],u);const d=r(e,["density"]);d!=null&&a(t,["density"],d);const c=r(e,["brightness"]);c!=null&&a(t,["brightness"],c);const f=r(e,["scale"]);f!=null&&a(t,["scale"],f);const p=r(e,["muteBass"]);p!=null&&a(t,["muteBass"],p);const m=r(e,["muteDrums"]);m!=null&&a(t,["muteDrums"],m);const h=r(e,["onlyBassAndDrums"]);h!=null&&a(t,["onlyBassAndDrums"],h);const g=r(e,["musicGenerationMode"]);return g!=null&&a(t,["musicGenerationMode"],g),t}function fl(o,e){const t={},n=r(e,["musicGenerationConfig"]);return n!=null&&a(t,["musicGenerationConfig"],Ri(o,n)),t}function Ni(o,e){const t={},n=r(e,["model"]);return n!=null&&a(t,["model"],n),t}function Pi(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ki(o,s))),a(t,["weightedPrompts"],i)}return t}function rn(o,e){const t={},n=r(e,["setup"]);n!=null&&a(t,["setup"],Ni(o,n));const i=r(e,["clientContent"]);i!=null&&a(t,["clientContent"],Pi(o,i));const s=r(e,["musicGenerationConfig"]);s!=null&&a(t,["musicGenerationConfig"],Ri(o,s));const l=r(e,["playbackControl"]);return l!=null&&a(t,["playbackControl"],l),t}function pl(){return{}}function ml(){return{}}function hl(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function gl(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function yl(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function vl(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Cl(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],hl(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],yl(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Tl(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],gl(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],vl(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function _l(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Cl(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function El(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Tl(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Ho(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["finished"]);return i!=null&&a(t,["finished"],i),t}function Jo(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["finished"]);return i!=null&&a(t,["finished"],i),t}function xl(o,e){const t={},n=r(e,["retrievedUrl"]);n!=null&&a(t,["retrievedUrl"],n);const i=r(e,["urlRetrievalStatus"]);return i!=null&&a(t,["urlRetrievalStatus"],i),t}function Sl(o,e){const t={},n=r(e,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>xl(o,s))),a(t,["urlMetadata"],i)}return t}function Il(o,e){const t={},n=r(e,["modelTurn"]);n!=null&&a(t,["modelTurn"],_l(o,n));const i=r(e,["turnComplete"]);i!=null&&a(t,["turnComplete"],i);const s=r(e,["interrupted"]);s!=null&&a(t,["interrupted"],s);const l=r(e,["groundingMetadata"]);l!=null&&a(t,["groundingMetadata"],l);const u=r(e,["generationComplete"]);u!=null&&a(t,["generationComplete"],u);const d=r(e,["inputTranscription"]);d!=null&&a(t,["inputTranscription"],Ho(o,d));const c=r(e,["outputTranscription"]);c!=null&&a(t,["outputTranscription"],Ho(o,c));const f=r(e,["urlContextMetadata"]);return f!=null&&a(t,["urlContextMetadata"],Sl(o,f)),t}function Al(o,e){const t={},n=r(e,["modelTurn"]);n!=null&&a(t,["modelTurn"],El(o,n));const i=r(e,["turnComplete"]);i!=null&&a(t,["turnComplete"],i);const s=r(e,["interrupted"]);s!=null&&a(t,["interrupted"],s);const l=r(e,["groundingMetadata"]);l!=null&&a(t,["groundingMetadata"],l);const u=r(e,["generationComplete"]);u!=null&&a(t,["generationComplete"],u);const d=r(e,["inputTranscription"]);d!=null&&a(t,["inputTranscription"],Jo(o,d));const c=r(e,["outputTranscription"]);return c!=null&&a(t,["outputTranscription"],Jo(o,c)),t}function Ml(o,e){const t={},n=r(e,["id"]);n!=null&&a(t,["id"],n);const i=r(e,["args"]);i!=null&&a(t,["args"],i);const s=r(e,["name"]);return s!=null&&a(t,["name"],s),t}function wl(o,e){const t={},n=r(e,["args"]);n!=null&&a(t,["args"],n);const i=r(e,["name"]);return i!=null&&a(t,["name"],i),t}function kl(o,e){const t={},n=r(e,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ml(o,s))),a(t,["functionCalls"],i)}return t}function Rl(o,e){const t={},n=r(e,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>wl(o,s))),a(t,["functionCalls"],i)}return t}function Nl(o,e){const t={},n=r(e,["ids"]);return n!=null&&a(t,["ids"],n),t}function Pl(o,e){const t={},n=r(e,["ids"]);return n!=null&&a(t,["ids"],n),t}function ot(o,e){const t={},n=r(e,["modality"]);n!=null&&a(t,["modality"],n);const i=r(e,["tokenCount"]);return i!=null&&a(t,["tokenCount"],i),t}function it(o,e){const t={},n=r(e,["modality"]);n!=null&&a(t,["modality"],n);const i=r(e,["tokenCount"]);return i!=null&&a(t,["tokenCount"],i),t}function Dl(o,e){const t={},n=r(e,["promptTokenCount"]);n!=null&&a(t,["promptTokenCount"],n);const i=r(e,["cachedContentTokenCount"]);i!=null&&a(t,["cachedContentTokenCount"],i);const s=r(e,["responseTokenCount"]);s!=null&&a(t,["responseTokenCount"],s);const l=r(e,["toolUsePromptTokenCount"]);l!=null&&a(t,["toolUsePromptTokenCount"],l);const u=r(e,["thoughtsTokenCount"]);u!=null&&a(t,["thoughtsTokenCount"],u);const d=r(e,["totalTokenCount"]);d!=null&&a(t,["totalTokenCount"],d);const c=r(e,["promptTokensDetails"]);if(c!=null){let h=c;Array.isArray(h)&&(h=h.map(g=>ot(o,g))),a(t,["promptTokensDetails"],h)}const f=r(e,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(g=>ot(o,g))),a(t,["cacheTokensDetails"],h)}const p=r(e,["responseTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(g=>ot(o,g))),a(t,["responseTokensDetails"],h)}const m=r(e,["toolUsePromptTokensDetails"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>ot(o,g))),a(t,["toolUsePromptTokensDetails"],h)}return t}function Ll(o,e){const t={},n=r(e,["promptTokenCount"]);n!=null&&a(t,["promptTokenCount"],n);const i=r(e,["cachedContentTokenCount"]);i!=null&&a(t,["cachedContentTokenCount"],i);const s=r(e,["candidatesTokenCount"]);s!=null&&a(t,["responseTokenCount"],s);const l=r(e,["toolUsePromptTokenCount"]);l!=null&&a(t,["toolUsePromptTokenCount"],l);const u=r(e,["thoughtsTokenCount"]);u!=null&&a(t,["thoughtsTokenCount"],u);const d=r(e,["totalTokenCount"]);d!=null&&a(t,["totalTokenCount"],d);const c=r(e,["promptTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(y=>it(o,y))),a(t,["promptTokensDetails"],g)}const f=r(e,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(y=>it(o,y))),a(t,["cacheTokensDetails"],g)}const p=r(e,["candidatesTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(y=>it(o,y))),a(t,["responseTokensDetails"],g)}const m=r(e,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(y=>it(o,y))),a(t,["toolUsePromptTokensDetails"],g)}const h=r(e,["trafficType"]);return h!=null&&a(t,["trafficType"],h),t}function bl(o,e){const t={},n=r(e,["timeLeft"]);return n!=null&&a(t,["timeLeft"],n),t}function Vl(o,e){const t={},n=r(e,["timeLeft"]);return n!=null&&a(t,["timeLeft"],n),t}function Ul(o,e){const t={},n=r(e,["newHandle"]);n!=null&&a(t,["newHandle"],n);const i=r(e,["resumable"]);i!=null&&a(t,["resumable"],i);const s=r(e,["lastConsumedClientMessageIndex"]);return s!=null&&a(t,["lastConsumedClientMessageIndex"],s),t}function Fl(o,e){const t={},n=r(e,["newHandle"]);n!=null&&a(t,["newHandle"],n);const i=r(e,["resumable"]);i!=null&&a(t,["resumable"],i);const s=r(e,["lastConsumedClientMessageIndex"]);return s!=null&&a(t,["lastConsumedClientMessageIndex"],s),t}function Bl(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],pl());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],Il(o,i));const s=r(e,["toolCall"]);s!=null&&a(t,["toolCall"],kl(o,s));const l=r(e,["toolCallCancellation"]);l!=null&&a(t,["toolCallCancellation"],Nl(o,l));const u=r(e,["usageMetadata"]);u!=null&&a(t,["usageMetadata"],Dl(o,u));const d=r(e,["goAway"]);d!=null&&a(t,["goAway"],bl(o,d));const c=r(e,["sessionResumptionUpdate"]);return c!=null&&a(t,["sessionResumptionUpdate"],Ul(o,c)),t}function Gl(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],ml());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],Al(o,i));const s=r(e,["toolCall"]);s!=null&&a(t,["toolCall"],Rl(o,s));const l=r(e,["toolCallCancellation"]);l!=null&&a(t,["toolCallCancellation"],Pl(o,l));const u=r(e,["usageMetadata"]);u!=null&&a(t,["usageMetadata"],Ll(o,u));const d=r(e,["goAway"]);d!=null&&a(t,["goAway"],Vl(o,d));const c=r(e,["sessionResumptionUpdate"]);return c!=null&&a(t,["sessionResumptionUpdate"],Fl(o,c)),t}function Ol(){return{}}function ql(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["weight"]);return i!=null&&a(t,["weight"],i),t}function $l(o,e){const t={},n=r(e,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>ql(o,s))),a(t,["weightedPrompts"],i)}return t}function Hl(o,e){const t={},n=r(e,["temperature"]);n!=null&&a(t,["temperature"],n);const i=r(e,["topK"]);i!=null&&a(t,["topK"],i);const s=r(e,["seed"]);s!=null&&a(t,["seed"],s);const l=r(e,["guidance"]);l!=null&&a(t,["guidance"],l);const u=r(e,["bpm"]);u!=null&&a(t,["bpm"],u);const d=r(e,["density"]);d!=null&&a(t,["density"],d);const c=r(e,["brightness"]);c!=null&&a(t,["brightness"],c);const f=r(e,["scale"]);f!=null&&a(t,["scale"],f);const p=r(e,["muteBass"]);p!=null&&a(t,["muteBass"],p);const m=r(e,["muteDrums"]);m!=null&&a(t,["muteDrums"],m);const h=r(e,["onlyBassAndDrums"]);h!=null&&a(t,["onlyBassAndDrums"],h);const g=r(e,["musicGenerationMode"]);return g!=null&&a(t,["musicGenerationMode"],g),t}function Jl(o,e){const t={},n=r(e,["clientContent"]);n!=null&&a(t,["clientContent"],$l(o,n));const i=r(e,["musicGenerationConfig"]);return i!=null&&a(t,["musicGenerationConfig"],Hl(o,i)),t}function Yl(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);i!=null&&a(t,["mimeType"],i);const s=r(e,["sourceMetadata"]);return s!=null&&a(t,["sourceMetadata"],Jl(o,s)),t}function Kl(o,e){const t={},n=r(e,["audioChunks"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Yl(o,s))),a(t,["audioChunks"],i)}return t}function zl(o,e){const t={},n=r(e,["text"]);n!=null&&a(t,["text"],n);const i=r(e,["filteredReason"]);return i!=null&&a(t,["filteredReason"],i),t}function Wl(o,e){const t={};r(e,["setupComplete"])!=null&&a(t,["setupComplete"],Ol());const i=r(e,["serverContent"]);i!=null&&a(t,["serverContent"],Kl(o,i));const s=r(e,["filteredPrompt"]);return s!=null&&a(t,["filteredPrompt"],zl(o,s)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zl(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Xl(o,e){const t={};if(r(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Ql(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Zl(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Xl(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Dt(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Ql(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function jl(o,e){const t={};if(r(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=r(e,["category"]);n!=null&&a(t,["category"],n);const i=r(e,["threshold"]);return i!=null&&a(t,["threshold"],i),t}function eu(o,e){const t={},n=r(e,["behavior"]);n!=null&&a(t,["behavior"],n);const i=r(e,["description"]);i!=null&&a(t,["description"],i);const s=r(e,["name"]);s!=null&&a(t,["name"],s);const l=r(e,["parameters"]);l!=null&&a(t,["parameters"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],u),t}function tu(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function nu(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],tu(o,n)),t}function ou(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function iu(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],ou(o,n)),t}function su(){return{}}function ru(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>eu(o,c))),a(t,["functionDeclarations"],d)}if(r(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=r(e,["googleSearch"]);i!=null&&a(t,["googleSearch"],nu(o,i));const s=r(e,["googleSearchRetrieval"]);if(s!=null&&a(t,["googleSearchRetrieval"],iu(o,s)),r(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");r(e,["urlContext"])!=null&&a(t,["urlContext"],su());const u=r(e,["codeExecution"]);return u!=null&&a(t,["codeExecution"],u),t}function au(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function lu(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function uu(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],lu(o,n)),t}function cu(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],au(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],uu(o,i)),t}function du(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function Di(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],du(o,n)),t}function fu(o,e){const t={},n=r(e,["speaker"]);n!=null&&a(t,["speaker"],n);const i=r(e,["voiceConfig"]);return i!=null&&a(t,["voiceConfig"],Di(o,i)),t}function pu(o,e){const t={},n=r(e,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>fu(o,s))),a(t,["speakerVoiceConfigs"],i)}return t}function mu(o,e){const t={},n=r(e,["voiceConfig"]);n!=null&&a(t,["voiceConfig"],Di(o,n));const i=r(e,["multiSpeakerVoiceConfig"]);i!=null&&a(t,["multiSpeakerVoiceConfig"],pu(o,i));const s=r(e,["languageCode"]);return s!=null&&a(t,["languageCode"],s),t}function hu(o,e){const t={},n=r(e,["includeThoughts"]);n!=null&&a(t,["includeThoughts"],n);const i=r(e,["thinkingBudget"]);return i!=null&&a(t,["thinkingBudget"],i),t}function gu(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Dt(o,Y(o,i)));const s=r(e,["temperature"]);s!=null&&a(n,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(n,["topP"],l);const u=r(e,["topK"]);u!=null&&a(n,["topK"],u);const d=r(e,["candidateCount"]);d!=null&&a(n,["candidateCount"],d);const c=r(e,["maxOutputTokens"]);c!=null&&a(n,["maxOutputTokens"],c);const f=r(e,["stopSequences"]);f!=null&&a(n,["stopSequences"],f);const p=r(e,["responseLogprobs"]);p!=null&&a(n,["responseLogprobs"],p);const m=r(e,["logprobs"]);m!=null&&a(n,["logprobs"],m);const h=r(e,["presencePenalty"]);h!=null&&a(n,["presencePenalty"],h);const g=r(e,["frequencyPenalty"]);g!=null&&a(n,["frequencyPenalty"],g);const y=r(e,["seed"]);y!=null&&a(n,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&a(n,["responseMimeType"],E);const w=r(e,["responseSchema"]);if(w!=null&&a(n,["responseSchema"],xt(o,w)),r(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const M=r(e,["safetySettings"]);if(t!==void 0&&M!=null){let b=M;Array.isArray(b)&&(b=b.map(ee=>jl(o,ee))),a(t,["safetySettings"],b)}const I=r(e,["tools"]);if(t!==void 0&&I!=null){let b=Nt(o,I);Array.isArray(b)&&(b=b.map(ee=>ru(o,Rt(o,ee)))),a(t,["tools"],b)}const R=r(e,["toolConfig"]);if(t!==void 0&&R!=null&&a(t,["toolConfig"],cu(o,R)),r(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const L=r(e,["cachedContent"]);t!==void 0&&L!=null&&a(t,["cachedContent"],ge(o,L));const B=r(e,["responseModalities"]);B!=null&&a(n,["responseModalities"],B);const G=r(e,["mediaResolution"]);G!=null&&a(n,["mediaResolution"],G);const Q=r(e,["speechConfig"]);if(Q!=null&&a(n,["speechConfig"],mu(o,_i(o,Q))),r(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const P=r(e,["thinkingConfig"]);return P!=null&&a(n,["thinkingConfig"],hu(o,P)),n}function Yo(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);if(i!=null){let l=j(o,i);Array.isArray(l)&&(l=l.map(u=>Dt(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],gu(o,s,t)),t}function yu(o,e,t){const n={},i=r(e,["taskType"]);t!==void 0&&i!=null&&a(t,["requests[]","taskType"],i);const s=r(e,["title"]);t!==void 0&&s!=null&&a(t,["requests[]","title"],s);const l=r(e,["outputDimensionality"]);if(t!==void 0&&l!=null&&a(t,["requests[]","outputDimensionality"],l),r(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function vu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);i!=null&&a(t,["requests[]","content"],Ti(o,i));const s=r(e,["config"]);s!=null&&a(t,["config"],yu(o,s,t));const l=r(e,["model"]);return l!==void 0&&a(t,["requests[]","model"],V(o,l)),t}function Cu(o,e,t){const n={};if(r(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(e,["numberOfImages"]);t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i);const s=r(e,["aspectRatio"]);t!==void 0&&s!=null&&a(t,["parameters","aspectRatio"],s);const l=r(e,["guidanceScale"]);if(t!==void 0&&l!=null&&a(t,["parameters","guidanceScale"],l),r(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=r(e,["safetyFilterLevel"]);t!==void 0&&u!=null&&a(t,["parameters","safetySetting"],u);const d=r(e,["personGeneration"]);t!==void 0&&d!=null&&a(t,["parameters","personGeneration"],d);const c=r(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&a(t,["parameters","includeSafetyAttributes"],c);const f=r(e,["includeRaiReason"]);t!==void 0&&f!=null&&a(t,["parameters","includeRaiReason"],f);const p=r(e,["language"]);t!==void 0&&p!=null&&a(t,["parameters","language"],p);const m=r(e,["outputMimeType"]);t!==void 0&&m!=null&&a(t,["parameters","outputOptions","mimeType"],m);const h=r(e,["outputCompressionQuality"]);if(t!==void 0&&h!=null&&a(t,["parameters","outputOptions","compressionQuality"],h),r(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Tu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],Cu(o,s,t)),t}function _u(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Eu(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],Ii(o,u)),n}function xu(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],Eu(o,n,t)),t}function Su(o,e,t){const n={},i=r(e,["displayName"]);t!==void 0&&i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);t!==void 0&&s!=null&&a(t,["description"],s);const l=r(e,["defaultCheckpointId"]);return t!==void 0&&l!=null&&a(t,["defaultCheckpointId"],l),n}function Iu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],Su(o,i,t)),t}function Au(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Mu(o,e){const t={};if(r(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function wu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);if(i!=null){let l=j(o,i);Array.isArray(l)&&(l=l.map(u=>Dt(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],Mu(o,s)),t}function ku(o,e){const t={};if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(e,["imageBytes"]);n!=null&&a(t,["bytesBase64Encoded"],ye(o,n));const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Ru(o,e,t){const n={},i=r(e,["numberOfVideos"]);if(t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i),r(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=r(e,["durationSeconds"]);if(t!==void 0&&s!=null&&a(t,["parameters","durationSeconds"],s),r(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=r(e,["aspectRatio"]);if(t!==void 0&&l!=null&&a(t,["parameters","aspectRatio"],l),r(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const u=r(e,["personGeneration"]);if(t!==void 0&&u!=null&&a(t,["parameters","personGeneration"],u),r(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=r(e,["negativePrompt"]);if(t!==void 0&&d!=null&&a(t,["parameters","negativePrompt"],d),r(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Nu(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["image"]);s!=null&&a(t,["instances[0]","image"],ku(o,s));const l=r(e,["config"]);return l!=null&&a(t,["config"],Ru(o,l,t)),t}function Pu(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Du(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Lu(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Pu(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Du(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Fe(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Lu(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function bu(o,e){const t={},n=r(e,["featureSelectionPreference"]);return n!=null&&a(t,["featureSelectionPreference"],n),t}function Vu(o,e){const t={},n=r(e,["method"]);n!=null&&a(t,["method"],n);const i=r(e,["category"]);i!=null&&a(t,["category"],i);const s=r(e,["threshold"]);return s!=null&&a(t,["threshold"],s),t}function Uu(o,e){const t={};if(r(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=r(e,["description"]);n!=null&&a(t,["description"],n);const i=r(e,["name"]);i!=null&&a(t,["name"],i);const s=r(e,["parameters"]);s!=null&&a(t,["parameters"],s);const l=r(e,["response"]);return l!=null&&a(t,["response"],l),t}function Fu(o,e){const t={},n=r(e,["startTime"]);n!=null&&a(t,["startTime"],n);const i=r(e,["endTime"]);return i!=null&&a(t,["endTime"],i),t}function Bu(o,e){const t={},n=r(e,["timeRangeFilter"]);return n!=null&&a(t,["timeRangeFilter"],Fu(o,n)),t}function Gu(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["dynamicThreshold"]);return i!=null&&a(t,["dynamicThreshold"],i),t}function Ou(o,e){const t={},n=r(e,["dynamicRetrievalConfig"]);return n!=null&&a(t,["dynamicRetrievalConfig"],Gu(o,n)),t}function qu(){return{}}function $u(o,e){const t={},n=r(e,["apiKeyString"]);return n!=null&&a(t,["apiKeyString"],n),t}function Hu(o,e){const t={},n=r(e,["apiKeyConfig"]);n!=null&&a(t,["apiKeyConfig"],$u(o,n));const i=r(e,["authType"]);i!=null&&a(t,["authType"],i);const s=r(e,["googleServiceAccountConfig"]);s!=null&&a(t,["googleServiceAccountConfig"],s);const l=r(e,["httpBasicAuthConfig"]);l!=null&&a(t,["httpBasicAuthConfig"],l);const u=r(e,["oauthConfig"]);u!=null&&a(t,["oauthConfig"],u);const d=r(e,["oidcConfig"]);return d!=null&&a(t,["oidcConfig"],d),t}function Ju(o,e){const t={},n=r(e,["authConfig"]);return n!=null&&a(t,["authConfig"],Hu(o,n)),t}function Li(o,e){const t={},n=r(e,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(p=>Uu(o,p))),a(t,["functionDeclarations"],f)}const i=r(e,["retrieval"]);i!=null&&a(t,["retrieval"],i);const s=r(e,["googleSearch"]);s!=null&&a(t,["googleSearch"],Bu(o,s));const l=r(e,["googleSearchRetrieval"]);l!=null&&a(t,["googleSearchRetrieval"],Ou(o,l)),r(e,["enterpriseWebSearch"])!=null&&a(t,["enterpriseWebSearch"],qu());const d=r(e,["googleMaps"]);if(d!=null&&a(t,["googleMaps"],Ju(o,d)),r(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const c=r(e,["codeExecution"]);return c!=null&&a(t,["codeExecution"],c),t}function Yu(o,e){const t={},n=r(e,["mode"]);n!=null&&a(t,["mode"],n);const i=r(e,["allowedFunctionNames"]);return i!=null&&a(t,["allowedFunctionNames"],i),t}function Ku(o,e){const t={},n=r(e,["latitude"]);n!=null&&a(t,["latitude"],n);const i=r(e,["longitude"]);return i!=null&&a(t,["longitude"],i),t}function zu(o,e){const t={},n=r(e,["latLng"]);return n!=null&&a(t,["latLng"],Ku(o,n)),t}function Wu(o,e){const t={},n=r(e,["functionCallingConfig"]);n!=null&&a(t,["functionCallingConfig"],Yu(o,n));const i=r(e,["retrievalConfig"]);return i!=null&&a(t,["retrievalConfig"],zu(o,i)),t}function Zu(o,e){const t={},n=r(e,["voiceName"]);return n!=null&&a(t,["voiceName"],n),t}function Xu(o,e){const t={},n=r(e,["prebuiltVoiceConfig"]);return n!=null&&a(t,["prebuiltVoiceConfig"],Zu(o,n)),t}function Qu(o,e){const t={},n=r(e,["voiceConfig"]);if(n!=null&&a(t,["voiceConfig"],Xu(o,n)),r(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=r(e,["languageCode"]);return i!=null&&a(t,["languageCode"],i),t}function ju(o,e){const t={},n=r(e,["includeThoughts"]);n!=null&&a(t,["includeThoughts"],n);const i=r(e,["thinkingBudget"]);return i!=null&&a(t,["thinkingBudget"],i),t}function ec(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Fe(o,Y(o,i)));const s=r(e,["temperature"]);s!=null&&a(n,["temperature"],s);const l=r(e,["topP"]);l!=null&&a(n,["topP"],l);const u=r(e,["topK"]);u!=null&&a(n,["topK"],u);const d=r(e,["candidateCount"]);d!=null&&a(n,["candidateCount"],d);const c=r(e,["maxOutputTokens"]);c!=null&&a(n,["maxOutputTokens"],c);const f=r(e,["stopSequences"]);f!=null&&a(n,["stopSequences"],f);const p=r(e,["responseLogprobs"]);p!=null&&a(n,["responseLogprobs"],p);const m=r(e,["logprobs"]);m!=null&&a(n,["logprobs"],m);const h=r(e,["presencePenalty"]);h!=null&&a(n,["presencePenalty"],h);const g=r(e,["frequencyPenalty"]);g!=null&&a(n,["frequencyPenalty"],g);const y=r(e,["seed"]);y!=null&&a(n,["seed"],y);const E=r(e,["responseMimeType"]);E!=null&&a(n,["responseMimeType"],E);const w=r(e,["responseSchema"]);w!=null&&a(n,["responseSchema"],xt(o,w));const M=r(e,["routingConfig"]);M!=null&&a(n,["routingConfig"],M);const I=r(e,["modelSelectionConfig"]);I!=null&&a(n,["modelConfig"],bu(o,I));const R=r(e,["safetySettings"]);if(t!==void 0&&R!=null){let se=R;Array.isArray(se)&&(se=se.map(Vt=>Vu(o,Vt))),a(t,["safetySettings"],se)}const L=r(e,["tools"]);if(t!==void 0&&L!=null){let se=Nt(o,L);Array.isArray(se)&&(se=se.map(Vt=>Li(o,Rt(o,Vt)))),a(t,["tools"],se)}const B=r(e,["toolConfig"]);t!==void 0&&B!=null&&a(t,["toolConfig"],Wu(o,B));const G=r(e,["labels"]);t!==void 0&&G!=null&&a(t,["labels"],G);const Q=r(e,["cachedContent"]);t!==void 0&&Q!=null&&a(t,["cachedContent"],ge(o,Q));const P=r(e,["responseModalities"]);P!=null&&a(n,["responseModalities"],P);const b=r(e,["mediaResolution"]);b!=null&&a(n,["mediaResolution"],b);const ee=r(e,["speechConfig"]);ee!=null&&a(n,["speechConfig"],Qu(o,_i(o,ee)));const En=r(e,["audioTimestamp"]);En!=null&&a(n,["audioTimestamp"],En);const xn=r(e,["thinkingConfig"]);return xn!=null&&a(n,["thinkingConfig"],ju(o,xn)),n}function Ko(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);if(i!=null){let l=j(o,i);Array.isArray(l)&&(l=l.map(u=>Fe(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["generationConfig"],ec(o,s,t)),t}function tc(o,e,t){const n={},i=r(e,["taskType"]);t!==void 0&&i!=null&&a(t,["instances[]","task_type"],i);const s=r(e,["title"]);t!==void 0&&s!=null&&a(t,["instances[]","title"],s);const l=r(e,["outputDimensionality"]);t!==void 0&&l!=null&&a(t,["parameters","outputDimensionality"],l);const u=r(e,["mimeType"]);t!==void 0&&u!=null&&a(t,["instances[]","mimeType"],u);const d=r(e,["autoTruncate"]);return t!==void 0&&d!=null&&a(t,["parameters","autoTruncate"],d),n}function nc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);i!=null&&a(t,["instances[]","content"],Ti(o,i));const s=r(e,["config"]);return s!=null&&a(t,["config"],tc(o,s,t)),t}function oc(o,e,t){const n={},i=r(e,["outputGcsUri"]);t!==void 0&&i!=null&&a(t,["parameters","storageUri"],i);const s=r(e,["negativePrompt"]);t!==void 0&&s!=null&&a(t,["parameters","negativePrompt"],s);const l=r(e,["numberOfImages"]);t!==void 0&&l!=null&&a(t,["parameters","sampleCount"],l);const u=r(e,["aspectRatio"]);t!==void 0&&u!=null&&a(t,["parameters","aspectRatio"],u);const d=r(e,["guidanceScale"]);t!==void 0&&d!=null&&a(t,["parameters","guidanceScale"],d);const c=r(e,["seed"]);t!==void 0&&c!=null&&a(t,["parameters","seed"],c);const f=r(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&a(t,["parameters","safetySetting"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["includeSafetyAttributes"]);t!==void 0&&m!=null&&a(t,["parameters","includeSafetyAttributes"],m);const h=r(e,["includeRaiReason"]);t!==void 0&&h!=null&&a(t,["parameters","includeRaiReason"],h);const g=r(e,["language"]);t!==void 0&&g!=null&&a(t,["parameters","language"],g);const y=r(e,["outputMimeType"]);t!==void 0&&y!=null&&a(t,["parameters","outputOptions","mimeType"],y);const E=r(e,["outputCompressionQuality"]);t!==void 0&&E!=null&&a(t,["parameters","outputOptions","compressionQuality"],E);const w=r(e,["addWatermark"]);t!==void 0&&w!=null&&a(t,["parameters","addWatermark"],w);const M=r(e,["enhancePrompt"]);return t!==void 0&&M!=null&&a(t,["parameters","enhancePrompt"],M),n}function ic(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],oc(o,s,t)),t}function vn(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["gcsUri"],n);const i=r(e,["imageBytes"]);i!=null&&a(t,["bytesBase64Encoded"],ye(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function sc(o,e){const t={},n=r(e,["maskMode"]);n!=null&&a(t,["maskMode"],n);const i=r(e,["segmentationClasses"]);i!=null&&a(t,["maskClasses"],i);const s=r(e,["maskDilation"]);return s!=null&&a(t,["dilation"],s),t}function rc(o,e){const t={},n=r(e,["controlType"]);n!=null&&a(t,["controlType"],n);const i=r(e,["enableControlImageComputation"]);return i!=null&&a(t,["computeControl"],i),t}function ac(o,e){const t={},n=r(e,["styleDescription"]);return n!=null&&a(t,["styleDescription"],n),t}function lc(o,e){const t={},n=r(e,["subjectType"]);n!=null&&a(t,["subjectType"],n);const i=r(e,["subjectDescription"]);return i!=null&&a(t,["subjectDescription"],i),t}function uc(o,e){const t={},n=r(e,["referenceImage"]);n!=null&&a(t,["referenceImage"],vn(o,n));const i=r(e,["referenceId"]);i!=null&&a(t,["referenceId"],i);const s=r(e,["referenceType"]);s!=null&&a(t,["referenceType"],s);const l=r(e,["maskImageConfig"]);l!=null&&a(t,["maskImageConfig"],sc(o,l));const u=r(e,["controlImageConfig"]);u!=null&&a(t,["controlImageConfig"],rc(o,u));const d=r(e,["styleImageConfig"]);d!=null&&a(t,["styleImageConfig"],ac(o,d));const c=r(e,["subjectImageConfig"]);return c!=null&&a(t,["subjectImageConfig"],lc(o,c)),t}function cc(o,e,t){const n={},i=r(e,["outputGcsUri"]);t!==void 0&&i!=null&&a(t,["parameters","storageUri"],i);const s=r(e,["negativePrompt"]);t!==void 0&&s!=null&&a(t,["parameters","negativePrompt"],s);const l=r(e,["numberOfImages"]);t!==void 0&&l!=null&&a(t,["parameters","sampleCount"],l);const u=r(e,["aspectRatio"]);t!==void 0&&u!=null&&a(t,["parameters","aspectRatio"],u);const d=r(e,["guidanceScale"]);t!==void 0&&d!=null&&a(t,["parameters","guidanceScale"],d);const c=r(e,["seed"]);t!==void 0&&c!=null&&a(t,["parameters","seed"],c);const f=r(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&a(t,["parameters","safetySetting"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["includeSafetyAttributes"]);t!==void 0&&m!=null&&a(t,["parameters","includeSafetyAttributes"],m);const h=r(e,["includeRaiReason"]);t!==void 0&&h!=null&&a(t,["parameters","includeRaiReason"],h);const g=r(e,["language"]);t!==void 0&&g!=null&&a(t,["parameters","language"],g);const y=r(e,["outputMimeType"]);t!==void 0&&y!=null&&a(t,["parameters","outputOptions","mimeType"],y);const E=r(e,["outputCompressionQuality"]);t!==void 0&&E!=null&&a(t,["parameters","outputOptions","compressionQuality"],E);const w=r(e,["editMode"]);t!==void 0&&w!=null&&a(t,["parameters","editMode"],w);const M=r(e,["baseSteps"]);return t!==void 0&&M!=null&&a(t,["parameters","editConfig","baseSteps"],M),n}function dc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["referenceImages"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>uc(o,d))),a(t,["instances[0]","referenceImages"],u)}const l=r(e,["config"]);return l!=null&&a(t,["config"],cc(o,l,t)),t}function fc(o,e,t){const n={},i=r(e,["includeRaiReason"]);t!==void 0&&i!=null&&a(t,["parameters","includeRaiReason"],i);const s=r(e,["outputMimeType"]);t!==void 0&&s!=null&&a(t,["parameters","outputOptions","mimeType"],s);const l=r(e,["outputCompressionQuality"]);t!==void 0&&l!=null&&a(t,["parameters","outputOptions","compressionQuality"],l);const u=r(e,["numberOfImages"]);t!==void 0&&u!=null&&a(t,["parameters","sampleCount"],u);const d=r(e,["mode"]);return t!==void 0&&d!=null&&a(t,["parameters","mode"],d),n}function pc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["image"]);i!=null&&a(t,["instances[0]","image"],vn(o,i));const s=r(e,["upscaleFactor"]);s!=null&&a(t,["parameters","upscaleConfig","upscaleFactor"],s);const l=r(e,["config"]);return l!=null&&a(t,["config"],fc(o,l,t)),t}function mc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function hc(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);t!==void 0&&l!=null&&a(t,["_query","filter"],l);const u=r(e,["queryBase"]);return t!==void 0&&u!=null&&a(t,["_url","models_url"],Ii(o,u)),n}function gc(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],hc(o,n,t)),t}function yc(o,e,t){const n={},i=r(e,["displayName"]);t!==void 0&&i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);t!==void 0&&s!=null&&a(t,["description"],s);const l=r(e,["defaultCheckpointId"]);return t!==void 0&&l!=null&&a(t,["defaultCheckpointId"],l),n}function vc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],yc(o,i,t)),t}function Cc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","name"],V(o,n));const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Tc(o,e,t){const n={},i=r(e,["systemInstruction"]);t!==void 0&&i!=null&&a(t,["systemInstruction"],Fe(o,Y(o,i)));const s=r(e,["tools"]);if(t!==void 0&&s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>Li(o,d))),a(t,["tools"],u)}const l=r(e,["generationConfig"]);return t!==void 0&&l!=null&&a(t,["generationConfig"],l),n}function _c(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);if(i!=null){let l=j(o,i);Array.isArray(l)&&(l=l.map(u=>Fe(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],Tc(o,s,t)),t}function Ec(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["contents"]);if(i!=null){let l=j(o,i);Array.isArray(l)&&(l=l.map(u=>Fe(o,u))),a(t,["contents"],l)}const s=r(e,["config"]);return s!=null&&a(t,["config"],s),t}function xc(o,e,t){const n={},i=r(e,["numberOfVideos"]);t!==void 0&&i!=null&&a(t,["parameters","sampleCount"],i);const s=r(e,["outputGcsUri"]);t!==void 0&&s!=null&&a(t,["parameters","storageUri"],s);const l=r(e,["fps"]);t!==void 0&&l!=null&&a(t,["parameters","fps"],l);const u=r(e,["durationSeconds"]);t!==void 0&&u!=null&&a(t,["parameters","durationSeconds"],u);const d=r(e,["seed"]);t!==void 0&&d!=null&&a(t,["parameters","seed"],d);const c=r(e,["aspectRatio"]);t!==void 0&&c!=null&&a(t,["parameters","aspectRatio"],c);const f=r(e,["resolution"]);t!==void 0&&f!=null&&a(t,["parameters","resolution"],f);const p=r(e,["personGeneration"]);t!==void 0&&p!=null&&a(t,["parameters","personGeneration"],p);const m=r(e,["pubsubTopic"]);t!==void 0&&m!=null&&a(t,["parameters","pubsubTopic"],m);const h=r(e,["negativePrompt"]);t!==void 0&&h!=null&&a(t,["parameters","negativePrompt"],h);const g=r(e,["enhancePrompt"]);return t!==void 0&&g!=null&&a(t,["parameters","enhancePrompt"],g),n}function Sc(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["_url","model"],V(o,n));const i=r(e,["prompt"]);i!=null&&a(t,["instances[0]","prompt"],i);const s=r(e,["image"]);s!=null&&a(t,["instances[0]","image"],vn(o,s));const l=r(e,["config"]);return l!=null&&a(t,["config"],xc(o,l,t)),t}function Ic(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function Ac(o,e){const t={},n=r(e,["data"]);n!=null&&a(t,["data"],n);const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function Mc(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Ic(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],Ac(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function wc(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Mc(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function kc(o,e){const t={},n=r(e,["citationSources"]);return n!=null&&a(t,["citations"],n),t}function Rc(o,e){const t={},n=r(e,["retrievedUrl"]);n!=null&&a(t,["retrievedUrl"],n);const i=r(e,["urlRetrievalStatus"]);return i!=null&&a(t,["urlRetrievalStatus"],i),t}function Nc(o,e){const t={},n=r(e,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Rc(o,s))),a(t,["urlMetadata"],i)}return t}function Pc(o,e){const t={},n=r(e,["content"]);n!=null&&a(t,["content"],wc(o,n));const i=r(e,["citationMetadata"]);i!=null&&a(t,["citationMetadata"],kc(o,i));const s=r(e,["tokenCount"]);s!=null&&a(t,["tokenCount"],s);const l=r(e,["finishReason"]);l!=null&&a(t,["finishReason"],l);const u=r(e,["urlContextMetadata"]);u!=null&&a(t,["urlContextMetadata"],Nc(o,u));const d=r(e,["avgLogprobs"]);d!=null&&a(t,["avgLogprobs"],d);const c=r(e,["groundingMetadata"]);c!=null&&a(t,["groundingMetadata"],c);const f=r(e,["index"]);f!=null&&a(t,["index"],f);const p=r(e,["logprobsResult"]);p!=null&&a(t,["logprobsResult"],p);const m=r(e,["safetyRatings"]);return m!=null&&a(t,["safetyRatings"],m),t}function zo(o,e){const t={},n=r(e,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>Pc(o,d))),a(t,["candidates"],u)}const i=r(e,["modelVersion"]);i!=null&&a(t,["modelVersion"],i);const s=r(e,["promptFeedback"]);s!=null&&a(t,["promptFeedback"],s);const l=r(e,["usageMetadata"]);return l!=null&&a(t,["usageMetadata"],l),t}function Dc(o,e){const t={},n=r(e,["values"]);return n!=null&&a(t,["values"],n),t}function Lc(){return{}}function bc(o,e){const t={},n=r(e,["embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Dc(o,l))),a(t,["embeddings"],s)}return r(e,["metadata"])!=null&&a(t,["metadata"],Lc()),t}function Vc(o,e){const t={},n=r(e,["bytesBase64Encoded"]);n!=null&&a(t,["imageBytes"],ye(o,n));const i=r(e,["mimeType"]);return i!=null&&a(t,["mimeType"],i),t}function bi(o,e){const t={},n=r(e,["safetyAttributes","categories"]);n!=null&&a(t,["categories"],n);const i=r(e,["safetyAttributes","scores"]);i!=null&&a(t,["scores"],i);const s=r(e,["contentType"]);return s!=null&&a(t,["contentType"],s),t}function Uc(o,e){const t={},n=r(e,["_self"]);n!=null&&a(t,["image"],Vc(o,n));const i=r(e,["raiFilteredReason"]);i!=null&&a(t,["raiFilteredReason"],i);const s=r(e,["_self"]);return s!=null&&a(t,["safetyAttributes"],bi(o,s)),t}function Fc(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Uc(o,l))),a(t,["generatedImages"],s)}const i=r(e,["positivePromptSafetyAttributes"]);return i!=null&&a(t,["positivePromptSafetyAttributes"],bi(o,i)),t}function Bc(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["updateTime"]);return s!=null&&a(t,["updateTime"],s),t}function an(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);s!=null&&a(t,["description"],s);const l=r(e,["version"]);l!=null&&a(t,["version"],l);const u=r(e,["_self"]);u!=null&&a(t,["tunedModelInfo"],Bc(o,u));const d=r(e,["inputTokenLimit"]);d!=null&&a(t,["inputTokenLimit"],d);const c=r(e,["outputTokenLimit"]);c!=null&&a(t,["outputTokenLimit"],c);const f=r(e,["supportedGenerationMethods"]);return f!=null&&a(t,["supportedActions"],f),t}function Gc(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["_self"]);if(i!=null){let s=Ai(o,i);Array.isArray(s)&&(s=s.map(l=>an(o,l))),a(t,["models"],s)}return t}function Oc(){return{}}function qc(o,e){const t={},n=r(e,["totalTokens"]);n!=null&&a(t,["totalTokens"],n);const i=r(e,["cachedContentTokenCount"]);return i!=null&&a(t,["cachedContentTokenCount"],i),t}function $c(o,e){const t={},n=r(e,["video","uri"]);n!=null&&a(t,["uri"],n);const i=r(e,["video","encodedVideo"]);i!=null&&a(t,["videoBytes"],ye(o,i));const s=r(e,["encoding"]);return s!=null&&a(t,["mimeType"],s),t}function Hc(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],$c(o,n)),t}function Jc(o,e){const t={},n=r(e,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Hc(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function Yc(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response","generateVideoResponse"]);return u!=null&&a(t,["response"],Jc(o,u)),t}function Kc(o,e){const t={},n=r(e,["fps"]);n!=null&&a(t,["fps"],n);const i=r(e,["endOffset"]);i!=null&&a(t,["endOffset"],i);const s=r(e,["startOffset"]);return s!=null&&a(t,["startOffset"],s),t}function zc(o,e){const t={},n=r(e,["displayName"]);n!=null&&a(t,["displayName"],n);const i=r(e,["data"]);i!=null&&a(t,["data"],i);const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Wc(o,e){const t={},n=r(e,["videoMetadata"]);n!=null&&a(t,["videoMetadata"],Kc(o,n));const i=r(e,["thought"]);i!=null&&a(t,["thought"],i);const s=r(e,["inlineData"]);s!=null&&a(t,["inlineData"],zc(o,s));const l=r(e,["codeExecutionResult"]);l!=null&&a(t,["codeExecutionResult"],l);const u=r(e,["executableCode"]);u!=null&&a(t,["executableCode"],u);const d=r(e,["fileData"]);d!=null&&a(t,["fileData"],d);const c=r(e,["functionCall"]);c!=null&&a(t,["functionCall"],c);const f=r(e,["functionResponse"]);f!=null&&a(t,["functionResponse"],f);const p=r(e,["text"]);return p!=null&&a(t,["text"],p),t}function Zc(o,e){const t={},n=r(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Wc(o,l))),a(t,["parts"],s)}const i=r(e,["role"]);return i!=null&&a(t,["role"],i),t}function Xc(o,e){const t={},n=r(e,["citations"]);return n!=null&&a(t,["citations"],n),t}function Qc(o,e){const t={},n=r(e,["content"]);n!=null&&a(t,["content"],Zc(o,n));const i=r(e,["citationMetadata"]);i!=null&&a(t,["citationMetadata"],Xc(o,i));const s=r(e,["finishMessage"]);s!=null&&a(t,["finishMessage"],s);const l=r(e,["finishReason"]);l!=null&&a(t,["finishReason"],l);const u=r(e,["avgLogprobs"]);u!=null&&a(t,["avgLogprobs"],u);const d=r(e,["groundingMetadata"]);d!=null&&a(t,["groundingMetadata"],d);const c=r(e,["index"]);c!=null&&a(t,["index"],c);const f=r(e,["logprobsResult"]);f!=null&&a(t,["logprobsResult"],f);const p=r(e,["safetyRatings"]);return p!=null&&a(t,["safetyRatings"],p),t}function Wo(o,e){const t={},n=r(e,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(f=>Qc(o,f))),a(t,["candidates"],c)}const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["responseId"]);s!=null&&a(t,["responseId"],s);const l=r(e,["modelVersion"]);l!=null&&a(t,["modelVersion"],l);const u=r(e,["promptFeedback"]);u!=null&&a(t,["promptFeedback"],u);const d=r(e,["usageMetadata"]);return d!=null&&a(t,["usageMetadata"],d),t}function jc(o,e){const t={},n=r(e,["truncated"]);n!=null&&a(t,["truncated"],n);const i=r(e,["token_count"]);return i!=null&&a(t,["tokenCount"],i),t}function ed(o,e){const t={},n=r(e,["values"]);n!=null&&a(t,["values"],n);const i=r(e,["statistics"]);return i!=null&&a(t,["statistics"],jc(o,i)),t}function td(o,e){const t={},n=r(e,["billableCharacterCount"]);return n!=null&&a(t,["billableCharacterCount"],n),t}function nd(o,e){const t={},n=r(e,["predictions[]","embeddings"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>ed(o,l))),a(t,["embeddings"],s)}const i=r(e,["metadata"]);return i!=null&&a(t,["metadata"],td(o,i)),t}function od(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["gcsUri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["imageBytes"],ye(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Vi(o,e){const t={},n=r(e,["safetyAttributes","categories"]);n!=null&&a(t,["categories"],n);const i=r(e,["safetyAttributes","scores"]);i!=null&&a(t,["scores"],i);const s=r(e,["contentType"]);return s!=null&&a(t,["contentType"],s),t}function Cn(o,e){const t={},n=r(e,["_self"]);n!=null&&a(t,["image"],od(o,n));const i=r(e,["raiFilteredReason"]);i!=null&&a(t,["raiFilteredReason"],i);const s=r(e,["_self"]);s!=null&&a(t,["safetyAttributes"],Vi(o,s));const l=r(e,["prompt"]);return l!=null&&a(t,["enhancedPrompt"],l),t}function id(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(l=>Cn(o,l))),a(t,["generatedImages"],s)}const i=r(e,["positivePromptSafetyAttributes"]);return i!=null&&a(t,["positivePromptSafetyAttributes"],Vi(o,i)),t}function sd(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Cn(o,s))),a(t,["generatedImages"],i)}return t}function rd(o,e){const t={},n=r(e,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Cn(o,s))),a(t,["generatedImages"],i)}return t}function ad(o,e){const t={},n=r(e,["endpoint"]);n!=null&&a(t,["name"],n);const i=r(e,["deployedModelId"]);return i!=null&&a(t,["deployedModelId"],i),t}function ld(o,e){const t={},n=r(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["createTime"]);i!=null&&a(t,["createTime"],i);const s=r(e,["updateTime"]);return s!=null&&a(t,["updateTime"],s),t}function ud(o,e){const t={},n=r(e,["checkpointId"]);n!=null&&a(t,["checkpointId"],n);const i=r(e,["epoch"]);i!=null&&a(t,["epoch"],i);const s=r(e,["step"]);return s!=null&&a(t,["step"],s),t}function ln(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["displayName"]);i!=null&&a(t,["displayName"],i);const s=r(e,["description"]);s!=null&&a(t,["description"],s);const l=r(e,["versionId"]);l!=null&&a(t,["version"],l);const u=r(e,["deployedModels"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(h=>ad(o,h))),a(t,["endpoints"],m)}const d=r(e,["labels"]);d!=null&&a(t,["labels"],d);const c=r(e,["_self"]);c!=null&&a(t,["tunedModelInfo"],ld(o,c));const f=r(e,["defaultCheckpointId"]);f!=null&&a(t,["defaultCheckpointId"],f);const p=r(e,["checkpoints"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(h=>ud(o,h))),a(t,["checkpoints"],m)}return t}function cd(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["_self"]);if(i!=null){let s=Ai(o,i);Array.isArray(s)&&(s=s.map(l=>ln(o,l))),a(t,["models"],s)}return t}function dd(){return{}}function fd(o,e){const t={},n=r(e,["totalTokens"]);return n!=null&&a(t,["totalTokens"],n),t}function pd(o,e){const t={},n=r(e,["tokensInfo"]);return n!=null&&a(t,["tokensInfo"],n),t}function md(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["uri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["videoBytes"],ye(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function hd(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],md(o,n)),t}function gd(o,e){const t={},n=r(e,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>hd(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function yd(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],gd(o,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vd="Content-Type",Cd="X-Server-Timeout",Td="User-Agent",un="x-goog-api-client",_d="0.15.0",Ed=`google-genai-sdk/${_d}`,xd="v1beta1",Sd="v1beta",Zo=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Ui extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class cn extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class Id{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:xd,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Sd,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[l,u]of Object.entries(e.queryParams))i.searchParams.append(l,String(u));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.unaryApiCall(i,s,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[i,s]of Object.entries(t))typeof s=="object"?n[i]=Object.assign(Object.assign({},n[i]),s):s!==void 0&&(n[i]=s);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,e.abortSignal),this.streamApiCall(i,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n){if(t&&t.timeout||n){const i=new AbortController,s=i.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>i.abort(),t.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),e.signal=s}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await Xo(i),new nn(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async i=>(await Xo(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return Ke(this,arguments,function*(){const i=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),s=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:u,value:d}=yield U(i.read());if(u){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=s.decode(d);try{const p=JSON.parse(c);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),h=m.status,g=m.code,y=`got status: ${h}. ${JSON.stringify(p)}`;if(g>=400&&g<500)throw new Ui(y);if(g>=500&&g<600)throw new cn(y)}}catch(p){const m=p;if(m.name==="ClientError"||m.name==="ServerError")throw p}l+=c;let f=l.match(Zo);for(;f;){const p=f[1];try{const m=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield U(new nn(m)),l=l.slice(f[0].length),f=l.match(Zo)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},t=Ed+" "+this.clientOptions.userAgentExtra;return e[Td]=t,e[un]=t,e[vd]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[n,i]of Object.entries(e.headers))t.append(n,i);e.timeout&&e.timeout>0&&t.append(Cd,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var n;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const s=this.clientOptions.uploader,l=await s.stat(e);i.sizeBytes=String(l.size);const u=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const d=await this.fetchUploadUrl(i,t);return s.upload(e,d,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var n;let i={};t!=null&&t.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const s={file:e},l=await this.request({path:x("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:i});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(n=l==null?void 0:l.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function Xo(o){var e;if(o===void 0)throw new cn("response is undefined");if(!o.ok){const t=o.status,n=o.statusText;let i;!((e=o.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const s=`got status: ${t} ${n}. ${JSON.stringify(i)}`;throw t>=400&&t<500?new Ui(s):t>=500&&t<600?new cn(s):new Error(s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ad="mcp_used/unknown";function dn(o){for(const e of o)if(Tn(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function fn(o){var e;o[un]=(((e=o[un])!==null&&e!==void 0?e:"")+` ${Ad}`).trimStart()}function Md(o){var e,t,n;return(n=(t=(e=o.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Tn(i)))!==null&&n!==void 0?n:!1}function wd(o){var e,t,n;return(n=(t=(e=o.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!Tn(i)))!==null&&n!==void 0?n:!1}function Tn(o){return o!==null&&typeof o=="object"&&"tool"in o&&"callTool"in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function kd(o,e,t){const n=new Gs,i=JSON.parse(t.data),s=Wl(o,i);Object.assign(n,s),e(n)}class Rd{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),l=Dd(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${u}`;let c=()=>{};const f=new Promise(I=>{c=I}),p=e.callbacks,m=function(){c({})},h=this.apiClient,g={onopen:m,onmessage:I=>{kd(h,p.onmessage,I)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(I){},onclose:(n=p==null?void 0:p.onclose)!==null&&n!==void 0?n:function(I){}},y=this.webSocketFactory.create(d,Pd(l),g);y.connect(),await f;const E=V(this.apiClient,e.model),w=Ni(this.apiClient,{model:E}),M=rn(this.apiClient,{setup:w});return y.send(JSON.stringify(M)),new Nd(y,this.apiClient)}}class Nd{constructor(e,t){this.conn=e,this.apiClient=t}async setClientContent(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=dl(this.apiClient,e),n=Pi(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=fl(this.apiClient,e),n=rn(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const t=rn(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ke.PLAY)}pause(){this.sendPlaybackControl(ke.PAUSE)}stop(){this.sendPlaybackControl(ke.STOP)}resetContext(){this.sendPlaybackControl(ke.RESET_CONTEXT)}close(){this.conn.close()}}function Pd(o){const e={};return o.forEach((t,n)=>{e[n]=t}),e}function Dd(o){const e=new Headers;for(const[t,n]of Object.entries(o))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ld="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function bd(o,e,t){const n=new Bs;let i;if(t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),o.isVertexAI()){const s=Gl(o,i);Object.assign(n,s)}else{const s=Bl(o,i);Object.assign(n,s)}e(n)}class Vd{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Rd(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,s,l,u;const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const p=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&dn(e.config.tools)&&fn(p);const m=Gd(p);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const P=this.apiClient.getApiKey();f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.BidiGenerateContent?key=${P}`}let h=()=>{};const g=new Promise(P=>{h=P}),y=e.callbacks,E=function(){var P;(P=y==null?void 0:y.onopen)===null||P===void 0||P.call(y),h({})},w=this.apiClient,M={onopen:E,onmessage:P=>{bd(w,y.onmessage,P)},onerror:(t=y==null?void 0:y.onerror)!==null&&t!==void 0?t:function(P){},onclose:(n=y==null?void 0:y.onclose)!==null&&n!==void 0?n:function(P){}},I=this.webSocketFactory.create(f,Bd(m),M);I.connect(),await g;let R=V(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&R.startsWith("publishers/")){const P=this.apiClient.getProject(),b=this.apiClient.getLocation();R=`projects/${P}/locations/${b}/`+R}let L={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[_t.AUDIO]}:e.config.responseModalities=[_t.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const B=(u=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[],G=[];for(const P of B)if(this.isCallableTool(P)){const b=P;G.push(await b.tool())}else G.push(P);G.length>0&&(e.config.tools=G);const Q={model:R,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?L=il(this.apiClient,Q):L=ol(this.apiClient,Q),delete L.config,I.send(JSON.stringify(L)),new Fd(I,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const Ud={turnComplete:!0};class Fd{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=j(e,t.turns),e.isVertexAI()?n=n.map(i=>Fe(e,i)):n=n.map(i=>Dt(e,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const s of n){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(Ld)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Ud),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:cl(this.apiClient,e)}:t={realtimeInput:ul(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function Bd(o){const e={};return o.forEach((t,n)=>{e[n]=t}),e}function Gd(o){const e=new Headers;for(const[t,n]of Object.entries(o))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Qo=10;function jo(o){var e,t,n;if(!((e=o==null?void 0:o.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const l of(t=o==null?void 0:o.tools)!==null&&t!==void 0?t:[])if(ft(l)){i=!0;break}if(!i)return!0;const s=(n=o==null?void 0:o.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function ft(o){return"callTool"in o&&typeof o.callTool=="function"}function ei(o){var e;return!(!((e=o==null?void 0:o.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Od extends tt{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,i,s,l,u;if(t.config&&t.config.tools&&dn(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),fn(t.config.httpOptions.headers)),!Md(t)||jo(t.config))return await this.generateContentInternal(t);if(wd(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");const d=await this.transformCallableTools(t);let c,f;const p=j(this.apiClient,d.contents),m=(s=(i=(n=d.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:Qo;let h=0;for(;h<m&&(c=await this.generateContentInternal(d),!(!c.functionCalls||c.functionCalls.length===0));){const g=c.candidates[0].content,y=[];for(const E of(u=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&u!==void 0?u:[])if(ft(E)){const M=await E.callTool(c.functionCalls);y.push(...M)}h++,f={role:"user",parts:y},d.contents=j(this.apiClient,d.contents),d.contents.push(g),d.contents.push(f),ei(d.config)&&(p.push(g),p.push(f))}return ei(d.config)&&(c.automaticFunctionCallingHistory=p),c},this.generateContentStream=async t=>{if(t.config&&t.config.tools&&dn(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),fn(t.config.httpOptions.headers)),jo(t.config)){const n=await this.transformCallableTools(t);return await this.generateContentStreamInternal(n)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var i;let s;const l=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?s=d==null?void 0:d.safetyAttributes:l.push(d);let u;return s?u={generatedImages:l,positivePromptSafetyAttributes:s}:u={generatedImages:l},u}),this.list=async t=>{var n;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((n=l.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Pt(Ve.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(l),l)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(i)}}async transformCallableTools(e){var t;const n=(t=e.config)===null||t===void 0?void 0:t.tools;if(!n)return e;const i=await Promise.all(n.map(async l=>ft(l)?await l.tool():l)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};return s.config.tools=i,s}async initAfcToolsMap(e){var t,n,i;const s=new Map;for(const l of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(ft(l)){const u=l,d=await u.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(s.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);s.set(c.name,u)}}return s}async processAfcStream(e){var t,n,i;const s=(i=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&i!==void 0?i:Qo;let l=!1,u=0;const d=await this.initAfcToolsMap(e);return function(c,f,p){var m,h;return Ke(this,arguments,function*(){for(var g,y,E,w;u<s;){l&&(u++,l=!1);const L=yield U(c.transformCallableTools(p)),B=yield U(c.generateContentStreamInternal(L)),G=[],Q=[];try{for(var M=!0,I=(y=void 0,dt(B)),R;R=yield U(I.next()),g=R.done,!g;M=!0){w=R.value,M=!1;const P=w;if(yield yield U(P),P.candidates&&(!((m=P.candidates[0])===null||m===void 0)&&m.content)){Q.push(P.candidates[0].content);for(const b of(h=P.candidates[0].content.parts)!==null&&h!==void 0?h:[])if(u<s&&b.functionCall){if(!b.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(b.functionCall.name)){const ee=yield U(f.get(b.functionCall.name).callTool([b.functionCall]));G.push(...ee)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${b.functionCall.name}`)}}}}catch(P){y={error:P}}finally{try{!M&&!g&&(E=I.return)&&(yield U(E.call(I)))}finally{if(y)throw y.error}}if(G.length>0){l=!0;const P=new Be;P.candidates=[{content:{role:"user",parts:G}}],yield yield U(P);const b=[];b.push(...Q),b.push({role:"user",parts:G});const ee=j(c.apiClient,p.contents).concat(b);p.contents=ee}else break}})}(this,d,e)}async generateContentInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ko(this.apiClient,e);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Wo(this.apiClient,f),m=new Be;return Object.assign(m,p),m})}else{const c=Yo(this.apiClient,e);return u=x("{model}:generateContent",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=zo(this.apiClient,f),m=new Be;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Ko(this.apiClient,e);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return l=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),l.then(function(p){return Ke(this,arguments,function*(){var m,h,g,y;try{for(var E=!0,w=dt(p),M;M=yield U(w.next()),m=M.done,!m;E=!0){y=M.value,E=!1;const R=Wo(f,yield U(y.json())),L=new Be;Object.assign(L,R),yield yield U(L)}}catch(I){h={error:I}}finally{try{!E&&!m&&(g=w.return)&&(yield U(g.call(w)))}finally{if(h)throw h.error}}})})}else{const c=Yo(this.apiClient,e);u=x("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c.config,delete c._url,delete c._query;const f=this.apiClient;return l=f.requestStream({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),l.then(function(p){return Ke(this,arguments,function*(){var m,h,g,y;try{for(var E=!0,w=dt(p),M;M=yield U(w.next()),m=M.done,!m;E=!0){y=M.value,E=!1;const R=zo(f,yield U(y.json())),L=new Be;Object.assign(L,R),yield yield U(L)}}catch(I){h={error:I}}finally{try{!E&&!m&&(g=w.return)&&(yield U(g.call(w)))}finally{if(h)throw h.error}}})})}}async embedContent(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=nc(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=nd(this.apiClient,f),m=new Ao;return Object.assign(m,p),m})}else{const c=vu(this.apiClient,e);return u=x("{model}:batchEmbedContents",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=bc(this.apiClient,f),m=new Ao;return Object.assign(m,p),m})}}async generateImagesInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=ic(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=id(this.apiClient,f),m=new Mo;return Object.assign(m,p),m})}else{const c=Tu(this.apiClient,e);return u=x("{model}:predict",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Fc(this.apiClient,f),m=new Mo;return Object.assign(m,p),m})}}async editImageInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=dc(this.apiClient,e);return s=x("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=sd(this.apiClient,d),f=new Ds;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=pc(this.apiClient,e);return s=x("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=rd(this.apiClient,d),f=new Ls;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=mc(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ln(this.apiClient,f))}else{const c=_u(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>an(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=gc(this.apiClient,e);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=cd(this.apiClient,f),m=new wo;return Object.assign(m,p),m})}else{const c=xu(this.apiClient,e);return u=x("{models_url}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Gc(this.apiClient,f),m=new wo;return Object.assign(m,p),m})}}async update(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=vc(this.apiClient,e);return u=x("{model}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ln(this.apiClient,f))}else{const c=Iu(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>an(this.apiClient,f))}}async delete(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Cc(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(()=>{const f=dd(),p=new ko;return Object.assign(p,f),p})}else{const c=Au(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(()=>{const f=Oc(),p=new ko;return Object.assign(p,f),p})}}async countTokens(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=_c(this.apiClient,e);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=fd(this.apiClient,f),m=new Ro;return Object.assign(m,p),m})}else{const c=wu(this.apiClient,e);return u=x("{model}:countTokens",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=qc(this.apiClient,f),m=new Ro;return Object.assign(m,p),m})}}async computeTokens(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=Ec(this.apiClient,e);return s=x("{model}:computeTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const c=pd(this.apiClient,d),f=new bs;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=Sc(this.apiClient,e);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>yd(this.apiClient,f))}else{const c=Nu(this.apiClient,e);return u=x("{model}:predictLongRunning",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Yc(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qd(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["_url","operationName"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function $d(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["_url","operationName"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function Hd(o,e){const t={},n=r(e,["operationName"]);n!=null&&a(t,["operationName"],n);const i=r(e,["resourceName"]);i!=null&&a(t,["_url","resourceName"],i);const s=r(e,["config"]);return s!=null&&a(t,["config"],s),t}function Jd(o,e){const t={},n=r(e,["video","uri"]);n!=null&&a(t,["uri"],n);const i=r(e,["video","encodedVideo"]);i!=null&&a(t,["videoBytes"],ye(o,i));const s=r(e,["encoding"]);return s!=null&&a(t,["mimeType"],s),t}function Yd(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],Jd(o,n)),t}function Kd(o,e){const t={},n=r(e,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Yd(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function zd(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response","generateVideoResponse"]);return u!=null&&a(t,["response"],Kd(o,u)),t}function Wd(o,e){const t={},n=r(e,["gcsUri"]);n!=null&&a(t,["uri"],n);const i=r(e,["bytesBase64Encoded"]);i!=null&&a(t,["videoBytes"],ye(o,i));const s=r(e,["mimeType"]);return s!=null&&a(t,["mimeType"],s),t}function Zd(o,e){const t={},n=r(e,["_self"]);return n!=null&&a(t,["video"],Wd(o,n)),t}function Xd(o,e){const t={},n=r(e,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Zd(o,u))),a(t,["generatedVideos"],l)}const i=r(e,["raiMediaFilteredCount"]);i!=null&&a(t,["raiMediaFilteredCount"],i);const s=r(e,["raiMediaFilteredReasons"]);return s!=null&&a(t,["raiMediaFilteredReasons"],s),t}function ti(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);l!=null&&a(t,["error"],l);const u=r(e,["response"]);return u!=null&&a(t,["response"],Xd(o,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qd extends tt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let s;return n&&"httpOptions"in n&&(s=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:s}})}else return this.getVideosOperationInternal({operationName:t.name,config:n})}async getVideosOperationInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=$d(this.apiClient,e);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>ti(this.apiClient,f))}else{const c=qd(this.apiClient,e);return u=x("{operationName}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>zd(this.apiClient,f))}}async fetchPredictVideosOperationInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=Hd(this.apiClient,e);return s=x("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>ti(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jd(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function ef(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);return t!==void 0&&l!=null&&a(t,["_query","filter"],l),n}function tf(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],ef(o,n,t)),t}function nf(o,e){const t={},n=r(e,["textInput"]);n!=null&&a(t,["textInput"],n);const i=r(e,["output"]);return i!=null&&a(t,["output"],i),t}function of(o,e){const t={};if(r(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(e,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>nf(o,s))),a(t,["examples","examples"],i)}return t}function sf(o,e,t){const n={};if(r(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(e,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&a(t,["displayName"],i),r(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const s=r(e,["epochCount"]);t!==void 0&&s!=null&&a(t,["tuningTask","hyperparameters","epochCount"],s);const l=r(e,["learningRateMultiplier"]);if(l!=null&&a(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),r(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=r(e,["batchSize"]);t!==void 0&&u!=null&&a(t,["tuningTask","hyperparameters","batchSize"],u);const d=r(e,["learningRate"]);return t!==void 0&&d!=null&&a(t,["tuningTask","hyperparameters","learningRate"],d),n}function rf(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["trainingDataset"]);i!=null&&a(t,["tuningTask","trainingData"],of(o,i));const s=r(e,["config"]);return s!=null&&a(t,["config"],sf(o,s,t)),t}function af(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["_url","name"],n);const i=r(e,["config"]);return i!=null&&a(t,["config"],i),t}function lf(o,e,t){const n={},i=r(e,["pageSize"]);t!==void 0&&i!=null&&a(t,["_query","pageSize"],i);const s=r(e,["pageToken"]);t!==void 0&&s!=null&&a(t,["_query","pageToken"],s);const l=r(e,["filter"]);return t!==void 0&&l!=null&&a(t,["_query","filter"],l),n}function uf(o,e){const t={},n=r(e,["config"]);return n!=null&&a(t,["config"],lf(o,n,t)),t}function cf(o,e,t){const n={},i=r(e,["gcsUri"]);if(t!==void 0&&i!=null&&a(t,["supervisedTuningSpec","trainingDatasetUri"],i),r(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function df(o,e){const t={},n=r(e,["gcsUri"]);return n!=null&&a(t,["validationDatasetUri"],n),t}function ff(o,e,t){const n={},i=r(e,["validationDataset"]);t!==void 0&&i!=null&&a(t,["supervisedTuningSpec"],df(o,i));const s=r(e,["tunedModelDisplayName"]);t!==void 0&&s!=null&&a(t,["tunedModelDisplayName"],s);const l=r(e,["description"]);t!==void 0&&l!=null&&a(t,["description"],l);const u=r(e,["epochCount"]);t!==void 0&&u!=null&&a(t,["supervisedTuningSpec","hyperParameters","epochCount"],u);const d=r(e,["learningRateMultiplier"]);t!==void 0&&d!=null&&a(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const c=r(e,["exportLastCheckpointOnly"]);t!==void 0&&c!=null&&a(t,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const f=r(e,["adapterSize"]);if(t!==void 0&&f!=null&&a(t,["supervisedTuningSpec","hyperParameters","adapterSize"],f),r(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function pf(o,e){const t={},n=r(e,["baseModel"]);n!=null&&a(t,["baseModel"],n);const i=r(e,["trainingDataset"]);i!=null&&a(t,["supervisedTuningSpec","trainingDatasetUri"],cf(o,i,t));const s=r(e,["config"]);return s!=null&&a(t,["config"],ff(o,s,t)),t}function mf(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["model"],n);const i=r(e,["name"]);return i!=null&&a(t,["endpoint"],i),t}function Fi(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["state"]);i!=null&&a(t,["state"],xi(o,i));const s=r(e,["createTime"]);s!=null&&a(t,["createTime"],s);const l=r(e,["tuningTask","startTime"]);l!=null&&a(t,["startTime"],l);const u=r(e,["tuningTask","completeTime"]);u!=null&&a(t,["endTime"],u);const d=r(e,["updateTime"]);d!=null&&a(t,["updateTime"],d);const c=r(e,["description"]);c!=null&&a(t,["description"],c);const f=r(e,["baseModel"]);f!=null&&a(t,["baseModel"],f);const p=r(e,["_self"]);p!=null&&a(t,["tunedModel"],mf(o,p));const m=r(e,["distillationSpec"]);m!=null&&a(t,["distillationSpec"],m);const h=r(e,["experiment"]);h!=null&&a(t,["experiment"],h);const g=r(e,["labels"]);g!=null&&a(t,["labels"],g);const y=r(e,["pipelineJob"]);y!=null&&a(t,["pipelineJob"],y);const E=r(e,["tunedModelDisplayName"]);return E!=null&&a(t,["tunedModelDisplayName"],E),t}function hf(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Fi(o,l))),a(t,["tuningJobs"],s)}return t}function gf(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["metadata"]);i!=null&&a(t,["metadata"],i);const s=r(e,["done"]);s!=null&&a(t,["done"],s);const l=r(e,["error"]);return l!=null&&a(t,["error"],l),t}function yf(o,e){const t={},n=r(e,["checkpointId"]);n!=null&&a(t,["checkpointId"],n);const i=r(e,["epoch"]);i!=null&&a(t,["epoch"],i);const s=r(e,["step"]);s!=null&&a(t,["step"],s);const l=r(e,["endpoint"]);return l!=null&&a(t,["endpoint"],l),t}function vf(o,e){const t={},n=r(e,["model"]);n!=null&&a(t,["model"],n);const i=r(e,["endpoint"]);i!=null&&a(t,["endpoint"],i);const s=r(e,["checkpoints"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>yf(o,u))),a(t,["checkpoints"],l)}return t}function pn(o,e){const t={},n=r(e,["name"]);n!=null&&a(t,["name"],n);const i=r(e,["state"]);i!=null&&a(t,["state"],xi(o,i));const s=r(e,["createTime"]);s!=null&&a(t,["createTime"],s);const l=r(e,["startTime"]);l!=null&&a(t,["startTime"],l);const u=r(e,["endTime"]);u!=null&&a(t,["endTime"],u);const d=r(e,["updateTime"]);d!=null&&a(t,["updateTime"],d);const c=r(e,["error"]);c!=null&&a(t,["error"],c);const f=r(e,["description"]);f!=null&&a(t,["description"],f);const p=r(e,["baseModel"]);p!=null&&a(t,["baseModel"],p);const m=r(e,["tunedModel"]);m!=null&&a(t,["tunedModel"],vf(o,m));const h=r(e,["supervisedTuningSpec"]);h!=null&&a(t,["supervisedTuningSpec"],h);const g=r(e,["tuningDataStats"]);g!=null&&a(t,["tuningDataStats"],g);const y=r(e,["encryptionSpec"]);y!=null&&a(t,["encryptionSpec"],y);const E=r(e,["partnerModelTuningSpec"]);E!=null&&a(t,["partnerModelTuningSpec"],E);const w=r(e,["distillationSpec"]);w!=null&&a(t,["distillationSpec"],w);const M=r(e,["experiment"]);M!=null&&a(t,["experiment"],M);const I=r(e,["labels"]);I!=null&&a(t,["labels"],I);const R=r(e,["pipelineJob"]);R!=null&&a(t,["pipelineJob"],R);const L=r(e,["tunedModelDisplayName"]);return L!=null&&a(t,["tunedModelDisplayName"],L),t}function Cf(o,e){const t={},n=r(e,["nextPageToken"]);n!=null&&a(t,["nextPageToken"],n);const i=r(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>pn(o,l))),a(t,["tuningJobs"],s)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tf extends tt{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Pt(Ve.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const n=await this.tuneMldevInternal(t);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:tn.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=af(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>pn(this.apiClient,f))}else{const c=jd(this.apiClient,e);return u=x("{name}",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>Fi(this.apiClient,f))}}async listInternal(e){var t,n,i,s;let l,u="",d={};if(this.apiClient.isVertexAI()){const c=uf(this.apiClient,e);return u=x("tuningJobs",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),l.then(f=>{const p=Cf(this.apiClient,f),m=new No;return Object.assign(m,p),m})}else{const c=tf(this.apiClient,e);return u=x("tunedModels",c._url),d=c._query,delete c.config,delete c._url,delete c._query,l=this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),l.then(f=>{const p=hf(this.apiClient,f),m=new No;return Object.assign(m,p),m})}}async tuneInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI()){const u=pf(this.apiClient,e);return s=x("tuningJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>pn(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i,s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rf(this.apiClient,e);return s=x("tunedModels",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>gf(this.apiClient,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _f{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Ef=1024*1024*8,xf=3,Sf=1e3,If=2,Gt="x-goog-upload-status";async function Af(o,e,t){var n,i,s;let l=0,u=0,d=new nn(new Response),c="upload";for(l=o.size;u<l;){const p=Math.min(Ef,l-u),m=o.slice(u,u+p);u+p>=l&&(c+=", finalize");let h=0,g=Sf;for(;h<xf&&(d=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),!(!((n=d==null?void 0:d.headers)===null||n===void 0)&&n[Gt]));)h++,await wf(g),g=g*If;if(u+=p,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[Gt])!=="active")break;if(l<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((s=d==null?void 0:d.headers)===null||s===void 0?void 0:s[Gt])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function Mf(o){return{size:o.size,type:o.type}}function wf(o){return new Promise(e=>setTimeout(e,o))}class kf{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Af(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Mf(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rf{create(e,t,n){return new Nf(e,t,n)}}class Nf{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ni="x-goog-api-key";class Pf{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(ni)===null&&e.append(ni,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Df="gl-node/";class Bi{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=Ps(e,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion;const i=new Pf(this.apiKey);this.apiClient=new Id({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Df+"web",uploader:new kf,downloader:new _f}),this.models=new Od(this.apiClient),this.live=new Vd(this.apiClient,i,new Rf),this.chats=new Xr(this.models,this.apiClient),this.caches=new zr(this.apiClient),this.files=new ca(this.apiClient),this.operations=new Qd(this.apiClient),this.tunings=new Tf(this.apiClient)}}const Lf={low:"Identify only the most essential and defining grammar patterns of the sentence. Focus on major conjunctions, verb conjugations (tense/politeness), and sentence-ending particles. Avoid breaking down common compound words or very simple phrases.",medium:"Provide a balanced analysis. Identify all major grammar patterns, common set phrases, and important vocabulary usage. This is the standard level of detail suitable for most learners.",high:"Perform an exhaustive analysis. Identify every possible grammatical pattern, nuance, idiomatic expression, and compound word structure, no matter how small or common. Deconstruct everything for a very detailed view for advanced study."};function bf(o){return`You are an advanced linguistic analysis model, acting as a patient, insightful teacher of the Japanese language.
Your primary task is to take a single Japanese sentence and produce a detailed, structured analysis according to the specified JSON schema. Your explanations should be clear enough for a language learner.

Detailed Task Breakdown:
1.  **Sentence Analysis**: Deconstruct the input sentence into its smallest meaningful components (words, particles, etc.).
    For each component in the 'analysis' array:
    *   **Grammatical Category**: Assign a highly specific category. Use the format \`BASE_TYPE-FORM-TENSE-POLARITY\`.
        *   Examples: \`VERB_GODAN-TE-PAST-AFFIRMATIVE\`, \`ADJECTIVE_I-PLAIN-PRESENT-NEGATIVE\`, \`NOUN_COMMON\`.
        *   Available Categories: NOUN_COMMON, NOUN_PROPER, NOUN_PRONOUN, NOUN_COUNTER, VERB_ICHIDAN, VERB_GODAN, VERB_IRREGULAR, VERB_SURU, ADJECTIVE_I, ADJECTIVE_NA, ADVERB, PARTICLE, AUXILIARY_VERB, GRAMMATICAL_AUXILIARY, CONJUNCTION, INTERJECTION, SUFFIX, PREFIX, PUNCTUATION.
    *   **Reading**: Provide the reading in Hiragana or Katakana.
    *   **English Equivalent**: Provide a concise English meaning.
    *   **Pitch Accent**: THIS IS A CRITICAL, MANDATORY FIELD.
        *   Provide the standard Tokyo-dialect pitch accent as a string of 'H' (High) and 'L' (Low).
        *   **RULE: The length of the 'pitch_accent' string MUST EXACTLY match the character length of the 'reading' string.**
        *   Example: If 'reading' is 'ねこ' (2 chars), 'pitch_accent' MUST be 'LH' (2 chars).
        *   Example: If 'reading' is 'ともだち' (4 chars), 'pitch_accent' (heiban) MUST be 'LHHH' (4 chars).
        *   For particles or single-mora words with no accent drop, use the appropriate single letter ('H' or 'L').
        *   If pitch is truly not applicable (like punctuation), provide an empty string "". DO NOT OMIT THE FIELD. Avoid common pitfalls like providing a pattern shorter than the reading.

2.  **Full Translation**: Provide a natural, fluent English translation of the entire sentence.

3.  **Grammar & Phrase Explanations**: In the 'grammar_patterns' array, identify and explain all notable grammar points, set phrases, or nuanced vocabulary.
    *   **Analysis Thoroughness Level: ${o.toUpperCase()}**
    *   **Instruction: ${Lf[o]}**
    *   For each pattern, provide its name, a clear explanation for a learner, and the 'constituent_indices' that form the pattern in the 'analysis' array. This section must be comprehensive according to the specified thoroughness level.

Input is a single Japanese sentence. You must respond ONLY with the JSON object defined in the schema. Do not add any conversational text or markdown fences.`}function Vf(o){return`You are a Japanese language teaching assistant.
Your task is to provide 2-3 simple, distinct, and pedagogically useful example sentences for the Japanese grammar pattern: "${o}".

For each example sentence, you MUST provide:
1.  'japanese': The full sentence in Japanese, using Kanji where appropriate.
2.  'reading': The complete furigana reading of the sentence in Hiragana.
3.  'english': A natural and accurate English translation.
4.  'highlight_indices': A two-element array \`[startIndex, endIndex]\` indicating the exact location of the grammar pattern "${o}" within the 'japanese' string. 'startIndex' is the zero-based index of the first character of the pattern, and 'endIndex' is the zero-based index of the character immediately AFTER the last character of the pattern.

Example for pattern "〜について":
If the sentence is "日本の文化について話します。", the pattern "について" starts at index 5 and ends at index 9. So, 'highlight_indices' would be [5, 9].

Respond ONLY with a JSON object that adheres to the provided schema. Do not add any extra text or markdown fences.`}const Uf={type:"OBJECT",properties:{original_japanese_sentence:{type:"STRING",description:"The original Japanese sentence provided by the user."},analysis:{type:"ARRAY",description:"An array of objects, each representing a segmented component of the Japanese sentence.",items:{type:"OBJECT",properties:{japanese_segment:{type:"STRING",description:"The individual Japanese segment (word, particle, etc.)."},reading:{type:"STRING",description:"The reading of the Japanese segment in Hiragana or Katakana."},category:{type:"STRING",description:"A highly specific grammatical category label for the segment (e.g., 'NOUN_COMMON', 'VERB_ICHIDAN-TE-PAST-AFFIRMATIVE')."},english_equivalent:{type:"STRING",description:"A direct, concise English equivalent of the segment."},pitch_accent:{type:"STRING",description:`CRITICAL: A string representing the pitch accent pattern using 'H' for high and 'L' for low. This string's length MUST exactly match the character length of the 'reading' field. For heiban words, use 'L' followed by all 'H's (e.g., reading 'ともだち' -> pitch 'LHHH'). For non-applicable segments like punctuation, this MUST be an empty string "". Do not omit this field.`}},required:["japanese_segment","reading","category","english_equivalent","pitch_accent"]}},grammar_patterns:{type:"ARRAY",description:"A comprehensive array of identified grammatical patterns, idiomatic phrases, or nuanced vocabulary in the sentence.",items:{type:"OBJECT",properties:{pattern_name:{type:"STRING",description:"The name of the grammatical pattern or the phrase being explained (e.g., '〜なければならない', 'よろしくお願いします')."},explanation:{type:"STRING",description:"A detailed explanation of the pattern's meaning, usage, and nuance for a language learner."},constituent_indices:{type:"ARRAY",description:"An array of zero-based indices from the 'analysis' array that form this pattern.",items:{type:"NUMBER"}}},required:["pattern_name","explanation","constituent_indices"]}},english_translation:{type:"STRING",description:"The complete, natural-sounding English translation of the entire Japanese sentence."}},required:["original_japanese_sentence","analysis","grammar_patterns","english_translation"]},Ff={type:"ARRAY",description:"An array of 2-3 simple example sentences for the given grammar pattern.",items:{type:"OBJECT",properties:{japanese:{type:"STRING",description:"The full example sentence in Japanese, including Kanji."},reading:{type:"STRING",description:"The complete reading of the Japanese sentence in Hiragana."},english:{type:"STRING",description:"The natural English translation of the sentence."},highlight_indices:{type:"ARRAY",description:"A two-element array [startIndex, endIndex] indicating the character position of the grammar pattern within the 'japanese' string. startIndex is inclusive, endIndex is exclusive.",items:{type:"NUMBER"},minItems:2,maxItems:2}},required:["japanese","reading","english","highlight_indices"]}};async function Bf(o,e,t){var f;const n=new Bi({apiKey:o}),i=bf(t),s=`Analyze the following Japanese sentence: "${e}"`,u=(await n.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:i+s,config:{responseMimeType:"application/json",responseSchema:Uf,temperature:.1,seed:42}})).text,d=((f=u.trim().match(/^```(?:json)?\s*\n?(.*?)\n?\s*```$/s))==null?void 0:f[1])||u.trim(),c=JSON.parse(d);return Array.isArray(c)?c[0]:c}async function Gf(o,e){var i;const t=new Bi({apiKey:o}),n=Vf(e);try{const s=await t.models.generateContent({model:"gemini-2.5-flash-preview-04-17",contents:n,config:{responseMimeType:"application/json",responseSchema:Ff,temperature:.01,seed:42}});let l=((i=s.text.trim().match(/^```(?:json)?\s*\n?(.*?)\n?\s*```$/s))==null?void 0:i[1])||s.text.trim();return JSON.parse(l)}catch(s){throw console.error(`Failed to get examples for "${e}":`,s),new Error(`Could not generate examples for ${e}.`)}}function Of(){if(!("speechSynthesis"in window)){document.body.classList.remove("tts-available");return}const o=()=>{const e=window.speechSynthesis.getVoices().filter(s=>s.lang==="ja-JP");if(e.length===0){Sn(null),document.body.classList.remove("tts-available");return}const t=e.find(s=>s.name.includes("Google")),n=e.find(s=>!s.localService),i=t||n||e[0]||null;Sn(i),document.body.classList.toggle("tts-available",!!i)};o(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=o)}function qf(o){if(!("speechSynthesis"in window)||!Yt){console.warn("Speech synthesis not available or no Japanese voice found.");return}window.speechSynthesis.cancel();const e=new SpeechSynthesisUtterance(o);e.voice=Yt,e.lang="ja-JP",e.rate=.9,e.pitch=1,window.speechSynthesis.speak(e)}const Ot=[{light:"#1e88e5",dark:"#90caf9"},{light:"#43a047",dark:"#a5d6a7"},{light:"#fb8c00",dark:"#ffcc80"},{light:"#8e24aa",dark:"#ce93d8"},{light:"#d81b60",dark:"#f48fb1"},{light:"#00897b",dark:"#80cbc4"},{light:"#e53935",dark:"#ef9a9a"},{light:"#3949ab",dark:"#9fa8da"},{light:"#039be5",dark:"#81d4fa"},{light:"#ffb300",dark:"#ffe082"},{light:"#f4511e",dark:"#ffab91"},{light:"#546e7a",dark:"#b0bec5"}];function $f(o){const e=(o||"unknown").split(/[-_]/)[0].toLowerCase(),t={noun:"bg-blue-100 dark:bg-blue-900/60 text-blue-800 dark:text-blue-200",verb:"bg-green-100 dark:bg-green-900/60 text-green-800 dark:text-green-200",particle:"bg-amber-100 dark:bg-amber-900/60 text-amber-800 dark:text-amber-200",adjective:"bg-purple-100 dark:bg-purple-900/60 text-purple-800 dark:text-purple-200",adverb:"bg-yellow-100 dark:bg-yellow-900/60 text-yellow-800 dark:text-yellow-200",auxiliary:"bg-cyan-100 dark:bg-cyan-900/60 text-cyan-800 dark:text-cyan-200",grammatical:"bg-cyan-100 dark:bg-cyan-900/60 text-cyan-800 dark:text-cyan-200",conjunction:"bg-pink-100 dark:bg-pink-900/60 text-pink-800 dark:text-pink-200",punctuation:"bg-transparent",unknown:"bg-slate-100 dark:bg-slate-700"};return t[e]||t.unknown}function oi(o){return o.split("").map(e=>/[一-龯]/.test(e)?`<a href="https://jisho.org/search/${encodeURIComponent(e)}%20%23kanji" target="_blank" rel="noopener noreferrer" class="underline decoration-slate-400/50 decoration-1 underline-offset-2 hover:text-sky-500 hover:decoration-sky-500 transition">${e}</a>`:e).join("")}function Gi(o,e,t){if(!e||o===e)return t?oi(o):o;const n=o.match(/([一-龯]+|[^一-龯]+)/g)||[];let i=0,s="";for(let l=0;l<n.length;l++){const u=n[l];if(/[一-龯]/.test(u)){let c="";const f=l+1<n.length&&!/[一-龯]/.test(n[l+1])?n[l+1]:"",p=f?e.indexOf(f,i):-1;p!==-1?(c=e.substring(i,p),i=p):(c=e.substring(i),i=e.length);const m=t?oi(u):u;s+=c&&c!==u?`<ruby>${m}<rt class="text-xs text-slate-500 select-none">${c}</rt></ruby>`:m}else s+=u,e.substring(i).startsWith(u)&&(i+=u.length)}return s}function Hf(o,e){if(!o||!e||o.length!==e.length)return null;const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg");n.setAttribute("class","pitch-accent-svg absolute top-0 left-0 w-full h-[14px] overflow-visible pointer-events-none");const i=e.split("").map((s,l)=>({x:100/o.length*(l+.5),y:s==="H"?2:8}));if(i.length>1){const s=document.createElementNS(t,"polyline");s.setAttribute("points",i.map(l=>`${l.x},${l.y}`).join(" ")),s.setAttribute("class","fill-none stroke-slate-500 dark:stroke-slate-400"),s.setAttribute("stroke-width","1.5"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-linejoin","round"),n.appendChild(s)}return i.forEach(s=>{const l=document.createElementNS(t,"circle");l.setAttribute("cx",String(s.x)),l.setAttribute("cy",String(s.y)),l.setAttribute("r","1.2"),l.setAttribute("class","fill-slate-500 dark:fill-slate-400"),n.appendChild(l)}),n.setAttribute("viewBox","0 0 100 10"),n.setAttribute("preserveAspectRatio","none"),n}function Ze(o,e,t={}){var u,d;const{stickyTopClass:n="top-0"}=t;o.innerHTML="";const i=[],s=document.createElement("div");s.className=`sticky ${n} z-10 bg-white dark:bg-slate-800 transition-colors duration-300 py-4 shadow-md dark:shadow-slate-700/50`,o.appendChild(s);const l=document.createElement("div");if(l.className="pt-6 px-4 pb-4",o.appendChild(l),e.original_japanese_sentence){const c=document.createElement("div");c.className="p-4 bg-slate-100 dark:bg-slate-900/50 rounded-lg flex justify-between items-center gap-4",c.id="current-analysis-header";const f=document.createElement("span");f.className="text-lg font-semibold text-sky-700 dark:text-sky-400",f.textContent=e.original_japanese_sentence;const p=document.createElement("button");p.className="tts-button flex-shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-white dark:bg-slate-700 text-sky-600 dark:text-sky-400 hover:bg-sky-100 dark:hover:bg-sky-600 dark:hover:text-white transition",p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"></path></svg>',p.title="Read sentence aloud",p.onclick=m=>{m.preventDefault(),qf(e.original_japanese_sentence)},c.append(f,p),s.appendChild(c)}if(((u=e.analysis)==null?void 0:u.length)>0){const c=document.createElement("div");c.className="flex flex-wrap gap-x-1.5 gap-y-1 text-2xl p-4 bg-slate-100 dark:bg-slate-900/50 rounded-lg mt-4",e.analysis.forEach(f=>{const p=document.createElement("span");if(p.className=`segment relative inline-block rounded-md px-2 py-1 cursor-pointer transition-transform duration-200 hover:-translate-y-0.5 leading-loose ${$f(f.category)}`,p.dataset.reading=f.reading,p.dataset.english=f.english_equivalent,p.dataset.category=f.category,p.dataset.wordUrl=`https://jisho.org/search/${encodeURIComponent(f.japanese_segment)}`,f.category!=="PUNCTUATION"){const h=Hf(f.reading,f.pitch_accent);h&&p.appendChild(h)}const m=document.createElement("div");m.innerHTML=Gi(f.japanese_segment,f.reading,!0),p.appendChild(m),c.appendChild(p),i.push(p)}),s.appendChild(c)}if(e.english_translation){const c=document.createElement("div");c.innerHTML=`<h3 class="text-base font-semibold border-b border-slate-200 dark:border-slate-700 pb-2 mb-3">English Translation</h3><p class="text-base italic text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-900/50 p-4 rounded-lg">${e.english_translation}</p>`,l.appendChild(c)}if(((d=e.grammar_patterns)==null?void 0:d.length)>0){const c=document.createElement("div");c.className="mt-6",c.innerHTML='<h3 class="text-base font-semibold border-b border-slate-200 dark:border-slate-700 pb-2 mb-3">Grammar & Vocabulary Notes</h3>';const f=document.createElement("ul");f.className="flex flex-col gap-3";const p=new Map,m=document.documentElement.classList.contains("dark");e.grammar_patterns.forEach((h,g)=>{var I;const y=g%Ot.length,E=`p-${y}`,w={name:h.pattern_name,explanation:h.explanation,colorClass:`bg-pattern-${y}`,idClass:E,underlineColor:m?Ot[y].dark:Ot[y].light};(I=h.constituent_indices)==null||I.forEach(R=>{p.has(R)||p.set(R,[]),p.get(R).push(w)});const M=document.createElement("li");M.className="flex gap-4 p-4 rounded-lg bg-slate-100 dark:bg-slate-900/50 cursor-pointer transition-all duration-200",M.dataset.patternId=E,M.innerHTML=`
          <span class="flex-shrink-0 w-1.5 rounded-full bg-pattern-${y}"></span>
          <div class="flex-grow">
              <strong class="font-semibold text-sky-700 dark:text-sky-400">${h.pattern_name}</strong>
              <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">${h.explanation}</p>
              <button class="show-examples-button mt-3 text-xs font-semibold px-2 py-1 rounded-md border border-sky-500 text-sky-600 dark:text-sky-400 hover:bg-sky-500 hover:text-white dark:hover:text-slate-900 transition inline-flex items-center gap-2 disabled:opacity-50" data-pattern-name="${h.pattern_name}">Show Examples</button>
          </div>
      `,f.appendChild(M)}),p.forEach((h,g)=>{const y=i[g];if(y&&h.length>0){y.classList.add("grammar-pattern",...h.map(I=>I.idClass)),y.dataset.patterns=JSON.stringify(h.map(({name:I,explanation:R,colorClass:L})=>({name:I,explanation:R,colorClass:L})));const E=2,w=3;y.style.paddingBottom=`${4+h.length*E+(h.length-1)*w}px`;const M=h.map(I=>`linear-gradient(to top, ${I.underlineColor} 0%, ${I.underlineColor} 100%)`);y.style.backgroundImage=M.join(", "),y.style.backgroundSize=h.map(()=>`100% ${E}px`).join(", "),y.style.backgroundPosition=h.map((I,R)=>`0 calc(100% - ${R*(E+w)}px)`).join(", "),y.style.backgroundRepeat="no-repeat"}}),c.appendChild(f),l.appendChild(c)}}function Lt(o){W.innerHTML="",O&&(O.classList.add("opacity-0","invisible","translate-y-5"),O.classList.remove("transform")),_e&&(_e.disconnect(),fi(null)),ze&&(window.removeEventListener("scroll",ze),pi(null));const t=o.text.split(`
`).map(d=>{var c;return((c=d.match(/[^。？！\s]+[。？！]?/g))==null?void 0:c.filter(f=>f==null?void 0:f.trim()))||[]}),n=t.flat();if(!(n.length>0))return;const s=document.createElement("div");W.appendChild(s);const l=document.createElement("div");if(l.className="flex justify-between items-center mb-4",l.innerHTML='<h2 class="text-xl font-bold text-slate-800 dark:text-slate-200">Text Content</h2>',n.length>0){const d=document.createElement("button");d.id="start-reading-button",d.className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 dark:bg-sky-500 dark:hover:bg-sky-600 dark:text-slate-900 dark:font-semibold",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>Start Reading',l.appendChild(d)}s.appendChild(l);const u=document.createElement("div");u.className="bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 rounded-lg p-4 sm:p-6 max-h-80 overflow-y-auto",t.forEach(d=>{const c=document.createElement("p");c.className="text-lg sm:text-xl leading-relaxed",d.length>0?d.forEach(f=>{var h;const p=document.createElement("span");p.className="clickable-sentence cursor-pointer rounded p-1 -m-1 transition-colors duration-200 hover:bg-sky-100 dark:hover:bg-sky-500/20",!!((h=o.analyzedSentences[f])!=null&&h[fe])?(p.classList.add("text-sky-700","dark:text-sky-400"),p.title="Analyzed. Click to view."):p.title="Click to analyze.",p.textContent=f,p.dataset.sentence=f,c.append(p," ")}):c.innerHTML="&nbsp;",u.appendChild(c)}),s.appendChild(u)}function Jf(o,e,t){J.innerHTML="",J.className="";const i=o.text.split(`
`).flatMap(u=>{var d;return((d=u.match(/[^。？！\s]+[。？！]?/g))==null?void 0:d.filter(c=>c==null?void 0:c.trim()))||[]}).length,s=document.createElement("header");s.className="sticky top-0 z-20 flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 transition-colors duration-300",s.innerHTML=`
        <button id="reading-mode-exit" title="Exit Reading Mode" class="px-3 py-1.5 text-sm rounded-md hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">Exit</button>
        <div class="font-medium text-slate-700 dark:text-slate-300 flex items-center gap-1">
            <input type="number" id="reading-mode-sentence-input" value="${e+1}" min="1" max="${i}" title="Enter sentence number and press Enter" class="w-12 text-center bg-slate-100 dark:bg-slate-700 rounded-md p-1 focus:ring-2 focus:ring-sky-500 focus:outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
            <span>/ ${i}</span>
        </div>
        <div class="flex items-center gap-2">
            <button id="reading-nav-prev" title="Previous Sentence" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-30 disabled:cursor-not-allowed" ${e===0?"disabled":""}>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="reading-nav-next" title="Next Sentence" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-30 disabled:cursor-not-allowed" ${e>=i-1?"disabled":""}>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>
    `,J.appendChild(s);const l=document.createElement("div");Ze(l,t,{stickyTopClass:"top-[4.5625rem]"}),J.appendChild(l)}function Yf(o="Loading analysis..."){J.innerHTML=`
        <div class="flex flex-col items-center justify-center p-16 text-slate-500">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-slate-500 mb-4"></div>
            <p>${o}</p>
        </div>
    `}function nt(o,e="main"){const t=`<p class="text-center text-red-600 dark:text-red-400 font-medium p-4">${o}</p>`;e==="analysis"?H.innerHTML=t:(kt.classList.remove("hidden"),J.classList.add("hidden"),W.innerHTML=t,H.innerHTML="")}function Xe(){pt.innerHTML="";const o=K;ui.classList.toggle("hidden",o.length>0),hn.classList.toggle("hidden",o.length===0),o.forEach(e=>{const t=document.createElement("li");t.className="text-entry-item group p-4 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-colors flex justify-between items-center";const n=document.createElement("div");n.className="flex-grow pr-4 truncate";const i=document.createElement("span");i.className="font-medium text-sm cursor-pointer",i.textContent=e.title,i.title=e.title,i.dataset.action="load",i.dataset.entryId=e.id;const s=document.createElement("span");s.className="block text-xs text-slate-500 dark:text-slate-400 mt-1",s.textContent=`Updated: ${new Date(e.updatedAt).toLocaleString()}`,n.append(i,s);const l=document.createElement("div");l.className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0";const u=document.createElement("button");u.className="p-1.5 rounded-md hover:bg-sky-100 dark:hover:bg-sky-600",u.title="Load Text",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-sky-600 dark:text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>',u.dataset.action="load",u.dataset.entryId=e.id;const d=document.createElement("button");d.className="p-1.5 rounded-md hover:bg-red-100 dark:hover:bg-red-600",d.title="Delete Text",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-600 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>',d.dataset.action="delete",d.dataset.entryId=e.id,l.append(u,d),t.append(n,l),pt.appendChild(t)})}let re=null,Oi;function Ue(){z.classList.add("opacity-0","invisible","pointer-events-none"),re&&(re.classList.remove("tooltip-active"),re=null)}const qi=()=>clearTimeout(Oi),ii=()=>{Oi=window.setTimeout(Ue,300)};function $i(o){qi();const{reading:e,english:t,patterns:n,category:i,wordUrl:s}=o.dataset;let l="",u="";if(i){const h=i.replace(/_/g," ").split("-").map(g=>g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()).join(", ");u+=`<p class="text-xs text-slate-600 dark:text-slate-400"><strong class="font-medium text-slate-800 dark:text-slate-200">Category:</strong> ${h}</p>`}if(u+=`<p class="text-xs text-slate-600 dark:text-slate-400 mt-1"><strong class="font-medium text-slate-800 dark:text-slate-200">Reading:</strong> ${e||"N/A"}</p>`,u+=`<p class="text-xs text-slate-600 dark:text-slate-400 mt-1"><strong class="font-medium text-slate-800 dark:text-slate-200">English:</strong> ${t||"N/A"}</p>`,s&&s.includes("http")&&(u+=`<div class="mt-2"><a href="${s}" target="_blank" rel="noopener noreferrer" class="text-xs font-semibold text-sky-600 dark:text-sky-400 hover:underline inline-flex items-center gap-1">Search on Jisho <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></div>`),u&&(l+=`<div class="mb-3"><h4 class="text-sm font-semibold border-b border-slate-200 dark:border-slate-700 pb-1 mb-1">Word Info</h4>${u}</div>`),n)try{JSON.parse(n).forEach(h=>{l+=`<div class="mb-2 last:mb-0"><div class="flex items-center gap-2 mb-1"><span class="flex-shrink-0 w-3 h-3 rounded-sm ${h.colorClass}"></span><h4 class="font-semibold text-sky-600 dark:text-sky-400">${h.name}</h4></div><p class="text-xs text-slate-600 dark:text-slate-400">${h.explanation}</p></div>`})}catch(h){console.error("Failed to parse patterns JSON",h)}if(!l){Ue();return}z.innerHTML=l,z.style.visibility="hidden",z.classList.remove("opacity-0","invisible","pointer-events-none");const d=o.getBoundingClientRect(),c=z.getBoundingClientRect(),f=10;let p=d.left+d.width/2-c.width/2;p<f&&(p=f),p+c.width>window.innerWidth-f&&(p=window.innerWidth-c.width-f);let m=d.top-c.height-10;m<f&&(m=d.bottom+10),z.style.left=`${p}px`,z.style.top=`${m}px`,z.style.visibility="visible"}function Kf(o){re&&re.classList.remove("tooltip-active"),re=o,re.classList.add("tooltip-active"),$i(o)}function zf(o){return re===o}function st(){return re!==null}function Wf(){de.addEventListener("mouseover",o=>{if(st())return;const e=o.target.closest(".segment");e&&$i(e)}),de.addEventListener("mouseout",o=>{st()||o.target.closest(".segment")&&ii()}),document.addEventListener("click",o=>{if(!st())return;const e=o.target.closest(".segment"),t=z.contains(o.target);!e&&!t&&Ue()}),z.addEventListener("mouseover",qi),z.addEventListener("mouseout",()=>{st()||ii()})}function Hi(){if(!O){const o=document.createElement("button");o.className="fixed bottom-5 right-5 w-12 h-12 bg-sky-600 text-white rounded-full shadow-lg flex items-center justify-center text-2xl font-bold opacity-0 invisible transform translate-y-5 transition-all duration-300 hover:bg-sky-700 z-50",o.innerHTML="&#8679;",o.title="Back to analyzed sentence",document.body.appendChild(o),zi(o)}}function si(){const o=W.querySelector(".clickable-sentence.selected");if(!o)return;Hi(),O&&(O.onclick=()=>o.scrollIntoView({behavior:"smooth",block:"center"}),O.title="Back to analyzed sentence"),_e&&_e.disconnect();const e=new IntersectionObserver(([t])=>{O==null||O.classList.toggle("opacity-0",t.isIntersecting),O==null||O.classList.toggle("invisible",t.isIntersecting),O==null||O.classList.toggle("translate-y-5",t.isIntersecting)},{root:null,threshold:.1});e.observe(W),fi(e)}const Ji="japanese-analyzer-history-v2",Qe="japanese-analyzer-unsaved-title",je="japanese-analyzer-unsaved-text",St="japanese-analyzer-analysis-depth",qt="japanese-analyzer-api-key",It="theme",At="furigana-hidden",Mt="pitch-accent-hidden";function me(){const o=!He.checked,e=!Je.checked;document.querySelectorAll("#result-container rt").forEach(t=>t.classList.toggle("hidden",o)),document.querySelectorAll("#result-container .pitch-accent-svg").forEach(t=>t.classList.toggle("hidden",e)),document.querySelectorAll("#result-container .segment").forEach(t=>{t.classList.toggle("pt-[18px]",!e),t.classList.toggle("pt-1",e)})}function Zf(){(localStorage.getItem(It)||"light")==="dark"?(document.documentElement.classList.add("dark"),Ae.checked=!0):(document.documentElement.classList.remove("dark"),Ae.checked=!1),Ae.addEventListener("change",()=>{var n;const e=Ae.checked?"dark":"light";document.documentElement.classList.toggle("dark",Ae.checked),localStorage.setItem(It,e);const t=W.querySelector(".clickable-sentence.selected");if(t!=null&&t.dataset.sentence&&q){const i=Z(q),s=(n=i==null?void 0:i.analyzedSentences[t.dataset.sentence])==null?void 0:n[fe];s&&(Ze(H,s),me())}})}function Xf(){const o=localStorage.getItem(At)==="true";He.checked=!o,He.addEventListener("change",()=>{const t=!He.checked;localStorage.setItem(At,String(t)),me()});const e=localStorage.getItem(Mt)!=="false";Je.checked=!e,Je.addEventListener("change",()=>{const t=!Je.checked;localStorage.setItem(Mt,String(t)),me()})}function Qf(){const o=localStorage.getItem(St),e=o&&Ut.includes(o)?o:"medium";In(e);const t=Ut.indexOf(e);rt.value=String(t),Ht.textContent=e.charAt(0).toUpperCase()+e.slice(1),rt.addEventListener("input",()=>{const n=Ut[parseInt(rt.value,10)];if(Ht.textContent=n.charAt(0).toUpperCase()+n.slice(1),In(n),localStorage.setItem(St,n),q){const i=Z(q);if(!i)return;if(Lt(i),!J.classList.contains("hidden")){wt(i,i.readingProgress);return}const s=W.querySelector(".clickable-sentence.selected");if(s!=null&&s.dataset.sentence){const l=s.dataset.sentence;H.innerHTML=`<p class="text-center p-8 text-slate-500">Analyzing with new '${n}' setting...</p>`,bt(i,l,n).then(u=>{Ze(H,u),me()}).catch(u=>{nt(u instanceof Error?u.message:"Unknown error","analysis")})}}})}function jf(){Te.value=localStorage.getItem(Qe)||"",ue.value=localStorage.getItem(je)||"",Te.addEventListener("input",()=>{localStorage.setItem(Qe,Te.value)}),ue.addEventListener("input",()=>{localStorage.setItem(je,ue.value),et()})}function ep(){try{const o=localStorage.getItem(Ji);o&&Kt(JSON.parse(o))}catch(o){console.error("Failed to load or parse history from localStorage",o),Kt([])}Xe()}function he(){try{K.sort((o,e)=>e.updatedAt-o.updatedAt),localStorage.setItem(Ji,JSON.stringify(K))}catch(o){console.error("Failed to save history to localStorage",o)}}function et(){const o=ue.value.trim().length>0,e=!!Re;we.disabled=!o||!e,e?o?we.title="":we.title="Please enter some text to process.":we.title="Please set your Gemini API key in the settings menu."}function tp(){const o=localStorage.getItem(qt);Ft(o||void 0||null),o?(Oe.placeholder="API key saved",Ce.textContent="Using key from local storage."):(Ce.textContent="No API key found. Please add one.",Ce.classList.add("text-amber-500","font-semibold")),di.addEventListener("click",()=>{const t=Oe.value.trim();t?(localStorage.setItem(qt,t),Ft(t),Oe.value="",Oe.placeholder="API key saved",Ce.textContent="✅ Key saved and is now active.",Ce.classList.remove("text-amber-500","font-semibold")):(localStorage.removeItem(qt),Ft(null),Ce.textContent="User-defined key removed. Falling back to built-in key if available."),et()}),et()}function Yi(){kt.classList.remove("hidden"),J.classList.add("hidden")}function np(){kt.classList.add("hidden"),J.classList.remove("hidden")}async function bt(o,e,t){var i;const n=(i=o.analyzedSentences[e])==null?void 0:i[t];if(n)return n;if(!Re)throw new Error("API Key is not configured. Please add one in the settings menu.");try{const s=await Bf(Re,e.trim(),t);return Mn(e,s,t),he(),Xe(),s}catch(s){console.error(`Analysis failed for: "${e}"`,s);const u={error:s instanceof Error?s.message:"An unknown error occurred."};throw Mn(e,u,t),he(),s}}async function op(o,e){var i;const t=o.text.split(`
`).flatMap(s=>{var l;return((l=s.match(/[^。？！\s]+[。？！]?/g))==null?void 0:l.filter(u=>u==null?void 0:u.trim()))||[]}),n=e+1;if(n<t.length){const s=t[n];(i=o.analyzedSentences[s])!=null&&i[fe]||(console.log(`Prefetching analysis for: "${s}"`),bt(o,s,fe).catch(l=>{console.warn(`Prefetch failed for sentence ${n+1}:`,l.message)}))}}async function wt(o,e){const t=o.text.split(`
`).flatMap(i=>{var s;return((s=i.match(/[^。？！\s]+[。？！]?/g))==null?void 0:s.filter(l=>l==null?void 0:l.trim()))||[]});if(e>=t.length||t.length===0){_n(o.id);return}const n=t[e];np(),Yf();try{const i=await bt(o,n,fe);if(i.error)throw new Error(i.error);Jf(o,e,i),me(),_e&&_e.disconnect(),ze&&window.removeEventListener("scroll",ze),Hi();const s=O;if(s){s.onclick=()=>window.scrollTo({top:0,behavior:"smooth"}),s.title="Scroll to top",s.classList.add("opacity-0","invisible","translate-y-5");const l=()=>{if(J.classList.contains("hidden"))return;const u=window.scrollY>window.innerHeight/2;s.classList.toggle("opacity-0",!u),s.classList.toggle("invisible",!u),s.classList.toggle("translate-y-5",!u)};window.addEventListener("scroll",l),pi(l)}await op(o,e)}catch(i){const s=i instanceof Error?i.message:"An unknown error occurred during analysis.";nt(s,"main")}}function _n(o){const e=Z(o);e&&(Yi(),Te.value=e.title,ue.value=e.text,localStorage.setItem(Qe,e.title),localStorage.setItem(je,e.text),gn(o),Lt(e),H.innerHTML='<p class="text-center p-8 text-slate-500">Select a sentence to analyze, or start reading mode.</p>',et())}function mn(){Te.value="",ue.value="",Yi(),W.innerHTML="",H.innerHTML="",localStorage.removeItem(Qe),localStorage.removeItem(je),gn(null),Ue(),et()}function ip(){const o=()=>{Jt.classList.remove("translate-x-full"),at.classList.remove("invisible","opacity-0")},e=()=>{Jt.classList.add("translate-x-full"),at.classList.add("invisible","opacity-0")};ai.addEventListener("click",o),li.addEventListener("click",e),at.addEventListener("click",e),hn.addEventListener("click",()=>{K.length!==0&&window.confirm("Are you sure you want to delete all your saved texts? This cannot be undone.")&&(Zi(),he(),Xe(),q&&mn())}),pt.addEventListener("click",t=>{const i=t.target.closest("[data-action]");if(!i)return;const{action:s,entryId:l}=i.dataset;if(!s||!l)return;const u=Z(l);if(u)switch(s){case"load":e(),_n(l);break;case"delete":if(window.confirm(`Are you sure you want to delete "${u.title}"?`)){const d=q===l;Wi(l),he(),Xe(),d&&mn()}break}})}function sp(){de.addEventListener("click",o=>{const e=o.target.closest("[data-pattern-id]");if(!e)return;const t=e.closest("#analysis-view, #reading-mode-view");if(!t)return;const{patternId:n}=e.dataset;if(!n)return;const i=e.classList.contains("is-focused");t.querySelectorAll("[data-pattern-id]").forEach(s=>s.classList.remove("is-focused","ring-2","ring-sky-500","bg-white","dark:bg-slate-900")),t.querySelectorAll(".segment").forEach(s=>s.classList.remove("opacity-30")),i||(e.classList.add("is-focused","ring-2","ring-sky-500","bg-white","dark:bg-slate-900"),t.querySelectorAll(`.segment:not(.${n})`).forEach(l=>l.classList.add("opacity-30")))})}function rp(){de.addEventListener("click",async o=>{const e=o.target.closest(".show-examples-button");if(!e||e.disabled)return;if(o.preventDefault(),!Re){nt("API Key is not configured. Please add one in the settings menu.");return}const{patternName:t}=e.dataset,n=e.nextElementSibling;if(n&&n.classList.contains("examples-container")){n.classList.toggle("hidden"),e.textContent=n.classList.contains("hidden")?"Show Examples":"Hide Examples";return}e.disabled=!0,e.innerHTML='<span class="animate-spin rounded-full h-4 w-4 border-b-2 border-slate-900 dark:border-white"></span>Loading...';try{const i=await Gf(Re,t);if((i==null?void 0:i.length)>0){const s=document.createElement("div");s.className="examples-container mt-4 pt-4 border-t border-dashed border-slate-200 dark:border-slate-700";const l=document.createElement("dl");l.className="flex flex-col gap-4",i.forEach(u=>{const d=document.createElement("dt"),c=document.createElement("dd"),f=Gi(u.japanese,u.reading,!1);d.innerHTML=`<span class="text-lg font-jp">${f}</span>`,c.className="text-sm text-slate-600 dark:text-slate-400 -mt-1",c.textContent=u.english,l.append(d,c)}),s.appendChild(l),e.insertAdjacentElement("afterend",s),e.textContent="Hide Examples"}else e.textContent="No examples found."}catch(i){console.error(i),e.textContent="Error. Retry?"}finally{e.disabled=!1,me()}})}function ap(){we.addEventListener("click",async()=>{const o=ue.value;if(!o.trim()){nt("Please enter some Japanese text.","main");return}const e=Te.value.trim()||o.substring(0,40)+"...";let t=q;if(t){const i=Z(t);if(i){const s=f=>new Set(f.split(`
`).flatMap(p=>{var m;return((m=p.match(/[^。？！\s]+[。？！]?/g))==null?void 0:m.filter(h=>h==null?void 0:h.trim()))||[]})),l=s(i.text),u=s(o),d=i.analyzedSentences,c={};for(const f of u)l.has(f)&&d[f]&&(c[f]=d[f]);i.title=e,i.text=o,i.analyzedSentences=c,i.updatedAt=Date.now(),i.readingProgress=0,mt(i)}else t=null}if(!t){const i=Date.now().toString(),s={id:i,title:e,text:o,createdAt:Date.now(),updatedAt:Date.now(),analyzedSentences:{},readingProgress:0};mt(s),gn(i)}he(),Xe(),localStorage.setItem(Qe,e),localStorage.setItem(je,o);const n=Z(q);Lt(n),H.innerHTML='<p class="text-center p-8 text-slate-500">Select a sentence to analyze, or start reading mode.</p>'})}function lp(){de.addEventListener("click",async o=>{var i,s;if(!J.classList.contains("hidden"))return;const e=o.target;if(e.closest("#start-reading-button")){if(q){const l=Z(q);l&&await wt(l,l.readingProgress)}return}const t=e.closest(".clickable-sentence");if(t&&W.contains(t)){const l=t.dataset.sentence;if(!l||!q)return;Ue(),W.querySelectorAll(".clickable-sentence").forEach(c=>c.classList.remove("selected","bg-sky-200/60","dark:bg-sky-500/30","font-semibold")),t.classList.add("selected","bg-sky-200/60","dark:bg-sky-500/30","font-semibold");const u=Z(q),d=(i=u.analyzedSentences[l])==null?void 0:i[fe];if(d)Ze(H,d),si();else{H.innerHTML='<p class="text-center p-8 text-slate-500">Analyzing sentence...</p>';try{const c=await bt(u,l,fe);Lt(u),(s=W.querySelector(`.clickable-sentence[data-sentence="${CSS.escape(l)}"]`))==null||s.classList.add("selected","bg-sky-200/60","dark:bg-sky-500/30","font-semibold"),Ze(H,c),si()}catch(c){nt(c instanceof Error?c.message:"Unknown error","analysis")}}me();return}if(e.closest("a.underline")){o.stopPropagation();return}const n=e.closest(".segment");if(n&&H.contains(n)){if(o.stopPropagation(),H.querySelector(".is-focused"))return;zf(n)?Ue():Kf(n)}})}function up(){de.addEventListener("click",o=>{if(J.classList.contains("hidden"))return;const e=o.target,t=q;if(!t)return;const n=Z(t);if(!n)return;let i=n.readingProgress;if(e.closest("#reading-mode-exit")){_n(t);return}if(e.closest("#reading-nav-next"))i++;else if(e.closest("#reading-nav-prev"))i--;else return;An(t,i),he(),wt(n,i)}),de.addEventListener("change",o=>{if(J.classList.contains("hidden"))return;const e=o.target;if(e.id!=="reading-mode-sentence-input")return;const t=q;if(!t)return;const n=Z(t);if(!n)return;const s=n.text.split(`
`).flatMap(u=>{var d;return((d=u.match(/[^。？！\s]+[。？！]?/g))==null?void 0:d.filter(c=>c==null?void 0:c.trim()))||[]}).length;let l=parseInt(e.value,10)-1;if(isNaN(l)||l<0||l>=s){e.value=String(n.readingProgress+1);return}l!==n.readingProgress&&(An(t,l),he(),wt(n,l))})}function cp(){ci.addEventListener("click",()=>{const o={version:"1.0",exportedAt:Date.now(),history:K,settings:{[It]:localStorage.getItem(It),[At]:localStorage.getItem(At),[Mt]:localStorage.getItem(Mt),[St]:localStorage.getItem(St)}},e=JSON.stringify(o,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n;const s=new Date().toISOString().split("T")[0];i.download=`japanese-analyzer-backup-${s}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}),lt.addEventListener("change",()=>{var t;const o=(t=lt.files)==null?void 0:t[0];if(!o)return;const e=new FileReader;e.onload=n=>{var i;try{const s=JSON.parse((i=n.target)==null?void 0:i.result);if(!s.history||!s.settings)throw new Error("Invalid backup file structure.");window.confirm("Importing will overwrite your current history and settings. Are you sure you want to continue?")&&(Kt(s.history),he(),Object.keys(s.settings).forEach(l=>{const u=s.settings[l];u!=null?localStorage.setItem(l,u):localStorage.removeItem(l)}),alert("Import successful! The application will now reload to apply the new settings."),window.location.reload())}catch(s){alert(`Import failed: ${s instanceof Error?s.message:"Could not read file."}`)}finally{lt.value=""}},e.readAsText(o)})}function dp(){$t.addEventListener("click",o=>{o.stopPropagation(),Ge.classList.toggle("hidden")}),document.addEventListener("click",o=>{Ge.classList.contains("hidden")||!Ge.contains(o.target)&&!$t.contains(o.target)&&Ge.classList.add("hidden")})}function fp(){ri.addEventListener("click",mn)}function pp(){tp(),dp(),ip(),Zf(),Xf(),Qf(),jf(),ep(),Of(),Wf(),sp(),rp(),ap(),lp(),up(),fp(),cp(),me()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/pp();
