import{j as n,e as I,R as v,r as P,a as R}from"./index.prod-CXvYPYqy.js";const C=({text:c,title:t="Read aloud"})=>n.jsx("button",{className:"tts-button btn-ghost p-1 text-text-muted hover:text-text-primary",title:t,onClick:e=>{e.stopPropagation(),I(c)},children:n.jsx("i",{className:"bi bi-volume-up text-base"})}),k=v.memo(function({text:t}){const e=P.useMemo(()=>t.split("").map((o,l)=>/[一-龯]/.test(o)?n.jsx("a",{href:`https://jisho.org/search/${encodeURIComponent(o)}%20%23kanji`,target:"_blank",rel:"noopener noreferrer",className:"underline decoration-text-muted/50 decoration-1 underline-offset-2 hover:text-accent hover:decoration-accent transition",onClick:s=>s.stopPropagation(),children:o},l):o),[t]);return n.jsx(n.Fragment,{children:e})}),j=c=>/[一-龯]/.test(c),L=v.memo(function({base:t,reading:e,interactiveKanji:o=!1}){const{state:l}=R(),{showFurigana:s}=l,a=P.useMemo(()=>{if(!s||!e||t===e)return o?n.jsx(k,{text:t}):t;const d=[];let r=0,i=0;for(;i<t.length;)if(j(t[i])){let h="",u=i;for(;u<t.length&&j(t[u]);)h+=t[u],u++;let x="",m=u;for(;m<t.length&&!j(t[m]);)x+=t[m],m++;let p="",f=x?e.indexOf(x,r):-1;if(x&&f===r){const g=e.indexOf(x,r+1);g!==-1&&(f=g)}if(f!==-1)p=e.substring(r,f);else{const g=t.substring(i),w=e.substring(r),F=g.split("").filter(N=>!j(N)).length;p=w.slice(0,w.length-F)}const y=o?n.jsx(k,{text:h}):h;d.push(n.jsxs("ruby",{children:[y,n.jsx("rt",{className:"text-xs text-text-muted select-none",children:p})]},i)),r+=p.length,i+=h.length}else d.push(t[i]),r<e.length&&t[i]===e[r]&&r++,i++;return d},[t,e,o,s]);return s?n.jsx(n.Fragment,{children:a}):o?n.jsx(k,{text:t}):t}),A=v.memo(function({reading:t,pitchAccent:e}){const{state:o}=R();if(!o.showPitchAccent||!t||!e||t.length!==e.length)return null;const l=e.split("").map((s,a)=>({x:100/t.length*(a+.5),y:s==="H"?2:8}));return n.jsxs("svg",{className:"pitch-accent-svg absolute top-0 left-0 w-full h-[14px] overflow-visible pointer-events-none",viewBox:"0 0 100 10",preserveAspectRatio:"none",children:[l.length>1&&n.jsx("polyline",{points:l.map(s=>`${s.x},${s.y}`).join(" "),className:"fill-none stroke-text-muted",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),l.map((s,a)=>n.jsx("circle",{cx:s.x,cy:s.y,r:"1.2",className:"fill-text-muted"},a))]})});export{L as F,A as P,C as T};
