import{r as h,j as s,R as Oe,u as ke,a as Me,b as Le,V as De}from"./index.prod-wyqjZk6G.js";import{F as Y,T as Ke,P as Ue}from"./PitchAccentVisualizer-BfOCVX0-.js";const Pe=[0,4,8,24,48,168,336,720,2880],ze=1,He=.5,Fe=2.5,$e=.15,Be=.15,Ge=.2;function B(e,t){const n={...e};let a=e.srsStage,r=e.intervalModifier??ze;if(t===1){n.incorrectAnswerCount=(e.incorrectAnswerCount||0)+1;const i=Math.ceil(n.incorrectAnswerCount/2),o=e.srsStage>=5?2:1,c=i*o;a=Math.max(1,e.srsStage-c),r-=Ge}else n.incorrectAnswerCount=0,t===2?r-=Be:(t===3||(r+=$e),a=e.srsStage+1);if(n.intervalModifier=Math.max(He,Math.min(r,Fe)),a>=9)n.srsStage=9,n.nextReviewDate=new Date("9999-12-31").getTime();else{n.srsStage=a;const o=Pe[n.srsStage]*n.intervalModifier,c=new Date;n.nextReviewDate=new Date(c.getTime()+o*60*60*1e3).getTime()}return n}function O(e){return e===null?"null":e!==Object(e)?typeof e:{}.toString.call(e).slice(8,-1).toLowerCase()}function k(e){return O(e)!=="string"?!0:!e.length}function Q(e="",t,n){if(k(e))return!1;const a=e.charCodeAt(0);return t<=a&&a<=n}const ne={HIRAGANA:"toHiragana",KATAKANA:"toKatakana"},xe={HEPBURN:"hepburn"},Ve={useObsoleteKana:!1,passRomaji:!1,convertLongVowelMark:!0,upcaseKatakana:!1,IMEMode:!1,romanization:xe.HEPBURN},We=65,Je=90,Ye=65345,Qe=65370,qe=65313,Ze=65338,fe=12353,Xe=12438,et=12449,tt=12540,nt=12539,st=[65296,65305],rt=[qe,Ze],at=[Ye,Qe],it=[65281,65295],ot=[65306,65311],ct=[65339,65343],lt=[65371,65376],ut=[65504,65518],dt=[12352,12447],xt=[12448,12543],ft=[65382,65439],mt=[12539,12540],me=[65377,65381],ht=[12288,12351],pt=[19968,40959],gt=[13312,19903],bt=[dt,xt,me,ft],jt=[ht,me,mt,it,ot,ct,lt,ut],Nt=[...bt,...jt,rt,at,st,pt,gt];function wt(e=""){return Nt.some(([t,n])=>Q(e,t,n))}function F(e="",t){const n=O(t)==="regexp";return k(e)?!1:[...e].every(a=>{const r=wt(a);return n?r||t.test(a):r})}var se=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function vt(e,t){return!!(e===t||se(e)&&se(t))}function yt(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!vt(e[n],t[n]))return!1;return!0}function he(e,t){t===void 0&&(t=yt);var n=null;function a(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(n&&n.lastThis===this&&t(r,n.lastArgs))return n.lastResult;var o=e.apply(this,r);return n={lastResult:o,lastArgs:r,lastThis:this},o}return a.clear=function(){n=null},a}var re=Object.prototype.hasOwnProperty;function ae(e,t,n){for(n of e.keys())if(_(n,t))return n}function _(e,t){var n,a,r;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((a=e.length)===t.length)for(;a--&&_(e[a],t[a]););return a===-1}if(n===Set){if(e.size!==t.size)return!1;for(a of e)if(r=a,r&&typeof r=="object"&&(r=ae(t,r),!r)||!t.has(r))return!1;return!0}if(n===Map){if(e.size!==t.size)return!1;for(a of e)if(r=a[0],r&&typeof r=="object"&&(r=ae(t,r),!r)||!_(a[1],t.get(r)))return!1;return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((a=e.byteLength)===t.byteLength)for(;a--&&e.getInt8(a)===t.getInt8(a););return a===-1}if(ArrayBuffer.isView(e)){if((a=e.byteLength)===t.byteLength)for(;a--&&e[a]===t[a];);return a===-1}if(!n||typeof e=="object"){a=0;for(n in e)if(re.call(e,n)&&++a&&!re.call(t,n)||!(n in t)||!_(e[n],t[n]))return!1;return Object.keys(t).length===a}}return e!==e&&t!==t}const pe=(e={})=>Object.assign({},Ve,e);function Et(e,t,n){const a=t;function r(c,l){if(c[l]!==void 0)return Object.assign({"":c[""]+l},c[l])}function i(c,l){const u=c.charAt(0);return o(Object.assign({"":u},a[u]),c.slice(1),l,l+1)}function o(c,l,u,d){if(!l)return n||Object.keys(c).length===1?c[""]?[[u,d,c[""]]]:[]:[[u,d,null]];if(Object.keys(c).length===1)return[[u,d,c[""]]].concat(i(l,d));const x=r(c,l.charAt(0));return x===void 0?[[u,d,c[""]]].concat(i(l,d)):o(x,l.slice(1),u,d+1)}return i(e,0)}function q(e){return Object.entries(e).reduce((t,[n,a])=>{const r=O(a)==="string";return t[n]=r?{"":a}:q(a),t},{})}function ge(e,t){return t.split("").reduce((n,a)=>(n[a]===void 0&&(n[a]={}),n[a]),e)}function be(e={}){const t={};return O(e)==="object"&&Object.entries(e).forEach(([n,a])=>{let r=t;n.split("").forEach(i=>{r[i]===void 0&&(r[i]={}),r=r[i]}),r[""]=a}),function(a){const r=JSON.parse(JSON.stringify(a));function i(o,c){return o===void 0||O(o)==="string"?c:Object.entries(c).reduce((l,[u,d])=>(l[u]=i(o[u],d),l),o)}return i(r,t)}}function je(e,t){return t?O(t)==="function"?t(e):be(t)(e):e}const At={a:"あ",i:"い",u:"う",e:"え",o:"お",k:{a:"か",i:"き",u:"く",e:"け",o:"こ"},s:{a:"さ",i:"し",u:"す",e:"せ",o:"そ"},t:{a:"た",i:"ち",u:"つ",e:"て",o:"と"},n:{a:"な",i:"に",u:"ぬ",e:"ね",o:"の"},h:{a:"は",i:"ひ",u:"ふ",e:"へ",o:"ほ"},m:{a:"ま",i:"み",u:"む",e:"め",o:"も"},y:{a:"や",u:"ゆ",o:"よ"},r:{a:"ら",i:"り",u:"る",e:"れ",o:"ろ"},w:{a:"わ",i:"ゐ",e:"ゑ",o:"を"},g:{a:"が",i:"ぎ",u:"ぐ",e:"げ",o:"ご"},z:{a:"ざ",i:"じ",u:"ず",e:"ぜ",o:"ぞ"},d:{a:"だ",i:"ぢ",u:"づ",e:"で",o:"ど"},b:{a:"ば",i:"び",u:"ぶ",e:"べ",o:"ぼ"},p:{a:"ぱ",i:"ぴ",u:"ぷ",e:"ぺ",o:"ぽ"},v:{a:"ゔぁ",i:"ゔぃ",u:"ゔ",e:"ゔぇ",o:"ゔぉ"}},St={".":"。",",":"、",":":"：","/":"・","!":"！","?":"？","~":"〜","-":"ー","‘":"「","’":"」","“":"『","”":"』","[":"［","]":"］","(":"（",")":"）","{":"｛","}":"｝"},ie={k:"き",s:"し",t:"ち",n:"に",h:"ひ",m:"み",r:"り",g:"ぎ",z:"じ",d:"ぢ",b:"び",p:"ぴ",v:"ゔ",q:"く",f:"ふ"},Ne={ya:"ゃ",yi:"ぃ",yu:"ゅ",ye:"ぇ",yo:"ょ"},we={a:"ぁ",i:"ぃ",u:"ぅ",e:"ぇ",o:"ぉ"},oe={sh:"sy",ch:"ty",cy:"ty",chy:"ty",shy:"sy",j:"zy",jy:"zy",shi:"si",chi:"ti",tsu:"tu",ji:"zi",fu:"hu"},Ct=Object.assign({tu:"っ",wa:"ゎ",ka:"ヵ",ke:"ヶ"},we,Ne),It={yi:"い",wu:"う",ye:"いぇ",wi:"うぃ",we:"うぇ",kwa:"くぁ",whu:"う",tha:"てゃ",thu:"てゅ",tho:"てょ",dha:"でゃ",dhu:"でゅ",dho:"でょ"},Tt={wh:"う",kw:"く",qw:"く",q:"く",gw:"ぐ",sw:"す",ts:"つ",th:"て",tw:"と",dh:"で",dw:"ど",fw:"ふ",f:"ふ"};function Rt(){const e=q(At),t=r=>ge(e,r);Object.entries(ie).forEach(([r,i])=>{Object.entries(Ne).forEach(([o,c])=>{t(r+o)[""]=i+c})}),Object.entries(St).forEach(([r,i])=>{t(r)[""]=i}),Object.entries(Tt).forEach(([r,i])=>{Object.entries(we).forEach(([o,c])=>{const l=t(r+o);l[""]=i+c})}),["n","n'","xn"].forEach(r=>{t(r)[""]="ん"}),e.c=JSON.parse(JSON.stringify(e.k)),Object.entries(oe).forEach(([r,i])=>{const o=r.slice(0,r.length-1),c=r.charAt(r.length-1),l=t(o);l[c]=JSON.parse(JSON.stringify(t(i)))});function n(r){return[...Object.entries(oe),["c","k"]].reduce((i,[o,c])=>r.startsWith(c)?i.concat(r.replace(c,o)):i,[])}Object.entries(Ct).forEach(([r,i])=>{const o=x=>x.charAt(x.length-1),c=x=>x.slice(0,x.length-1),l=`x${r}`,u=t(l);u[""]=i;const d=t(`l${c(r)}`);d[o(r)]=u,n(r).forEach(x=>{["l","x"].forEach(w=>{const M=t(w+c(x));M[o(x)]=t(w+r)})})}),Object.entries(It).forEach(([r,i])=>{t(r)[""]=i});function a(r){return Object.entries(r).reduce((i,[o,c])=>(o?i[o]=a(c):i[o]=`っ${c}`,i),{})}return[...Object.keys(ie),"c","y","w","j"].forEach(r=>{const i=e[r];i[r]=a(i)}),delete e.n.n,Object.freeze(JSON.parse(JSON.stringify(e)))}let G=null;function _t(){return G==null&&(G=Rt()),G}const Ot=be({wi:"ゐ",we:"ゑ"});function kt(e){const t=JSON.parse(JSON.stringify(e));return t.n.n={"":"ん"},t.n[" "]={"":"ん"},t}function Mt(e=""){return k(e)?!1:Q(e,We,Je)}function ve(e=""){return k(e)?!1:e.charCodeAt(0)===tt}function Lt(e=""){return k(e)?!1:e.charCodeAt(0)===nt}function Dt(e=""){return k(e)?!1:ve(e)?!0:Q(e,fe,Xe)}function Kt(e=""){const t=[];return e.split("").forEach(n=>{if(ve(n)||Lt(n))t.push(n);else if(Dt(n)){const a=n.charCodeAt(0)+(et-fe),r=String.fromCharCode(a);t.push(r)}else t.push(n)}),t.join("")}const Z=he((e,t,n)=>{let a=_t();return a=e?kt(a):a,a=t?Ot(a):a,n&&(a=je(a,n)),a},_);function Ut(e="",t={},n){let a;return n?a=t:(a=pe(t),n=Z(a.IMEMode,a.useObsoleteKana,a.customKanaMapping)),Pt(e,a,n).map(r=>{const[i,o,c]=r;if(c===null)return e.slice(i);const l=a.IMEMode===ne.HIRAGANA,u=a.IMEMode===ne.KATAKANA||[...e.slice(i,o)].every(Mt);return l||!u?c:Kt(c)}).join("")}function Pt(e="",t={},n){const{IMEMode:a,useObsoleteKana:r,customKanaMapping:i}=t;return n||(n=Z(a,r,i)),Et(e.toLowerCase(),n,!a)}let K=[];function zt(e){let t;const n=Object.assign({},pe(e),{IMEMode:e.IMEMode||!0}),a=Z(n.IMEMode,n.useObsoleteKana,n.customKanaMapping),r=[...Object.keys(a),...Object.keys(a).map(i=>i.toUpperCase())];return function({target:o}){o.value!==t&&o.dataset.ignoreComposition!=="true"&&Ht(o,n,a,r)}}function Ht(e,t,n,a,r){const[i,o,c]=Gt(e.value,e.selectionEnd,a),l=Ut(o,t,n);if(o!==l){const d=i.length+l.length,x=i+l+c;e.value=x,c.length?setTimeout(()=>e.setSelectionRange(d,d),1):e.setSelectionRange(d,d)}else e.value}function V({type:e,target:t,data:n}){/Mac/.test(window.navigator&&window.navigator.platform)&&(e==="compositionupdate"&&F(n)&&(t.dataset.ignoreComposition="true"),e==="compositionend"&&(t.dataset.ignoreComposition="false"))}function Ft(e,t,n){K=K.concat({id:e,inputHandler:t,compositionHandler:n})}function $t({id:e}){K=K.filter(({id:t})=>t!==e)}function Bt(e){return e&&K.find(({id:t})=>t===e.getAttribute("data-wanakana-id"))}function Gt(e="",t=0,n=[]){let a,r,i;return t===0&&n.includes(e[0])?[a,r,i]=Vt(e,n):t>0?[a,r,i]=Wt(e,t):([a,r]=H(e,o=>!n.includes(o)),[r,i]=H(r,o=>!F(o))),[a,r,i]}function Vt(e,t){return["",...H(e,n=>t.includes(n)||!F(n,/[0-9]/))]}function Wt(e="",t=0){const[n,a]=H([...e.slice(0,t)].reverse(),r=>!F(r));return[a.reverse().join(""),n.split("").reverse().join(""),e.slice(t)]}function H(e={},t=n=>!!n){const n=[],{length:a}=e;let r=0;for(;r<a&&t(e[r],r);)n.push(e[r]),r+=1;return[n.join(""),e.slice(r)]}const Jt=({target:{value:e,selectionStart:t,selectionEnd:n}})=>console.log("input:",{value:e,selectionStart:t,selectionEnd:n}),Yt=()=>console.log("compositionstart"),Qt=({target:{value:e,selectionStart:t,selectionEnd:n},data:a})=>console.log("compositionupdate",{data:a,value:e,selectionStart:t,selectionEnd:n}),qt=()=>console.log("compositionend"),ye={input:Jt,compositionstart:Yt,compositionupdate:Qt,compositionend:qt},Zt=e=>{Object.entries(ye).forEach(([t,n])=>e.addEventListener(t,n))},Xt=e=>{Object.entries(ye).forEach(([t,n])=>e.removeEventListener(t,n))},en=["TEXTAREA","INPUT"];let ce=0;const tn=()=>(ce+=1,`${Date.now()}${ce}`);function nn(e={},t={},n=!1){if(!en.includes(e.nodeName))throw new Error(`Element provided to Wanakana bind() was not a valid input or textarea element.
 Received: (${JSON.stringify(e)})`);if(e.hasAttribute("data-wanakana-id"))return;const a=zt(t),r=tn(),i=[{name:"data-wanakana-id",value:r},{name:"lang",value:"ja"},{name:"autoCapitalize",value:"none"},{name:"autoCorrect",value:"off"},{name:"autoComplete",value:"off"},{name:"spellCheck",value:"false"}],o={};i.forEach(c=>{o[c.name]=e.getAttribute(c.name),e.setAttribute(c.name,c.value)}),e.dataset.previousAttributes=JSON.stringify(o),e.addEventListener("input",a),e.addEventListener("compositionupdate",V),e.addEventListener("compositionend",V),Ft(r,a,V),n===!0&&Zt(e)}function sn(e,t=!1){const n=Bt(e);if(n==null)throw new Error(`Element provided to Wanakana unbind() had no listener registered.
 Received: ${JSON.stringify(e)}`);const{inputHandler:a,compositionHandler:r}=n,i=JSON.parse(e.dataset.previousAttributes);Object.keys(i).forEach(o=>{i[o]?e.setAttribute(o,i[o]):e.removeAttribute(o)}),e.removeAttribute("data-previous-attributes"),e.removeAttribute("data-ignore-composition"),e.removeEventListener("input",a),e.removeEventListener("compositionstart",r),e.removeEventListener("compositionupdate",r),e.removeEventListener("compositionend",r),$t(n),t===!0&&Xt(e)}let W=null;const rn={あ:"a",い:"i",う:"u",え:"e",お:"o",か:"ka",き:"ki",く:"ku",け:"ke",こ:"ko",さ:"sa",し:"shi",す:"su",せ:"se",そ:"so",た:"ta",ち:"chi",つ:"tsu",て:"te",と:"to",な:"na",に:"ni",ぬ:"nu",ね:"ne",の:"no",は:"ha",ひ:"hi",ふ:"fu",へ:"he",ほ:"ho",ま:"ma",み:"mi",む:"mu",め:"me",も:"mo",ら:"ra",り:"ri",る:"ru",れ:"re",ろ:"ro",や:"ya",ゆ:"yu",よ:"yo",わ:"wa",ゐ:"wi",ゑ:"we",を:"wo",ん:"n",が:"ga",ぎ:"gi",ぐ:"gu",げ:"ge",ご:"go",ざ:"za",じ:"ji",ず:"zu",ぜ:"ze",ぞ:"zo",だ:"da",ぢ:"ji",づ:"zu",で:"de",ど:"do",ば:"ba",び:"bi",ぶ:"bu",べ:"be",ぼ:"bo",ぱ:"pa",ぴ:"pi",ぷ:"pu",ぺ:"pe",ぽ:"po",ゔぁ:"va",ゔぃ:"vi",ゔ:"vu",ゔぇ:"ve",ゔぉ:"vo"},an={"。":".","、":",","：":":","・":"/","！":"!","？":"?","〜":"~",ー:"-","「":"‘","」":"’","『":"“","』":"”","［":"[","］":"]","（":"(","）":")","｛":"{","｝":"}","　":" "},on=["あ","い","う","え","お","や","ゆ","よ"],J={ゃ:"ya",ゅ:"yu",ょ:"yo"},cn={ぃ:"yi",ぇ:"ye"},ln={ぁ:"a",ぃ:"i",ぅ:"u",ぇ:"e",ぉ:"o"},un=["き","に","ひ","み","り","ぎ","び","ぴ","ゔ","く","ふ"],dn={し:"sh",ち:"ch",じ:"j",ぢ:"j"},xn={っ:"",ゃ:"ya",ゅ:"yu",ょ:"yo",ぁ:"a",ぃ:"i",ぅ:"u",ぇ:"e",ぉ:"o"},le={b:"b",c:"t",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",m:"m",p:"p",q:"q",r:"r",s:"s",t:"t",v:"v",w:"w",x:"x",z:"z"};function fn(){return W==null&&(W=hn()),W}function mn(e){switch(e){case xe.HEPBURN:return fn();default:return{}}}function hn(){const e=q(rn),t=a=>ge(e,a),n=(a,r)=>{t(a)[""]=r};return Object.entries(an).forEach(([a,r])=>{t(a)[""]=r}),[...Object.entries(J),...Object.entries(ln)].forEach(([a,r])=>{n(a,r)}),un.forEach(a=>{const r=t(a)[""][0];Object.entries(J).forEach(([i,o])=>{n(a+i,r+o)}),Object.entries(cn).forEach(([i,o])=>{n(a+i,r+o)})}),Object.entries(dn).forEach(([a,r])=>{Object.entries(J).forEach(([i,o])=>{n(a+i,r+o[1])}),n(`${a}ぃ`,`${r}yi`),n(`${a}ぇ`,`${r}e`)}),e.っ=Ee(e),Object.entries(xn).forEach(([a,r])=>{n(a,r)}),on.forEach(a=>{n(`ん${a}`,`n'${t(a)[""]}`)}),Object.freeze(JSON.parse(JSON.stringify(e)))}function Ee(e){return Object.entries(e).reduce((t,[n,a])=>{if(n)t[n]=Ee(a);else{const r=a.charAt(0);t[n]=Object.keys(le).includes(r)?le[r]+a:a}return t},{})}he((e,t)=>{let n=mn(e);return t&&(n=je(n,t)),n},_);function pn(e,t){const n=e?e.length:0,a=t?t.length:0;if(n===0)return a;if(a===0)return n;const r=Array.from({length:n+1},()=>Array(a+1).fill(0));for(let i=0;i<=n;i++)r[i][0]=i;for(let i=0;i<=a;i++)r[0][i]=i;for(let i=1;i<=n;i++)for(let o=1;o<=a;o++){const c=e[i-1]===t[o-1]?0:1;r[i][o]=Math.min(r[i-1][o]+1,r[i][o-1]+1,r[i-1][o-1]+c)}return r[n][a]}function ue(e,t){const n=e.trim().toLowerCase();if(!t)return n==="";const a=t.trim().toLowerCase();if(n===a)return!0;const r=a.replace(/\s*\([^)]*\)/g,"").trim().split(/[,/]/).map(c=>c.trim()).filter(Boolean),i=a.replace(/[()]/g,"").trim().split(/[,/]/).map(c=>c.trim()).filter(Boolean),o=[...new Set([...r,...i])];return o.some(c=>n===c)?!0:o.some(c=>{const l=pn(n,c),u=Math.max(n.length,c.length);return u<=4?l<=1:u<=10?l<=2:l<=Math.floor(u*.2)})}const gn={"jp-en":{questionLabel:"Translate to English",answerPlaceholder:"Meaning",inputLang:"en",inputMode:"text",colorClass:"border-review-jp-en"},"kanji-read":{questionLabel:"What is the reading?",answerPlaceholder:"ひらがな",inputLang:"ja",inputMode:"text",colorClass:"border-review-kanji-read"}},Ae=({item:e,quizType:t,onComplete:n})=>{const[a,r]=h.useState(""),[i,o]=h.useState(!1),[c,l]=h.useState(!1),u=h.useRef(null),d=h.useRef(null);h.useEffect(()=>{const g=u.current;if(g&&(g.focus(),t==="kanji-read"))return nn(g,{IMEMode:"toHiragana"}),()=>{sn(g)}},[t]),h.useEffect(()=>{var g;i&&((g=d.current)==null||g.focus())},[i]);const{content:x}=e,{questionLabel:w,answerPlaceholder:M,inputLang:T,colorClass:A}=gn[t],U=h.useMemo(()=>s.jsx("span",{className:"font-japanese",children:x.japanese_segment}),[x]),L=()=>{var C;const g=((C=u.current)==null?void 0:C.value)||"";if(!g.trim())return;r(g);let E=!1;switch(t){case"jp-en":E=ue(g,x.english_equivalent);break;case"kanji-read":E=x.reading.split(/[,/]/).map(y=>y.trim()).filter(Boolean).some(y=>ue(g,y));break}l(E),o(!0)},S=g=>{g.key==="Enter"&&(g.preventDefault(),i?n(c):setTimeout(L,0))},P=g=>{g.key==="Enter"&&(g.preventDefault(),n(c))},z=c?"bg-accent-subtle-bg":"bg-destructive-subtle-bg",R=c?"border-accent":"border-destructive",D=c?"text-accent-text":"text-destructive-subtle-text";return s.jsxs("div",{className:`relative w-full flex flex-col justify-center items-center p-6 bg-surface-soft rounded-2xl shadow-lg border-t-4 ${A}`,children:[s.jsx("div",{className:"absolute top-3 left-3 text-xs font-bold uppercase tracking-wider opacity-60",style:{color:`var(--color-review-${t}-rgb)`},children:w}),s.jsx("div",{className:"text-5xl md:text-7xl font-semibold text-center text-text-primary p-4 mb-4",children:U}),i?s.jsxs("div",{className:`w-full text-center p-4 rounded-lg border-2 animate-fade-in ${z} ${R}`,children:[s.jsxs("div",{className:"flex justify-center items-center gap-2 mb-4",children:[c?s.jsx("i",{className:"bi bi-check-circle-fill text-2xl text-accent-text"}):s.jsx("i",{className:"bi bi-x-circle-fill text-2xl text-destructive-subtle-text"}),s.jsx("p",{className:`text-xl font-bold ${D}`,children:c?"Correct!":"Incorrect"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-2xl font-japanese font-semibold",children:[s.jsx(Y,{base:x.japanese_segment,reading:x.reading}),s.jsx(Ke,{text:x.japanese_segment})]}),s.jsx("p",{className:"text-text-secondary text-lg",children:x.english_equivalent})]}),!c&&s.jsxs("p",{className:"mt-2",children:["Your answer: ",s.jsx("span",{className:"font-semibold",children:a})]}),s.jsx("button",{ref:d,onKeyDown:P,onClick:()=>n(c),className:"mt-6 w-full btn-primary text-lg",children:"Continue"})]}):s.jsxs("div",{className:"w-full max-w-sm flex flex-col items-center gap-4",children:[s.jsx("input",{ref:u,type:"text",lang:T,value:a,onChange:g=>r(g.target.value),onKeyDown:S,placeholder:M,className:"w-full text-center text-xl p-3 rounded-lg border-2 border-border bg-surface focus:border-primary focus:ring-primary transition",autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),s.jsx("button",{onClick:L,className:"btn-secondary px-8 py-2 text-base",children:"Check"})]})]})},bn=({onExit:e})=>s.jsx("div",{className:"w-full flex justify-end mb-4",children:s.jsx("button",{"data-action":"review-exit",onClick:e,title:"Exit Review Session",className:"btn-ghost",children:s.jsx("i",{className:"bi bi-x-lg text-2xl"})})}),jn=({item:e,onReview:t,cardKey:n})=>{const{content:a}=e,[r,i]=h.useState(!1);h.useEffect(()=>{i(!1)},[e,n]);const{original_sentence:o,constituent_text:c,pattern_name:l,explanation:u}=a,d=o&&c?o.replace(c,`<span class="bg-accent-subtle-bg text-accent-text px-2 py-1 rounded">${c}</span>`):l,x=s.jsx("div",{className:"text-2xl md:text-3xl font-japanese font-medium text-center text-text-primary p-8 leading-relaxed",dangerouslySetInnerHTML:{__html:d}}),w=s.jsxs("div",{className:"text-center space-y-6",children:[s.jsx("div",{className:"text-xl md:text-2xl font-japanese font-medium text-text-primary leading-relaxed p-4 bg-surface rounded-xl border border-border-subtle",dangerouslySetInnerHTML:{__html:d}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-japanese font-semibold mb-2 text-accent",children:l}),s.jsx("p",{className:"text-lg text-text-secondary",children:u})]})]});return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative w-full min-h-[20rem] flex flex-col justify-center items-center p-6 bg-surface-soft rounded-2xl shadow-lg",children:r?w:x}),r?s.jsx("div",{className:"mt-8 w-full",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-center text-text-muted mb-4 text-sm",children:"How well did you remember?"}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4",children:[s.jsxs("button",{onClick:()=>t(1),"data-action":"review-quality-1",className:"text-lg font-bold py-4 px-4 rounded-xl bg-destructive-subtle-bg text-destructive-subtle-text hover:bg-destructive-subtle-bg/80 focus-ring transition",children:["Again ",s.jsx("span",{className:"text-xs font-normal",children:"(1)"})]}),s.jsxs("button",{onClick:()=>t(2),"data-action":"review-quality-2",className:"text-lg font-bold py-4 px-4 rounded-xl bg-pos-auxiliary-bg text-pos-auxiliary-text hover:opacity-80 focus-ring transition",children:["Hard ",s.jsx("span",{className:"text-xs font-normal",children:"(2)"})]}),s.jsxs("button",{onClick:()=>t(3),"data-action":"review-quality-3",className:"text-lg font-bold py-4 px-4 rounded-xl bg-surface-hover text-text-secondary hover:bg-surface-hover/80 focus-ring transition",children:["Good ",s.jsx("span",{className:"text-xs font-normal",children:"(3)"})]}),s.jsxs("button",{onClick:()=>t(4),"data-action":"review-quality-4",className:"text-lg font-bold py-4 px-4 rounded-xl bg-accent-subtle-bg text-accent-text hover:bg-accent-subtle-bg/80 focus-ring transition",children:["Easy ",s.jsx("span",{className:"text-xs font-normal",children:"(4)"})]})]})]})}):s.jsx("div",{className:"mt-8 w-full flex items-center",children:s.jsxs("button",{onClick:()=>i(!0),"data-action":"review-show-answer",className:"w-full max-w-xs mx-auto btn-primary text-lg",children:["Show Answer ",s.jsx("span",{className:"text-sm font-normal text-primary-text/80 ml-2",children:"(Space)"})]})})]})},Nn=({item:e,quizType:t,onReview:n,onExit:a,cardKey:r})=>s.jsxs("div",{className:"w-full max-w-2xl mx-auto flex flex-col items-center px-4",children:[s.jsx(bn,{onExit:a}),e.type==="word"&&t?s.jsx(Ae,{item:e,quizType:t,onComplete:i=>n(i)},r):s.jsx(jn,{item:e,onReview:i=>n(i),cardKey:r},r)]}),wn=e=>{if(e===null||!isFinite(e))return"";const t=Date.now(),n=e-t;if(n<=0)return"soon";const a=n/(1e3*60),r=a/60,i=r/24;return i>=2?`in ${Math.round(i)} days`:i>=1?"tomorrow":r>=2?`in ${Math.round(r)} hours`:r>=1?"in an hour":a>=2?`in ${Math.round(a)} minutes`:"in a minute"},vn=({learnedCount:e,reviewedCount:t,onManage:n,onExit:a,onRestart:r,hasMoreItems:i,nextReviewTimestamp:o})=>{const l=e+t>0,u=wn(o),d=i?"Round Complete!":l?"Session Complete!":"All Caught Up!",x=l?s.jsxs("div",{className:"mt-2 text-text-secondary space-y-1",children:[s.jsxs("p",{children:["Great work! You learned ",s.jsx("strong",{className:"text-primary",children:e})," new items and reviewed ",s.jsx("strong",{className:"text-accent",children:t})," items."]}),i&&s.jsx("p",{children:"There are more items ready for your next round."}),!i&&u&&s.jsxs("p",{children:["Your next review is due ",u,"."]})]}):s.jsxs("p",{className:"mt-2 text-text-secondary",children:["There are no new words or reviews due right now.",!i&&u&&` Your next review is due ${u}.`]});return s.jsxs("div",{className:"text-center py-16 px-6 max-w-lg mx-auto",children:[s.jsx("i",{className:"bi bi-check-circle text-6xl text-accent mx-auto mb-6","aria-hidden":"true"}),s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:d}),x,s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row items-center justify-center gap-4",children:[i?s.jsx("button",{onClick:r,className:"btn-primary",children:"Start Next Round"}):s.jsx("button",{onClick:a,className:"btn-secondary",children:"Back to Analyzer"}),s.jsx("button",{onClick:n,className:"btn-ghost",children:"Manage Deck"})]})]})},yn=({onManage:e,onExit:t})=>s.jsxs("div",{className:"text-center py-16 px-6 max-w-lg mx-auto",children:[s.jsx("i",{className:"bi bi-journal-bookmark text-6xl text-text-muted/50 mx-auto mb-6","aria-hidden":"true"}),s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Review Deck is Empty"}),s.jsx("p",{className:"mt-2 text-text-secondary",children:'Add items by clicking the "Add to Deck" button on words or grammar patterns.'}),s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row items-center justify-center gap-4",children:[s.jsx("button",{onClick:t,className:"btn-secondary",children:"Back to Analyzer"}),s.jsx("button",{onClick:e,className:"btn-ghost",children:"Manage Deck"})]})]}),En=({item:e,onDelete:t})=>{const[n,a]=Oe.useState(!1);let r,i;if(e.type==="word"){const{japanese_segment:o,english_equivalent:c,reading:l,category:u,pitch_accent:d}=e.content;r=s.jsxs(s.Fragment,{children:[s.jsx("strong",{className:"font-japanese text-lg",children:o})," ",s.jsxs("span",{className:"text-text-muted",children:["- ",c]})]}),i=s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"relative inline-block text-xl font-japanese font-semibold p-2 bg-surface-subtle rounded-lg",style:{paddingTop:"22px"},children:[s.jsx(Ue,{reading:l,pitchAccent:d}),s.jsx(Y,{base:o,reading:l,interactiveKanji:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3 text-sm mt-2",children:[s.jsxs("div",{children:[s.jsx("strong",{className:"font-medium text-text-secondary block",children:"Meaning"}),s.jsx("p",{className:"text-text-primary",children:c})]}),s.jsxs("div",{children:[s.jsx("strong",{className:"font-medium text-text-secondary block",children:"Category"}),s.jsx("p",{className:"text-text-primary capitalize",children:u.replace(/_/g," ").toLowerCase()})]}),s.jsxs("div",{className:"sm:col-span-2",children:[s.jsx("strong",{className:"font-medium text-text-secondary block",children:"Reading"}),s.jsx("p",{className:"text-text-primary font-japanese",children:l})]})]})]})}else{const{pattern_name:o,constituent_text:c,explanation:l}=e.content;c?r=s.jsxs(s.Fragment,{children:[s.jsx("strong",{className:"font-japanese text-lg",children:c})," ",s.jsxs("span",{className:"text-text-muted",children:["- ",o]})]}):r=s.jsx("strong",{className:"font-japanese text-lg",children:o}),i=s.jsx("p",{className:"text-sm text-text-secondary",children:l})}return s.jsxs("li",{className:"deck-item bg-surface-soft rounded-lg shadow-sm transition-shadow hover:shadow-md",children:[s.jsxs("div",{className:"p-4 flex justify-between items-center cursor-pointer",onClick:()=>a(!n),children:[s.jsx("div",{className:"flex-grow pr-2",children:r}),s.jsxs("div",{className:"flex items-center flex-shrink-0 ml-4",children:[s.jsx("button",{onClick:o=>{o.stopPropagation(),t(e.id)},title:"Delete Item",className:"btn-ghost p-2 text-destructive/70 hover:bg-destructive-subtle-bg hover:text-destructive",children:s.jsx("i",{className:"bi bi-trash3 text-xl"})}),s.jsx("i",{className:`bi bi-chevron-down text-xl text-text-muted transition-transform ${n?"rotate-180":""}`})]})]}),n&&s.jsx("div",{className:"p-4 border-t border-border-subtle bg-surface",children:i})]})},An=({items:e,onDelete:t,onExit:n,title:a})=>s.jsxs("div",{className:"w-full max-w-3xl mx-auto p-4 md:p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-text-primary truncate pr-4",title:a,children:[a," (",e.length," items)"]}),s.jsx("button",{onClick:n,title:"Back to Analyzer",className:"btn-secondary flex-shrink-0",children:"Back"})]}),e.length===0?s.jsx("p",{className:"text-center text-text-muted p-8",children:"Your deck is empty."}):s.jsx("ul",{className:"space-y-3",children:e.map(r=>s.jsx(En,{item:r,onDelete:t},r.id))})]}),Sn=({item:e})=>{if(e.type==="word")return s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl font-japanese font-semibold mb-4 pb-4 border-b border-border-subtle",children:s.jsx(Y,{base:e.content.japanese_segment,reading:e.content.reading||""})}),s.jsx("div",{className:"text-lg text-text-secondary mb-6",children:e.content.english_equivalent}),s.jsxs("div",{className:"text-sm space-y-2 text-text-muted",children:[s.jsxs("p",{children:[s.jsx("strong",{className:"font-medium text-text-secondary",children:"Category:"})," ",e.content.category.replace(/_/g," ").replace(/-/g,", ")]}),s.jsxs("p",{children:[s.jsx("strong",{className:"font-medium text-text-secondary",children:"Reading:"})," ",e.content.reading]})]})]});const{original_sentence:t,constituent_text:n,pattern_name:a,explanation:r}=e.content,i=t&&n?t.replace(n,`<span class="bg-accent-subtle-bg text-accent-text px-2 py-1 rounded">${n}</span>`):a;return s.jsxs("div",{className:"text-center",children:[(t||n)&&s.jsx("div",{className:"text-xl md:text-2xl font-japanese font-medium text-center text-text-primary p-2 leading-relaxed mb-6 pb-6 border-b border-border-subtle",dangerouslySetInnerHTML:{__html:i}}),s.jsx("div",{className:"text-3xl font-japanese font-semibold mb-4 text-accent",children:a}),s.jsx("p",{className:"text-lg text-text-secondary",children:r})]})},Cn=({item:e,onExit:t,currentIndex:n,totalInChunk:a,onNext:r,onPrev:i,onStartQuiz:o})=>{const c=n===0,l=n===a-1;return s.jsxs("div",{className:"w-full max-w-2xl mx-auto flex flex-col items-center px-4",children:[s.jsxs("div",{className:"w-full flex justify-between items-center mb-4",children:[s.jsxs("span",{className:"text-sm font-semibold text-text-muted px-3 py-1 bg-surface rounded-full",children:[n+1," / ",a]}),s.jsx("button",{onClick:t,title:"Exit Review Session",className:"btn-ghost",children:s.jsx("i",{className:"bi bi-x-lg text-2xl"})})]}),s.jsx("div",{className:"relative w-full min-h-[20rem] flex flex-col justify-center items-center p-6 bg-surface-soft rounded-2xl shadow-lg",children:s.jsx(Sn,{item:e})}),s.jsxs("div",{className:"mt-8 w-full flex items-center justify-center gap-4",children:[s.jsx("button",{onClick:i,disabled:c,className:"p-4 rounded-full bg-surface-hover text-text-secondary disabled:opacity-50 transition",children:s.jsx("i",{className:"bi bi-arrow-left text-2xl"})}),l?s.jsx("button",{onClick:o,className:"btn-primary text-xl px-10 py-4",children:"Start Quiz!"}):s.jsx("button",{onClick:r,className:"p-4 rounded-full bg-surface-hover text-text-secondary transition",children:s.jsx("i",{className:"bi bi-arrow-right text-2xl"})})]})]})},In=({item:e,onAnswer:t,cardKey:n})=>{const[a,r]=h.useState(!1);h.useEffect(()=>{r(!1)},[e,n]);const{content:i}=e,{original_sentence:o,constituent_text:c,pattern_name:l,explanation:u}=i,d=o&&c?o.replace(c,`<strong class="text-accent-text">${c}</strong>`):l,x=s.jsxs("div",{className:"text-xl md:text-2xl font-japanese font-medium text-center text-text-primary p-4 leading-relaxed",children:[s.jsx("p",{className:"mb-2 text-sm text-text-muted",children:"In sentence:"}),s.jsx("div",{dangerouslySetInnerHTML:{__html:d}}),s.jsxs("p",{className:"mt-6 text-base text-text-secondary",children:["What does ",s.jsx("strong",{className:"text-accent-text",children:l})," mean?"]})]}),w=s.jsxs("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"text-lg font-japanese text-text-primary p-4 leading-relaxed bg-surface rounded-md border border-border-subtle",dangerouslySetInnerHTML:{__html:d}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-japanese font-semibold mb-2 text-accent",children:l}),s.jsx("p",{className:"text-base text-text-secondary",children:u})]})]});return s.jsxs("div",{className:"w-full flex flex-col items-center",children:[s.jsx("div",{className:"relative w-full min-h-[15rem] flex flex-col justify-center items-center p-6 bg-surface-soft rounded-2xl shadow-lg border-t-4 border-pos-conjunction-bg/50",children:a?w:x}),s.jsx("div",{className:"mt-6 w-full max-w-sm",children:a?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("button",{onClick:()=>t(!1),className:"text-lg font-bold py-3 px-4 rounded-xl bg-destructive-subtle-bg text-destructive-subtle-text hover:bg-destructive-subtle-bg/80 focus-ring transition",children:"Forgot"}),s.jsx("button",{onClick:()=>t(!0),className:"text-lg font-bold py-3 px-4 rounded-xl bg-accent-subtle-bg text-accent-text hover:bg-accent-subtle-bg/80 focus-ring transition",children:"Remembered"})]}):s.jsx("button",{onClick:()=>r(!0),className:"w-full btn-primary text-lg",children:"Show Answer"})})]})},Tn=({quizQuestion:e,onExit:t,onAnswer:n,remainingCount:a,cardKey:r})=>{const{item:i,quizType:o}=e;return s.jsxs("div",{className:"w-full max-w-2xl mx-auto flex flex-col items-center px-4",children:[s.jsxs("div",{className:"w-full flex justify-between items-center mb-4",children:[s.jsxs("span",{className:"text-sm font-semibold text-text-muted px-3 py-1 bg-surface rounded-full",children:[a," to go"]}),s.jsx("button",{onClick:t,title:"Exit Review Session",className:"btn-ghost",children:s.jsx("i",{className:"bi bi-x-lg text-2xl"})})]}),o?s.jsx(Ae,{item:i,quizType:o,onComplete:c=>n(e,c)},r):s.jsx(In,{item:i,onAnswer:c=>n(e,c),cardKey:r},r)]})},Rn=({onContinue:e,onExit:t,hasMoreChunks:n,hasReviews:a})=>{const r=!n&&!a,i=r?"Session Complete!":"Chunk Complete!",o=r?"You've finished all learning and review items for now.":"Great work! You've learned this set of items.",c=r?"See Summary":"Continue";return s.jsxs("div",{className:"text-center py-16 px-6 max-w-lg mx-auto flex flex-col h-full justify-center",children:[s.jsx("i",{className:"bi bi-patch-check-fill text-6xl text-accent mx-auto mb-6","aria-hidden":"true"}),s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:i}),s.jsx("p",{className:"mt-2 text-text-secondary",children:o}),s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row items-center justify-center gap-4",children:[s.jsx("button",{onClick:t,className:"btn-secondary",children:"Finish for Now"}),s.jsx("button",{onClick:e,className:`btn-primary text-lg ${r?"px-8 py-3":""}`,children:c})]})]})},_n=({newCount:e,reviewCount:t,onStartLearning:n,onStartReviewing:a,onExit:r})=>{const i=e>0,o=t>0;return s.jsxs("div",{className:"text-center py-6 px-6 max-w-lg mx-auto flex flex-col h-full",children:[s.jsx("div",{className:"w-full flex justify-end mb-4",children:s.jsx("button",{"data-action":"review-exit",onClick:r,title:"Exit Review Session",className:"btn-ghost",children:s.jsx("i",{className:"bi bi-x-lg text-2xl"})})}),s.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center",children:[s.jsx("i",{className:"bi bi-play-circle text-6xl text-accent mx-auto mb-6","aria-hidden":"true"}),s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Ready for your session?"}),s.jsxs("div",{className:"mt-8 flex flex-col gap-4 w-full max-w-xs",children:[i&&s.jsxs("button",{onClick:n,className:"btn-primary text-lg font-semibold px-8 py-3",children:["Learn ",e," new item",e>1?"s":""]}),o&&s.jsxs("button",{onClick:a,className:`${i?"btn-secondary":"btn-primary"} text-lg font-semibold px-8 py-3`,children:["Review ",t," due item",t>1?"s":""]})]})]})]})},de=5,Mn=()=>{const{state:e,dispatch:t}=ke(),{state:n}=Me(),{showConfirmation:a}=Le(),[r,i]=h.useState(0),[o,c]=h.useState("LOADING"),[l,u]=h.useState("STUDY"),[d,x]=h.useState({newItemsForSession:[],allDueReviewItems:[]}),[w,M]=h.useState([]),[T,A]=h.useState([]),[U,L]=h.useState(new Set),[S,P]=h.useState(0),[z,R]=h.useState(0),[D,g]=h.useState([]),[E,C]=h.useState({learned:0,reviewed:0}),X=h.useMemo(()=>{const m=e.reviewDeck.filter(b=>e.currentTextEntryId?b.textEntryId===e.currentTextEntryId||!b.textEntryId:!0).filter(b=>b.srsStage>0&&b.srsStage<9);if(m.length===0)return null;const p=m.map(b=>b.nextReviewDate);return Math.min(...p)},[e.reviewDeck,e.currentTextEntryId]),y=h.useCallback(()=>{const f=Date.now(),m=e.reviewDeck.filter(N=>e.currentTextEntryId?N.textEntryId===e.currentTextEntryId||!N.textEntryId:!0),p=m.filter(N=>N.srsStage===0).sort((N,$)=>N.addedAt-$.addedAt),b=m.filter(N=>N.srsStage>0&&N.nextReviewDate<=f).sort((N,$)=>N.nextReviewDate-$.nextReviewDate),j=p.slice(0,n.newWordsPerDay);x({newItemsForSession:j,allDueReviewItems:b});const v=[];for(let N=0;N<j.length;N+=de)v.push(j.slice(N,N+de));M(v),m.length===0?c("EMPTY"):j.length===0&&b.length===0?c("COMPLETE"):c("START")},[e.reviewDeck,e.currentTextEntryId,n.newWordsPerDay]);h.useEffect(()=>{(o==="LOADING"||o!=="LEARNING"&&o!=="REVIEW"&&o!=="MANAGE")&&(P(0),R(0),g([]),A([]),i(0),C({learned:0,reviewed:0}),u("STUDY"),y())},[o,y]),h.useEffect(()=>{o==="REVIEW"&&T.length===0&&E.reviewed>0&&y()},[T,o,E.reviewed,y]);const I=()=>{e.currentTextEntryId?t({type:"SET_VIEW",payload:De.Reader}):t({type:"RESET_VIEW"})},Se=()=>{w.length>0?c("LEARNING"):y()},ee=()=>{if(d.allDueReviewItems.length>0){L(new Set);const f=d.allDueReviewItems.map(m=>{let p;if(m.type==="word"){const b=["jp-en"];/[一-龯]/.test(m.content.japanese_segment)&&b.push("kanji-read"),p=b[Math.floor(Math.random()*b.length)]}return{item:m,quizType:p}});A(f),c("REVIEW")}else y()},Ce=()=>{const f=w[S];if(f){const m=[];f.forEach(p=>{p.type==="word"?(m.push({item:p,quizType:"jp-en"}),/[一-龯]/.test(p.content.japanese_segment)&&m.push({item:p,quizType:"kanji-read"})):p.type==="grammar"&&m.push({item:p})}),g(m.sort(()=>.5-Math.random())),u("QUIZ")}},Ie=(f,m)=>{const p=[...D],b=p.shift();if(m||p.push(b),p.length===0){const j=w[S];j.forEach(v=>{const N=B(v,3);t({type:"ADD_OR_UPDATE_REVIEW_ITEM",payload:N})}),C(v=>({...v,learned:v.learned+j.length})),u("CHUNK_COMPLETE")}else g(p);i(j=>j+1)},Te=()=>{S<w.length-1?(P(f=>f+1),R(0),u("STUDY")):d.allDueReviewItems.length>0?ee():y()},Re=f=>{const m=T[0];if(!m)return;const{item:p}=m;let b;if(typeof f=="boolean"?b=f?3:1:b=f,b===1){if(!U.has(p.id)){const j=B(p,b);t({type:"ADD_OR_UPDATE_REVIEW_ITEM",payload:j}),L(v=>new Set(v).add(p.id))}A(j=>[...j.slice(1),m])}else if(U.has(p.id))C(j=>({...j,reviewed:j.reviewed+1})),A(j=>j.slice(1));else{const j=B(p,b);t({type:"ADD_OR_UPDATE_REVIEW_ITEM",payload:j}),C(v=>({...v,reviewed:v.reviewed+1})),A(v=>v.slice(1))}i(j=>j+1)},_e=f=>{a("Are you sure you want to delete this item?",()=>{t({type:"REMOVE_REVIEW_ITEM",payload:f})},{confirmText:"Delete"})},te=h.useMemo(()=>e.history.find(f=>f.id===e.currentTextEntryId),[e.history,e.currentTextEntryId]);switch(o){case"LOADING":return s.jsx("div",{className:"p-6 text-center text-text-muted",children:"Loading review session..."});case"START":return s.jsx(_n,{newCount:d.newItemsForSession.length,reviewCount:d.allDueReviewItems.length,onStartLearning:Se,onStartReviewing:ee,onExit:I});case"LEARNING":{const f=w[S];if(!f)return y(),null;switch(l){case"STUDY":return s.jsx(Cn,{item:f[z],onExit:I,currentIndex:z,totalInChunk:f.length,onNext:()=>R(m=>m+1),onPrev:()=>R(m=>m-1),onStartQuiz:Ce});case"QUIZ":{const m=D[0];return m?s.jsx(Tn,{quizQuestion:m,onExit:I,onAnswer:Ie,remainingCount:D.length,cardKey:r}):null}case"CHUNK_COMPLETE":return s.jsx(Rn,{onContinue:Te,onExit:I,hasMoreChunks:S<w.length-1,hasReviews:d.allDueReviewItems.length>0})}}case"REVIEW":{const f=T[0];return f?s.jsx(Nn,{item:f.item,quizType:f.quizType,onReview:Re,onExit:I,cardKey:r}):s.jsx("div",{className:"p-6 text-center text-text-muted",children:"Loading next review..."})}case"COMPLETE":{const f=d.newItemsForSession.length>0||d.allDueReviewItems.length>0;return s.jsx(vn,{learnedCount:E.learned,reviewedCount:E.reviewed,onManage:()=>c("MANAGE"),onExit:I,nextReviewTimestamp:X,hasMoreItems:f,onRestart:y})}case"EMPTY":return s.jsx(yn,{onManage:()=>c("MANAGE"),onExit:I});case"MANAGE":{const f=e.reviewDeck.filter(p=>e.currentTextEntryId?p.textEntryId===e.currentTextEntryId||!p.textEntryId:!0),m=e.currentTextEntryId&&te?`Deck for "${te.title}"`:"Full Review Deck";return s.jsx("div",{className:"flex-grow min-h-0 overflow-y-auto no-scrollbar",children:s.jsx(An,{items:f,onDelete:_e,onExit:y,title:m})})}default:return s.jsx("div",{className:"p-6 text-center text-text-muted",children:"An unexpected error occurred."})}};export{Mn as default};
