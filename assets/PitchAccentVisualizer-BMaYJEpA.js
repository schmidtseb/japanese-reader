import{j as t,d as O,r as h,c as T,R as y,a as w}from"./index.prod-BX_X32YV.js";import{e as _}from"./gemini-BzDqQZuT.js";const B=({text:l,title:e="Read aloud"})=>t.jsx("button",{className:"tts-button btn-ghost p-1 text-text-muted hover:text-text-primary",title:e,onClick:s=>{s.stopPropagation(),O(l)},children:t.jsx("i",{className:"bi bi-volume-up text-base"})}),E=5,P=({error:l,onRetry:e})=>{const[s,c]=h.useState(!1),[d,n]=h.useState(0),i=(l==null?void 0:l.message)||"An unknown error occurred.";h.useEffect(()=>{const u=/rate limit|429/i.test(i);if(c(u),u){n(E);const x=setInterval(()=>{n(m=>m<=1?(clearInterval(x),0):m-1)},1e3);return()=>clearInterval(x)}else n(0)},[i]);const a=()=>{e&&(s&&n(E),e())},r=s?"Too many requests":"API Error",o=s?"You are analyzing sentences too quickly. Please wait a moment before trying again.":i;return t.jsx("div",{role:"alert",className:"p-4 bg-destructive-subtle-bg border-l-4 border-destructive rounded-r-lg shadow-md my-4 transition-all duration-300",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("i",{className:"bi bi-x-circle-fill text-xl text-destructive","aria-hidden":"true"})}),t.jsxs("div",{className:"ml-3 flex-1",children:[t.jsx("p",{className:"text-sm font-semibold text-destructive-subtle-text",children:r}),o&&t.jsx("div",{className:"mt-2 text-sm text-destructive-subtle-text/80",children:t.jsx("p",{children:o})}),e&&t.jsx("button",{onClick:a,disabled:d>0,className:"mt-3 text-xs font-semibold px-2 py-1 rounded-md border border-destructive-subtle-text text-destructive-subtle-text hover:bg-destructive-subtle-text/10 transition disabled:opacity-50 disabled:cursor-wait",children:d>0?`Try Again in ${d}s`:"Try Again"})]})]})})},L=({kanji:l})=>{const{data:e,isLoading:s,error:c,execute:d}=_(),{dispatch:n,state:i}=T();return h.useEffect(()=>{d(l)},[l,d]),h.useEffect(()=>{i.bottomSheet.visible&&(e?n({type:"SET_BOTTOM_SHEET_TITLE",payload:`Details for ${e.kanji}`}):s||n({type:"SET_BOTTOM_SHEET_TITLE",payload:`Details for ${l}`}))},[e,l,s,n,i.bottomSheet.visible]),s&&!e?t.jsx("div",{className:"flex items-center justify-center p-8 min-h-[200px]",children:t.jsx("i",{className:"bi bi-arrow-repeat text-3xl text-text-muted animate-spin"})}):c?t.jsx(P,{error:c,onRetry:()=>d(l)}):e?t.jsxs("div",{className:"p-2 space-y-6",children:[t.jsxs("div",{className:"text-center pb-4 border-b border-border-subtle",children:[t.jsx("h3",{className:"text-6xl font-japanese font-bold text-primary",children:e.kanji}),t.jsx("p",{className:"text-xl text-text-secondary mt-2",children:e.meaning})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-center text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-text-muted uppercase text-xs tracking-wider",children:"On'yomi"}),t.jsx("div",{className:"text-lg font-japanese mt-1",children:e.onyomi||"–"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-text-muted uppercase text-xs tracking-wider",children:"Kun'yomi"}),t.jsx("div",{className:"text-lg font-japanese mt-1",children:e.kunyomi||"–"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-text-muted uppercase text-xs tracking-wider",children:"JLPT"}),t.jsx("div",{className:"text-lg font-semibold mt-1",children:e.jlpt_level})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-text-secondary mb-3 text-sm",children:"Example Words"}),t.jsx("ul",{className:"space-y-4",children:e.example_words.map((a,r)=>t.jsxs("li",{className:"flex flex-col",children:[t.jsx("a",{href:`https://jisho.org/search/${encodeURIComponent(a.word)}`,target:"_blank",rel:"noopener noreferrer",className:"text-lg font-jp text-text-primary hover:text-accent transition",onClick:o=>o.stopPropagation(),children:t.jsx(R,{base:a.word,reading:a.reading})}),t.jsx("span",{className:"text-sm text-text-muted -mt-1",children:a.meaning})]},r))})]})]}):t.jsx("div",{className:"p-4 text-center text-text-muted",children:"No details found."})},v=y.memo(function({text:e}){const{state:s,dispatch:c}=T(),d=(i,a)=>{i.stopPropagation();const r=i.currentTarget,o=t.jsx(L,{kanji:a}),u=`Details for ${a}`;if(window.innerWidth<768)s.bottomSheet.visible&&s.bottomSheet.targetElement===r?c({type:"HIDE_BOTTOM_SHEET"}):c({type:"SHOW_BOTTOM_SHEET",payload:{content:{title:u,body:o},targetElement:r}});else{const x=r.getBoundingClientRect(),m={top:x.bottom+10,left:x.left+x.width/2};c({type:"PIN_TOOLTIP",payload:{content:o,position:m,targetElement:r}})}},n=h.useMemo(()=>e.split("").map((i,a)=>/[一-龯]/.test(i)?t.jsx("button",{onClick:r=>d(r,i),className:"underline decoration-text-muted/50 decoration-1 underline-offset-2 hover:text-accent hover:decoration-accent transition",children:i},a):t.jsx("span",{children:i},a)),[e]);return t.jsx(t.Fragment,{children:n})}),b=l=>/[一-龯]/.test(l),R=y.memo(function({base:e,reading:s,interactiveKanji:c=!1}){const{state:d}=w(),{showFurigana:n}=d,i=h.useMemo(()=>{if(!n||!s||e===s)return c?t.jsx(v,{text:e}):e;const a=[];let r=0,o=0;for(;o<e.length;)if(b(e[o])){let u="",x=o;for(;x<e.length&&b(e[x]);)u+=e[x],x++;let m="",p=x;for(;p<e.length&&!b(e[p]);)m+=e[p],p++;let f="",j=m?s.indexOf(m,r):-1;if(m&&j===r){const g=s.indexOf(m,r+1);g!==-1&&(j=g)}if(j!==-1)f=s.substring(r,j);else{const g=e.substring(o),N=s.substring(r),S=g.split("").filter(I=>!b(I)).length;f=N.slice(0,N.length-S)}const k=c?t.jsx(v,{text:u}):u;a.push(t.jsxs("ruby",{children:[k,t.jsx("rt",{className:"text-xs text-text-muted select-none",children:f})]},o)),r+=f.length,o+=u.length}else a.push(e[o]),r<s.length&&e[o]===s[r]&&r++,o++;return a},[e,s,c,n]);return n?t.jsx(t.Fragment,{children:i}):c?t.jsx(v,{text:e}):e}),A=y.memo(function({reading:e,pitchAccent:s}){const{state:c}=w();if(!c.showPitchAccent||!e||!s||e.length!==s.length)return null;const d=s.split("").map((n,i)=>({x:100/e.length*(i+.5),y:n==="H"?2:8}));return t.jsxs("svg",{className:"pitch-accent-svg absolute top-0 left-0 w-full h-[14px] overflow-visible pointer-events-none",viewBox:"0 0 100 10",preserveAspectRatio:"none",children:[d.length>1&&t.jsx("polyline",{points:d.map(n=>`${n.x},${n.y}`).join(" "),className:"fill-none stroke-text-muted",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),d.map((n,i)=>t.jsx("circle",{cx:n.x,cy:n.y,r:"1.2",className:"fill-text-muted"},i))]})});export{P as E,R as F,A as P,B as T};
